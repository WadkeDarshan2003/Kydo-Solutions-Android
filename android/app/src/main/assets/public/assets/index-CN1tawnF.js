(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();function IN(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ex={exports:{}},ku={},tx={exports:{}},Rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sb;function BA(){if(Sb)return Rt;Sb=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),w=Symbol.iterator;function N($){return $===null||typeof $!="object"?null:($=w&&$[w]||$["@@iterator"],typeof $=="function"?$:null)}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},z=Object.assign,L={};function O($,oe,we){this.props=$,this.context=oe,this.refs=L,this.updater=we||D}O.prototype.isReactComponent={},O.prototype.setState=function($,oe){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,oe,"setState")},O.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function le(){}le.prototype=O.prototype;function ge($,oe,we){this.props=$,this.context=oe,this.refs=L,this.updater=we||D}var ae=ge.prototype=new le;ae.constructor=ge,z(ae,O.prototype),ae.isPureReactComponent=!0;var xe=Array.isArray,j=Object.prototype.hasOwnProperty,ie={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function R($,oe,we){var he,ke={},me=null,$e=null;if(oe!=null)for(he in oe.ref!==void 0&&($e=oe.ref),oe.key!==void 0&&(me=""+oe.key),oe)j.call(oe,he)&&!k.hasOwnProperty(he)&&(ke[he]=oe[he]);var pt=arguments.length-2;if(pt===1)ke.children=we;else if(1<pt){for(var at=Array(pt),lt=0;lt<pt;lt++)at[lt]=arguments[lt+2];ke.children=at}if($&&$.defaultProps)for(he in pt=$.defaultProps,pt)ke[he]===void 0&&(ke[he]=pt[he]);return{$$typeof:n,type:$,key:me,ref:$e,props:ke,_owner:ie.current}}function M($,oe){return{$$typeof:n,type:$.type,key:oe,ref:$.ref,props:$.props,_owner:$._owner}}function q($){return typeof $=="object"&&$!==null&&$.$$typeof===n}function U($){var oe={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(we){return oe[we]})}var K=/\/+/g;function V($,oe){return typeof $=="object"&&$!==null&&$.key!=null?U(""+$.key):oe.toString(36)}function Fe($,oe,we,he,ke){var me=typeof $;(me==="undefined"||me==="boolean")&&($=null);var $e=!1;if($===null)$e=!0;else switch(me){case"string":case"number":$e=!0;break;case"object":switch($.$$typeof){case n:case e:$e=!0}}if($e)return $e=$,ke=ke($e),$=he===""?"."+V($e,0):he,xe(ke)?(we="",$!=null&&(we=$.replace(K,"$&/")+"/"),Fe(ke,oe,we,"",function(lt){return lt})):ke!=null&&(q(ke)&&(ke=M(ke,we+(!ke.key||$e&&$e.key===ke.key?"":(""+ke.key).replace(K,"$&/")+"/")+$)),oe.push(ke)),1;if($e=0,he=he===""?".":he+":",xe($))for(var pt=0;pt<$.length;pt++){me=$[pt];var at=he+V(me,pt);$e+=Fe(me,oe,we,at,ke)}else if(at=N($),typeof at=="function")for($=at.call($),pt=0;!(me=$.next()).done;)me=me.value,at=he+V(me,pt++),$e+=Fe(me,oe,we,at,ke);else if(me==="object")throw oe=String($),Error("Objects are not valid as a React child (found: "+(oe==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":oe)+"). If you meant to render a collection of children, use an array instead.");return $e}function ue($,oe,we){if($==null)return $;var he=[],ke=0;return Fe($,he,"","",function(me){return oe.call(we,me,ke++)}),he}function Te($){if($._status===-1){var oe=$._result;oe=oe(),oe.then(function(we){($._status===0||$._status===-1)&&($._status=1,$._result=we)},function(we){($._status===0||$._status===-1)&&($._status=2,$._result=we)}),$._status===-1&&($._status=0,$._result=oe)}if($._status===1)return $._result.default;throw $._result}var Ie={current:null},fe={transition:null},P={ReactCurrentDispatcher:Ie,ReactCurrentBatchConfig:fe,ReactCurrentOwner:ie};function H(){throw Error("act(...) is not supported in production builds of React.")}return Rt.Children={map:ue,forEach:function($,oe,we){ue($,function(){oe.apply(this,arguments)},we)},count:function($){var oe=0;return ue($,function(){oe++}),oe},toArray:function($){return ue($,function(oe){return oe})||[]},only:function($){if(!q($))throw Error("React.Children.only expected to receive a single React element child.");return $}},Rt.Component=O,Rt.Fragment=t,Rt.Profiler=i,Rt.PureComponent=ge,Rt.StrictMode=r,Rt.Suspense=p,Rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,Rt.act=H,Rt.cloneElement=function($,oe,we){if($==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+$+".");var he=z({},$.props),ke=$.key,me=$.ref,$e=$._owner;if(oe!=null){if(oe.ref!==void 0&&(me=oe.ref,$e=ie.current),oe.key!==void 0&&(ke=""+oe.key),$.type&&$.type.defaultProps)var pt=$.type.defaultProps;for(at in oe)j.call(oe,at)&&!k.hasOwnProperty(at)&&(he[at]=oe[at]===void 0&&pt!==void 0?pt[at]:oe[at])}var at=arguments.length-2;if(at===1)he.children=we;else if(1<at){pt=Array(at);for(var lt=0;lt<at;lt++)pt[lt]=arguments[lt+2];he.children=pt}return{$$typeof:n,type:$.type,key:ke,ref:me,props:he,_owner:$e}},Rt.createContext=function($){return $={$$typeof:c,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},$.Provider={$$typeof:l,_context:$},$.Consumer=$},Rt.createElement=R,Rt.createFactory=function($){var oe=R.bind(null,$);return oe.type=$,oe},Rt.createRef=function(){return{current:null}},Rt.forwardRef=function($){return{$$typeof:u,render:$}},Rt.isValidElement=q,Rt.lazy=function($){return{$$typeof:b,_payload:{_status:-1,_result:$},_init:Te}},Rt.memo=function($,oe){return{$$typeof:g,type:$,compare:oe===void 0?null:oe}},Rt.startTransition=function($){var oe=fe.transition;fe.transition={};try{$()}finally{fe.transition=oe}},Rt.unstable_act=H,Rt.useCallback=function($,oe){return Ie.current.useCallback($,oe)},Rt.useContext=function($){return Ie.current.useContext($)},Rt.useDebugValue=function(){},Rt.useDeferredValue=function($){return Ie.current.useDeferredValue($)},Rt.useEffect=function($,oe){return Ie.current.useEffect($,oe)},Rt.useId=function(){return Ie.current.useId()},Rt.useImperativeHandle=function($,oe,we){return Ie.current.useImperativeHandle($,oe,we)},Rt.useInsertionEffect=function($,oe){return Ie.current.useInsertionEffect($,oe)},Rt.useLayoutEffect=function($,oe){return Ie.current.useLayoutEffect($,oe)},Rt.useMemo=function($,oe){return Ie.current.useMemo($,oe)},Rt.useReducer=function($,oe,we){return Ie.current.useReducer($,oe,we)},Rt.useRef=function($){return Ie.current.useRef($)},Rt.useState=function($){return Ie.current.useState($)},Rt.useSyncExternalStore=function($,oe,we){return Ie.current.useSyncExternalStore($,oe,we)},Rt.useTransition=function(){return Ie.current.useTransition()},Rt.version="18.3.1",Rt}var jb;function My(){return jb||(jb=1,tx.exports=BA()),tx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kb;function UA(){if(kb)return ku;kb=1;var n=My(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(u,p,g){var b,w={},N=null,D=null;g!==void 0&&(N=""+g),p.key!==void 0&&(N=""+p.key),p.ref!==void 0&&(D=p.ref);for(b in p)r.call(p,b)&&!l.hasOwnProperty(b)&&(w[b]=p[b]);if(u&&u.defaultProps)for(b in p=u.defaultProps,p)w[b]===void 0&&(w[b]=p[b]);return{$$typeof:e,type:u,key:N,ref:D,props:w,_owner:i.current}}return ku.Fragment=t,ku.jsx=c,ku.jsxs=c,ku}var Cb;function zA(){return Cb||(Cb=1,ex.exports=UA()),ex.exports}var a=zA(),W=My();const ii=IN(W);var Zm={},nx={exports:{}},ls={},rx={exports:{}},sx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rb;function qA(){return Rb||(Rb=1,(function(n){function e(fe,P){var H=fe.length;fe.push(P);e:for(;0<H;){var $=H-1>>>1,oe=fe[$];if(0<i(oe,P))fe[$]=P,fe[H]=oe,H=$;else break e}}function t(fe){return fe.length===0?null:fe[0]}function r(fe){if(fe.length===0)return null;var P=fe[0],H=fe.pop();if(H!==P){fe[0]=H;e:for(var $=0,oe=fe.length,we=oe>>>1;$<we;){var he=2*($+1)-1,ke=fe[he],me=he+1,$e=fe[me];if(0>i(ke,H))me<oe&&0>i($e,ke)?(fe[$]=$e,fe[me]=H,$=me):(fe[$]=ke,fe[he]=H,$=he);else if(me<oe&&0>i($e,H))fe[$]=$e,fe[me]=H,$=me;else break e}}return P}function i(fe,P){var H=fe.sortIndex-P.sortIndex;return H!==0?H:fe.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;n.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();n.unstable_now=function(){return c.now()-u}}var p=[],g=[],b=1,w=null,N=3,D=!1,z=!1,L=!1,O=typeof setTimeout=="function"?setTimeout:null,le=typeof clearTimeout=="function"?clearTimeout:null,ge=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ae(fe){for(var P=t(g);P!==null;){if(P.callback===null)r(g);else if(P.startTime<=fe)r(g),P.sortIndex=P.expirationTime,e(p,P);else break;P=t(g)}}function xe(fe){if(L=!1,ae(fe),!z)if(t(p)!==null)z=!0,Te(j);else{var P=t(g);P!==null&&Ie(xe,P.startTime-fe)}}function j(fe,P){z=!1,L&&(L=!1,le(R),R=-1),D=!0;var H=N;try{for(ae(P),w=t(p);w!==null&&(!(w.expirationTime>P)||fe&&!U());){var $=w.callback;if(typeof $=="function"){w.callback=null,N=w.priorityLevel;var oe=$(w.expirationTime<=P);P=n.unstable_now(),typeof oe=="function"?w.callback=oe:w===t(p)&&r(p),ae(P)}else r(p);w=t(p)}if(w!==null)var we=!0;else{var he=t(g);he!==null&&Ie(xe,he.startTime-P),we=!1}return we}finally{w=null,N=H,D=!1}}var ie=!1,k=null,R=-1,M=5,q=-1;function U(){return!(n.unstable_now()-q<M)}function K(){if(k!==null){var fe=n.unstable_now();q=fe;var P=!0;try{P=k(!0,fe)}finally{P?V():(ie=!1,k=null)}}else ie=!1}var V;if(typeof ge=="function")V=function(){ge(K)};else if(typeof MessageChannel<"u"){var Fe=new MessageChannel,ue=Fe.port2;Fe.port1.onmessage=K,V=function(){ue.postMessage(null)}}else V=function(){O(K,0)};function Te(fe){k=fe,ie||(ie=!0,V())}function Ie(fe,P){R=O(function(){fe(n.unstable_now())},P)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(fe){fe.callback=null},n.unstable_continueExecution=function(){z||D||(z=!0,Te(j))},n.unstable_forceFrameRate=function(fe){0>fe||125<fe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<fe?Math.floor(1e3/fe):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return t(p)},n.unstable_next=function(fe){switch(N){case 1:case 2:case 3:var P=3;break;default:P=N}var H=N;N=P;try{return fe()}finally{N=H}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(fe,P){switch(fe){case 1:case 2:case 3:case 4:case 5:break;default:fe=3}var H=N;N=fe;try{return P()}finally{N=H}},n.unstable_scheduleCallback=function(fe,P,H){var $=n.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?$+H:$):H=$,fe){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=H+oe,fe={id:b++,callback:P,priorityLevel:fe,startTime:H,expirationTime:oe,sortIndex:-1},H>$?(fe.sortIndex=H,e(g,fe),t(p)===null&&fe===t(g)&&(L?(le(R),R=-1):L=!0,Ie(xe,H-$))):(fe.sortIndex=oe,e(p,fe),z||D||(z=!0,Te(j))),fe},n.unstable_shouldYield=U,n.unstable_wrapCallback=function(fe){var P=N;return function(){var H=N;N=P;try{return fe.apply(this,arguments)}finally{N=H}}}})(sx)),sx}var Db;function WA(){return Db||(Db=1,rx.exports=qA()),rx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pb;function HA(){if(Pb)return ls;Pb=1;var n=My(),e=WA();function t(s){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+s,d=1;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function l(s,o){c(s,o),c(s+"Capture",o)}function c(s,o){for(i[s]=o,s=0;s<o.length;s++)r.add(o[s])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),p=Object.prototype.hasOwnProperty,g=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,b={},w={};function N(s){return p.call(w,s)?!0:p.call(b,s)?!1:g.test(s)?w[s]=!0:(b[s]=!0,!1)}function D(s,o,d,f){if(d!==null&&d.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return f?!1:d!==null?!d.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function z(s,o,d,f){if(o===null||typeof o>"u"||D(s,o,d,f))return!0;if(f)return!1;if(d!==null)switch(d.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function L(s,o,d,f,x,y,T){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=f,this.attributeNamespace=x,this.mustUseProperty=d,this.propertyName=s,this.type=o,this.sanitizeURL=y,this.removeEmptyString=T}var O={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){O[s]=new L(s,0,!1,s,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var o=s[0];O[o]=new L(o,1,!1,s[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(s){O[s]=new L(s,2,!1,s.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){O[s]=new L(s,2,!1,s,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){O[s]=new L(s,3,!1,s.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(s){O[s]=new L(s,3,!0,s,null,!1,!1)}),["capture","download"].forEach(function(s){O[s]=new L(s,4,!1,s,null,!1,!1)}),["cols","rows","size","span"].forEach(function(s){O[s]=new L(s,6,!1,s,null,!1,!1)}),["rowSpan","start"].forEach(function(s){O[s]=new L(s,5,!1,s.toLowerCase(),null,!1,!1)});var le=/[\-:]([a-z])/g;function ge(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var o=s.replace(le,ge);O[o]=new L(o,1,!1,s,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var o=s.replace(le,ge);O[o]=new L(o,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(s){var o=s.replace(le,ge);O[o]=new L(o,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(s){O[s]=new L(s,1,!1,s.toLowerCase(),null,!1,!1)}),O.xlinkHref=new L("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(s){O[s]=new L(s,1,!1,s.toLowerCase(),null,!0,!0)});function ae(s,o,d,f){var x=O.hasOwnProperty(o)?O[o]:null;(x!==null?x.type!==0:f||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(z(o,d,x,f)&&(d=null),f||x===null?N(o)&&(d===null?s.removeAttribute(o):s.setAttribute(o,""+d)):x.mustUseProperty?s[x.propertyName]=d===null?x.type===3?!1:"":d:(o=x.attributeName,f=x.attributeNamespace,d===null?s.removeAttribute(o):(x=x.type,d=x===3||x===4&&d===!0?"":""+d,f?s.setAttributeNS(f,o,d):s.setAttribute(o,d))))}var xe=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),ie=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),U=Symbol.for("react.context"),K=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),Fe=Symbol.for("react.suspense_list"),ue=Symbol.for("react.memo"),Te=Symbol.for("react.lazy"),Ie=Symbol.for("react.offscreen"),fe=Symbol.iterator;function P(s){return s===null||typeof s!="object"?null:(s=fe&&s[fe]||s["@@iterator"],typeof s=="function"?s:null)}var H=Object.assign,$;function oe(s){if($===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);$=o&&o[1]||""}return`
`+$+s}var we=!1;function he(s,o){if(!s||we)return"";we=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(ce){var f=ce}Reflect.construct(s,[],o)}else{try{o.call()}catch(ce){f=ce}s.call(o.prototype)}else{try{throw Error()}catch(ce){f=ce}s()}}catch(ce){if(ce&&f&&typeof ce.stack=="string"){for(var x=ce.stack.split(`
`),y=f.stack.split(`
`),T=x.length-1,B=y.length-1;1<=T&&0<=B&&x[T]!==y[B];)B--;for(;1<=T&&0<=B;T--,B--)if(x[T]!==y[B]){if(T!==1||B!==1)do if(T--,B--,0>B||x[T]!==y[B]){var G=`
`+x[T].replace(" at new "," at ");return s.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",s.displayName)),G}while(1<=T&&0<=B);break}}}finally{we=!1,Error.prepareStackTrace=d}return(s=s?s.displayName||s.name:"")?oe(s):""}function ke(s){switch(s.tag){case 5:return oe(s.type);case 16:return oe("Lazy");case 13:return oe("Suspense");case 19:return oe("SuspenseList");case 0:case 2:case 15:return s=he(s.type,!1),s;case 11:return s=he(s.type.render,!1),s;case 1:return s=he(s.type,!0),s;default:return""}}function me(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case k:return"Fragment";case ie:return"Portal";case M:return"Profiler";case R:return"StrictMode";case V:return"Suspense";case Fe:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case U:return(s.displayName||"Context")+".Consumer";case q:return(s._context.displayName||"Context")+".Provider";case K:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case ue:return o=s.displayName||null,o!==null?o:me(s.type)||"Memo";case Te:o=s._payload,s=s._init;try{return me(s(o))}catch{}}return null}function $e(s){var o=s.type;switch(s.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=o.render,s=s.displayName||s.name||"",o.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return me(o);case 8:return o===R?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function pt(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function at(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function lt(s){var o=at(s)?"checked":"value",d=Object.getOwnPropertyDescriptor(s.constructor.prototype,o),f=""+s[o];if(!s.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var x=d.get,y=d.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return x.call(this)},set:function(T){f=""+T,y.call(this,T)}}),Object.defineProperty(s,o,{enumerable:d.enumerable}),{getValue:function(){return f},setValue:function(T){f=""+T},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function on(s){s._valueTracker||(s._valueTracker=lt(s))}function Re(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var d=o.getValue(),f="";return s&&(f=at(s)?s.checked?"true":"false":s.value),s=f,s!==d?(o.setValue(s),!0):!1}function Oe(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function mn(s,o){var d=o.checked;return H({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??s._wrapperState.initialChecked})}function pn(s,o){var d=o.defaultValue==null?"":o.defaultValue,f=o.checked!=null?o.checked:o.defaultChecked;d=pt(o.value!=null?o.value:d),s._wrapperState={initialChecked:f,initialValue:d,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function yn(s,o){o=o.checked,o!=null&&ae(s,"checked",o,!1)}function Be(s,o){yn(s,o);var d=pt(o.value),f=o.type;if(d!=null)f==="number"?(d===0&&s.value===""||s.value!=d)&&(s.value=""+d):s.value!==""+d&&(s.value=""+d);else if(f==="submit"||f==="reset"){s.removeAttribute("value");return}o.hasOwnProperty("value")?_t(s,o.type,d):o.hasOwnProperty("defaultValue")&&_t(s,o.type,pt(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(s.defaultChecked=!!o.defaultChecked)}function zt(s,o,d){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var f=o.type;if(!(f!=="submit"&&f!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+s._wrapperState.initialValue,d||o===s.value||(s.value=o),s.defaultValue=o}d=s.name,d!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,d!==""&&(s.name=d)}function _t(s,o,d){(o!=="number"||Oe(s.ownerDocument)!==s)&&(d==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+d&&(s.defaultValue=""+d))}var Tt=Array.isArray;function jt(s,o,d,f){if(s=s.options,o){o={};for(var x=0;x<d.length;x++)o["$"+d[x]]=!0;for(d=0;d<s.length;d++)x=o.hasOwnProperty("$"+s[d].value),s[d].selected!==x&&(s[d].selected=x),x&&f&&(s[d].defaultSelected=!0)}else{for(d=""+pt(d),o=null,x=0;x<s.length;x++){if(s[x].value===d){s[x].selected=!0,f&&(s[x].defaultSelected=!0);return}o!==null||s[x].disabled||(o=s[x])}o!==null&&(o.selected=!0)}}function Yr(s,o){if(o.dangerouslySetInnerHTML!=null)throw Error(t(91));return H({},o,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function ms(s,o){var d=o.value;if(d==null){if(d=o.children,o=o.defaultValue,d!=null){if(o!=null)throw Error(t(92));if(Tt(d)){if(1<d.length)throw Error(t(93));d=d[0]}o=d}o==null&&(o=""),d=o}s._wrapperState={initialValue:pt(d)}}function ui(s,o){var d=pt(o.value),f=pt(o.defaultValue);d!=null&&(d=""+d,d!==s.value&&(s.value=d),o.defaultValue==null&&s.defaultValue!==d&&(s.defaultValue=d)),f!=null&&(s.defaultValue=""+f)}function Ms(s){var o=s.textContent;o===s._wrapperState.initialValue&&o!==""&&o!==null&&(s.value=o)}function hi(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vs(s,o){return s==null||s==="http://www.w3.org/1999/xhtml"?hi(o):s==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var Jr,ma=(function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,d,f,x){MSApp.execUnsafeLocalFunction(function(){return s(o,d,f,x)})}:s})(function(s,o){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=o;else{for(Jr=Jr||document.createElement("div"),Jr.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Jr.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;o.firstChild;)s.appendChild(o.firstChild)}});function or(s,o){if(o){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=o;return}}s.textContent=o}var ps={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},mi=["Webkit","ms","Moz","O"];Object.keys(ps).forEach(function(s){mi.forEach(function(o){o=o+s.charAt(0).toUpperCase()+s.substring(1),ps[o]=ps[s]})});function se(s,o,d){return o==null||typeof o=="boolean"||o===""?"":d||typeof o!="number"||o===0||ps.hasOwnProperty(s)&&ps[s]?(""+o).trim():o+"px"}function _e(s,o){s=s.style;for(var d in o)if(o.hasOwnProperty(d)){var f=d.indexOf("--")===0,x=se(d,o[d],f);d==="float"&&(d="cssFloat"),f?s.setProperty(d,x):s[d]=x}}var ze=H({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Qe(s,o){if(o){if(ze[s]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(t(137,s));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(t(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(t(61))}if(o.style!=null&&typeof o.style!="object")throw Error(t(62))}}function J(s,o){if(s.indexOf("-")===-1)return typeof o.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ye=null;function Lt(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var it=null,xt=null,Ve=null;function ve(s){if(s=wo(s)){if(typeof it!="function")throw Error(t(280));var o=s.stateNode;o&&(o=_l(o),it(s.stateNode,s.type,o))}}function et(s){xt?Ve?Ve.push(s):Ve=[s]:xt=s}function rn(){if(xt){var s=xt,o=Ve;if(Ve=xt=null,ve(s),o)for(s=0;s<o.length;s++)ve(o[s])}}function In(s,o){return s(o)}function yr(){}var Vn=!1;function Rr(s,o,d){if(Vn)return s(o,d);Vn=!0;try{return In(s,o,d)}finally{Vn=!1,(xt!==null||Ve!==null)&&(yr(),rn())}}function ut(s,o){var d=s.stateNode;if(d===null)return null;var f=_l(d);if(f===null)return null;d=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(t(231,o,typeof d));return d}var Qt=!1;if(u)try{var $i={};Object.defineProperty($i,"passive",{get:function(){Qt=!0}}),window.addEventListener("test",$i,$i),window.removeEventListener("test",$i,$i)}catch{Qt=!1}function ol(s,o,d,f,x,y,T,B,G){var ce=Array.prototype.slice.call(arguments,3);try{o.apply(d,ce)}catch(Ne){this.onError(Ne)}}var fs=!1,Ls=null,pi=!1,Wn=null,gs={onError:function(s){fs=!0,Ls=s}};function xs(s,o,d,f,x,y,T,B,G){fs=!1,Ls=null,ol.apply(gs,arguments)}function Xa(s,o,d,f,x,y,T,B,G){if(xs.apply(this,arguments),fs){if(fs){var ce=Ls;fs=!1,Ls=null}else throw Error(t(198));pi||(pi=!0,Wn=ce)}}function ys(s){var o=s,d=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,(o.flags&4098)!==0&&(d=o.return),s=o.return;while(s)}return o.tag===3?d:null}function fi(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function wc(s){if(ys(s)!==s)throw Error(t(188))}function Za(s){var o=s.alternate;if(!o){if(o=ys(s),o===null)throw Error(t(188));return o!==s?null:s}for(var d=s,f=o;;){var x=d.return;if(x===null)break;var y=x.alternate;if(y===null){if(f=x.return,f!==null){d=f;continue}break}if(x.child===y.child){for(y=x.child;y;){if(y===d)return wc(x),s;if(y===f)return wc(x),o;y=y.sibling}throw Error(t(188))}if(d.return!==f.return)d=x,f=y;else{for(var T=!1,B=x.child;B;){if(B===d){T=!0,d=x,f=y;break}if(B===f){T=!0,f=x,d=y;break}B=B.sibling}if(!T){for(B=y.child;B;){if(B===d){T=!0,d=y,f=x;break}if(B===f){T=!0,f=y,d=x;break}B=B.sibling}if(!T)throw Error(t(189))}}if(d.alternate!==f)throw Error(t(190))}if(d.tag!==3)throw Error(t(188));return d.stateNode.current===d?s:o}function _c(s){return s=Za(s),s!==null?$s(s):null}function $s(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var o=$s(s);if(o!==null)return o;s=s.sibling}return null}var eo=e.unstable_scheduleCallback,pa=e.unstable_cancelCallback,Fi=e.unstable_shouldYield,Fs=e.unstable_requestPaint,Wt=e.unstable_now,Nc=e.unstable_getCurrentPriorityLevel,to=e.unstable_ImmediatePriority,Bi=e.unstable_UserBlockingPriority,lr=e.unstable_NormalPriority,Ui=e.unstable_LowPriority,no=e.unstable_IdlePriority,gi=null,Dr=null;function ro(s){if(Dr&&typeof Dr.onCommitFiberRoot=="function")try{Dr.onCommitFiberRoot(gi,s,void 0,(s.current.flags&128)===128)}catch{}}var vr=Math.clz32?Math.clz32:xi,Xr=Math.log,Zr=Math.LN2;function xi(s){return s>>>=0,s===0?32:31-(Xr(s)/Zr|0)|0}var br=64,Bs=4194304;function Bt(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function vs(s,o){var d=s.pendingLanes;if(d===0)return 0;var f=0,x=s.suspendedLanes,y=s.pingedLanes,T=d&268435455;if(T!==0){var B=T&~x;B!==0?f=Bt(B):(y&=T,y!==0&&(f=Bt(y)))}else T=d&~x,T!==0?f=Bt(T):y!==0&&(f=Bt(y));if(f===0)return 0;if(o!==0&&o!==f&&(o&x)===0&&(x=f&-f,y=o&-o,x>=y||x===16&&(y&4194240)!==0))return o;if((f&4)!==0&&(f|=d&16),o=s.entangledLanes,o!==0)for(s=s.entanglements,o&=f;0<o;)d=31-vr(o),x=1<<d,f|=s[d],o&=~x;return f}function Us(s,o){switch(s){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yi(s,o){for(var d=s.suspendedLanes,f=s.pingedLanes,x=s.expirationTimes,y=s.pendingLanes;0<y;){var T=31-vr(y),B=1<<T,G=x[T];G===-1?((B&d)===0||(B&f)!==0)&&(x[T]=Us(B,o)):G<=o&&(s.expiredLanes|=B),y&=~B}}function Vt(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function so(){var s=br;return br<<=1,(br&4194240)===0&&(br=64),s}function Pr(s){for(var o=[],d=0;31>d;d++)o.push(s);return o}function zi(s,o,d){s.pendingLanes|=o,o!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,o=31-vr(o),s[o]=d}function es(s,o){var d=s.pendingLanes&~o;s.pendingLanes=o,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=o,s.mutableReadLanes&=o,s.entangledLanes&=o,o=s.entanglements;var f=s.eventTimes;for(s=s.expirationTimes;0<d;){var x=31-vr(d),y=1<<x;o[x]=0,f[x]=-1,s[x]=-1,d&=~y}}function fa(s,o){var d=s.entangledLanes|=o;for(s=s.entanglements;d;){var f=31-vr(d),x=1<<f;x&o|s[f]&o&&(s[f]|=o),d&=~x}}var kt=0;function bs(s){return s&=-s,1<s?4<s?(s&268435455)!==0?16:536870912:4:1}var ll,io,ga,ws,qi,Or=!1,vi=[],Pn=null,zs=null,fn=null,xa=new Map,Mr=new Map,Vr=[],ao="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wi(s,o){switch(s){case"focusin":case"focusout":Pn=null;break;case"dragenter":case"dragleave":zs=null;break;case"mouseover":case"mouseout":fn=null;break;case"pointerover":case"pointerout":xa.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mr.delete(o.pointerId)}}function cr(s,o,d,f,x,y){return s===null||s.nativeEvent!==y?(s={blockedOn:o,domEventName:d,eventSystemFlags:f,nativeEvent:y,targetContainers:[x]},o!==null&&(o=wo(o),o!==null&&io(o)),s):(s.eventSystemFlags|=f,o=s.targetContainers,x!==null&&o.indexOf(x)===-1&&o.push(x),s)}function Ic(s,o,d,f,x){switch(o){case"focusin":return Pn=cr(Pn,s,o,d,f,x),!0;case"dragenter":return zs=cr(zs,s,o,d,f,x),!0;case"mouseover":return fn=cr(fn,s,o,d,f,x),!0;case"pointerover":var y=x.pointerId;return xa.set(y,cr(xa.get(y)||null,s,o,d,f,x)),!0;case"gotpointercapture":return y=x.pointerId,Mr.set(y,cr(Mr.get(y)||null,s,o,d,f,x)),!0}return!1}function It(s){var o=Ki(s.target);if(o!==null){var d=ys(o);if(d!==null){if(o=d.tag,o===13){if(o=fi(d),o!==null){s.blockedOn=o,qi(s.priority,function(){ga(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function He(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var d=dl(s.domEventName,s.eventSystemFlags,o[0],s.nativeEvent);if(d===null){d=s.nativeEvent;var f=new d.constructor(d.type,d);Ye=f,d.target.dispatchEvent(f),Ye=null}else return o=wo(d),o!==null&&io(o),s.blockedOn=d,!1;o.shift()}return!0}function ya(s,o,d){He(s)&&d.delete(o)}function oo(){Or=!1,Pn!==null&&He(Pn)&&(Pn=null),zs!==null&&He(zs)&&(zs=null),fn!==null&&He(fn)&&(fn=null),xa.forEach(ya),Mr.forEach(ya)}function vn(s,o){s.blockedOn===o&&(s.blockedOn=null,Or||(Or=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,oo)))}function $t(s){function o(x){return vn(x,s)}if(0<vi.length){vn(vi[0],s);for(var d=1;d<vi.length;d++){var f=vi[d];f.blockedOn===s&&(f.blockedOn=null)}}for(Pn!==null&&vn(Pn,s),zs!==null&&vn(zs,s),fn!==null&&vn(fn,s),xa.forEach(o),Mr.forEach(o),d=0;d<Vr.length;d++)f=Vr[d],f.blockedOn===s&&(f.blockedOn=null);for(;0<Vr.length&&(d=Vr[0],d.blockedOn===null);)It(d),d.blockedOn===null&&Vr.shift()}var qs=xe.ReactCurrentBatchConfig,Ct=!0;function Ws(s,o,d,f){var x=kt,y=qs.transition;qs.transition=null;try{kt=1,Ec(s,o,d,f)}finally{kt=x,qs.transition=y}}function cl(s,o,d,f){var x=kt,y=qs.transition;qs.transition=null;try{kt=4,Ec(s,o,d,f)}finally{kt=x,qs.transition=y}}function Ec(s,o,d,f){if(Ct){var x=dl(s,o,d,f);if(x===null)$c(s,o,f,bi,d),Wi(s,f);else if(Ic(x,s,o,d,f))f.stopPropagation();else if(Wi(s,f),o&4&&-1<ao.indexOf(s)){for(;x!==null;){var y=wo(x);if(y!==null&&ll(y),y=dl(s,o,d,f),y===null&&$c(s,o,f,bi,d),y===x)break;x=y}x!==null&&f.stopPropagation()}else $c(s,o,f,null,d)}}var bi=null;function dl(s,o,d,f){if(bi=null,s=Lt(f),s=Ki(s),s!==null)if(o=ys(s),o===null)s=null;else if(d=o.tag,d===13){if(s=fi(o),s!==null)return s;s=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null);return bi=s,null}function ul(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Nc()){case to:return 1;case Bi:return 4;case lr:case Ui:return 16;case no:return 536870912;default:return 16}default:return 16}}var cn=null,sn=null,wi=null;function Tc(){if(wi)return wi;var s,o=sn,d=o.length,f,x="value"in cn?cn.value:cn.textContent,y=x.length;for(s=0;s<d&&o[s]===x[s];s++);var T=d-s;for(f=1;f<=T&&o[d-f]===x[y-f];f++);return wi=x.slice(s,1<f?1-f:void 0)}function va(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function _s(){return!0}function hl(){return!1}function tr(s){function o(d,f,x,y,T){this._reactName=d,this._targetInst=x,this.type=f,this.nativeEvent=y,this.target=T,this.currentTarget=null;for(var B in s)s.hasOwnProperty(B)&&(d=s[B],this[B]=d?d(y):y[B]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?_s:hl,this.isPropagationStopped=hl,this}return H(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=_s)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=_s)},persist:function(){},isPersistent:_s}),o}var Ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lr=tr(Ns),$r=H({},Ns,{view:0,detail:0}),nr=tr($r),En,ts,dr,ba=H({},$r,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ft,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==dr&&(dr&&s.type==="mousemove"?(En=s.screenX-dr.screenX,ts=s.screenY-dr.screenY):ts=En=0,dr=s),En)},movementY:function(s){return"movementY"in s?s.movementY:ts}}),lo=tr(ba),Dt=H({},ba,{dataTransfer:0}),_i=tr(Dt),co=H({},$r,{relatedTarget:0}),Ln=tr(co),ml=H({},Ns,{animationName:0,elapsedTime:0,pseudoElement:0}),Ac=tr(ml),Ni=H({},Ns,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),m=tr(Ni),v=H({},Ns,{data:0}),I=tr(v),C={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Z={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},de={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function De(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=de[s])?!!o[s]:!1}function ft(){return De}var dn=H({},$r,{key:function(s){if(s.key){var o=C[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=va(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Z[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ft,charCode:function(s){return s.type==="keypress"?va(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?va(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Ht=tr(dn),un=H({},ba,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tn=tr(un),$n=H({},$r,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ft}),Hs=tr($n),Gs=H({},Ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),uo=tr(Gs),pl=H({},ba,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),eg=tr(pl),em=[9,13,27,32],Sc=u&&"CompositionEvent"in window,ho=null;u&&"documentMode"in document&&(ho=document.documentMode);var tg=u&&"TextEvent"in window&&!ho,jc=u&&(!Sc||ho&&8<ho&&11>=ho),tm=" ",nm=!1;function rm(s,o){switch(s){case"keyup":return em.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zd(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Hn=!1;function ng(s,o){switch(s){case"compositionend":return zd(o);case"keypress":return o.which!==32?null:(nm=!0,tm);case"textInput":return s=o.data,s===tm&&nm?null:s;default:return null}}function Ii(s,o){if(Hn)return s==="compositionend"||!Sc&&rm(s,o)?(s=Tc(),wi=sn=cn=null,Hn=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return jc&&o.locale!=="ko"?null:o.data;default:return null}}var Ei={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qd(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!Ei[s.type]:o==="textarea"}function ns(s,o,d,f){et(f),o=vl(o,"onChange"),0<o.length&&(d=new Lr("onChange","change",null,d,f),s.push({event:d,listeners:o}))}var mo=null,Ks=null;function Hi(s){iu(s,0)}function Gi(s){var o=Ea(s);if(Re(o))return s}function sm(s,o){if(s==="change")return o}var kc=!1;if(u){var Cc;if(u){var fl="oninput"in document;if(!fl){var Wd=document.createElement("div");Wd.setAttribute("oninput","return;"),fl=typeof Wd.oninput=="function"}Cc=fl}else Cc=!1;kc=Cc&&(!document.documentMode||9<document.documentMode)}function po(){mo&&(mo.detachEvent("onpropertychange",im),Ks=mo=null)}function im(s){if(s.propertyName==="value"&&Gi(Ks)){var o=[];ns(o,Ks,s,Lt(s)),Rr(Hi,o)}}function Et(s,o,d){s==="focusin"?(po(),mo=o,Ks=d,mo.attachEvent("onpropertychange",im)):s==="focusout"&&po()}function rg(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Gi(Ks)}function am(s,o){if(s==="click")return Gi(o)}function om(s,o){if(s==="input"||s==="change")return Gi(o)}function lm(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var rs=typeof Object.is=="function"?Object.is:lm;function fo(s,o){if(rs(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var d=Object.keys(s),f=Object.keys(o);if(d.length!==f.length)return!1;for(f=0;f<d.length;f++){var x=d[f];if(!p.call(o,x)||!rs(s[x],o[x]))return!1}return!0}function Hd(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Gd(s,o){var d=Hd(s);s=0;for(var f;d;){if(d.nodeType===3){if(f=s+d.textContent.length,s<=o&&f>=o)return{node:d,offset:o-s};s=f}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Hd(d)}}function Kd(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?Kd(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function Qd(){for(var s=window,o=Oe();o instanceof s.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)s=o.contentWindow;else break;o=Oe(s.document)}return o}function Rc(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}function cm(s){var o=Qd(),d=s.focusedElem,f=s.selectionRange;if(o!==d&&d&&d.ownerDocument&&Kd(d.ownerDocument.documentElement,d)){if(f!==null&&Rc(d)){if(o=f.start,s=f.end,s===void 0&&(s=o),"selectionStart"in d)d.selectionStart=o,d.selectionEnd=Math.min(s,d.value.length);else if(s=(o=d.ownerDocument||document)&&o.defaultView||window,s.getSelection){s=s.getSelection();var x=d.textContent.length,y=Math.min(f.start,x);f=f.end===void 0?y:Math.min(f.end,x),!s.extend&&y>f&&(x=f,f=y,y=x),x=Gd(d,y);var T=Gd(d,f);x&&T&&(s.rangeCount!==1||s.anchorNode!==x.node||s.anchorOffset!==x.offset||s.focusNode!==T.node||s.focusOffset!==T.offset)&&(o=o.createRange(),o.setStart(x.node,x.offset),s.removeAllRanges(),y>f?(s.addRange(o),s.extend(T.node,T.offset)):(o.setEnd(T.node,T.offset),s.addRange(o)))}}for(o=[],s=d;s=s.parentNode;)s.nodeType===1&&o.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<o.length;d++)s=o[d],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var dm=u&&"documentMode"in document&&11>=document.documentMode,wa=null,Dc=null,go=null,Pc=!1;function Yd(s,o,d){var f=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Pc||wa==null||wa!==Oe(f)||(f=wa,"selectionStart"in f&&Rc(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),go&&fo(go,f)||(go=f,f=vl(Dc,"onSelect"),0<f.length&&(o=new Lr("onSelect","select",null,o,d),s.push({event:o,listeners:f}),o.target=wa)))}function gl(s,o){var d={};return d[s.toLowerCase()]=o.toLowerCase(),d["Webkit"+s]="webkit"+o,d["Moz"+s]="moz"+o,d}var _a={animationend:gl("Animation","AnimationEnd"),animationiteration:gl("Animation","AnimationIteration"),animationstart:gl("Animation","AnimationStart"),transitionend:gl("Transition","TransitionEnd")},Oc={},Jd={};u&&(Jd=document.createElement("div").style,"AnimationEvent"in window||(delete _a.animationend.animation,delete _a.animationiteration.animation,delete _a.animationstart.animation),"TransitionEvent"in window||delete _a.transitionend.transition);function xl(s){if(Oc[s])return Oc[s];if(!_a[s])return s;var o=_a[s],d;for(d in o)if(o.hasOwnProperty(d)&&d in Jd)return Oc[s]=o[d];return s}var Xd=xl("animationend"),Zd=xl("animationiteration"),eu=xl("animationstart"),tu=xl("transitionend"),nu=new Map,ru="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ti(s,o){nu.set(s,o),l(o,[s])}for(var Mc=0;Mc<ru.length;Mc++){var Vc=ru[Mc],um=Vc.toLowerCase(),hm=Vc[0].toUpperCase()+Vc.slice(1);Ti(um,"on"+hm)}Ti(Xd,"onAnimationEnd"),Ti(Zd,"onAnimationIteration"),Ti(eu,"onAnimationStart"),Ti("dblclick","onDoubleClick"),Ti("focusin","onFocus"),Ti("focusout","onBlur"),Ti(tu,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mm=new Set("cancel close invalid load scroll toggle".split(" ").concat(xo));function su(s,o,d){var f=s.type||"unknown-event";s.currentTarget=d,Xa(f,o,void 0,s),s.currentTarget=null}function iu(s,o){o=(o&4)!==0;for(var d=0;d<s.length;d++){var f=s[d],x=f.event;f=f.listeners;e:{var y=void 0;if(o)for(var T=f.length-1;0<=T;T--){var B=f[T],G=B.instance,ce=B.currentTarget;if(B=B.listener,G!==y&&x.isPropagationStopped())break e;su(x,B,ce),y=G}else for(T=0;T<f.length;T++){if(B=f[T],G=B.instance,ce=B.currentTarget,B=B.listener,G!==y&&x.isPropagationStopped())break e;su(x,B,ce),y=G}}}if(pi)throw s=Wn,pi=!1,Wn=null,s}function en(s,o){var d=o[Wc];d===void 0&&(d=o[Wc]=new Set);var f=s+"__bubble";d.has(f)||(au(o,s,2,!1),d.add(f))}function Lc(s,o,d){var f=0;o&&(f|=4),au(d,s,f,o)}var yl="_reactListening"+Math.random().toString(36).slice(2);function yo(s){if(!s[yl]){s[yl]=!0,r.forEach(function(d){d!=="selectionchange"&&(mm.has(d)||Lc(d,!1,s),Lc(d,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[yl]||(o[yl]=!0,Lc("selectionchange",!1,o))}}function au(s,o,d,f){switch(ul(o)){case 1:var x=Ws;break;case 4:x=cl;break;default:x=Ec}d=x.bind(null,o,d,s),x=void 0,!Qt||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(x=!0),f?x!==void 0?s.addEventListener(o,d,{capture:!0,passive:x}):s.addEventListener(o,d,!0):x!==void 0?s.addEventListener(o,d,{passive:x}):s.addEventListener(o,d,!1)}function $c(s,o,d,f,x){var y=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var T=f.tag;if(T===3||T===4){var B=f.stateNode.containerInfo;if(B===x||B.nodeType===8&&B.parentNode===x)break;if(T===4)for(T=f.return;T!==null;){var G=T.tag;if((G===3||G===4)&&(G=T.stateNode.containerInfo,G===x||G.nodeType===8&&G.parentNode===x))return;T=T.return}for(;B!==null;){if(T=Ki(B),T===null)return;if(G=T.tag,G===5||G===6){f=y=T;continue e}B=B.parentNode}}f=f.return}Rr(function(){var ce=y,Ne=Lt(d),Ee=[];e:{var be=nu.get(s);if(be!==void 0){var Ue=Lr,Je=s;switch(s){case"keypress":if(va(d)===0)break e;case"keydown":case"keyup":Ue=Ht;break;case"focusin":Je="focus",Ue=Ln;break;case"focusout":Je="blur",Ue=Ln;break;case"beforeblur":case"afterblur":Ue=Ln;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ue=lo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ue=_i;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ue=Hs;break;case Xd:case Zd:case eu:Ue=Ac;break;case tu:Ue=uo;break;case"scroll":Ue=nr;break;case"wheel":Ue=eg;break;case"copy":case"cut":case"paste":Ue=m;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ue=Tn}var Ze=(o&4)!==0,On=!Ze&&s==="scroll",te=Ze?be!==null?be+"Capture":null:be;Ze=[];for(var Q=ce,ne;Q!==null;){ne=Q;var je=ne.stateNode;if(ne.tag===5&&je!==null&&(ne=je,te!==null&&(je=ut(Q,te),je!=null&&Ze.push(vo(Q,je,ne)))),On)break;Q=Q.return}0<Ze.length&&(be=new Ue(be,Je,null,d,Ne),Ee.push({event:be,listeners:Ze}))}}if((o&7)===0){e:{if(be=s==="mouseover"||s==="pointerover",Ue=s==="mouseout"||s==="pointerout",be&&d!==Ye&&(Je=d.relatedTarget||d.fromElement)&&(Ki(Je)||Je[Qs]))break e;if((Ue||be)&&(be=Ne.window===Ne?Ne:(be=Ne.ownerDocument)?be.defaultView||be.parentWindow:window,Ue?(Je=d.relatedTarget||d.toElement,Ue=ce,Je=Je?Ki(Je):null,Je!==null&&(On=ys(Je),Je!==On||Je.tag!==5&&Je.tag!==6)&&(Je=null)):(Ue=null,Je=ce),Ue!==Je)){if(Ze=lo,je="onMouseLeave",te="onMouseEnter",Q="mouse",(s==="pointerout"||s==="pointerover")&&(Ze=Tn,je="onPointerLeave",te="onPointerEnter",Q="pointer"),On=Ue==null?be:Ea(Ue),ne=Je==null?be:Ea(Je),be=new Ze(je,Q+"leave",Ue,d,Ne),be.target=On,be.relatedTarget=ne,je=null,Ki(Ne)===ce&&(Ze=new Ze(te,Q+"enter",Je,d,Ne),Ze.target=ne,Ze.relatedTarget=On,je=Ze),On=je,Ue&&Je)t:{for(Ze=Ue,te=Je,Q=0,ne=Ze;ne;ne=Na(ne))Q++;for(ne=0,je=te;je;je=Na(je))ne++;for(;0<Q-ne;)Ze=Na(Ze),Q--;for(;0<ne-Q;)te=Na(te),ne--;for(;Q--;){if(Ze===te||te!==null&&Ze===te.alternate)break t;Ze=Na(Ze),te=Na(te)}Ze=null}else Ze=null;Ue!==null&&ou(Ee,be,Ue,Ze,!1),Je!==null&&On!==null&&ou(Ee,On,Je,Ze,!0)}}e:{if(be=ce?Ea(ce):window,Ue=be.nodeName&&be.nodeName.toLowerCase(),Ue==="select"||Ue==="input"&&be.type==="file")var tt=sm;else if(qd(be))if(kc)tt=om;else{tt=rg;var ct=Et}else(Ue=be.nodeName)&&Ue.toLowerCase()==="input"&&(be.type==="checkbox"||be.type==="radio")&&(tt=am);if(tt&&(tt=tt(s,ce))){ns(Ee,tt,d,Ne);break e}ct&&ct(s,be,ce),s==="focusout"&&(ct=be._wrapperState)&&ct.controlled&&be.type==="number"&&_t(be,"number",be.value)}switch(ct=ce?Ea(ce):window,s){case"focusin":(qd(ct)||ct.contentEditable==="true")&&(wa=ct,Dc=ce,go=null);break;case"focusout":go=Dc=wa=null;break;case"mousedown":Pc=!0;break;case"contextmenu":case"mouseup":case"dragend":Pc=!1,Yd(Ee,d,Ne);break;case"selectionchange":if(dm)break;case"keydown":case"keyup":Yd(Ee,d,Ne)}var dt;if(Sc)e:{switch(s){case"compositionstart":var gt="onCompositionStart";break e;case"compositionend":gt="onCompositionEnd";break e;case"compositionupdate":gt="onCompositionUpdate";break e}gt=void 0}else Hn?rm(s,d)&&(gt="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&(gt="onCompositionStart");gt&&(jc&&d.locale!=="ko"&&(Hn||gt!=="onCompositionStart"?gt==="onCompositionEnd"&&Hn&&(dt=Tc()):(cn=Ne,sn="value"in cn?cn.value:cn.textContent,Hn=!0)),ct=vl(ce,gt),0<ct.length&&(gt=new I(gt,s,null,d,Ne),Ee.push({event:gt,listeners:ct}),dt?gt.data=dt:(dt=zd(d),dt!==null&&(gt.data=dt)))),(dt=tg?ng(s,d):Ii(s,d))&&(ce=vl(ce,"onBeforeInput"),0<ce.length&&(Ne=new I("onBeforeInput","beforeinput",null,d,Ne),Ee.push({event:Ne,listeners:ce}),Ne.data=dt))}iu(Ee,o)})}function vo(s,o,d){return{instance:s,listener:o,currentTarget:d}}function vl(s,o){for(var d=o+"Capture",f=[];s!==null;){var x=s,y=x.stateNode;x.tag===5&&y!==null&&(x=y,y=ut(s,d),y!=null&&f.unshift(vo(s,y,x)),y=ut(s,o),y!=null&&f.push(vo(s,y,x))),s=s.return}return f}function Na(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function ou(s,o,d,f,x){for(var y=o._reactName,T=[];d!==null&&d!==f;){var B=d,G=B.alternate,ce=B.stateNode;if(G!==null&&G===f)break;B.tag===5&&ce!==null&&(B=ce,x?(G=ut(d,y),G!=null&&T.unshift(vo(d,G,B))):x||(G=ut(d,y),G!=null&&T.push(vo(d,G,B)))),d=d.return}T.length!==0&&s.push({event:o,listeners:T})}var pm=/\r\n?/g,fm=/\u0000|\uFFFD/g;function lu(s){return(typeof s=="string"?s:""+s).replace(pm,`
`).replace(fm,"")}function bl(s,o,d){if(o=lu(o),lu(s)!==o&&d)throw Error(t(425))}function wl(){}var Fc=null,Bc=null;function Uc(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var zc=typeof setTimeout=="function"?setTimeout:void 0,gm=typeof clearTimeout=="function"?clearTimeout:void 0,cu=typeof Promise=="function"?Promise:void 0,xm=typeof queueMicrotask=="function"?queueMicrotask:typeof cu<"u"?function(s){return cu.resolve(null).then(s).catch(ym)}:zc;function ym(s){setTimeout(function(){throw s})}function qc(s,o){var d=o,f=0;do{var x=d.nextSibling;if(s.removeChild(d),x&&x.nodeType===8)if(d=x.data,d==="/$"){if(f===0){s.removeChild(x),$t(o);return}f--}else d!=="$"&&d!=="$?"&&d!=="$!"||f++;d=x}while(d);$t(o)}function Ai(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return s}function du(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return s;o--}else d==="/$"&&o++}s=s.previousSibling}return null}var Ia=Math.random().toString(36).slice(2),Is="__reactFiber$"+Ia,bo="__reactProps$"+Ia,Qs="__reactContainer$"+Ia,Wc="__reactEvents$"+Ia,vm="__reactListeners$"+Ia,bm="__reactHandles$"+Ia;function Ki(s){var o=s[Is];if(o)return o;for(var d=s.parentNode;d;){if(o=d[Qs]||d[Is]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(s=du(s);s!==null;){if(d=s[Is])return d;s=du(s)}return o}s=d,d=s.parentNode}return null}function wo(s){return s=s[Is]||s[Qs],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Ea(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(t(33))}function _l(s){return s[bo]||null}var Hc=[],Ta=-1;function Si(s){return{current:s}}function tn(s){0>Ta||(s.current=Hc[Ta],Hc[Ta]=null,Ta--)}function Yt(s,o){Ta++,Hc[Ta]=s.current,s.current=o}var ji={},Gn=Si(ji),ur=Si(!1),Qi=ji;function Aa(s,o){var d=s.type.contextTypes;if(!d)return ji;var f=s.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===o)return f.__reactInternalMemoizedMaskedChildContext;var x={},y;for(y in d)x[y]=o[y];return f&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=o,s.__reactInternalMemoizedMaskedChildContext=x),x}function hr(s){return s=s.childContextTypes,s!=null}function Nl(){tn(ur),tn(Gn)}function uu(s,o,d){if(Gn.current!==ji)throw Error(t(168));Yt(Gn,o),Yt(ur,d)}function hu(s,o,d){var f=s.stateNode;if(o=o.childContextTypes,typeof f.getChildContext!="function")return d;f=f.getChildContext();for(var x in f)if(!(x in o))throw Error(t(108,$e(s)||"Unknown",x));return H({},d,f)}function Il(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||ji,Qi=Gn.current,Yt(Gn,s),Yt(ur,ur.current),!0}function mu(s,o,d){var f=s.stateNode;if(!f)throw Error(t(169));d?(s=hu(s,o,Qi),f.__reactInternalMemoizedMergedChildContext=s,tn(ur),tn(Gn),Yt(Gn,s)):tn(ur),Yt(ur,d)}var Ys=null,El=!1,Gc=!1;function pu(s){Ys===null?Ys=[s]:Ys.push(s)}function wm(s){El=!0,pu(s)}function ki(){if(!Gc&&Ys!==null){Gc=!0;var s=0,o=kt;try{var d=Ys;for(kt=1;s<d.length;s++){var f=d[s];do f=f(!0);while(f!==null)}Ys=null,El=!1}catch(x){throw Ys!==null&&(Ys=Ys.slice(s+1)),eo(to,ki),x}finally{kt=o,Gc=!1}}return null}var h=[],_=0,E=null,S=0,A=[],re=0,Y=null,X=1,Se="";function Ge(s,o){h[_++]=S,h[_++]=E,E=s,S=o}function Ce(s,o,d){A[re++]=X,A[re++]=Se,A[re++]=Y,Y=s;var f=X;s=Se;var x=32-vr(f)-1;f&=~(1<<x),d+=1;var y=32-vr(o)+x;if(30<y){var T=x-x%5;y=(f&(1<<T)-1).toString(32),f>>=T,x-=T,X=1<<32-vr(o)+x|d<<x|f,Se=y+s}else X=1<<y|d<<x|f,Se=s}function nt(s){s.return!==null&&(Ge(s,1),Ce(s,1,0))}function ht(s){for(;s===E;)E=h[--_],h[_]=null,S=h[--_],h[_]=null;for(;s===Y;)Y=A[--re],A[re]=null,Se=A[--re],A[re]=null,X=A[--re],A[re]=null}var mt=null,wt=null,At=!1,Le=null;function Kn(s,o){var d=ei(5,null,null,0);d.elementType="DELETED",d.stateNode=o,d.return=s,o=s.deletions,o===null?(s.deletions=[d],s.flags|=16):o.push(d)}function ss(s,o){switch(s.tag){case 5:var d=s.type;return o=o.nodeType!==1||d.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(s.stateNode=o,mt=s,wt=Ai(o.firstChild),!0):!1;case 6:return o=s.pendingProps===""||o.nodeType!==3?null:o,o!==null?(s.stateNode=o,mt=s,wt=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(d=Y!==null?{id:X,overflow:Se}:null,s.memoizedState={dehydrated:o,treeContext:d,retryLane:1073741824},d=ei(18,null,null,0),d.stateNode=o,d.return=s,s.child=d,mt=s,wt=null,!0):!1;default:return!1}}function Fr(s){return(s.mode&1)!==0&&(s.flags&128)===0}function Nt(s){if(At){var o=wt;if(o){var d=o;if(!ss(s,o)){if(Fr(s))throw Error(t(418));o=Ai(d.nextSibling);var f=mt;o&&ss(s,o)?Kn(f,d):(s.flags=s.flags&-4097|2,At=!1,mt=s)}}else{if(Fr(s))throw Error(t(418));s.flags=s.flags&-4097|2,At=!1,mt=s}}}function nn(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;mt=s}function an(s){if(s!==mt)return!1;if(!At)return nn(s),At=!0,!1;var o;if((o=s.tag!==3)&&!(o=s.tag!==5)&&(o=s.type,o=o!=="head"&&o!=="body"&&!Uc(s.type,s.memoizedProps)),o&&(o=wt)){if(Fr(s))throw Qn(),Error(t(418));for(;o;)Kn(s,o),o=Ai(o.nextSibling)}if(nn(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(t(317));e:{for(s=s.nextSibling,o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="/$"){if(o===0){wt=Ai(s.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++}s=s.nextSibling}wt=null}}else wt=mt?Ai(s.stateNode.nextSibling):null;return!0}function Qn(){for(var s=wt;s;)s=Ai(s.nextSibling)}function An(){wt=mt=null,At=!1}function Br(s){Le===null?Le=[s]:Le.push(s)}var Yn=xe.ReactCurrentBatchConfig;function mr(s,o,d){if(s=d.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(t(309));var f=d.stateNode}if(!f)throw Error(t(147,s));var x=f,y=""+s;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===y?o.ref:(o=function(T){var B=x.refs;T===null?delete B[y]:B[y]=T},o._stringRef=y,o)}if(typeof s!="string")throw Error(t(284));if(!d._owner)throw Error(t(290,s))}return s}function Sa(s,o){throw s=Object.prototype.toString.call(o),Error(t(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s))}function fu(s){var o=s._init;return o(s._payload)}function gu(s){function o(te,Q){if(s){var ne=te.deletions;ne===null?(te.deletions=[Q],te.flags|=16):ne.push(Q)}}function d(te,Q){if(!s)return null;for(;Q!==null;)o(te,Q),Q=Q.sibling;return null}function f(te,Q){for(te=new Map;Q!==null;)Q.key!==null?te.set(Q.key,Q):te.set(Q.index,Q),Q=Q.sibling;return te}function x(te,Q){return te=jo(te,Q),te.index=0,te.sibling=null,te}function y(te,Q,ne){return te.index=ne,s?(ne=te.alternate,ne!==null?(ne=ne.index,ne<Q?(te.flags|=2,Q):ne):(te.flags|=2,Q)):(te.flags|=1048576,Q)}function T(te){return s&&te.alternate===null&&(te.flags|=2),te}function B(te,Q,ne,je){return Q===null||Q.tag!==6?(Q=Kg(ne,te.mode,je),Q.return=te,Q):(Q=x(Q,ne),Q.return=te,Q)}function G(te,Q,ne,je){var tt=ne.type;return tt===k?Ne(te,Q,ne.props.children,je,ne.key):Q!==null&&(Q.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===Te&&fu(tt)===Q.type)?(je=x(Q,ne.props),je.ref=mr(te,Q,ne),je.return=te,je):(je=Wm(ne.type,ne.key,ne.props,null,te.mode,je),je.ref=mr(te,Q,ne),je.return=te,je)}function ce(te,Q,ne,je){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ne.containerInfo||Q.stateNode.implementation!==ne.implementation?(Q=Qg(ne,te.mode,je),Q.return=te,Q):(Q=x(Q,ne.children||[]),Q.return=te,Q)}function Ne(te,Q,ne,je,tt){return Q===null||Q.tag!==7?(Q=Dl(ne,te.mode,je,tt),Q.return=te,Q):(Q=x(Q,ne),Q.return=te,Q)}function Ee(te,Q,ne){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=Kg(""+Q,te.mode,ne),Q.return=te,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case j:return ne=Wm(Q.type,Q.key,Q.props,null,te.mode,ne),ne.ref=mr(te,null,Q),ne.return=te,ne;case ie:return Q=Qg(Q,te.mode,ne),Q.return=te,Q;case Te:var je=Q._init;return Ee(te,je(Q._payload),ne)}if(Tt(Q)||P(Q))return Q=Dl(Q,te.mode,ne,null),Q.return=te,Q;Sa(te,Q)}return null}function be(te,Q,ne,je){var tt=Q!==null?Q.key:null;if(typeof ne=="string"&&ne!==""||typeof ne=="number")return tt!==null?null:B(te,Q,""+ne,je);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case j:return ne.key===tt?G(te,Q,ne,je):null;case ie:return ne.key===tt?ce(te,Q,ne,je):null;case Te:return tt=ne._init,be(te,Q,tt(ne._payload),je)}if(Tt(ne)||P(ne))return tt!==null?null:Ne(te,Q,ne,je,null);Sa(te,ne)}return null}function Ue(te,Q,ne,je,tt){if(typeof je=="string"&&je!==""||typeof je=="number")return te=te.get(ne)||null,B(Q,te,""+je,tt);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case j:return te=te.get(je.key===null?ne:je.key)||null,G(Q,te,je,tt);case ie:return te=te.get(je.key===null?ne:je.key)||null,ce(Q,te,je,tt);case Te:var ct=je._init;return Ue(te,Q,ne,ct(je._payload),tt)}if(Tt(je)||P(je))return te=te.get(ne)||null,Ne(Q,te,je,tt,null);Sa(Q,je)}return null}function Je(te,Q,ne,je){for(var tt=null,ct=null,dt=Q,gt=Q=0,ir=null;dt!==null&&gt<ne.length;gt++){dt.index>gt?(ir=dt,dt=null):ir=dt.sibling;var qt=be(te,dt,ne[gt],je);if(qt===null){dt===null&&(dt=ir);break}s&&dt&&qt.alternate===null&&o(te,dt),Q=y(qt,Q,gt),ct===null?tt=qt:ct.sibling=qt,ct=qt,dt=ir}if(gt===ne.length)return d(te,dt),At&&Ge(te,gt),tt;if(dt===null){for(;gt<ne.length;gt++)dt=Ee(te,ne[gt],je),dt!==null&&(Q=y(dt,Q,gt),ct===null?tt=dt:ct.sibling=dt,ct=dt);return At&&Ge(te,gt),tt}for(dt=f(te,dt);gt<ne.length;gt++)ir=Ue(dt,te,gt,ne[gt],je),ir!==null&&(s&&ir.alternate!==null&&dt.delete(ir.key===null?gt:ir.key),Q=y(ir,Q,gt),ct===null?tt=ir:ct.sibling=ir,ct=ir);return s&&dt.forEach(function(ko){return o(te,ko)}),At&&Ge(te,gt),tt}function Ze(te,Q,ne,je){var tt=P(ne);if(typeof tt!="function")throw Error(t(150));if(ne=tt.call(ne),ne==null)throw Error(t(151));for(var ct=tt=null,dt=Q,gt=Q=0,ir=null,qt=ne.next();dt!==null&&!qt.done;gt++,qt=ne.next()){dt.index>gt?(ir=dt,dt=null):ir=dt.sibling;var ko=be(te,dt,qt.value,je);if(ko===null){dt===null&&(dt=ir);break}s&&dt&&ko.alternate===null&&o(te,dt),Q=y(ko,Q,gt),ct===null?tt=ko:ct.sibling=ko,ct=ko,dt=ir}if(qt.done)return d(te,dt),At&&Ge(te,gt),tt;if(dt===null){for(;!qt.done;gt++,qt=ne.next())qt=Ee(te,qt.value,je),qt!==null&&(Q=y(qt,Q,gt),ct===null?tt=qt:ct.sibling=qt,ct=qt);return At&&Ge(te,gt),tt}for(dt=f(te,dt);!qt.done;gt++,qt=ne.next())qt=Ue(dt,te,gt,qt.value,je),qt!==null&&(s&&qt.alternate!==null&&dt.delete(qt.key===null?gt:qt.key),Q=y(qt,Q,gt),ct===null?tt=qt:ct.sibling=qt,ct=qt);return s&&dt.forEach(function(FA){return o(te,FA)}),At&&Ge(te,gt),tt}function On(te,Q,ne,je){if(typeof ne=="object"&&ne!==null&&ne.type===k&&ne.key===null&&(ne=ne.props.children),typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case j:e:{for(var tt=ne.key,ct=Q;ct!==null;){if(ct.key===tt){if(tt=ne.type,tt===k){if(ct.tag===7){d(te,ct.sibling),Q=x(ct,ne.props.children),Q.return=te,te=Q;break e}}else if(ct.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===Te&&fu(tt)===ct.type){d(te,ct.sibling),Q=x(ct,ne.props),Q.ref=mr(te,ct,ne),Q.return=te,te=Q;break e}d(te,ct);break}else o(te,ct);ct=ct.sibling}ne.type===k?(Q=Dl(ne.props.children,te.mode,je,ne.key),Q.return=te,te=Q):(je=Wm(ne.type,ne.key,ne.props,null,te.mode,je),je.ref=mr(te,Q,ne),je.return=te,te=je)}return T(te);case ie:e:{for(ct=ne.key;Q!==null;){if(Q.key===ct)if(Q.tag===4&&Q.stateNode.containerInfo===ne.containerInfo&&Q.stateNode.implementation===ne.implementation){d(te,Q.sibling),Q=x(Q,ne.children||[]),Q.return=te,te=Q;break e}else{d(te,Q);break}else o(te,Q);Q=Q.sibling}Q=Qg(ne,te.mode,je),Q.return=te,te=Q}return T(te);case Te:return ct=ne._init,On(te,Q,ct(ne._payload),je)}if(Tt(ne))return Je(te,Q,ne,je);if(P(ne))return Ze(te,Q,ne,je);Sa(te,ne)}return typeof ne=="string"&&ne!==""||typeof ne=="number"?(ne=""+ne,Q!==null&&Q.tag===6?(d(te,Q.sibling),Q=x(Q,ne),Q.return=te,te=Q):(d(te,Q),Q=Kg(ne,te.mode,je),Q.return=te,te=Q),T(te)):d(te,Q)}return On}var ja=gu(!0),ov=gu(!1),_m=Si(null),Nm=null,Kc=null,sg=null;function ig(){sg=Kc=Nm=null}function ag(s){var o=_m.current;tn(_m),s._currentValue=o}function og(s,o,d){for(;s!==null;){var f=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),s===d)break;s=s.return}}function Qc(s,o){Nm=s,sg=Kc=null,s=s.dependencies,s!==null&&s.firstContext!==null&&((s.lanes&o)!==0&&(is=!0),s.firstContext=null)}function Js(s){var o=s._currentValue;if(sg!==s)if(s={context:s,memoizedValue:o,next:null},Kc===null){if(Nm===null)throw Error(t(308));Kc=s,Nm.dependencies={lanes:0,firstContext:s}}else Kc=Kc.next=s;return o}var Tl=null;function lg(s){Tl===null?Tl=[s]:Tl.push(s)}function lv(s,o,d,f){var x=o.interleaved;return x===null?(d.next=d,lg(o)):(d.next=x.next,x.next=d),o.interleaved=d,ka(s,f)}function ka(s,o){s.lanes|=o;var d=s.alternate;for(d!==null&&(d.lanes|=o),d=s,s=s.return;s!==null;)s.childLanes|=o,d=s.alternate,d!==null&&(d.childLanes|=o),d=s,s=s.return;return d.tag===3?d.stateNode:null}var _o=!1;function cg(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cv(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Ca(s,o){return{eventTime:s,lane:o,tag:0,payload:null,callback:null,next:null}}function No(s,o,d){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(Ut&2)!==0){var x=f.pending;return x===null?o.next=o:(o.next=x.next,x.next=o),f.pending=o,ka(s,d)}return x=f.interleaved,x===null?(o.next=o,lg(f)):(o.next=x.next,x.next=o),f.interleaved=o,ka(s,d)}function Im(s,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194240)!==0)){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,fa(s,d)}}function dv(s,o){var d=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,d===f)){var x=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var T={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};y===null?x=y=T:y=y.next=T,d=d.next}while(d!==null);y===null?x=y=o:y=y.next=o}else x=y=o;d={baseState:f.baseState,firstBaseUpdate:x,lastBaseUpdate:y,shared:f.shared,effects:f.effects},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=o:s.next=o,d.lastBaseUpdate=o}function Em(s,o,d,f){var x=s.updateQueue;_o=!1;var y=x.firstBaseUpdate,T=x.lastBaseUpdate,B=x.shared.pending;if(B!==null){x.shared.pending=null;var G=B,ce=G.next;G.next=null,T===null?y=ce:T.next=ce,T=G;var Ne=s.alternate;Ne!==null&&(Ne=Ne.updateQueue,B=Ne.lastBaseUpdate,B!==T&&(B===null?Ne.firstBaseUpdate=ce:B.next=ce,Ne.lastBaseUpdate=G))}if(y!==null){var Ee=x.baseState;T=0,Ne=ce=G=null,B=y;do{var be=B.lane,Ue=B.eventTime;if((f&be)===be){Ne!==null&&(Ne=Ne.next={eventTime:Ue,lane:0,tag:B.tag,payload:B.payload,callback:B.callback,next:null});e:{var Je=s,Ze=B;switch(be=o,Ue=d,Ze.tag){case 1:if(Je=Ze.payload,typeof Je=="function"){Ee=Je.call(Ue,Ee,be);break e}Ee=Je;break e;case 3:Je.flags=Je.flags&-65537|128;case 0:if(Je=Ze.payload,be=typeof Je=="function"?Je.call(Ue,Ee,be):Je,be==null)break e;Ee=H({},Ee,be);break e;case 2:_o=!0}}B.callback!==null&&B.lane!==0&&(s.flags|=64,be=x.effects,be===null?x.effects=[B]:be.push(B))}else Ue={eventTime:Ue,lane:be,tag:B.tag,payload:B.payload,callback:B.callback,next:null},Ne===null?(ce=Ne=Ue,G=Ee):Ne=Ne.next=Ue,T|=be;if(B=B.next,B===null){if(B=x.shared.pending,B===null)break;be=B,B=be.next,be.next=null,x.lastBaseUpdate=be,x.shared.pending=null}}while(!0);if(Ne===null&&(G=Ee),x.baseState=G,x.firstBaseUpdate=ce,x.lastBaseUpdate=Ne,o=x.shared.interleaved,o!==null){x=o;do T|=x.lane,x=x.next;while(x!==o)}else y===null&&(x.shared.lanes=0);jl|=T,s.lanes=T,s.memoizedState=Ee}}function uv(s,o,d){if(s=o.effects,o.effects=null,s!==null)for(o=0;o<s.length;o++){var f=s[o],x=f.callback;if(x!==null){if(f.callback=null,f=d,typeof x!="function")throw Error(t(191,x));x.call(f)}}}var xu={},Yi=Si(xu),yu=Si(xu),vu=Si(xu);function Al(s){if(s===xu)throw Error(t(174));return s}function dg(s,o){switch(Yt(vu,o),Yt(yu,s),Yt(Yi,xu),s=o.nodeType,s){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Vs(null,"");break;default:s=s===8?o.parentNode:o,o=s.namespaceURI||null,s=s.tagName,o=Vs(o,s)}tn(Yi),Yt(Yi,o)}function Yc(){tn(Yi),tn(yu),tn(vu)}function hv(s){Al(vu.current);var o=Al(Yi.current),d=Vs(o,s.type);o!==d&&(Yt(yu,s),Yt(Yi,d))}function ug(s){yu.current===s&&(tn(Yi),tn(yu))}var bn=Si(0);function Tm(s){for(var o=s;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var hg=[];function mg(){for(var s=0;s<hg.length;s++)hg[s]._workInProgressVersionPrimary=null;hg.length=0}var Am=xe.ReactCurrentDispatcher,pg=xe.ReactCurrentBatchConfig,Sl=0,wn=null,Jn=null,rr=null,Sm=!1,bu=!1,wu=0,lA=0;function wr(){throw Error(t(321))}function fg(s,o){if(o===null)return!1;for(var d=0;d<o.length&&d<s.length;d++)if(!rs(s[d],o[d]))return!1;return!0}function gg(s,o,d,f,x,y){if(Sl=y,wn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Am.current=s===null||s.memoizedState===null?hA:mA,s=d(f,x),bu){y=0;do{if(bu=!1,wu=0,25<=y)throw Error(t(301));y+=1,rr=Jn=null,o.updateQueue=null,Am.current=pA,s=d(f,x)}while(bu)}if(Am.current=Cm,o=Jn!==null&&Jn.next!==null,Sl=0,rr=Jn=wn=null,Sm=!1,o)throw Error(t(300));return s}function xg(){var s=wu!==0;return wu=0,s}function Ji(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rr===null?wn.memoizedState=rr=s:rr=rr.next=s,rr}function Xs(){if(Jn===null){var s=wn.alternate;s=s!==null?s.memoizedState:null}else s=Jn.next;var o=rr===null?wn.memoizedState:rr.next;if(o!==null)rr=o,Jn=s;else{if(s===null)throw Error(t(310));Jn=s,s={memoizedState:Jn.memoizedState,baseState:Jn.baseState,baseQueue:Jn.baseQueue,queue:Jn.queue,next:null},rr===null?wn.memoizedState=rr=s:rr=rr.next=s}return rr}function _u(s,o){return typeof o=="function"?o(s):o}function yg(s){var o=Xs(),d=o.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=s;var f=Jn,x=f.baseQueue,y=d.pending;if(y!==null){if(x!==null){var T=x.next;x.next=y.next,y.next=T}f.baseQueue=x=y,d.pending=null}if(x!==null){y=x.next,f=f.baseState;var B=T=null,G=null,ce=y;do{var Ne=ce.lane;if((Sl&Ne)===Ne)G!==null&&(G=G.next={lane:0,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),f=ce.hasEagerState?ce.eagerState:s(f,ce.action);else{var Ee={lane:Ne,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null};G===null?(B=G=Ee,T=f):G=G.next=Ee,wn.lanes|=Ne,jl|=Ne}ce=ce.next}while(ce!==null&&ce!==y);G===null?T=f:G.next=B,rs(f,o.memoizedState)||(is=!0),o.memoizedState=f,o.baseState=T,o.baseQueue=G,d.lastRenderedState=f}if(s=d.interleaved,s!==null){x=s;do y=x.lane,wn.lanes|=y,jl|=y,x=x.next;while(x!==s)}else x===null&&(d.lanes=0);return[o.memoizedState,d.dispatch]}function vg(s){var o=Xs(),d=o.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=s;var f=d.dispatch,x=d.pending,y=o.memoizedState;if(x!==null){d.pending=null;var T=x=x.next;do y=s(y,T.action),T=T.next;while(T!==x);rs(y,o.memoizedState)||(is=!0),o.memoizedState=y,o.baseQueue===null&&(o.baseState=y),d.lastRenderedState=y}return[y,f]}function mv(){}function pv(s,o){var d=wn,f=Xs(),x=o(),y=!rs(f.memoizedState,x);if(y&&(f.memoizedState=x,is=!0),f=f.queue,bg(xv.bind(null,d,f,s),[s]),f.getSnapshot!==o||y||rr!==null&&rr.memoizedState.tag&1){if(d.flags|=2048,Nu(9,gv.bind(null,d,f,x,o),void 0,null),sr===null)throw Error(t(349));(Sl&30)!==0||fv(d,o,x)}return x}function fv(s,o,d){s.flags|=16384,s={getSnapshot:o,value:d},o=wn.updateQueue,o===null?(o={lastEffect:null,stores:null},wn.updateQueue=o,o.stores=[s]):(d=o.stores,d===null?o.stores=[s]:d.push(s))}function gv(s,o,d,f){o.value=d,o.getSnapshot=f,yv(o)&&vv(s)}function xv(s,o,d){return d(function(){yv(o)&&vv(s)})}function yv(s){var o=s.getSnapshot;s=s.value;try{var d=o();return!rs(s,d)}catch{return!0}}function vv(s){var o=ka(s,1);o!==null&&Pi(o,s,1,-1)}function bv(s){var o=Ji();return typeof s=="function"&&(s=s()),o.memoizedState=o.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_u,lastRenderedState:s},o.queue=s,s=s.dispatch=uA.bind(null,wn,s),[o.memoizedState,s]}function Nu(s,o,d,f){return s={tag:s,create:o,destroy:d,deps:f,next:null},o=wn.updateQueue,o===null?(o={lastEffect:null,stores:null},wn.updateQueue=o,o.lastEffect=s.next=s):(d=o.lastEffect,d===null?o.lastEffect=s.next=s:(f=d.next,d.next=s,s.next=f,o.lastEffect=s)),s}function wv(){return Xs().memoizedState}function jm(s,o,d,f){var x=Ji();wn.flags|=s,x.memoizedState=Nu(1|o,d,void 0,f===void 0?null:f)}function km(s,o,d,f){var x=Xs();f=f===void 0?null:f;var y=void 0;if(Jn!==null){var T=Jn.memoizedState;if(y=T.destroy,f!==null&&fg(f,T.deps)){x.memoizedState=Nu(o,d,y,f);return}}wn.flags|=s,x.memoizedState=Nu(1|o,d,y,f)}function _v(s,o){return jm(8390656,8,s,o)}function bg(s,o){return km(2048,8,s,o)}function Nv(s,o){return km(4,2,s,o)}function Iv(s,o){return km(4,4,s,o)}function Ev(s,o){if(typeof o=="function")return s=s(),o(s),function(){o(null)};if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function Tv(s,o,d){return d=d!=null?d.concat([s]):null,km(4,4,Ev.bind(null,o,s),d)}function wg(){}function Av(s,o){var d=Xs();o=o===void 0?null:o;var f=d.memoizedState;return f!==null&&o!==null&&fg(o,f[1])?f[0]:(d.memoizedState=[s,o],s)}function Sv(s,o){var d=Xs();o=o===void 0?null:o;var f=d.memoizedState;return f!==null&&o!==null&&fg(o,f[1])?f[0]:(s=s(),d.memoizedState=[s,o],s)}function jv(s,o,d){return(Sl&21)===0?(s.baseState&&(s.baseState=!1,is=!0),s.memoizedState=d):(rs(d,o)||(d=so(),wn.lanes|=d,jl|=d,s.baseState=!0),o)}function cA(s,o){var d=kt;kt=d!==0&&4>d?d:4,s(!0);var f=pg.transition;pg.transition={};try{s(!1),o()}finally{kt=d,pg.transition=f}}function kv(){return Xs().memoizedState}function dA(s,o,d){var f=Ao(s);if(d={lane:f,action:d,hasEagerState:!1,eagerState:null,next:null},Cv(s))Rv(o,d);else if(d=lv(s,o,d,f),d!==null){var x=zr();Pi(d,s,f,x),Dv(d,o,f)}}function uA(s,o,d){var f=Ao(s),x={lane:f,action:d,hasEagerState:!1,eagerState:null,next:null};if(Cv(s))Rv(o,x);else{var y=s.alternate;if(s.lanes===0&&(y===null||y.lanes===0)&&(y=o.lastRenderedReducer,y!==null))try{var T=o.lastRenderedState,B=y(T,d);if(x.hasEagerState=!0,x.eagerState=B,rs(B,T)){var G=o.interleaved;G===null?(x.next=x,lg(o)):(x.next=G.next,G.next=x),o.interleaved=x;return}}catch{}finally{}d=lv(s,o,x,f),d!==null&&(x=zr(),Pi(d,s,f,x),Dv(d,o,f))}}function Cv(s){var o=s.alternate;return s===wn||o!==null&&o===wn}function Rv(s,o){bu=Sm=!0;var d=s.pending;d===null?o.next=o:(o.next=d.next,d.next=o),s.pending=o}function Dv(s,o,d){if((d&4194240)!==0){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,fa(s,d)}}var Cm={readContext:Js,useCallback:wr,useContext:wr,useEffect:wr,useImperativeHandle:wr,useInsertionEffect:wr,useLayoutEffect:wr,useMemo:wr,useReducer:wr,useRef:wr,useState:wr,useDebugValue:wr,useDeferredValue:wr,useTransition:wr,useMutableSource:wr,useSyncExternalStore:wr,useId:wr,unstable_isNewReconciler:!1},hA={readContext:Js,useCallback:function(s,o){return Ji().memoizedState=[s,o===void 0?null:o],s},useContext:Js,useEffect:_v,useImperativeHandle:function(s,o,d){return d=d!=null?d.concat([s]):null,jm(4194308,4,Ev.bind(null,o,s),d)},useLayoutEffect:function(s,o){return jm(4194308,4,s,o)},useInsertionEffect:function(s,o){return jm(4,2,s,o)},useMemo:function(s,o){var d=Ji();return o=o===void 0?null:o,s=s(),d.memoizedState=[s,o],s},useReducer:function(s,o,d){var f=Ji();return o=d!==void 0?d(o):o,f.memoizedState=f.baseState=o,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:o},f.queue=s,s=s.dispatch=dA.bind(null,wn,s),[f.memoizedState,s]},useRef:function(s){var o=Ji();return s={current:s},o.memoizedState=s},useState:bv,useDebugValue:wg,useDeferredValue:function(s){return Ji().memoizedState=s},useTransition:function(){var s=bv(!1),o=s[0];return s=cA.bind(null,s[1]),Ji().memoizedState=s,[o,s]},useMutableSource:function(){},useSyncExternalStore:function(s,o,d){var f=wn,x=Ji();if(At){if(d===void 0)throw Error(t(407));d=d()}else{if(d=o(),sr===null)throw Error(t(349));(Sl&30)!==0||fv(f,o,d)}x.memoizedState=d;var y={value:d,getSnapshot:o};return x.queue=y,_v(xv.bind(null,f,y,s),[s]),f.flags|=2048,Nu(9,gv.bind(null,f,y,d,o),void 0,null),d},useId:function(){var s=Ji(),o=sr.identifierPrefix;if(At){var d=Se,f=X;d=(f&~(1<<32-vr(f)-1)).toString(32)+d,o=":"+o+"R"+d,d=wu++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=lA++,o=":"+o+"r"+d.toString(32)+":";return s.memoizedState=o},unstable_isNewReconciler:!1},mA={readContext:Js,useCallback:Av,useContext:Js,useEffect:bg,useImperativeHandle:Tv,useInsertionEffect:Nv,useLayoutEffect:Iv,useMemo:Sv,useReducer:yg,useRef:wv,useState:function(){return yg(_u)},useDebugValue:wg,useDeferredValue:function(s){var o=Xs();return jv(o,Jn.memoizedState,s)},useTransition:function(){var s=yg(_u)[0],o=Xs().memoizedState;return[s,o]},useMutableSource:mv,useSyncExternalStore:pv,useId:kv,unstable_isNewReconciler:!1},pA={readContext:Js,useCallback:Av,useContext:Js,useEffect:bg,useImperativeHandle:Tv,useInsertionEffect:Nv,useLayoutEffect:Iv,useMemo:Sv,useReducer:vg,useRef:wv,useState:function(){return vg(_u)},useDebugValue:wg,useDeferredValue:function(s){var o=Xs();return Jn===null?o.memoizedState=s:jv(o,Jn.memoizedState,s)},useTransition:function(){var s=vg(_u)[0],o=Xs().memoizedState;return[s,o]},useMutableSource:mv,useSyncExternalStore:pv,useId:kv,unstable_isNewReconciler:!1};function Ci(s,o){if(s&&s.defaultProps){o=H({},o),s=s.defaultProps;for(var d in s)o[d]===void 0&&(o[d]=s[d]);return o}return o}function _g(s,o,d,f){o=s.memoizedState,d=d(f,o),d=d==null?o:H({},o,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var Rm={isMounted:function(s){return(s=s._reactInternals)?ys(s)===s:!1},enqueueSetState:function(s,o,d){s=s._reactInternals;var f=zr(),x=Ao(s),y=Ca(f,x);y.payload=o,d!=null&&(y.callback=d),o=No(s,y,x),o!==null&&(Pi(o,s,x,f),Im(o,s,x))},enqueueReplaceState:function(s,o,d){s=s._reactInternals;var f=zr(),x=Ao(s),y=Ca(f,x);y.tag=1,y.payload=o,d!=null&&(y.callback=d),o=No(s,y,x),o!==null&&(Pi(o,s,x,f),Im(o,s,x))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var d=zr(),f=Ao(s),x=Ca(d,f);x.tag=2,o!=null&&(x.callback=o),o=No(s,x,f),o!==null&&(Pi(o,s,f,d),Im(o,s,f))}};function Pv(s,o,d,f,x,y,T){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,y,T):o.prototype&&o.prototype.isPureReactComponent?!fo(d,f)||!fo(x,y):!0}function Ov(s,o,d){var f=!1,x=ji,y=o.contextType;return typeof y=="object"&&y!==null?y=Js(y):(x=hr(o)?Qi:Gn.current,f=o.contextTypes,y=(f=f!=null)?Aa(s,x):ji),o=new o(d,y),s.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Rm,s.stateNode=o,o._reactInternals=s,f&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=x,s.__reactInternalMemoizedMaskedChildContext=y),o}function Mv(s,o,d,f){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,f),o.state!==s&&Rm.enqueueReplaceState(o,o.state,null)}function Ng(s,o,d,f){var x=s.stateNode;x.props=d,x.state=s.memoizedState,x.refs={},cg(s);var y=o.contextType;typeof y=="object"&&y!==null?x.context=Js(y):(y=hr(o)?Qi:Gn.current,x.context=Aa(s,y)),x.state=s.memoizedState,y=o.getDerivedStateFromProps,typeof y=="function"&&(_g(s,o,y,d),x.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(o=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),o!==x.state&&Rm.enqueueReplaceState(x,x.state,null),Em(s,d,x,f),x.state=s.memoizedState),typeof x.componentDidMount=="function"&&(s.flags|=4194308)}function Jc(s,o){try{var d="",f=o;do d+=ke(f),f=f.return;while(f);var x=d}catch(y){x=`
Error generating stack: `+y.message+`
`+y.stack}return{value:s,source:o,stack:x,digest:null}}function Ig(s,o,d){return{value:s,source:null,stack:d??null,digest:o??null}}function Eg(s,o){try{console.error(o.value)}catch(d){setTimeout(function(){throw d})}}var fA=typeof WeakMap=="function"?WeakMap:Map;function Vv(s,o,d){d=Ca(-1,d),d.tag=3,d.payload={element:null};var f=o.value;return d.callback=function(){$m||($m=!0,Fg=f),Eg(s,o)},d}function Lv(s,o,d){d=Ca(-1,d),d.tag=3;var f=s.type.getDerivedStateFromError;if(typeof f=="function"){var x=o.value;d.payload=function(){return f(x)},d.callback=function(){Eg(s,o)}}var y=s.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(d.callback=function(){Eg(s,o),typeof f!="function"&&(Eo===null?Eo=new Set([this]):Eo.add(this));var T=o.stack;this.componentDidCatch(o.value,{componentStack:T!==null?T:""})}),d}function $v(s,o,d){var f=s.pingCache;if(f===null){f=s.pingCache=new fA;var x=new Set;f.set(o,x)}else x=f.get(o),x===void 0&&(x=new Set,f.set(o,x));x.has(d)||(x.add(d),s=jA.bind(null,s,o,d),o.then(s,s))}function Fv(s){do{var o;if((o=s.tag===13)&&(o=s.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return s;s=s.return}while(s!==null);return null}function Bv(s,o,d,f,x){return(s.mode&1)===0?(s===o?s.flags|=65536:(s.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(o=Ca(-1,1),o.tag=2,No(d,o,1))),d.lanes|=1),s):(s.flags|=65536,s.lanes=x,s)}var gA=xe.ReactCurrentOwner,is=!1;function Ur(s,o,d,f){o.child=s===null?ov(o,null,d,f):ja(o,s.child,d,f)}function Uv(s,o,d,f,x){d=d.render;var y=o.ref;return Qc(o,x),f=gg(s,o,d,f,y,x),d=xg(),s!==null&&!is?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~x,Ra(s,o,x)):(At&&d&&nt(o),o.flags|=1,Ur(s,o,f,x),o.child)}function zv(s,o,d,f,x){if(s===null){var y=d.type;return typeof y=="function"&&!Gg(y)&&y.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(o.tag=15,o.type=y,qv(s,o,y,f,x)):(s=Wm(d.type,null,f,o,o.mode,x),s.ref=o.ref,s.return=o,o.child=s)}if(y=s.child,(s.lanes&x)===0){var T=y.memoizedProps;if(d=d.compare,d=d!==null?d:fo,d(T,f)&&s.ref===o.ref)return Ra(s,o,x)}return o.flags|=1,s=jo(y,f),s.ref=o.ref,s.return=o,o.child=s}function qv(s,o,d,f,x){if(s!==null){var y=s.memoizedProps;if(fo(y,f)&&s.ref===o.ref)if(is=!1,o.pendingProps=f=y,(s.lanes&x)!==0)(s.flags&131072)!==0&&(is=!0);else return o.lanes=s.lanes,Ra(s,o,x)}return Tg(s,o,d,f,x)}function Wv(s,o,d){var f=o.pendingProps,x=f.children,y=s!==null?s.memoizedState:null;if(f.mode==="hidden")if((o.mode&1)===0)o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yt(Zc,Es),Es|=d;else{if((d&1073741824)===0)return s=y!==null?y.baseLanes|d:d,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:s,cachePool:null,transitions:null},o.updateQueue=null,Yt(Zc,Es),Es|=s,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=y!==null?y.baseLanes:d,Yt(Zc,Es),Es|=f}else y!==null?(f=y.baseLanes|d,o.memoizedState=null):f=d,Yt(Zc,Es),Es|=f;return Ur(s,o,x,d),o.child}function Hv(s,o){var d=o.ref;(s===null&&d!==null||s!==null&&s.ref!==d)&&(o.flags|=512,o.flags|=2097152)}function Tg(s,o,d,f,x){var y=hr(d)?Qi:Gn.current;return y=Aa(o,y),Qc(o,x),d=gg(s,o,d,f,y,x),f=xg(),s!==null&&!is?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~x,Ra(s,o,x)):(At&&f&&nt(o),o.flags|=1,Ur(s,o,d,x),o.child)}function Gv(s,o,d,f,x){if(hr(d)){var y=!0;Il(o)}else y=!1;if(Qc(o,x),o.stateNode===null)Pm(s,o),Ov(o,d,f),Ng(o,d,f,x),f=!0;else if(s===null){var T=o.stateNode,B=o.memoizedProps;T.props=B;var G=T.context,ce=d.contextType;typeof ce=="object"&&ce!==null?ce=Js(ce):(ce=hr(d)?Qi:Gn.current,ce=Aa(o,ce));var Ne=d.getDerivedStateFromProps,Ee=typeof Ne=="function"||typeof T.getSnapshotBeforeUpdate=="function";Ee||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(B!==f||G!==ce)&&Mv(o,T,f,ce),_o=!1;var be=o.memoizedState;T.state=be,Em(o,f,T,x),G=o.memoizedState,B!==f||be!==G||ur.current||_o?(typeof Ne=="function"&&(_g(o,d,Ne,f),G=o.memoizedState),(B=_o||Pv(o,d,B,f,be,G,ce))?(Ee||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(o.flags|=4194308)):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=G),T.props=f,T.state=G,T.context=ce,f=B):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{T=o.stateNode,cv(s,o),B=o.memoizedProps,ce=o.type===o.elementType?B:Ci(o.type,B),T.props=ce,Ee=o.pendingProps,be=T.context,G=d.contextType,typeof G=="object"&&G!==null?G=Js(G):(G=hr(d)?Qi:Gn.current,G=Aa(o,G));var Ue=d.getDerivedStateFromProps;(Ne=typeof Ue=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(B!==Ee||be!==G)&&Mv(o,T,f,G),_o=!1,be=o.memoizedState,T.state=be,Em(o,f,T,x);var Je=o.memoizedState;B!==Ee||be!==Je||ur.current||_o?(typeof Ue=="function"&&(_g(o,d,Ue,f),Je=o.memoizedState),(ce=_o||Pv(o,d,ce,f,be,Je,G)||!1)?(Ne||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,Je,G),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,Je,G)),typeof T.componentDidUpdate=="function"&&(o.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof T.componentDidUpdate!="function"||B===s.memoizedProps&&be===s.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||B===s.memoizedProps&&be===s.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=Je),T.props=f,T.state=Je,T.context=G,f=ce):(typeof T.componentDidUpdate!="function"||B===s.memoizedProps&&be===s.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||B===s.memoizedProps&&be===s.memoizedState||(o.flags|=1024),f=!1)}return Ag(s,o,d,f,y,x)}function Ag(s,o,d,f,x,y){Hv(s,o);var T=(o.flags&128)!==0;if(!f&&!T)return x&&mu(o,d,!1),Ra(s,o,y);f=o.stateNode,gA.current=o;var B=T&&typeof d.getDerivedStateFromError!="function"?null:f.render();return o.flags|=1,s!==null&&T?(o.child=ja(o,s.child,null,y),o.child=ja(o,null,B,y)):Ur(s,o,B,y),o.memoizedState=f.state,x&&mu(o,d,!0),o.child}function Kv(s){var o=s.stateNode;o.pendingContext?uu(s,o.pendingContext,o.pendingContext!==o.context):o.context&&uu(s,o.context,!1),dg(s,o.containerInfo)}function Qv(s,o,d,f,x){return An(),Br(x),o.flags|=256,Ur(s,o,d,f),o.child}var Sg={dehydrated:null,treeContext:null,retryLane:0};function jg(s){return{baseLanes:s,cachePool:null,transitions:null}}function Yv(s,o,d){var f=o.pendingProps,x=bn.current,y=!1,T=(o.flags&128)!==0,B;if((B=T)||(B=s!==null&&s.memoizedState===null?!1:(x&2)!==0),B?(y=!0,o.flags&=-129):(s===null||s.memoizedState!==null)&&(x|=1),Yt(bn,x&1),s===null)return Nt(o),s=o.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?((o.mode&1)===0?o.lanes=1:s.data==="$!"?o.lanes=8:o.lanes=1073741824,null):(T=f.children,s=f.fallback,y?(f=o.mode,y=o.child,T={mode:"hidden",children:T},(f&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=T):y=Hm(T,f,0,null),s=Dl(s,f,d,null),y.return=o,s.return=o,y.sibling=s,o.child=y,o.child.memoizedState=jg(d),o.memoizedState=Sg,s):kg(o,T));if(x=s.memoizedState,x!==null&&(B=x.dehydrated,B!==null))return xA(s,o,T,f,B,x,d);if(y){y=f.fallback,T=o.mode,x=s.child,B=x.sibling;var G={mode:"hidden",children:f.children};return(T&1)===0&&o.child!==x?(f=o.child,f.childLanes=0,f.pendingProps=G,o.deletions=null):(f=jo(x,G),f.subtreeFlags=x.subtreeFlags&14680064),B!==null?y=jo(B,y):(y=Dl(y,T,d,null),y.flags|=2),y.return=o,f.return=o,f.sibling=y,o.child=f,f=y,y=o.child,T=s.child.memoizedState,T=T===null?jg(d):{baseLanes:T.baseLanes|d,cachePool:null,transitions:T.transitions},y.memoizedState=T,y.childLanes=s.childLanes&~d,o.memoizedState=Sg,f}return y=s.child,s=y.sibling,f=jo(y,{mode:"visible",children:f.children}),(o.mode&1)===0&&(f.lanes=d),f.return=o,f.sibling=null,s!==null&&(d=o.deletions,d===null?(o.deletions=[s],o.flags|=16):d.push(s)),o.child=f,o.memoizedState=null,f}function kg(s,o){return o=Hm({mode:"visible",children:o},s.mode,0,null),o.return=s,s.child=o}function Dm(s,o,d,f){return f!==null&&Br(f),ja(o,s.child,null,d),s=kg(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function xA(s,o,d,f,x,y,T){if(d)return o.flags&256?(o.flags&=-257,f=Ig(Error(t(422))),Dm(s,o,T,f)):o.memoizedState!==null?(o.child=s.child,o.flags|=128,null):(y=f.fallback,x=o.mode,f=Hm({mode:"visible",children:f.children},x,0,null),y=Dl(y,x,T,null),y.flags|=2,f.return=o,y.return=o,f.sibling=y,o.child=f,(o.mode&1)!==0&&ja(o,s.child,null,T),o.child.memoizedState=jg(T),o.memoizedState=Sg,y);if((o.mode&1)===0)return Dm(s,o,T,null);if(x.data==="$!"){if(f=x.nextSibling&&x.nextSibling.dataset,f)var B=f.dgst;return f=B,y=Error(t(419)),f=Ig(y,f,void 0),Dm(s,o,T,f)}if(B=(T&s.childLanes)!==0,is||B){if(f=sr,f!==null){switch(T&-T){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(f.suspendedLanes|T))!==0?0:x,x!==0&&x!==y.retryLane&&(y.retryLane=x,ka(s,x),Pi(f,s,x,-1))}return Hg(),f=Ig(Error(t(421))),Dm(s,o,T,f)}return x.data==="$?"?(o.flags|=128,o.child=s.child,o=kA.bind(null,s),x._reactRetry=o,null):(s=y.treeContext,wt=Ai(x.nextSibling),mt=o,At=!0,Le=null,s!==null&&(A[re++]=X,A[re++]=Se,A[re++]=Y,X=s.id,Se=s.overflow,Y=o),o=kg(o,f.children),o.flags|=4096,o)}function Jv(s,o,d){s.lanes|=o;var f=s.alternate;f!==null&&(f.lanes|=o),og(s.return,o,d)}function Cg(s,o,d,f,x){var y=s.memoizedState;y===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:d,tailMode:x}:(y.isBackwards=o,y.rendering=null,y.renderingStartTime=0,y.last=f,y.tail=d,y.tailMode=x)}function Xv(s,o,d){var f=o.pendingProps,x=f.revealOrder,y=f.tail;if(Ur(s,o,f.children,d),f=bn.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Jv(s,d,o);else if(s.tag===19)Jv(s,d,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break e;for(;s.sibling===null;){if(s.return===null||s.return===o)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}f&=1}if(Yt(bn,f),(o.mode&1)===0)o.memoizedState=null;else switch(x){case"forwards":for(d=o.child,x=null;d!==null;)s=d.alternate,s!==null&&Tm(s)===null&&(x=d),d=d.sibling;d=x,d===null?(x=o.child,o.child=null):(x=d.sibling,d.sibling=null),Cg(o,!1,x,d,y);break;case"backwards":for(d=null,x=o.child,o.child=null;x!==null;){if(s=x.alternate,s!==null&&Tm(s)===null){o.child=x;break}s=x.sibling,x.sibling=d,d=x,x=s}Cg(o,!0,d,null,y);break;case"together":Cg(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Pm(s,o){(o.mode&1)===0&&s!==null&&(s.alternate=null,o.alternate=null,o.flags|=2)}function Ra(s,o,d){if(s!==null&&(o.dependencies=s.dependencies),jl|=o.lanes,(d&o.childLanes)===0)return null;if(s!==null&&o.child!==s.child)throw Error(t(153));if(o.child!==null){for(s=o.child,d=jo(s,s.pendingProps),o.child=d,d.return=o;s.sibling!==null;)s=s.sibling,d=d.sibling=jo(s,s.pendingProps),d.return=o;d.sibling=null}return o.child}function yA(s,o,d){switch(o.tag){case 3:Kv(o),An();break;case 5:hv(o);break;case 1:hr(o.type)&&Il(o);break;case 4:dg(o,o.stateNode.containerInfo);break;case 10:var f=o.type._context,x=o.memoizedProps.value;Yt(_m,f._currentValue),f._currentValue=x;break;case 13:if(f=o.memoizedState,f!==null)return f.dehydrated!==null?(Yt(bn,bn.current&1),o.flags|=128,null):(d&o.child.childLanes)!==0?Yv(s,o,d):(Yt(bn,bn.current&1),s=Ra(s,o,d),s!==null?s.sibling:null);Yt(bn,bn.current&1);break;case 19:if(f=(d&o.childLanes)!==0,(s.flags&128)!==0){if(f)return Xv(s,o,d);o.flags|=128}if(x=o.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),Yt(bn,bn.current),f)break;return null;case 22:case 23:return o.lanes=0,Wv(s,o,d)}return Ra(s,o,d)}var Zv,Rg,eb,tb;Zv=function(s,o){for(var d=o.child;d!==null;){if(d.tag===5||d.tag===6)s.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Rg=function(){},eb=function(s,o,d,f){var x=s.memoizedProps;if(x!==f){s=o.stateNode,Al(Yi.current);var y=null;switch(d){case"input":x=mn(s,x),f=mn(s,f),y=[];break;case"select":x=H({},x,{value:void 0}),f=H({},f,{value:void 0}),y=[];break;case"textarea":x=Yr(s,x),f=Yr(s,f),y=[];break;default:typeof x.onClick!="function"&&typeof f.onClick=="function"&&(s.onclick=wl)}Qe(d,f);var T;d=null;for(ce in x)if(!f.hasOwnProperty(ce)&&x.hasOwnProperty(ce)&&x[ce]!=null)if(ce==="style"){var B=x[ce];for(T in B)B.hasOwnProperty(T)&&(d||(d={}),d[T]="")}else ce!=="dangerouslySetInnerHTML"&&ce!=="children"&&ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&ce!=="autoFocus"&&(i.hasOwnProperty(ce)?y||(y=[]):(y=y||[]).push(ce,null));for(ce in f){var G=f[ce];if(B=x!=null?x[ce]:void 0,f.hasOwnProperty(ce)&&G!==B&&(G!=null||B!=null))if(ce==="style")if(B){for(T in B)!B.hasOwnProperty(T)||G&&G.hasOwnProperty(T)||(d||(d={}),d[T]="");for(T in G)G.hasOwnProperty(T)&&B[T]!==G[T]&&(d||(d={}),d[T]=G[T])}else d||(y||(y=[]),y.push(ce,d)),d=G;else ce==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,B=B?B.__html:void 0,G!=null&&B!==G&&(y=y||[]).push(ce,G)):ce==="children"?typeof G!="string"&&typeof G!="number"||(y=y||[]).push(ce,""+G):ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&(i.hasOwnProperty(ce)?(G!=null&&ce==="onScroll"&&en("scroll",s),y||B===G||(y=[])):(y=y||[]).push(ce,G))}d&&(y=y||[]).push("style",d);var ce=y;(o.updateQueue=ce)&&(o.flags|=4)}},tb=function(s,o,d,f){d!==f&&(o.flags|=4)};function Iu(s,o){if(!At)switch(s.tailMode){case"hidden":o=s.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function _r(s){var o=s.alternate!==null&&s.alternate.child===s.child,d=0,f=0;if(o)for(var x=s.child;x!==null;)d|=x.lanes|x.childLanes,f|=x.subtreeFlags&14680064,f|=x.flags&14680064,x.return=s,x=x.sibling;else for(x=s.child;x!==null;)d|=x.lanes|x.childLanes,f|=x.subtreeFlags,f|=x.flags,x.return=s,x=x.sibling;return s.subtreeFlags|=f,s.childLanes=d,o}function vA(s,o,d){var f=o.pendingProps;switch(ht(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _r(o),null;case 1:return hr(o.type)&&Nl(),_r(o),null;case 3:return f=o.stateNode,Yc(),tn(ur),tn(Gn),mg(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(s===null||s.child===null)&&(an(o)?o.flags|=4:s===null||s.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Le!==null&&(zg(Le),Le=null))),Rg(s,o),_r(o),null;case 5:ug(o);var x=Al(vu.current);if(d=o.type,s!==null&&o.stateNode!=null)eb(s,o,d,f,x),s.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!f){if(o.stateNode===null)throw Error(t(166));return _r(o),null}if(s=Al(Yi.current),an(o)){f=o.stateNode,d=o.type;var y=o.memoizedProps;switch(f[Is]=o,f[bo]=y,s=(o.mode&1)!==0,d){case"dialog":en("cancel",f),en("close",f);break;case"iframe":case"object":case"embed":en("load",f);break;case"video":case"audio":for(x=0;x<xo.length;x++)en(xo[x],f);break;case"source":en("error",f);break;case"img":case"image":case"link":en("error",f),en("load",f);break;case"details":en("toggle",f);break;case"input":pn(f,y),en("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!y.multiple},en("invalid",f);break;case"textarea":ms(f,y),en("invalid",f)}Qe(d,y),x=null;for(var T in y)if(y.hasOwnProperty(T)){var B=y[T];T==="children"?typeof B=="string"?f.textContent!==B&&(y.suppressHydrationWarning!==!0&&bl(f.textContent,B,s),x=["children",B]):typeof B=="number"&&f.textContent!==""+B&&(y.suppressHydrationWarning!==!0&&bl(f.textContent,B,s),x=["children",""+B]):i.hasOwnProperty(T)&&B!=null&&T==="onScroll"&&en("scroll",f)}switch(d){case"input":on(f),zt(f,y,!0);break;case"textarea":on(f),Ms(f);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(f.onclick=wl)}f=x,o.updateQueue=f,f!==null&&(o.flags|=4)}else{T=x.nodeType===9?x:x.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=hi(d)),s==="http://www.w3.org/1999/xhtml"?d==="script"?(s=T.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof f.is=="string"?s=T.createElement(d,{is:f.is}):(s=T.createElement(d),d==="select"&&(T=s,f.multiple?T.multiple=!0:f.size&&(T.size=f.size))):s=T.createElementNS(s,d),s[Is]=o,s[bo]=f,Zv(s,o,!1,!1),o.stateNode=s;e:{switch(T=J(d,f),d){case"dialog":en("cancel",s),en("close",s),x=f;break;case"iframe":case"object":case"embed":en("load",s),x=f;break;case"video":case"audio":for(x=0;x<xo.length;x++)en(xo[x],s);x=f;break;case"source":en("error",s),x=f;break;case"img":case"image":case"link":en("error",s),en("load",s),x=f;break;case"details":en("toggle",s),x=f;break;case"input":pn(s,f),x=mn(s,f),en("invalid",s);break;case"option":x=f;break;case"select":s._wrapperState={wasMultiple:!!f.multiple},x=H({},f,{value:void 0}),en("invalid",s);break;case"textarea":ms(s,f),x=Yr(s,f),en("invalid",s);break;default:x=f}Qe(d,x),B=x;for(y in B)if(B.hasOwnProperty(y)){var G=B[y];y==="style"?_e(s,G):y==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,G!=null&&ma(s,G)):y==="children"?typeof G=="string"?(d!=="textarea"||G!=="")&&or(s,G):typeof G=="number"&&or(s,""+G):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(i.hasOwnProperty(y)?G!=null&&y==="onScroll"&&en("scroll",s):G!=null&&ae(s,y,G,T))}switch(d){case"input":on(s),zt(s,f,!1);break;case"textarea":on(s),Ms(s);break;case"option":f.value!=null&&s.setAttribute("value",""+pt(f.value));break;case"select":s.multiple=!!f.multiple,y=f.value,y!=null?jt(s,!!f.multiple,y,!1):f.defaultValue!=null&&jt(s,!!f.multiple,f.defaultValue,!0);break;default:typeof x.onClick=="function"&&(s.onclick=wl)}switch(d){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return _r(o),null;case 6:if(s&&o.stateNode!=null)tb(s,o,s.memoizedProps,f);else{if(typeof f!="string"&&o.stateNode===null)throw Error(t(166));if(d=Al(vu.current),Al(Yi.current),an(o)){if(f=o.stateNode,d=o.memoizedProps,f[Is]=o,(y=f.nodeValue!==d)&&(s=mt,s!==null))switch(s.tag){case 3:bl(f.nodeValue,d,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&bl(f.nodeValue,d,(s.mode&1)!==0)}y&&(o.flags|=4)}else f=(d.nodeType===9?d:d.ownerDocument).createTextNode(f),f[Is]=o,o.stateNode=f}return _r(o),null;case 13:if(tn(bn),f=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(At&&wt!==null&&(o.mode&1)!==0&&(o.flags&128)===0)Qn(),An(),o.flags|=98560,y=!1;else if(y=an(o),f!==null&&f.dehydrated!==null){if(s===null){if(!y)throw Error(t(318));if(y=o.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(t(317));y[Is]=o}else An(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;_r(o),y=!1}else Le!==null&&(zg(Le),Le=null),y=!0;if(!y)return o.flags&65536?o:null}return(o.flags&128)!==0?(o.lanes=d,o):(f=f!==null,f!==(s!==null&&s.memoizedState!==null)&&f&&(o.child.flags|=8192,(o.mode&1)!==0&&(s===null||(bn.current&1)!==0?Xn===0&&(Xn=3):Hg())),o.updateQueue!==null&&(o.flags|=4),_r(o),null);case 4:return Yc(),Rg(s,o),s===null&&yo(o.stateNode.containerInfo),_r(o),null;case 10:return ag(o.type._context),_r(o),null;case 17:return hr(o.type)&&Nl(),_r(o),null;case 19:if(tn(bn),y=o.memoizedState,y===null)return _r(o),null;if(f=(o.flags&128)!==0,T=y.rendering,T===null)if(f)Iu(y,!1);else{if(Xn!==0||s!==null&&(s.flags&128)!==0)for(s=o.child;s!==null;){if(T=Tm(s),T!==null){for(o.flags|=128,Iu(y,!1),f=T.updateQueue,f!==null&&(o.updateQueue=f,o.flags|=4),o.subtreeFlags=0,f=d,d=o.child;d!==null;)y=d,s=f,y.flags&=14680066,T=y.alternate,T===null?(y.childLanes=0,y.lanes=s,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=T.childLanes,y.lanes=T.lanes,y.child=T.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=T.memoizedProps,y.memoizedState=T.memoizedState,y.updateQueue=T.updateQueue,y.type=T.type,s=T.dependencies,y.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),d=d.sibling;return Yt(bn,bn.current&1|2),o.child}s=s.sibling}y.tail!==null&&Wt()>ed&&(o.flags|=128,f=!0,Iu(y,!1),o.lanes=4194304)}else{if(!f)if(s=Tm(T),s!==null){if(o.flags|=128,f=!0,d=s.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),Iu(y,!0),y.tail===null&&y.tailMode==="hidden"&&!T.alternate&&!At)return _r(o),null}else 2*Wt()-y.renderingStartTime>ed&&d!==1073741824&&(o.flags|=128,f=!0,Iu(y,!1),o.lanes=4194304);y.isBackwards?(T.sibling=o.child,o.child=T):(d=y.last,d!==null?d.sibling=T:o.child=T,y.last=T)}return y.tail!==null?(o=y.tail,y.rendering=o,y.tail=o.sibling,y.renderingStartTime=Wt(),o.sibling=null,d=bn.current,Yt(bn,f?d&1|2:d&1),o):(_r(o),null);case 22:case 23:return Wg(),f=o.memoizedState!==null,s!==null&&s.memoizedState!==null!==f&&(o.flags|=8192),f&&(o.mode&1)!==0?(Es&1073741824)!==0&&(_r(o),o.subtreeFlags&6&&(o.flags|=8192)):_r(o),null;case 24:return null;case 25:return null}throw Error(t(156,o.tag))}function bA(s,o){switch(ht(o),o.tag){case 1:return hr(o.type)&&Nl(),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return Yc(),tn(ur),tn(Gn),mg(),s=o.flags,(s&65536)!==0&&(s&128)===0?(o.flags=s&-65537|128,o):null;case 5:return ug(o),null;case 13:if(tn(bn),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(t(340));An()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return tn(bn),null;case 4:return Yc(),null;case 10:return ag(o.type._context),null;case 22:case 23:return Wg(),null;case 24:return null;default:return null}}var Om=!1,Nr=!1,wA=typeof WeakSet=="function"?WeakSet:Set,Ke=null;function Xc(s,o){var d=s.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(f){Sn(s,o,f)}else d.current=null}function Dg(s,o,d){try{d()}catch(f){Sn(s,o,f)}}var nb=!1;function _A(s,o){if(Fc=Ct,s=Qd(),Rc(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else e:{d=(d=s.ownerDocument)&&d.defaultView||window;var f=d.getSelection&&d.getSelection();if(f&&f.rangeCount!==0){d=f.anchorNode;var x=f.anchorOffset,y=f.focusNode;f=f.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var T=0,B=-1,G=-1,ce=0,Ne=0,Ee=s,be=null;t:for(;;){for(var Ue;Ee!==d||x!==0&&Ee.nodeType!==3||(B=T+x),Ee!==y||f!==0&&Ee.nodeType!==3||(G=T+f),Ee.nodeType===3&&(T+=Ee.nodeValue.length),(Ue=Ee.firstChild)!==null;)be=Ee,Ee=Ue;for(;;){if(Ee===s)break t;if(be===d&&++ce===x&&(B=T),be===y&&++Ne===f&&(G=T),(Ue=Ee.nextSibling)!==null)break;Ee=be,be=Ee.parentNode}Ee=Ue}d=B===-1||G===-1?null:{start:B,end:G}}else d=null}d=d||{start:0,end:0}}else d=null;for(Bc={focusedElem:s,selectionRange:d},Ct=!1,Ke=o;Ke!==null;)if(o=Ke,s=o.child,(o.subtreeFlags&1028)!==0&&s!==null)s.return=o,Ke=s;else for(;Ke!==null;){o=Ke;try{var Je=o.alternate;if((o.flags&1024)!==0)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Je!==null){var Ze=Je.memoizedProps,On=Je.memoizedState,te=o.stateNode,Q=te.getSnapshotBeforeUpdate(o.elementType===o.type?Ze:Ci(o.type,Ze),On);te.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var ne=o.stateNode.containerInfo;ne.nodeType===1?ne.textContent="":ne.nodeType===9&&ne.documentElement&&ne.removeChild(ne.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(je){Sn(o,o.return,je)}if(s=o.sibling,s!==null){s.return=o.return,Ke=s;break}Ke=o.return}return Je=nb,nb=!1,Je}function Eu(s,o,d){var f=o.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var x=f=f.next;do{if((x.tag&s)===s){var y=x.destroy;x.destroy=void 0,y!==void 0&&Dg(o,d,y)}x=x.next}while(x!==f)}}function Mm(s,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&s)===s){var f=d.create;d.destroy=f()}d=d.next}while(d!==o)}}function Pg(s){var o=s.ref;if(o!==null){var d=s.stateNode;switch(s.tag){case 5:s=d;break;default:s=d}typeof o=="function"?o(s):o.current=s}}function rb(s){var o=s.alternate;o!==null&&(s.alternate=null,rb(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&(delete o[Is],delete o[bo],delete o[Wc],delete o[vm],delete o[bm])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function sb(s){return s.tag===5||s.tag===3||s.tag===4}function ib(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||sb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Og(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(s,o):d.insertBefore(s,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(s,d)):(o=d,o.appendChild(s)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=wl));else if(f!==4&&(s=s.child,s!==null))for(Og(s,o,d),s=s.sibling;s!==null;)Og(s,o,d),s=s.sibling}function Mg(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?d.insertBefore(s,o):d.appendChild(s);else if(f!==4&&(s=s.child,s!==null))for(Mg(s,o,d),s=s.sibling;s!==null;)Mg(s,o,d),s=s.sibling}var pr=null,Ri=!1;function Io(s,o,d){for(d=d.child;d!==null;)ab(s,o,d),d=d.sibling}function ab(s,o,d){if(Dr&&typeof Dr.onCommitFiberUnmount=="function")try{Dr.onCommitFiberUnmount(gi,d)}catch{}switch(d.tag){case 5:Nr||Xc(d,o);case 6:var f=pr,x=Ri;pr=null,Io(s,o,d),pr=f,Ri=x,pr!==null&&(Ri?(s=pr,d=d.stateNode,s.nodeType===8?s.parentNode.removeChild(d):s.removeChild(d)):pr.removeChild(d.stateNode));break;case 18:pr!==null&&(Ri?(s=pr,d=d.stateNode,s.nodeType===8?qc(s.parentNode,d):s.nodeType===1&&qc(s,d),$t(s)):qc(pr,d.stateNode));break;case 4:f=pr,x=Ri,pr=d.stateNode.containerInfo,Ri=!0,Io(s,o,d),pr=f,Ri=x;break;case 0:case 11:case 14:case 15:if(!Nr&&(f=d.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){x=f=f.next;do{var y=x,T=y.destroy;y=y.tag,T!==void 0&&((y&2)!==0||(y&4)!==0)&&Dg(d,o,T),x=x.next}while(x!==f)}Io(s,o,d);break;case 1:if(!Nr&&(Xc(d,o),f=d.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=d.memoizedProps,f.state=d.memoizedState,f.componentWillUnmount()}catch(B){Sn(d,o,B)}Io(s,o,d);break;case 21:Io(s,o,d);break;case 22:d.mode&1?(Nr=(f=Nr)||d.memoizedState!==null,Io(s,o,d),Nr=f):Io(s,o,d);break;default:Io(s,o,d)}}function ob(s){var o=s.updateQueue;if(o!==null){s.updateQueue=null;var d=s.stateNode;d===null&&(d=s.stateNode=new wA),o.forEach(function(f){var x=CA.bind(null,s,f);d.has(f)||(d.add(f),f.then(x,x))})}}function Di(s,o){var d=o.deletions;if(d!==null)for(var f=0;f<d.length;f++){var x=d[f];try{var y=s,T=o,B=T;e:for(;B!==null;){switch(B.tag){case 5:pr=B.stateNode,Ri=!1;break e;case 3:pr=B.stateNode.containerInfo,Ri=!0;break e;case 4:pr=B.stateNode.containerInfo,Ri=!0;break e}B=B.return}if(pr===null)throw Error(t(160));ab(y,T,x),pr=null,Ri=!1;var G=x.alternate;G!==null&&(G.return=null),x.return=null}catch(ce){Sn(x,o,ce)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)lb(o,s),o=o.sibling}function lb(s,o){var d=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Di(o,s),Xi(s),f&4){try{Eu(3,s,s.return),Mm(3,s)}catch(Ze){Sn(s,s.return,Ze)}try{Eu(5,s,s.return)}catch(Ze){Sn(s,s.return,Ze)}}break;case 1:Di(o,s),Xi(s),f&512&&d!==null&&Xc(d,d.return);break;case 5:if(Di(o,s),Xi(s),f&512&&d!==null&&Xc(d,d.return),s.flags&32){var x=s.stateNode;try{or(x,"")}catch(Ze){Sn(s,s.return,Ze)}}if(f&4&&(x=s.stateNode,x!=null)){var y=s.memoizedProps,T=d!==null?d.memoizedProps:y,B=s.type,G=s.updateQueue;if(s.updateQueue=null,G!==null)try{B==="input"&&y.type==="radio"&&y.name!=null&&yn(x,y),J(B,T);var ce=J(B,y);for(T=0;T<G.length;T+=2){var Ne=G[T],Ee=G[T+1];Ne==="style"?_e(x,Ee):Ne==="dangerouslySetInnerHTML"?ma(x,Ee):Ne==="children"?or(x,Ee):ae(x,Ne,Ee,ce)}switch(B){case"input":Be(x,y);break;case"textarea":ui(x,y);break;case"select":var be=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!y.multiple;var Ue=y.value;Ue!=null?jt(x,!!y.multiple,Ue,!1):be!==!!y.multiple&&(y.defaultValue!=null?jt(x,!!y.multiple,y.defaultValue,!0):jt(x,!!y.multiple,y.multiple?[]:"",!1))}x[bo]=y}catch(Ze){Sn(s,s.return,Ze)}}break;case 6:if(Di(o,s),Xi(s),f&4){if(s.stateNode===null)throw Error(t(162));x=s.stateNode,y=s.memoizedProps;try{x.nodeValue=y}catch(Ze){Sn(s,s.return,Ze)}}break;case 3:if(Di(o,s),Xi(s),f&4&&d!==null&&d.memoizedState.isDehydrated)try{$t(o.containerInfo)}catch(Ze){Sn(s,s.return,Ze)}break;case 4:Di(o,s),Xi(s);break;case 13:Di(o,s),Xi(s),x=s.child,x.flags&8192&&(y=x.memoizedState!==null,x.stateNode.isHidden=y,!y||x.alternate!==null&&x.alternate.memoizedState!==null||($g=Wt())),f&4&&ob(s);break;case 22:if(Ne=d!==null&&d.memoizedState!==null,s.mode&1?(Nr=(ce=Nr)||Ne,Di(o,s),Nr=ce):Di(o,s),Xi(s),f&8192){if(ce=s.memoizedState!==null,(s.stateNode.isHidden=ce)&&!Ne&&(s.mode&1)!==0)for(Ke=s,Ne=s.child;Ne!==null;){for(Ee=Ke=Ne;Ke!==null;){switch(be=Ke,Ue=be.child,be.tag){case 0:case 11:case 14:case 15:Eu(4,be,be.return);break;case 1:Xc(be,be.return);var Je=be.stateNode;if(typeof Je.componentWillUnmount=="function"){f=be,d=be.return;try{o=f,Je.props=o.memoizedProps,Je.state=o.memoizedState,Je.componentWillUnmount()}catch(Ze){Sn(f,d,Ze)}}break;case 5:Xc(be,be.return);break;case 22:if(be.memoizedState!==null){ub(Ee);continue}}Ue!==null?(Ue.return=be,Ke=Ue):ub(Ee)}Ne=Ne.sibling}e:for(Ne=null,Ee=s;;){if(Ee.tag===5){if(Ne===null){Ne=Ee;try{x=Ee.stateNode,ce?(y=x.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(B=Ee.stateNode,G=Ee.memoizedProps.style,T=G!=null&&G.hasOwnProperty("display")?G.display:null,B.style.display=se("display",T))}catch(Ze){Sn(s,s.return,Ze)}}}else if(Ee.tag===6){if(Ne===null)try{Ee.stateNode.nodeValue=ce?"":Ee.memoizedProps}catch(Ze){Sn(s,s.return,Ze)}}else if((Ee.tag!==22&&Ee.tag!==23||Ee.memoizedState===null||Ee===s)&&Ee.child!==null){Ee.child.return=Ee,Ee=Ee.child;continue}if(Ee===s)break e;for(;Ee.sibling===null;){if(Ee.return===null||Ee.return===s)break e;Ne===Ee&&(Ne=null),Ee=Ee.return}Ne===Ee&&(Ne=null),Ee.sibling.return=Ee.return,Ee=Ee.sibling}}break;case 19:Di(o,s),Xi(s),f&4&&ob(s);break;case 21:break;default:Di(o,s),Xi(s)}}function Xi(s){var o=s.flags;if(o&2){try{e:{for(var d=s.return;d!==null;){if(sb(d)){var f=d;break e}d=d.return}throw Error(t(160))}switch(f.tag){case 5:var x=f.stateNode;f.flags&32&&(or(x,""),f.flags&=-33);var y=ib(s);Mg(s,y,x);break;case 3:case 4:var T=f.stateNode.containerInfo,B=ib(s);Og(s,B,T);break;default:throw Error(t(161))}}catch(G){Sn(s,s.return,G)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function NA(s,o,d){Ke=s,cb(s)}function cb(s,o,d){for(var f=(s.mode&1)!==0;Ke!==null;){var x=Ke,y=x.child;if(x.tag===22&&f){var T=x.memoizedState!==null||Om;if(!T){var B=x.alternate,G=B!==null&&B.memoizedState!==null||Nr;B=Om;var ce=Nr;if(Om=T,(Nr=G)&&!ce)for(Ke=x;Ke!==null;)T=Ke,G=T.child,T.tag===22&&T.memoizedState!==null?hb(x):G!==null?(G.return=T,Ke=G):hb(x);for(;y!==null;)Ke=y,cb(y),y=y.sibling;Ke=x,Om=B,Nr=ce}db(s)}else(x.subtreeFlags&8772)!==0&&y!==null?(y.return=x,Ke=y):db(s)}}function db(s){for(;Ke!==null;){var o=Ke;if((o.flags&8772)!==0){var d=o.alternate;try{if((o.flags&8772)!==0)switch(o.tag){case 0:case 11:case 15:Nr||Mm(5,o);break;case 1:var f=o.stateNode;if(o.flags&4&&!Nr)if(d===null)f.componentDidMount();else{var x=o.elementType===o.type?d.memoizedProps:Ci(o.type,d.memoizedProps);f.componentDidUpdate(x,d.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var y=o.updateQueue;y!==null&&uv(o,y,f);break;case 3:var T=o.updateQueue;if(T!==null){if(d=null,o.child!==null)switch(o.child.tag){case 5:d=o.child.stateNode;break;case 1:d=o.child.stateNode}uv(o,T,d)}break;case 5:var B=o.stateNode;if(d===null&&o.flags&4){d=B;var G=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":G.autoFocus&&d.focus();break;case"img":G.src&&(d.src=G.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var ce=o.alternate;if(ce!==null){var Ne=ce.memoizedState;if(Ne!==null){var Ee=Ne.dehydrated;Ee!==null&&$t(Ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Nr||o.flags&512&&Pg(o)}catch(be){Sn(o,o.return,be)}}if(o===s){Ke=null;break}if(d=o.sibling,d!==null){d.return=o.return,Ke=d;break}Ke=o.return}}function ub(s){for(;Ke!==null;){var o=Ke;if(o===s){Ke=null;break}var d=o.sibling;if(d!==null){d.return=o.return,Ke=d;break}Ke=o.return}}function hb(s){for(;Ke!==null;){var o=Ke;try{switch(o.tag){case 0:case 11:case 15:var d=o.return;try{Mm(4,o)}catch(G){Sn(o,d,G)}break;case 1:var f=o.stateNode;if(typeof f.componentDidMount=="function"){var x=o.return;try{f.componentDidMount()}catch(G){Sn(o,x,G)}}var y=o.return;try{Pg(o)}catch(G){Sn(o,y,G)}break;case 5:var T=o.return;try{Pg(o)}catch(G){Sn(o,T,G)}}}catch(G){Sn(o,o.return,G)}if(o===s){Ke=null;break}var B=o.sibling;if(B!==null){B.return=o.return,Ke=B;break}Ke=o.return}}var IA=Math.ceil,Vm=xe.ReactCurrentDispatcher,Vg=xe.ReactCurrentOwner,Zs=xe.ReactCurrentBatchConfig,Ut=0,sr=null,Fn=null,fr=0,Es=0,Zc=Si(0),Xn=0,Tu=null,jl=0,Lm=0,Lg=0,Au=null,as=null,$g=0,ed=1/0,Da=null,$m=!1,Fg=null,Eo=null,Fm=!1,To=null,Bm=0,Su=0,Bg=null,Um=-1,zm=0;function zr(){return(Ut&6)!==0?Wt():Um!==-1?Um:Um=Wt()}function Ao(s){return(s.mode&1)===0?1:(Ut&2)!==0&&fr!==0?fr&-fr:Yn.transition!==null?(zm===0&&(zm=so()),zm):(s=kt,s!==0||(s=window.event,s=s===void 0?16:ul(s.type)),s)}function Pi(s,o,d,f){if(50<Su)throw Su=0,Bg=null,Error(t(185));zi(s,d,f),((Ut&2)===0||s!==sr)&&(s===sr&&((Ut&2)===0&&(Lm|=d),Xn===4&&So(s,fr)),os(s,f),d===1&&Ut===0&&(o.mode&1)===0&&(ed=Wt()+500,El&&ki()))}function os(s,o){var d=s.callbackNode;yi(s,o);var f=vs(s,s===sr?fr:0);if(f===0)d!==null&&pa(d),s.callbackNode=null,s.callbackPriority=0;else if(o=f&-f,s.callbackPriority!==o){if(d!=null&&pa(d),o===1)s.tag===0?wm(pb.bind(null,s)):pu(pb.bind(null,s)),xm(function(){(Ut&6)===0&&ki()}),d=null;else{switch(bs(f)){case 1:d=to;break;case 4:d=Bi;break;case 16:d=lr;break;case 536870912:d=no;break;default:d=lr}d=_b(d,mb.bind(null,s))}s.callbackPriority=o,s.callbackNode=d}}function mb(s,o){if(Um=-1,zm=0,(Ut&6)!==0)throw Error(t(327));var d=s.callbackNode;if(td()&&s.callbackNode!==d)return null;var f=vs(s,s===sr?fr:0);if(f===0)return null;if((f&30)!==0||(f&s.expiredLanes)!==0||o)o=qm(s,f);else{o=f;var x=Ut;Ut|=2;var y=gb();(sr!==s||fr!==o)&&(Da=null,ed=Wt()+500,Cl(s,o));do try{AA();break}catch(B){fb(s,B)}while(!0);ig(),Vm.current=y,Ut=x,Fn!==null?o=0:(sr=null,fr=0,o=Xn)}if(o!==0){if(o===2&&(x=Vt(s),x!==0&&(f=x,o=Ug(s,x))),o===1)throw d=Tu,Cl(s,0),So(s,f),os(s,Wt()),d;if(o===6)So(s,f);else{if(x=s.current.alternate,(f&30)===0&&!EA(x)&&(o=qm(s,f),o===2&&(y=Vt(s),y!==0&&(f=y,o=Ug(s,y))),o===1))throw d=Tu,Cl(s,0),So(s,f),os(s,Wt()),d;switch(s.finishedWork=x,s.finishedLanes=f,o){case 0:case 1:throw Error(t(345));case 2:Rl(s,as,Da);break;case 3:if(So(s,f),(f&130023424)===f&&(o=$g+500-Wt(),10<o)){if(vs(s,0)!==0)break;if(x=s.suspendedLanes,(x&f)!==f){zr(),s.pingedLanes|=s.suspendedLanes&x;break}s.timeoutHandle=zc(Rl.bind(null,s,as,Da),o);break}Rl(s,as,Da);break;case 4:if(So(s,f),(f&4194240)===f)break;for(o=s.eventTimes,x=-1;0<f;){var T=31-vr(f);y=1<<T,T=o[T],T>x&&(x=T),f&=~y}if(f=x,f=Wt()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*IA(f/1960))-f,10<f){s.timeoutHandle=zc(Rl.bind(null,s,as,Da),f);break}Rl(s,as,Da);break;case 5:Rl(s,as,Da);break;default:throw Error(t(329))}}}return os(s,Wt()),s.callbackNode===d?mb.bind(null,s):null}function Ug(s,o){var d=Au;return s.current.memoizedState.isDehydrated&&(Cl(s,o).flags|=256),s=qm(s,o),s!==2&&(o=as,as=d,o!==null&&zg(o)),s}function zg(s){as===null?as=s:as.push.apply(as,s)}function EA(s){for(var o=s;;){if(o.flags&16384){var d=o.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var f=0;f<d.length;f++){var x=d[f],y=x.getSnapshot;x=x.value;try{if(!rs(y(),x))return!1}catch{return!1}}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function So(s,o){for(o&=~Lg,o&=~Lm,s.suspendedLanes|=o,s.pingedLanes&=~o,s=s.expirationTimes;0<o;){var d=31-vr(o),f=1<<d;s[d]=-1,o&=~f}}function pb(s){if((Ut&6)!==0)throw Error(t(327));td();var o=vs(s,0);if((o&1)===0)return os(s,Wt()),null;var d=qm(s,o);if(s.tag!==0&&d===2){var f=Vt(s);f!==0&&(o=f,d=Ug(s,f))}if(d===1)throw d=Tu,Cl(s,0),So(s,o),os(s,Wt()),d;if(d===6)throw Error(t(345));return s.finishedWork=s.current.alternate,s.finishedLanes=o,Rl(s,as,Da),os(s,Wt()),null}function qg(s,o){var d=Ut;Ut|=1;try{return s(o)}finally{Ut=d,Ut===0&&(ed=Wt()+500,El&&ki())}}function kl(s){To!==null&&To.tag===0&&(Ut&6)===0&&td();var o=Ut;Ut|=1;var d=Zs.transition,f=kt;try{if(Zs.transition=null,kt=1,s)return s()}finally{kt=f,Zs.transition=d,Ut=o,(Ut&6)===0&&ki()}}function Wg(){Es=Zc.current,tn(Zc)}function Cl(s,o){s.finishedWork=null,s.finishedLanes=0;var d=s.timeoutHandle;if(d!==-1&&(s.timeoutHandle=-1,gm(d)),Fn!==null)for(d=Fn.return;d!==null;){var f=d;switch(ht(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&Nl();break;case 3:Yc(),tn(ur),tn(Gn),mg();break;case 5:ug(f);break;case 4:Yc();break;case 13:tn(bn);break;case 19:tn(bn);break;case 10:ag(f.type._context);break;case 22:case 23:Wg()}d=d.return}if(sr=s,Fn=s=jo(s.current,null),fr=Es=o,Xn=0,Tu=null,Lg=Lm=jl=0,as=Au=null,Tl!==null){for(o=0;o<Tl.length;o++)if(d=Tl[o],f=d.interleaved,f!==null){d.interleaved=null;var x=f.next,y=d.pending;if(y!==null){var T=y.next;y.next=x,f.next=T}d.pending=f}Tl=null}return s}function fb(s,o){do{var d=Fn;try{if(ig(),Am.current=Cm,Sm){for(var f=wn.memoizedState;f!==null;){var x=f.queue;x!==null&&(x.pending=null),f=f.next}Sm=!1}if(Sl=0,rr=Jn=wn=null,bu=!1,wu=0,Vg.current=null,d===null||d.return===null){Xn=1,Tu=o,Fn=null;break}e:{var y=s,T=d.return,B=d,G=o;if(o=fr,B.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){var ce=G,Ne=B,Ee=Ne.tag;if((Ne.mode&1)===0&&(Ee===0||Ee===11||Ee===15)){var be=Ne.alternate;be?(Ne.updateQueue=be.updateQueue,Ne.memoizedState=be.memoizedState,Ne.lanes=be.lanes):(Ne.updateQueue=null,Ne.memoizedState=null)}var Ue=Fv(T);if(Ue!==null){Ue.flags&=-257,Bv(Ue,T,B,y,o),Ue.mode&1&&$v(y,ce,o),o=Ue,G=ce;var Je=o.updateQueue;if(Je===null){var Ze=new Set;Ze.add(G),o.updateQueue=Ze}else Je.add(G);break e}else{if((o&1)===0){$v(y,ce,o),Hg();break e}G=Error(t(426))}}else if(At&&B.mode&1){var On=Fv(T);if(On!==null){(On.flags&65536)===0&&(On.flags|=256),Bv(On,T,B,y,o),Br(Jc(G,B));break e}}y=G=Jc(G,B),Xn!==4&&(Xn=2),Au===null?Au=[y]:Au.push(y),y=T;do{switch(y.tag){case 3:y.flags|=65536,o&=-o,y.lanes|=o;var te=Vv(y,G,o);dv(y,te);break e;case 1:B=G;var Q=y.type,ne=y.stateNode;if((y.flags&128)===0&&(typeof Q.getDerivedStateFromError=="function"||ne!==null&&typeof ne.componentDidCatch=="function"&&(Eo===null||!Eo.has(ne)))){y.flags|=65536,o&=-o,y.lanes|=o;var je=Lv(y,B,o);dv(y,je);break e}}y=y.return}while(y!==null)}yb(d)}catch(tt){o=tt,Fn===d&&d!==null&&(Fn=d=d.return);continue}break}while(!0)}function gb(){var s=Vm.current;return Vm.current=Cm,s===null?Cm:s}function Hg(){(Xn===0||Xn===3||Xn===2)&&(Xn=4),sr===null||(jl&268435455)===0&&(Lm&268435455)===0||So(sr,fr)}function qm(s,o){var d=Ut;Ut|=2;var f=gb();(sr!==s||fr!==o)&&(Da=null,Cl(s,o));do try{TA();break}catch(x){fb(s,x)}while(!0);if(ig(),Ut=d,Vm.current=f,Fn!==null)throw Error(t(261));return sr=null,fr=0,Xn}function TA(){for(;Fn!==null;)xb(Fn)}function AA(){for(;Fn!==null&&!Fi();)xb(Fn)}function xb(s){var o=wb(s.alternate,s,Es);s.memoizedProps=s.pendingProps,o===null?yb(s):Fn=o,Vg.current=null}function yb(s){var o=s;do{var d=o.alternate;if(s=o.return,(o.flags&32768)===0){if(d=vA(d,o,Es),d!==null){Fn=d;return}}else{if(d=bA(d,o),d!==null){d.flags&=32767,Fn=d;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Xn=6,Fn=null;return}}if(o=o.sibling,o!==null){Fn=o;return}Fn=o=s}while(o!==null);Xn===0&&(Xn=5)}function Rl(s,o,d){var f=kt,x=Zs.transition;try{Zs.transition=null,kt=1,SA(s,o,d,f)}finally{Zs.transition=x,kt=f}return null}function SA(s,o,d,f){do td();while(To!==null);if((Ut&6)!==0)throw Error(t(327));d=s.finishedWork;var x=s.finishedLanes;if(d===null)return null;if(s.finishedWork=null,s.finishedLanes=0,d===s.current)throw Error(t(177));s.callbackNode=null,s.callbackPriority=0;var y=d.lanes|d.childLanes;if(es(s,y),s===sr&&(Fn=sr=null,fr=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||Fm||(Fm=!0,_b(lr,function(){return td(),null})),y=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||y){y=Zs.transition,Zs.transition=null;var T=kt;kt=1;var B=Ut;Ut|=4,Vg.current=null,_A(s,d),lb(d,s),cm(Bc),Ct=!!Fc,Bc=Fc=null,s.current=d,NA(d),Fs(),Ut=B,kt=T,Zs.transition=y}else s.current=d;if(Fm&&(Fm=!1,To=s,Bm=x),y=s.pendingLanes,y===0&&(Eo=null),ro(d.stateNode),os(s,Wt()),o!==null)for(f=s.onRecoverableError,d=0;d<o.length;d++)x=o[d],f(x.value,{componentStack:x.stack,digest:x.digest});if($m)throw $m=!1,s=Fg,Fg=null,s;return(Bm&1)!==0&&s.tag!==0&&td(),y=s.pendingLanes,(y&1)!==0?s===Bg?Su++:(Su=0,Bg=s):Su=0,ki(),null}function td(){if(To!==null){var s=bs(Bm),o=Zs.transition,d=kt;try{if(Zs.transition=null,kt=16>s?16:s,To===null)var f=!1;else{if(s=To,To=null,Bm=0,(Ut&6)!==0)throw Error(t(331));var x=Ut;for(Ut|=4,Ke=s.current;Ke!==null;){var y=Ke,T=y.child;if((Ke.flags&16)!==0){var B=y.deletions;if(B!==null){for(var G=0;G<B.length;G++){var ce=B[G];for(Ke=ce;Ke!==null;){var Ne=Ke;switch(Ne.tag){case 0:case 11:case 15:Eu(8,Ne,y)}var Ee=Ne.child;if(Ee!==null)Ee.return=Ne,Ke=Ee;else for(;Ke!==null;){Ne=Ke;var be=Ne.sibling,Ue=Ne.return;if(rb(Ne),Ne===ce){Ke=null;break}if(be!==null){be.return=Ue,Ke=be;break}Ke=Ue}}}var Je=y.alternate;if(Je!==null){var Ze=Je.child;if(Ze!==null){Je.child=null;do{var On=Ze.sibling;Ze.sibling=null,Ze=On}while(Ze!==null)}}Ke=y}}if((y.subtreeFlags&2064)!==0&&T!==null)T.return=y,Ke=T;else e:for(;Ke!==null;){if(y=Ke,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Eu(9,y,y.return)}var te=y.sibling;if(te!==null){te.return=y.return,Ke=te;break e}Ke=y.return}}var Q=s.current;for(Ke=Q;Ke!==null;){T=Ke;var ne=T.child;if((T.subtreeFlags&2064)!==0&&ne!==null)ne.return=T,Ke=ne;else e:for(T=Q;Ke!==null;){if(B=Ke,(B.flags&2048)!==0)try{switch(B.tag){case 0:case 11:case 15:Mm(9,B)}}catch(tt){Sn(B,B.return,tt)}if(B===T){Ke=null;break e}var je=B.sibling;if(je!==null){je.return=B.return,Ke=je;break e}Ke=B.return}}if(Ut=x,ki(),Dr&&typeof Dr.onPostCommitFiberRoot=="function")try{Dr.onPostCommitFiberRoot(gi,s)}catch{}f=!0}return f}finally{kt=d,Zs.transition=o}}return!1}function vb(s,o,d){o=Jc(d,o),o=Vv(s,o,1),s=No(s,o,1),o=zr(),s!==null&&(zi(s,1,o),os(s,o))}function Sn(s,o,d){if(s.tag===3)vb(s,s,d);else for(;o!==null;){if(o.tag===3){vb(o,s,d);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Eo===null||!Eo.has(f))){s=Jc(d,s),s=Lv(o,s,1),o=No(o,s,1),s=zr(),o!==null&&(zi(o,1,s),os(o,s));break}}o=o.return}}function jA(s,o,d){var f=s.pingCache;f!==null&&f.delete(o),o=zr(),s.pingedLanes|=s.suspendedLanes&d,sr===s&&(fr&d)===d&&(Xn===4||Xn===3&&(fr&130023424)===fr&&500>Wt()-$g?Cl(s,0):Lg|=d),os(s,o)}function bb(s,o){o===0&&((s.mode&1)===0?o=1:(o=Bs,Bs<<=1,(Bs&130023424)===0&&(Bs=4194304)));var d=zr();s=ka(s,o),s!==null&&(zi(s,o,d),os(s,d))}function kA(s){var o=s.memoizedState,d=0;o!==null&&(d=o.retryLane),bb(s,d)}function CA(s,o){var d=0;switch(s.tag){case 13:var f=s.stateNode,x=s.memoizedState;x!==null&&(d=x.retryLane);break;case 19:f=s.stateNode;break;default:throw Error(t(314))}f!==null&&f.delete(o),bb(s,d)}var wb;wb=function(s,o,d){if(s!==null)if(s.memoizedProps!==o.pendingProps||ur.current)is=!0;else{if((s.lanes&d)===0&&(o.flags&128)===0)return is=!1,yA(s,o,d);is=(s.flags&131072)!==0}else is=!1,At&&(o.flags&1048576)!==0&&Ce(o,S,o.index);switch(o.lanes=0,o.tag){case 2:var f=o.type;Pm(s,o),s=o.pendingProps;var x=Aa(o,Gn.current);Qc(o,d),x=gg(null,o,f,s,x,d);var y=xg();return o.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,hr(f)?(y=!0,Il(o)):y=!1,o.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,cg(o),x.updater=Rm,o.stateNode=x,x._reactInternals=o,Ng(o,f,s,d),o=Ag(null,o,f,!0,y,d)):(o.tag=0,At&&y&&nt(o),Ur(null,o,x,d),o=o.child),o;case 16:f=o.elementType;e:{switch(Pm(s,o),s=o.pendingProps,x=f._init,f=x(f._payload),o.type=f,x=o.tag=DA(f),s=Ci(f,s),x){case 0:o=Tg(null,o,f,s,d);break e;case 1:o=Gv(null,o,f,s,d);break e;case 11:o=Uv(null,o,f,s,d);break e;case 14:o=zv(null,o,f,Ci(f.type,s),d);break e}throw Error(t(306,f,""))}return o;case 0:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Tg(s,o,f,x,d);case 1:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Gv(s,o,f,x,d);case 3:e:{if(Kv(o),s===null)throw Error(t(387));f=o.pendingProps,y=o.memoizedState,x=y.element,cv(s,o),Em(o,f,null,d);var T=o.memoizedState;if(f=T.element,y.isDehydrated)if(y={element:f,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},o.updateQueue.baseState=y,o.memoizedState=y,o.flags&256){x=Jc(Error(t(423)),o),o=Qv(s,o,f,d,x);break e}else if(f!==x){x=Jc(Error(t(424)),o),o=Qv(s,o,f,d,x);break e}else for(wt=Ai(o.stateNode.containerInfo.firstChild),mt=o,At=!0,Le=null,d=ov(o,null,f,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(An(),f===x){o=Ra(s,o,d);break e}Ur(s,o,f,d)}o=o.child}return o;case 5:return hv(o),s===null&&Nt(o),f=o.type,x=o.pendingProps,y=s!==null?s.memoizedProps:null,T=x.children,Uc(f,x)?T=null:y!==null&&Uc(f,y)&&(o.flags|=32),Hv(s,o),Ur(s,o,T,d),o.child;case 6:return s===null&&Nt(o),null;case 13:return Yv(s,o,d);case 4:return dg(o,o.stateNode.containerInfo),f=o.pendingProps,s===null?o.child=ja(o,null,f,d):Ur(s,o,f,d),o.child;case 11:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Uv(s,o,f,x,d);case 7:return Ur(s,o,o.pendingProps,d),o.child;case 8:return Ur(s,o,o.pendingProps.children,d),o.child;case 12:return Ur(s,o,o.pendingProps.children,d),o.child;case 10:e:{if(f=o.type._context,x=o.pendingProps,y=o.memoizedProps,T=x.value,Yt(_m,f._currentValue),f._currentValue=T,y!==null)if(rs(y.value,T)){if(y.children===x.children&&!ur.current){o=Ra(s,o,d);break e}}else for(y=o.child,y!==null&&(y.return=o);y!==null;){var B=y.dependencies;if(B!==null){T=y.child;for(var G=B.firstContext;G!==null;){if(G.context===f){if(y.tag===1){G=Ca(-1,d&-d),G.tag=2;var ce=y.updateQueue;if(ce!==null){ce=ce.shared;var Ne=ce.pending;Ne===null?G.next=G:(G.next=Ne.next,Ne.next=G),ce.pending=G}}y.lanes|=d,G=y.alternate,G!==null&&(G.lanes|=d),og(y.return,d,o),B.lanes|=d;break}G=G.next}}else if(y.tag===10)T=y.type===o.type?null:y.child;else if(y.tag===18){if(T=y.return,T===null)throw Error(t(341));T.lanes|=d,B=T.alternate,B!==null&&(B.lanes|=d),og(T,d,o),T=y.sibling}else T=y.child;if(T!==null)T.return=y;else for(T=y;T!==null;){if(T===o){T=null;break}if(y=T.sibling,y!==null){y.return=T.return,T=y;break}T=T.return}y=T}Ur(s,o,x.children,d),o=o.child}return o;case 9:return x=o.type,f=o.pendingProps.children,Qc(o,d),x=Js(x),f=f(x),o.flags|=1,Ur(s,o,f,d),o.child;case 14:return f=o.type,x=Ci(f,o.pendingProps),x=Ci(f.type,x),zv(s,o,f,x,d);case 15:return qv(s,o,o.type,o.pendingProps,d);case 17:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Pm(s,o),o.tag=1,hr(f)?(s=!0,Il(o)):s=!1,Qc(o,d),Ov(o,f,x),Ng(o,f,x,d),Ag(null,o,f,!0,s,d);case 19:return Xv(s,o,d);case 22:return Wv(s,o,d)}throw Error(t(156,o.tag))};function _b(s,o){return eo(s,o)}function RA(s,o,d,f){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ei(s,o,d,f){return new RA(s,o,d,f)}function Gg(s){return s=s.prototype,!(!s||!s.isReactComponent)}function DA(s){if(typeof s=="function")return Gg(s)?1:0;if(s!=null){if(s=s.$$typeof,s===K)return 11;if(s===ue)return 14}return 2}function jo(s,o){var d=s.alternate;return d===null?(d=ei(s.tag,o,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=o,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&14680064,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,o=s.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d}function Wm(s,o,d,f,x,y){var T=2;if(f=s,typeof s=="function")Gg(s)&&(T=1);else if(typeof s=="string")T=5;else e:switch(s){case k:return Dl(d.children,x,y,o);case R:T=8,x|=8;break;case M:return s=ei(12,d,o,x|2),s.elementType=M,s.lanes=y,s;case V:return s=ei(13,d,o,x),s.elementType=V,s.lanes=y,s;case Fe:return s=ei(19,d,o,x),s.elementType=Fe,s.lanes=y,s;case Ie:return Hm(d,x,y,o);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case q:T=10;break e;case U:T=9;break e;case K:T=11;break e;case ue:T=14;break e;case Te:T=16,f=null;break e}throw Error(t(130,s==null?s:typeof s,""))}return o=ei(T,d,o,x),o.elementType=s,o.type=f,o.lanes=y,o}function Dl(s,o,d,f){return s=ei(7,s,f,o),s.lanes=d,s}function Hm(s,o,d,f){return s=ei(22,s,f,o),s.elementType=Ie,s.lanes=d,s.stateNode={isHidden:!1},s}function Kg(s,o,d){return s=ei(6,s,null,o),s.lanes=d,s}function Qg(s,o,d){return o=ei(4,s.children!==null?s.children:[],s.key,o),o.lanes=d,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}function PA(s,o,d,f,x){this.tag=o,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pr(0),this.expirationTimes=Pr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pr(0),this.identifierPrefix=f,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function Yg(s,o,d,f,x,y,T,B,G){return s=new PA(s,o,d,B,G),o===1?(o=1,y===!0&&(o|=8)):o=0,y=ei(3,null,null,o),s.current=y,y.stateNode=s,y.memoizedState={element:f,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},cg(y),s}function OA(s,o,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ie,key:f==null?null:""+f,children:s,containerInfo:o,implementation:d}}function Nb(s){if(!s)return ji;s=s._reactInternals;e:{if(ys(s)!==s||s.tag!==1)throw Error(t(170));var o=s;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(hr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(t(171))}if(s.tag===1){var d=s.type;if(hr(d))return hu(s,d,o)}return o}function Ib(s,o,d,f,x,y,T,B,G){return s=Yg(d,f,!0,s,x,y,T,B,G),s.context=Nb(null),d=s.current,f=zr(),x=Ao(d),y=Ca(f,x),y.callback=o??null,No(d,y,x),s.current.lanes=x,zi(s,x,f),os(s,f),s}function Gm(s,o,d,f){var x=o.current,y=zr(),T=Ao(x);return d=Nb(d),o.context===null?o.context=d:o.pendingContext=d,o=Ca(y,T),o.payload={element:s},f=f===void 0?null:f,f!==null&&(o.callback=f),s=No(x,o,T),s!==null&&(Pi(s,x,T,y),Im(s,x,T)),T}function Km(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function Eb(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<o?d:o}}function Jg(s,o){Eb(s,o),(s=s.alternate)&&Eb(s,o)}function MA(){return null}var Tb=typeof reportError=="function"?reportError:function(s){console.error(s)};function Xg(s){this._internalRoot=s}Qm.prototype.render=Xg.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(t(409));Gm(s,o,null,null)},Qm.prototype.unmount=Xg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;kl(function(){Gm(null,s,null,null)}),o[Qs]=null}};function Qm(s){this._internalRoot=s}Qm.prototype.unstable_scheduleHydration=function(s){if(s){var o=ws();s={blockedOn:null,target:s,priority:o};for(var d=0;d<Vr.length&&o!==0&&o<Vr[d].priority;d++);Vr.splice(d,0,s),d===0&&It(s)}};function Zg(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Ym(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function Ab(){}function VA(s,o,d,f,x){if(x){if(typeof f=="function"){var y=f;f=function(){var ce=Km(T);y.call(ce)}}var T=Ib(o,f,s,0,null,!1,!1,"",Ab);return s._reactRootContainer=T,s[Qs]=T.current,yo(s.nodeType===8?s.parentNode:s),kl(),T}for(;x=s.lastChild;)s.removeChild(x);if(typeof f=="function"){var B=f;f=function(){var ce=Km(G);B.call(ce)}}var G=Yg(s,0,!1,null,null,!1,!1,"",Ab);return s._reactRootContainer=G,s[Qs]=G.current,yo(s.nodeType===8?s.parentNode:s),kl(function(){Gm(o,G,d,f)}),G}function Jm(s,o,d,f,x){var y=d._reactRootContainer;if(y){var T=y;if(typeof x=="function"){var B=x;x=function(){var G=Km(T);B.call(G)}}Gm(o,T,s,x)}else T=VA(d,o,s,x,f);return Km(T)}ll=function(s){switch(s.tag){case 3:var o=s.stateNode;if(o.current.memoizedState.isDehydrated){var d=Bt(o.pendingLanes);d!==0&&(fa(o,d|1),os(o,Wt()),(Ut&6)===0&&(ed=Wt()+500,ki()))}break;case 13:kl(function(){var f=ka(s,1);if(f!==null){var x=zr();Pi(f,s,1,x)}}),Jg(s,1)}},io=function(s){if(s.tag===13){var o=ka(s,134217728);if(o!==null){var d=zr();Pi(o,s,134217728,d)}Jg(s,134217728)}},ga=function(s){if(s.tag===13){var o=Ao(s),d=ka(s,o);if(d!==null){var f=zr();Pi(d,s,o,f)}Jg(s,o)}},ws=function(){return kt},qi=function(s,o){var d=kt;try{return kt=s,o()}finally{kt=d}},it=function(s,o,d){switch(o){case"input":if(Be(s,d),o=d.name,d.type==="radio"&&o!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<d.length;o++){var f=d[o];if(f!==s&&f.form===s.form){var x=_l(f);if(!x)throw Error(t(90));Re(f),Be(f,x)}}}break;case"textarea":ui(s,d);break;case"select":o=d.value,o!=null&&jt(s,!!d.multiple,o,!1)}},In=qg,yr=kl;var LA={usingClientEntryPoint:!1,Events:[wo,Ea,_l,et,rn,qg]},ju={findFiberByHostInstance:Ki,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$A={bundleType:ju.bundleType,version:ju.version,rendererPackageName:ju.rendererPackageName,rendererConfig:ju.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xe.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=_c(s),s===null?null:s.stateNode},findFiberByHostInstance:ju.findFiberByHostInstance||MA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xm.isDisabled&&Xm.supportsFiber)try{gi=Xm.inject($A),Dr=Xm}catch{}}return ls.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LA,ls.createPortal=function(s,o){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zg(o))throw Error(t(200));return OA(s,o,null,d)},ls.createRoot=function(s,o){if(!Zg(s))throw Error(t(299));var d=!1,f="",x=Tb;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onRecoverableError!==void 0&&(x=o.onRecoverableError)),o=Yg(s,1,!1,null,null,d,!1,f,x),s[Qs]=o.current,yo(s.nodeType===8?s.parentNode:s),new Xg(o)},ls.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(t(188)):(s=Object.keys(s).join(","),Error(t(268,s)));return s=_c(o),s=s===null?null:s.stateNode,s},ls.flushSync=function(s){return kl(s)},ls.hydrate=function(s,o,d){if(!Ym(o))throw Error(t(200));return Jm(null,s,o,!0,d)},ls.hydrateRoot=function(s,o,d){if(!Zg(s))throw Error(t(405));var f=d!=null&&d.hydratedSources||null,x=!1,y="",T=Tb;if(d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onRecoverableError!==void 0&&(T=d.onRecoverableError)),o=Ib(o,null,s,1,d??null,x,!1,y,T),s[Qs]=o.current,yo(s),f)for(s=0;s<f.length;s++)d=f[s],x=d._getVersion,x=x(d._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[d,x]:o.mutableSourceEagerHydrationData.push(d,x);return new Qm(o)},ls.render=function(s,o,d){if(!Ym(o))throw Error(t(200));return Jm(null,s,o,!1,d)},ls.unmountComponentAtNode=function(s){if(!Ym(s))throw Error(t(40));return s._reactRootContainer?(kl(function(){Jm(null,null,s,!1,function(){s._reactRootContainer=null,s[Qs]=null})}),!0):!1},ls.unstable_batchedUpdates=qg,ls.unstable_renderSubtreeIntoContainer=function(s,o,d,f){if(!Ym(d))throw Error(t(200));if(s==null||s._reactInternals===void 0)throw Error(t(38));return Jm(s,o,d,!1,f)},ls.version="18.3.1-next-f1338f8080-20240426",ls}var Ob;function EN(){if(Ob)return nx.exports;Ob=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),nx.exports=HA(),nx.exports}var Mb;function GA(){if(Mb)return Zm;Mb=1;var n=EN();return Zm.createRoot=n.createRoot,Zm.hydrateRoot=n.hydrateRoot,Zm}var KA=GA();const QA=IN(KA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YA=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),JA=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Vb=n=>{const e=JA(n);return e.charAt(0).toUpperCase()+e.slice(1)},TN=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),XA=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ZA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=W.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:l,iconNode:c,...u},p)=>W.createElement("svg",{ref:p,...ZA,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:TN("lucide",i),...!l&&!XA(u)&&{"aria-hidden":"true"},...u},[...c.map(([g,b])=>W.createElement(g,b)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=(n,e)=>{const t=W.forwardRef(({className:r,...i},l)=>W.createElement(eS,{ref:l,iconNode:e,className:TN(`lucide-${YA(Vb(n))}`,`lucide-${n}`,r),...i}));return t.displayName=Vb(n),t};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],nS=We("arrow-down",tS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Hl=We("arrow-right",rS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],iS=We("arrow-up",sS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Mo=We("ban",aS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oS=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Op=We("bell",oS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lS=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Fx=We("briefcase",lS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cS=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],AN=We("building-2",cS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dS=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Mp=We("calendar",dS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uS=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ol=We("check",uS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hS=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],mS=We("chevron-down",hS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pS=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Va=We("chevron-right",pS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ma=We("circle-alert",fS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gS=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],_d=We("circle-check-big",gS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],xp=We("circle-check",xS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yS=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],Bx=We("circle-pause",yS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vS=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Lb=We("circle-play",vS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bS=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],th=We("clock",bS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wS=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],_S=We("copy",wS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NS=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],IS=We("credit-card",NS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ES=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],TS=We("dollar-sign",ES);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AS=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],$b=We("download",AS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SS=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],jS=We("eye-off",SS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kS=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ix=We("eye",kS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CS=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Pa=We("file-text",CS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RS=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],Cu=We("file",RS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DS=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],SN=We("folder-kanban",DS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PS=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],OS=We("funnel",PS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MS=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Fb=We("history",MS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VS=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Bb=We("image",VS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LS=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],yp=We("indian-rupee",LS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $S=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],jN=We("info",$S);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FS=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],BS=We("layers",FS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const US=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],zS=We("layout-dashboard",US);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qS=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ru=We("link-2",qS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WS=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],HS=We("list-checks",WS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GS=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],ep=We("list",GS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KS=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],QS=We("loader",KS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YS=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],xh=We("lock",YS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JS=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],XS=We("log-out",JS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZS=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Vp=We("mail",ZS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ej=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],tj=We("menu",ej);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nj=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],Ux=We("message-circle",nj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],tp=We("message-square",rj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sj=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],ij=We("palette",sj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],oj=We("panels-top-left",aj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lj=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],kN=We("pen-line",lj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],dj=We("pencil",cj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uj=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Lp=We("phone",uj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hj=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Oi=We("plus",hj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mj=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ax=We("send",mj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pj=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],fj=We("settings",pj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gj=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],xj=We("share-2",gj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yj=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],vj=We("shield-check",yj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bj=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],zx=We("shield",bj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wj=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],_j=We("shopping-bag",wj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nj=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ox=We("smartphone",Nj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ij=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],qx=We("square-pen",Ij);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ej=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],$p=We("tag",Ej);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tj=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],np=We("thumbs-down",Tj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aj=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],rp=We("thumbs-up",Aj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sj=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ts=We("trash-2",Sj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jj=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],kj=We("triangle-alert",jj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cj=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Uu=We("upload",Cj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rj=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],CN=We("user",Rj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Fp=We("users",Dj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pj=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Oj=We("wallet",Pj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mj=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],_n=We("x",Mj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vj=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Lj=We("zap",Vj);var RN={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ub=ii.createContext&&ii.createContext(RN),Wo=function(){return Wo=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Wo.apply(this,arguments)},$j=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};function DN(n){return n&&n.map(function(e,t){return ii.createElement(e.tag,Wo({key:t},e.attr),DN(e.child))})}function Fj(n){return function(e){return ii.createElement(Bj,Wo({attr:Wo({},n.attr)},e),DN(n.child))}}function Bj(n){var e=function(t){var r=n.attr,i=n.size,l=n.title,c=$j(n,["attr","size","title"]),u=i||t.size||"1em",p;return t.className&&(p=t.className),n.className&&(p=(p?p+" ":"")+n.className),ii.createElement("svg",Wo({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,c,{className:p,style:Wo(Wo({color:n.color||t.color},t.style),n.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&ii.createElement("title",null,l),n.children)};return Ub!==void 0?ii.createElement(Ub.Consumer,null,function(t){return e(t)}):e(RN)}function Uj(n){return Fj({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z"}},{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z"}}]})(n)}var F=(n=>(n.ADMIN="Admin",n.DESIGNER="Designer",n.VENDOR="Vendor",n.CLIENT="Client",n))(F||{}),jn=(n=>(n.DISCOVERY="Discovery",n.PLANNING="Planning",n.EXECUTION="Execution",n.COMPLETED="Completed",n.ON_HOLD="On Hold",n))(jn||{}),$l=(n=>(n.DESIGNING="Designing",n.TURNKEY="Turnkey",n))($l||{}),Vo=(n=>(n.COMMERCIAL="Commercial",n.RESIDENTIAL="Residential",n))(Vo||{}),pe=(n=>(n.TODO="To Do",n.IN_PROGRESS="In Progress",n.REVIEW="Review",n.DONE="Done",n.OVERDUE="Overdue",n.ABORTED="Aborted",n.ON_HOLD="On Hold",n))(pe||{});const zj=()=>{};var zb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PN=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},qj=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const l=n[t++];e[r++]=String.fromCharCode((i&31)<<6|l&63)}else if(i>239&&i<365){const l=n[t++],c=n[t++],u=n[t++],p=((i&7)<<18|(l&63)<<12|(c&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(p>>10)),e[r++]=String.fromCharCode(56320+(p&1023))}else{const l=n[t++],c=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(l&63)<<6|c&63)}}return e.join("")},ON={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const l=n[i],c=i+1<n.length,u=c?n[i+1]:0,p=i+2<n.length,g=p?n[i+2]:0,b=l>>2,w=(l&3)<<4|u>>4;let N=(u&15)<<2|g>>6,D=g&63;p||(D=64,c||(N=64)),r.push(t[b],t[w],t[N],t[D])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(PN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qj(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const l=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;const g=i<n.length?t[n.charAt(i)]:64;++i;const w=i<n.length?t[n.charAt(i)]:64;if(++i,l==null||u==null||g==null||w==null)throw new Wj;const N=l<<2|u>>4;if(r.push(N),g!==64){const D=u<<4&240|g>>2;if(r.push(D),w!==64){const z=g<<6&192|w;r.push(z)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Wj extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Hj=function(n){const e=PN(n);return ON.encodeByteArray(e,!0)},Bp=function(n){return Hj(n).replace(/\./g,"")},MN=function(n){try{return ON.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gj=()=>VN().__FIREBASE_DEFAULTS__,Kj=()=>{if(typeof process>"u"||typeof zb>"u")return;const n=zb.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Qj=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&MN(n[1]);return e&&JSON.parse(e)},yf=()=>{try{return zj()||Gj()||Kj()||Qj()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},LN=n=>{var e,t;return(t=(e=yf())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},$N=n=>{const e=LN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},FN=()=>{var n;return(n=yf())==null?void 0:n.config},BN=n=>{var e;return(e=yf())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yj{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tl(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Vy(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,l=n.sub||n.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Bp(JSON.stringify(t)),Bp(JSON.stringify(c)),""].join(".")}const nh={};function Jj(){const n={prod:[],emulator:[]};for(const e of Object.keys(nh))nh[e]?n.emulator.push(e):n.prod.push(e);return n}function Xj(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let qb=!1;function Ly(n,e){if(typeof window>"u"||typeof document>"u"||!tl(window.location.host)||nh[n]===e||nh[n]||qb)return;nh[n]=e;function t(N){return`__firebase__banner__${N}`}const r="__firebase__banner",l=Jj().prod.length>0;function c(){const N=document.getElementById(r);N&&N.remove()}function u(N){N.style.display="flex",N.style.background="#7faaf0",N.style.position="fixed",N.style.bottom="5px",N.style.left="5px",N.style.padding=".5em",N.style.borderRadius="5px",N.style.alignItems="center"}function p(N,D){N.setAttribute("width","24"),N.setAttribute("id",D),N.setAttribute("height","24"),N.setAttribute("viewBox","0 0 24 24"),N.setAttribute("fill","none"),N.style.marginLeft="-6px"}function g(){const N=document.createElement("span");return N.style.cursor="pointer",N.style.marginLeft="16px",N.style.fontSize="24px",N.innerHTML=" &times;",N.onclick=()=>{qb=!0,c()},N}function b(N,D){N.setAttribute("id",D),N.innerText="Learn more",N.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",N.setAttribute("target","__blank"),N.style.paddingLeft="5px",N.style.textDecoration="underline"}function w(){const N=Xj(r),D=t("text"),z=document.getElementById(D)||document.createElement("span"),L=t("learnmore"),O=document.getElementById(L)||document.createElement("a"),le=t("preprendIcon"),ge=document.getElementById(le)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(N.created){const ae=N.element;u(ae),b(O,L);const xe=g();p(ge,le),ae.append(ge,z,O,xe),document.body.appendChild(ae)}l?(z.innerText="Preview backend disconnected.",ge.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ge.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,z.innerText="Preview backend running in this workspace."),z.setAttribute("id",D)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",w):w()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Zj(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zn())}function zN(){var e;const n=(e=yf())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function e2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function qN(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function t2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function n2(){const n=Zn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function WN(){return!zN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function HN(){return!zN()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function vf(){try{return typeof indexedDB=="object"}catch{return!1}}function $y(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var l;e(((l=i.error)==null?void 0:l.message)||"")}}catch(t){e(t)}})}function GN(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r2="FirebaseError";class oi extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=r2,Object.setPrototypeOf(this,oi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,nl.prototype.create)}}class nl{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,l=this.errors[e],c=l?s2(l,r):"Error",u=`${this.serviceName}: ${c} (${i}).`;return new oi(i,u,r)}}function s2(n,e){return n.replace(i2,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const i2=/\{\$([^}]+)}/g;function a2(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function za(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const l=n[i],c=e[i];if(Wb(l)&&Wb(c)){if(!za(l,c))return!1}else if(l!==c)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function Wb(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vd(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function zu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,l]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(l)}}),e}function qu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function o2(n,e){const t=new l2(n,e);return t.subscribe.bind(t)}class l2{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");c2(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=lx),i.error===void 0&&(i.error=lx),i.complete===void 0&&(i.complete=lx);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function c2(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function lx(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d2=1e3,u2=2,h2=14400*1e3,m2=.5;function Hb(n,e=d2,t=u2){const r=e*Math.pow(t,n),i=Math.round(m2*r*(Math.random()-.5)*2);return Math.min(h2,r+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(n){return n&&n._delegate?n._delegate:n}class us{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ml="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p2{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Yj;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(g2(e))try{this.getOrInitializeService({instanceIdentifier:Ml})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:i});r.resolve(l)}catch{}}}}clearInstance(e=Ml){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ml){return this.instances.has(e)}getOptions(e=Ml){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[l,c]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(l);r===u&&c.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const l=this.instances.get(r);return l&&e(l,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:f2(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ml){return this.component?this.component.multipleInstances?e:Ml:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function f2(n){return n===Ml?void 0:n}function g2(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new p2(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ot;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ot||(Ot={}));const y2={debug:Ot.DEBUG,verbose:Ot.VERBOSE,info:Ot.INFO,warn:Ot.WARN,error:Ot.ERROR,silent:Ot.SILENT},v2=Ot.INFO,b2={[Ot.DEBUG]:"log",[Ot.VERBOSE]:"log",[Ot.INFO]:"info",[Ot.WARN]:"warn",[Ot.ERROR]:"error"},w2=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=b2[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bf{constructor(e){this.name=e,this._logLevel=v2,this._logHandler=w2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ot))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?y2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ot.DEBUG,...e),this._logHandler(this,Ot.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ot.VERBOSE,...e),this._logHandler(this,Ot.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ot.INFO,...e),this._logHandler(this,Ot.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ot.WARN,...e),this._logHandler(this,Ot.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ot.ERROR,...e),this._logHandler(this,Ot.ERROR,...e)}}const _2=(n,e)=>e.some(t=>n instanceof t);let Gb,Kb;function N2(){return Gb||(Gb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function I2(){return Kb||(Kb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const KN=new WeakMap,Wx=new WeakMap,QN=new WeakMap,cx=new WeakMap,Fy=new WeakMap;function E2(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",l),n.removeEventListener("error",c)},l=()=>{t(Ua(n.result)),i()},c=()=>{r(n.error),i()};n.addEventListener("success",l),n.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&KN.set(t,n)}).catch(()=>{}),Fy.set(e,n),e}function T2(n){if(Wx.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",l),n.removeEventListener("error",c),n.removeEventListener("abort",c)},l=()=>{t(),i()},c=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",l),n.addEventListener("error",c),n.addEventListener("abort",c)});Wx.set(n,e)}let Hx={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Wx.get(n);if(e==="objectStoreNames")return n.objectStoreNames||QN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ua(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function A2(n){Hx=n(Hx)}function S2(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(dx(this),e,...t);return QN.set(r,e.sort?e.sort():[e]),Ua(r)}:I2().includes(n)?function(...e){return n.apply(dx(this),e),Ua(KN.get(this))}:function(...e){return Ua(n.apply(dx(this),e))}}function j2(n){return typeof n=="function"?S2(n):(n instanceof IDBTransaction&&T2(n),_2(n,N2())?new Proxy(n,Hx):n)}function Ua(n){if(n instanceof IDBRequest)return E2(n);if(cx.has(n))return cx.get(n);const e=j2(n);return e!==n&&(cx.set(n,e),Fy.set(e,n)),e}const dx=n=>Fy.get(n);function wf(n,e,{blocked:t,upgrade:r,blocking:i,terminated:l}={}){const c=indexedDB.open(n,e),u=Ua(c);return r&&c.addEventListener("upgradeneeded",p=>{r(Ua(c.result),p.oldVersion,p.newVersion,Ua(c.transaction),p)}),t&&c.addEventListener("blocked",p=>t(p.oldVersion,p.newVersion,p)),u.then(p=>{l&&p.addEventListener("close",()=>l()),i&&p.addEventListener("versionchange",g=>i(g.oldVersion,g.newVersion,g))}).catch(()=>{}),u}function ux(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Ua(t).then(()=>{})}const k2=["get","getKey","getAll","getAllKeys","count"],C2=["put","add","delete","clear"],hx=new Map;function Qb(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(hx.get(e))return hx.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=C2.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||k2.includes(t)))return;const l=async function(c,...u){const p=this.transaction(c,i?"readwrite":"readonly");let g=p.store;return r&&(g=g.index(u.shift())),(await Promise.all([g[t](...u),i&&p.done]))[0]};return hx.set(e,l),l}A2(n=>({...n,get:(e,t,r)=>Qb(e,t)||n.get(e,t,r),has:(e,t)=>!!Qb(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(D2(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function D2(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Gx="@firebase/app",Yb="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qa=new bf("@firebase/app"),P2="@firebase/app-compat",O2="@firebase/analytics-compat",M2="@firebase/analytics",V2="@firebase/app-check-compat",L2="@firebase/app-check",$2="@firebase/auth",F2="@firebase/auth-compat",B2="@firebase/database",U2="@firebase/data-connect",z2="@firebase/database-compat",q2="@firebase/functions",W2="@firebase/functions-compat",H2="@firebase/installations",G2="@firebase/installations-compat",K2="@firebase/messaging",Q2="@firebase/messaging-compat",Y2="@firebase/performance",J2="@firebase/performance-compat",X2="@firebase/remote-config",Z2="@firebase/remote-config-compat",ek="@firebase/storage",tk="@firebase/storage-compat",nk="@firebase/firestore",rk="@firebase/ai",sk="@firebase/firestore-compat",ik="firebase",ak="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kx="[DEFAULT]",ok={[Gx]:"fire-core",[P2]:"fire-core-compat",[M2]:"fire-analytics",[O2]:"fire-analytics-compat",[L2]:"fire-app-check",[V2]:"fire-app-check-compat",[$2]:"fire-auth",[F2]:"fire-auth-compat",[B2]:"fire-rtdb",[U2]:"fire-data-connect",[z2]:"fire-rtdb-compat",[q2]:"fire-fn",[W2]:"fire-fn-compat",[H2]:"fire-iid",[G2]:"fire-iid-compat",[K2]:"fire-fcm",[Q2]:"fire-fcm-compat",[Y2]:"fire-perf",[J2]:"fire-perf-compat",[X2]:"fire-rc",[Z2]:"fire-rc-compat",[ek]:"fire-gcs",[tk]:"fire-gcs-compat",[nk]:"fire-fst",[sk]:"fire-fst-compat",[rk]:"fire-vertex","fire-js":"fire-js",[ik]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zl=new Map,Qx=new Map,Yx=new Map;function Jb(n,e){try{n.container.addComponent(e)}catch(t){qa.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Rs(n){const e=n.name;if(Yx.has(e))return qa.debug(`There were multiple attempts to register component ${e}.`),!1;Yx.set(e,n);for(const t of Zl.values())Jb(t,n);for(const t of Qx.values())Jb(t,n);return!0}function Ka(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function cs(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ho=new nl("app","Firebase",lk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new us("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ho.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc=ak;function By(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Kx,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Ho.create("bad-app-name",{appName:String(i)});if(t||(t=FN()),!t)throw Ho.create("no-options");const l=Zl.get(i);if(l){if(za(t,l.options)&&za(r,l.config))return l;throw Ho.create("duplicate-app",{appName:i})}const c=new x2(i);for(const p of Yx.values())c.addComponent(p);const u=new ck(t,r,c);return Zl.set(i,u),u}function Mh(n=Kx){const e=Zl.get(n);if(!e&&n===Kx&&FN())return By();if(!e)throw Ho.create("no-app",{appName:n});return e}function Xb(){return Array.from(Zl.values())}async function dk(n){let e=!1;const t=n.name;Zl.has(t)?(e=!0,Zl.delete(t)):Qx.has(t)&&n.decRefCount()<=0&&(Qx.delete(t),e=!0),e&&(await Promise.all(n.container.getProviders().map(r=>r.delete())),n.isDeleted=!0)}function Sr(n,e,t){let r=ok[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),l=e.match(/\s|\//);if(i||l){const c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qa.warn(c.join(" "));return}Rs(new us(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uk="firebase-heartbeat-database",hk=1,yh="firebase-heartbeat-store";let mx=null;function YN(){return mx||(mx=wf(uk,hk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(yh)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ho.create("idb-open",{originalErrorMessage:n.message})})),mx}async function mk(n){try{const t=(await YN()).transaction(yh),r=await t.objectStore(yh).get(JN(n));return await t.done,r}catch(e){if(e instanceof oi)qa.warn(e.message);else{const t=Ho.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qa.warn(t.message)}}}async function Zb(n,e){try{const r=(await YN()).transaction(yh,"readwrite");await r.objectStore(yh).put(e,JN(n)),await r.done}catch(t){if(t instanceof oi)qa.warn(t.message);else{const r=Ho.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});qa.warn(r.message)}}}function JN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk=1024,fk=30;class gk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new yk(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=ew();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(c=>c.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:i}),this._heartbeatsCache.heartbeats.length>fk){const c=vk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(c,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){qa.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ew(),{heartbeatsToSend:r,unsentEntries:i}=xk(this._heartbeatsCache.heartbeats),l=Bp(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(t){return qa.warn(t),""}}}function ew(){return new Date().toISOString().substring(0,10)}function xk(n,e=pk){const t=[];let r=n.slice();for(const i of n){const l=t.find(c=>c.agent===i.agent);if(l){if(l.dates.push(i.date),tw(t)>e){l.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),tw(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class yk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vf()?$y().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await mk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Zb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Zb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function tw(n){return Bp(JSON.stringify({version:2,heartbeats:n})).length}function vk(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bk(n){Rs(new us("platform-logger",e=>new R2(e),"PRIVATE")),Rs(new us("heartbeat",e=>new gk(e),"PRIVATE")),Sr(Gx,Yb,n),Sr(Gx,Yb,"esm2020"),Sr("fire-js","")}bk("");function XN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const wk=XN,ZN=new nl("auth","Firebase",XN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up=new bf("@firebase/auth");function _k(n,...e){Up.logLevel<=Ot.WARN&&Up.warn(`Auth (${gc}): ${n}`,...e)}function vp(n,...e){Up.logLevel<=Ot.ERROR&&Up.error(`Auth (${gc}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(n,...e){throw Uy(n,...e)}function ks(n,...e){return Uy(n,...e)}function e1(n,e,t){const r={...wk(),[e]:t};return new nl("auth","Firebase",r).create(e,{appName:n.name})}function sa(n){return e1(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Uy(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ZN.create(n,...e)}function qe(n,e,...t){if(!n)throw Uy(e,...t)}function La(n){const e="INTERNAL ASSERTION FAILED: "+n;throw vp(e),new Error(e)}function Wa(n,e){n||La(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jx(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function t1(){return nw()==="http:"||nw()==="https:"}function nw(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(t1()||qN()||"connection"in navigator)?navigator.onLine:!0}function Ik(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wa(t>e,"Short delay should be less than long delay!"),this.isMobile=Zj()||t2()}get(){return Nk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zy(n,e){Wa(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;La("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;La("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;La("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Ak=new Vh(3e4,6e4);function hs(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function li(n,e,t,r,i={}){return r1(n,i,async()=>{let l={},c={};r&&(e==="GET"?c=r:l={body:JSON.stringify(r)});const u=Vd({key:n.config.apiKey,...c}).slice(1),p=await n._getAdditionalHeaders();p["Content-Type"]="application/json",n.languageCode&&(p["X-Firebase-Locale"]=n.languageCode);const g={method:e,headers:p,...l};return e2()||(g.referrerPolicy="no-referrer"),n.emulatorConfig&&tl(n.emulatorConfig.host)&&(g.credentials="include"),n1.fetch()(await s1(n,n.config.apiHost,t,u),g)})}async function r1(n,e,t){n._canInitEmulator=!1;const r={...Ek,...e};try{const i=new jk(n),l=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const c=await l.json();if("needConfirmation"in c)throw Wu(n,"account-exists-with-different-credential",c);if(l.ok&&!("errorMessage"in c))return c;{const u=l.ok?c.errorMessage:c.error.message,[p,g]=u.split(" : ");if(p==="FEDERATED_USER_ID_ALREADY_LINKED")throw Wu(n,"credential-already-in-use",c);if(p==="EMAIL_EXISTS")throw Wu(n,"email-already-in-use",c);if(p==="USER_DISABLED")throw Wu(n,"user-disabled",c);const b=r[p]||p.toLowerCase().replace(/[_\s]+/g,"-");if(g)throw e1(n,b,g);Li(n,b)}}catch(i){if(i instanceof oi)throw i;Li(n,"network-request-failed",{message:String(i)})}}async function rl(n,e,t,r,i={}){const l=await li(n,e,t,r,i);return"mfaPendingCredential"in l&&Li(n,"multi-factor-auth-required",{_serverResponse:l}),l}async function s1(n,e,t,r){const i=`${e}${t}?${r}`,l=n,c=l.config.emulator?zy(n.config,i):`${n.config.apiScheme}://${i}`;return Tk.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(c).toString():c}function Sk(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class jk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ks(this.auth,"network-request-failed")),Ak.get())})}}function Wu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=ks(n,e,r);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rw(n){return n!==void 0&&n.getResponse!==void 0}function sw(n){return n!==void 0&&n.enterprise!==void 0}class i1{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Sk(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kk(n){return(await li(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function a1(n,e){return li(n,"GET","/v2/recaptchaConfig",hs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ck(n,e){return li(n,"POST","/v1/accounts:delete",e)}async function zp(n,e){return li(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rh(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Rk(n,e=!1){const t=Kt(n),r=await t.getIdToken(e),i=qy(r);qe(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const l=typeof i.firebase=="object"?i.firebase:void 0,c=l==null?void 0:l.sign_in_provider;return{claims:i,token:r,authTime:rh(px(i.auth_time)),issuedAtTime:rh(px(i.iat)),expirationTime:rh(px(i.exp)),signInProvider:c||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function px(n){return Number(n)*1e3}function qy(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return vp("JWT malformed, contained fewer than 3 sections"),null;try{const i=MN(t);return i?JSON.parse(i):(vp("Failed to decode base64 JWT payload"),null)}catch(i){return vp("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function iw(n){const e=qy(n);return qe(e,"internal-error"),qe(typeof e.exp<"u","internal-error"),qe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vh(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof oi&&Dk(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Dk({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=rh(this.lastLoginAt),this.creationTime=rh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qp(n){var w;const e=n.auth,t=await n.getIdToken(),r=await vh(n,zp(e,{idToken:t}));qe(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const l=(w=i.providerUserInfo)!=null&&w.length?o1(i.providerUserInfo):[],c=Mk(n.providerData,l),u=n.isAnonymous,p=!(n.email&&i.passwordHash)&&!(c!=null&&c.length),g=u?p:!1,b={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new Xx(i.createdAt,i.lastLoginAt),isAnonymous:g};Object.assign(n,b)}async function Ok(n){const e=Kt(n);await qp(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Mk(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function o1(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n,e){const t=await r1(n,{},async()=>{const r=Vd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:l}=n.config,c=await s1(n,i,"/v1/token",`key=${l}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const p={method:"POST",headers:u,body:r};return n.emulatorConfig&&tl(n.emulatorConfig.host)&&(p.credentials="include"),n1.fetch()(c,p)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Lk(n,e){return li(n,"POST","/v2/accounts:revokeToken",hs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gd{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){qe(e.idToken,"internal-error"),qe(typeof e.idToken<"u","internal-error"),qe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):iw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){qe(e.length!==0,"internal-error");const t=iw(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(qe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:l}=await Vk(e,t);this.updateTokensAndExpiration(r,i,Number(l))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:l}=t,c=new gd;return r&&(qe(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),i&&(qe(typeof i=="string","internal-error",{appName:e}),c.accessToken=i),l&&(qe(typeof l=="number","internal-error",{appName:e}),c.expirationTime=l),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gd,this.toJSON())}_performRefresh(){return La("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Co(n,e){qe(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Vi{constructor({uid:e,auth:t,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new Pk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Xx(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await vh(this,this.stsTokenManager.getToken(this.auth,e));return qe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Rk(this,e)}reload(){return Ok(this)}_assign(e){this!==e&&(qe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Vi({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){qe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await qp(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(cs(this.auth.app))return Promise.reject(sa(this.auth));const e=await this.getIdToken();return await vh(this,Ck(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,i=t.email??void 0,l=t.phoneNumber??void 0,c=t.photoURL??void 0,u=t.tenantId??void 0,p=t._redirectEventId??void 0,g=t.createdAt??void 0,b=t.lastLoginAt??void 0,{uid:w,emailVerified:N,isAnonymous:D,providerData:z,stsTokenManager:L}=t;qe(w&&L,e,"internal-error");const O=gd.fromJSON(this.name,L);qe(typeof w=="string",e,"internal-error"),Co(r,e.name),Co(i,e.name),qe(typeof N=="boolean",e,"internal-error"),qe(typeof D=="boolean",e,"internal-error"),Co(l,e.name),Co(c,e.name),Co(u,e.name),Co(p,e.name),Co(g,e.name),Co(b,e.name);const le=new Vi({uid:w,auth:e,email:i,emailVerified:N,displayName:r,isAnonymous:D,photoURL:c,phoneNumber:l,tenantId:u,stsTokenManager:O,createdAt:g,lastLoginAt:b});return z&&Array.isArray(z)&&(le.providerData=z.map(ge=>({...ge}))),p&&(le._redirectEventId=p),le}static async _fromIdTokenResponse(e,t,r=!1){const i=new gd;i.updateFromServerResponse(t);const l=new Vi({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await qp(l),l}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];qe(i.localId!==void 0,"internal-error");const l=i.providerUserInfo!==void 0?o1(i.providerUserInfo):[],c=!(i.email&&i.passwordHash)&&!(l!=null&&l.length),u=new gd;u.updateFromIdToken(r);const p=new Vi({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:c}),g={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Xx(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(l!=null&&l.length)};return Object.assign(p,g),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aw=new Map;function $a(n){Wa(n instanceof Function,"Expected a class definition");let e=aw.get(n);return e?(Wa(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,aw.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l1{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}l1.type="NONE";const Zx=l1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bp(n,e,t){return`firebase:${n}:${e}:${t}`}class xd{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:l}=this.auth;this.fullUserKey=bp(this.userKey,i.apiKey,l),this.fullPersistenceKey=bp("persistence",i.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await zp(this.auth,{idToken:e}).catch(()=>{});return t?Vi._fromGetAccountInfoResponse(this.auth,t,e):null}return Vi._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new xd($a(Zx),e,r);const i=(await Promise.all(t.map(async g=>{if(await g._isAvailable())return g}))).filter(g=>g);let l=i[0]||$a(Zx);const c=bp(r,e.config.apiKey,e.name);let u=null;for(const g of t)try{const b=await g._get(c);if(b){let w;if(typeof b=="string"){const N=await zp(e,{idToken:b}).catch(()=>{});if(!N)break;w=await Vi._fromGetAccountInfoResponse(e,N,b)}else w=Vi._fromJSON(e,b);g!==l&&(u=w),l=g;break}}catch{}const p=i.filter(g=>g._shouldAllowMigration);return!l._shouldAllowMigration||!p.length?new xd(l,e,r):(l=p[0],u&&await l._set(c,u.toJSON()),await Promise.all(t.map(async g=>{if(g!==l)try{await g._remove(c)}catch{}})),new xd(l,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ow(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(h1(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(c1(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(p1(e))return"Blackberry";if(f1(e))return"Webos";if(d1(e))return"Safari";if((e.includes("chrome/")||u1(e))&&!e.includes("edge/"))return"Chrome";if(m1(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function c1(n=Zn()){return/firefox\//i.test(n)}function d1(n=Zn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function u1(n=Zn()){return/crios\//i.test(n)}function h1(n=Zn()){return/iemobile/i.test(n)}function m1(n=Zn()){return/android/i.test(n)}function p1(n=Zn()){return/blackberry/i.test(n)}function f1(n=Zn()){return/webos/i.test(n)}function Wy(n=Zn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function $k(n=Zn()){var e;return Wy(n)&&!!((e=window.navigator)!=null&&e.standalone)}function Fk(){return n2()&&document.documentMode===10}function g1(n=Zn()){return Wy(n)||m1(n)||f1(n)||p1(n)||/windows phone/i.test(n)||h1(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x1(n,e=[]){let t;switch(n){case"Browser":t=ow(Zn());break;case"Worker":t=`${ow(Zn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gc}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=l=>new Promise((c,u)=>{try{const p=e(l);c(p)}catch(p){u(p)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(n,e={}){return li(n,"GET","/v2/passwordPolicy",hs(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zk=6;class qk{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??zk,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new lw(this),this.idTokenSubscription=new lw(this),this.beforeStateQueue=new Bk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ZN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$a(t)),this._initializationPromise=this.queue(async()=>{var r,i,l;if(!this._deleted&&(this.persistenceManager=await xd.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((l=this.currentUser)==null?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await zp(this,{idToken:e}),r=await Vi._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var l;if(cs(this.app)){const c=this.app.settings.authIdToken;return c?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(c).then(u,u))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const c=(l=this.redirectUser)==null?void 0:l._redirectEventId,u=r==null?void 0:r._redirectEventId,p=await this.tryRedirectSignIn(e);(!c||c===u)&&(p!=null&&p.user)&&(r=p.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(c){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(c))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return qe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qp(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Ik()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(cs(this.app))return Promise.reject(sa(this));const t=e?Kt(e):null;return t&&qe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&qe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return cs(this.app)?Promise.reject(sa(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return cs(this.app)?Promise.reject(sa(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($a(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Uk(this),t=new qk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new nl("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Lk(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$a(e)||this._popupRedirectResolver;qe(t,this,"argument-error"),this.redirectPersistenceManager=await xd.create(this,[$a(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let c=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(qe(u,this,"internal-error"),u.then(()=>{c||l(this.currentUser)}),typeof t=="function"){const p=e.addObserver(t,r,i);return()=>{c=!0,p()}}else{const p=e.addObserver(t);return()=>{c=!0,p()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return qe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=x1(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(cs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&_k(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ua(n){return Kt(n)}class lw{constructor(e){this.auth=e,this.observer=null,this.addObserver=o2(t=>this.observer=t)}get next(){return qe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Hk(n){Lh=n}function Hy(n){return Lh.loadJS(n)}function Gk(){return Lh.recaptchaV2Script}function Kk(){return Lh.recaptchaEnterpriseScript}function Qk(){return Lh.gapiScript}function y1(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yk=500,Jk=6e4,sp=1e12;class Xk{constructor(e){this.auth=e,this.counter=sp,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new tC(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||sp;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||sp;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||sp;return(r=this._widgets.get(t))==null||r.execute(),""}}class Zk{constructor(){this.enterprise=new eC}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eC{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class tC{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i=typeof e=="string"?document.getElementById(e):e;qe(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=nC(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Jk)},Yk))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function nC(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const rC="recaptcha-enterprise",sh="NO_RECAPTCHA";class v1{constructor(e){this.type=rC,this.auth=ua(e)}async verify(e="verify",t=!1){async function r(l){if(!t){if(l.tenantId==null&&l._agentRecaptchaConfig!=null)return l._agentRecaptchaConfig.siteKey;if(l.tenantId!=null&&l._tenantRecaptchaConfigs[l.tenantId]!==void 0)return l._tenantRecaptchaConfigs[l.tenantId].siteKey}return new Promise(async(c,u)=>{a1(l,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(p=>{if(p.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const g=new i1(p);return l.tenantId==null?l._agentRecaptchaConfig=g:l._tenantRecaptchaConfigs[l.tenantId]=g,c(g.siteKey)}}).catch(p=>{u(p)})})}function i(l,c,u){const p=window.grecaptcha;sw(p)?p.enterprise.ready(()=>{p.enterprise.execute(l,{action:e}).then(g=>{c(g)}).catch(()=>{c(sh)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Zk().execute("siteKey",{action:"verify"}):new Promise((l,c)=>{r(this.auth).then(u=>{if(!t&&sw(window.grecaptcha))i(u,l,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let p=Kk();p.length!==0&&(p+=u),Hy(p).then(()=>{i(u,l,c)}).catch(g=>{c(g)})}}).catch(u=>{c(u)})})}}async function Du(n,e,t,r=!1,i=!1){const l=new v1(n);let c;if(i)c=sh;else try{c=await l.verify(t)}catch{c=await l.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const p=u.phoneEnrollmentInfo.phoneNumber,g=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:p,recaptchaToken:g,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const p=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:p,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:c}):Object.assign(u,{captchaResponse:c}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function yd(n,e,t,r,i){var l,c;if(i==="EMAIL_PASSWORD_PROVIDER")if((l=n._getRecaptchaConfig())!=null&&l.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const u=await Du(n,e,t,t==="getOobCode");return r(n,u)}else return r(n,e).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const p=await Du(n,e,t,t==="getOobCode");return r(n,p)}else return Promise.reject(u)});else if(i==="PHONE_PROVIDER")if((c=n._getRecaptchaConfig())!=null&&c.isProviderEnabled("PHONE_PROVIDER")){const u=await Du(n,e,t);return r(n,u).catch(async p=>{var g;if(((g=n._getRecaptchaConfig())==null?void 0:g.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(p.code==="auth/missing-recaptcha-token"||p.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const b=await Du(n,e,t,!1,!0);return r(n,b)}return Promise.reject(p)})}else{const u=await Du(n,e,t,!1,!0);return r(n,u)}else return Promise.reject(i+" provider is not supported.")}async function sC(n){const e=ua(n),t=await a1(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new i1(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new v1(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b1(n,e){const t=Ka(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),l=t.getOptions();if(za(l,e??{}))return i;Li(i,"already-initialized")}return t.initialize({options:e})}function iC(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map($a);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function aC(n,e,t){const r=ua(n);qe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,l=w1(e),{host:c,port:u}=oC(e),p=u===null?"":`:${u}`,g={url:`${l}//${c}${p}/`},b=Object.freeze({host:c,port:u,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){qe(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),qe(za(g,r.config.emulator)&&za(b,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=g,r.emulatorConfig=b,r.settings.appVerificationDisabledForTesting=!0,tl(c)?(Vy(`${l}//${c}${p}`),Ly("Auth",!0)):lC()}function w1(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function oC(n){const e=w1(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const l=i[1];return{host:l,port:cw(r.substr(l.length+1))}}else{const[l,c]=r.split(":");return{host:l,port:cw(c)}}}function cw(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function lC(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return La("not implemented")}_getIdTokenResponse(e){return La("not implemented")}_linkToIdToken(e,t){return La("not implemented")}_getReauthenticationResolver(e){return La("not implemented")}}async function cC(n,e){return li(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dC(n,e){return rl(n,"POST","/v1/accounts:signInWithPassword",hs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uC(n,e){return rl(n,"POST","/v1/accounts:signInWithEmailLink",hs(n,e))}async function hC(n,e){return rl(n,"POST","/v1/accounts:signInWithEmailLink",hs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh extends _f{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new bh(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new bh(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yd(e,t,"signInWithPassword",dC,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return uC(e,{email:this._email,oobCode:this._password});default:Li(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yd(e,r,"signUpPassword",cC,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return hC(e,{idToken:t,email:this._email,oobCode:this._password});default:Li(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vd(n,e){return rl(n,"POST","/v1/accounts:signInWithIdp",hs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC="http://localhost";class ec extends _f{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ec(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Li("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...l}=t;if(!r||!i)return null;const c=new ec(r,i);return c.idToken=l.idToken||void 0,c.accessToken=l.accessToken||void 0,c.secret=l.secret,c.nonce=l.nonce,c.pendingToken=l.pendingToken||null,c}_getIdTokenResponse(e){const t=this.buildRequest();return vd(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,vd(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,vd(e,t)}buildRequest(){const e={requestUri:mC,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Vd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dw(n,e){return li(n,"POST","/v1/accounts:sendVerificationCode",hs(n,e))}async function pC(n,e){return rl(n,"POST","/v1/accounts:signInWithPhoneNumber",hs(n,e))}async function fC(n,e){const t=await rl(n,"POST","/v1/accounts:signInWithPhoneNumber",hs(n,e));if(t.temporaryProof)throw Wu(n,"account-exists-with-different-credential",t);return t}const gC={USER_NOT_FOUND:"user-not-found"};async function xC(n,e){const t={...e,operation:"REAUTH"};return rl(n,"POST","/v1/accounts:signInWithPhoneNumber",hs(n,t),gC)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih extends _f{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ih({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ih({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return pC(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return fC(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return xC(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:l}=e;return!r&&!t&&!i&&!l?null:new ih({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yC(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function vC(n){const e=zu(qu(n)).link,t=e?zu(qu(e)).deep_link_id:null,r=zu(qu(n)).deep_link_id;return(r?zu(qu(r)).link:null)||r||t||e||n}class Gy{constructor(e){const t=zu(qu(e)),r=t.apiKey??null,i=t.oobCode??null,l=yC(t.mode??null);qe(r&&i&&l,"argument-error"),this.apiKey=r,this.operation=l,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=vC(e);try{return new Gy(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld{constructor(){this.providerId=Ld.PROVIDER_ID}static credential(e,t){return bh._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Gy.parseLink(t);return qe(r,"argument-error"),bh._fromEmailAndCode(e,r.code,r.tenantId)}}Ld.PROVIDER_ID="password";Ld.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ld.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h extends _1{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo extends $h{constructor(){super("facebook.com")}static credential(e){return ec._fromParams({providerId:Lo.PROVIDER_ID,signInMethod:Lo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Lo.credentialFromTaggedObject(e)}static credentialFromError(e){return Lo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Lo.credential(e.oauthAccessToken)}catch{return null}}}Lo.FACEBOOK_SIGN_IN_METHOD="facebook.com";Lo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o extends $h{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ec._fromParams({providerId:$o.PROVIDER_ID,signInMethod:$o.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return $o.credentialFromTaggedObject(e)}static credentialFromError(e){return $o.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return $o.credential(t,r)}catch{return null}}}$o.GOOGLE_SIGN_IN_METHOD="google.com";$o.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo extends $h{constructor(){super("github.com")}static credential(e){return ec._fromParams({providerId:Fo.PROVIDER_ID,signInMethod:Fo.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Fo.credentialFromTaggedObject(e)}static credentialFromError(e){return Fo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Fo.credential(e.oauthAccessToken)}catch{return null}}}Fo.GITHUB_SIGN_IN_METHOD="github.com";Fo.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo extends $h{constructor(){super("twitter.com")}static credential(e,t){return ec._fromParams({providerId:Bo.PROVIDER_ID,signInMethod:Bo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Bo.credentialFromTaggedObject(e)}static credentialFromError(e){return Bo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Bo.credential(t,r)}catch{return null}}}Bo.TWITTER_SIGN_IN_METHOD="twitter.com";Bo.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bC(n,e){return rl(n,"POST","/v1/accounts:signUp",hs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const l=await Vi._fromIdTokenResponse(e,r,i),c=uw(r);return new tc({user:l,providerId:c,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=uw(r);return new tc({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function uw(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp extends oi{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Wp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new Wp(e,t,r,i)}}function N1(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?Wp._fromErrorAndOperation(n,l,e,r):l})}async function wC(n,e,t=!1){const r=await vh(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return tc._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _C(n,e,t=!1){const{auth:r}=n;if(cs(r.app))return Promise.reject(sa(r));const i="reauthenticate";try{const l=await vh(n,N1(r,i,e,n),t);qe(l.idToken,r,"internal-error");const c=qy(l.idToken);qe(c,r,"internal-error");const{sub:u}=c;return qe(n.uid===u,r,"user-mismatch"),tc._forOperation(n,i,l)}catch(l){throw(l==null?void 0:l.code)==="auth/user-not-found"&&Li(r,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I1(n,e,t=!1){if(cs(n.app))return Promise.reject(sa(n));const r="signIn",i=await N1(n,r,e),l=await tc._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(l.user),l}async function E1(n,e){return I1(ua(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T1(n){const e=ua(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function NC(n,e,t){if(cs(n.app))return Promise.reject(sa(n));const r=ua(n),c=await yd(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",bC,"EMAIL_PASSWORD_PROVIDER").catch(p=>{throw p.code==="auth/password-does-not-meet-requirements"&&T1(n),p}),u=await tc._fromIdTokenResponse(r,"signIn",c);return await r._updateCurrentUser(u.user),u}function IC(n,e,t){return cs(n.app)?Promise.reject(sa(n)):E1(Kt(n),Ld.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&T1(n),r})}function EC(n,e,t,r){return Kt(n).onIdTokenChanged(e,t,r)}function TC(n,e,t){return Kt(n).beforeAuthStateChanged(e,t)}function AC(n,e,t,r){return Kt(n).onAuthStateChanged(e,t,r)}function A1(n){return Kt(n).signOut()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hw(n,e){return li(n,"POST","/v2/accounts/mfaEnrollment:start",hs(n,e))}const Hp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Hp,"1"),this.storage.removeItem(Hp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SC=1e3,jC=10;class j1 extends S1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=g1(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((c,u,p)=>{this.notifyListeners(c,p)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const c=this.storage.getItem(r);!t&&this.localCache[r]===c||this.notifyListeners(r,c)},l=this.storage.getItem(r);Fk()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,jC):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},SC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}j1.type="LOCAL";const kC=j1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1 extends S1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}k1.type="SESSION";const C1=k1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CC(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new Nf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:l}=t.data,c=this.handlersMap[i];if(!(c!=null&&c.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const u=Array.from(c).map(async g=>g(t.origin,l)),p=await CC(u);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:p})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Nf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ky(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let l,c;return new Promise((u,p)=>{const g=Ky("",20);i.port1.start();const b=setTimeout(()=>{p(new Error("unsupported_event"))},r);c={messageChannel:i,onMessage(w){const N=w;if(N.data.eventId===g)switch(N.data.status){case"ack":clearTimeout(b),l=setTimeout(()=>{p(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),u(N.data.response);break;default:clearTimeout(b),clearTimeout(l),p(new Error("invalid_response"));break}}},this.handlers.add(c),i.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:g,data:t},[i.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(){return window}function DC(n){Un().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(){return typeof Un().WorkerGlobalScope<"u"&&typeof Un().importScripts=="function"}async function PC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function OC(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function MC(){return Qy()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R1="firebaseLocalStorageDb",VC=1,Gp="firebaseLocalStorage",D1="fbase_key";class Fh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function If(n,e){return n.transaction([Gp],e?"readwrite":"readonly").objectStore(Gp)}function LC(){const n=indexedDB.deleteDatabase(R1);return new Fh(n).toPromise()}function ey(){const n=indexedDB.open(R1,VC);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Gp,{keyPath:D1})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Gp)?e(r):(r.close(),await LC(),e(await ey()))})})}async function mw(n,e,t){const r=If(n,!0).put({[D1]:e,value:t});return new Fh(r).toPromise()}async function $C(n,e){const t=If(n,!1).get(e),r=await new Fh(t).toPromise();return r===void 0?null:r.value}function pw(n,e){const t=If(n,!0).delete(e);return new Fh(t).toPromise()}const FC=800,BC=3;class P1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ey(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>BC)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qy()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Nf._getInstance(MC()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await PC(),!this.activeServiceWorker)return;this.sender=new RC(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||OC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ey();return await mw(e,Hp,"1"),await pw(e,Hp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>mw(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>$C(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pw(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const l=If(i,!1).getAll();return new Fh(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:l}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(l)&&(this.notifyListeners(i,l),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),FC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}P1.type="LOCAL";const UC=P1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fw(n,e){return li(n,"POST","/v2/accounts/mfaSignIn:start",hs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fx=y1("rcb"),zC=new Vh(3e4,6e4);class qC{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=Un().grecaptcha)!=null&&e.render)}load(e,t=""){return qe(WC(t),e,"argument-error"),this.shouldResolveImmediately(t)&&rw(Un().grecaptcha)?Promise.resolve(Un().grecaptcha):new Promise((r,i)=>{const l=Un().setTimeout(()=>{i(ks(e,"network-request-failed"))},zC.get());Un()[fx]=()=>{Un().clearTimeout(l),delete Un()[fx];const u=Un().grecaptcha;if(!u||!rw(u)){i(ks(e,"internal-error"));return}const p=u.render;u.render=(g,b)=>{const w=p(g,b);return this.counter++,w},this.hostLanguage=t,r(u)};const c=`${Gk()}?${Vd({onload:fx,render:"explicit",hl:t})}`;Hy(c).catch(()=>{clearTimeout(l),i(ks(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=Un().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function WC(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class HC{async load(e){return new Xk(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah="recaptcha",GC={theme:"light",type:"image"};class KC{constructor(e,t,r={...GC}){this.parameters=r,this.type=ah,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ua(e),this.isInvisible=this.parameters.size==="invisible",qe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i=typeof t=="string"?document.getElementById(t):t;qe(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new HC:new qC,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{const l=c=>{c&&(this.tokenChangeListeners.delete(l),i(c))};this.tokenChangeListeners.add(l),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){qe(!this.parameters.sitekey,this.auth,"argument-error"),qe(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),qe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Un()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){qe(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){qe(t1()&&!Qy(),this.auth,"internal-error"),await QC(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await kk(this.auth);qe(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return qe(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function QC(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ih._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function JC(n,e,t){if(cs(n.app))return Promise.reject(sa(n));const r=ua(n),i=await XC(r,e,Kt(t));return new YC(i,l=>E1(r,l))}async function XC(n,e,t){var r;if(!n._getRecaptchaConfig())try{await sC(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const l=i.session;if("phoneNumber"in i){qe(l.type==="enroll",n,"internal-error");const c={idToken:l.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await yd(n,c,"mfaSmsEnrollment",async(b,w)=>{if(w.phoneEnrollmentInfo.captchaResponse===sh){qe((t==null?void 0:t.type)===ah,b,"argument-error");const N=await gx(b,w,t);return hw(b,N)}return hw(b,w)},"PHONE_PROVIDER").catch(b=>Promise.reject(b))).phoneSessionInfo.sessionInfo}else{qe(l.type==="signin",n,"internal-error");const c=((r=i.multiFactorHint)==null?void 0:r.uid)||i.multiFactorUid;qe(c,n,"missing-multi-factor-info");const u={mfaPendingCredential:l.credential,mfaEnrollmentId:c,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await yd(n,u,"mfaSmsSignIn",async(w,N)=>{if(N.phoneSignInInfo.captchaResponse===sh){qe((t==null?void 0:t.type)===ah,w,"argument-error");const D=await gx(w,N,t);return fw(w,D)}return fw(w,N)},"PHONE_PROVIDER").catch(w=>Promise.reject(w))).phoneResponseInfo.sessionInfo}}else{const l={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await yd(n,l,"sendVerificationCode",async(g,b)=>{if(b.captchaResponse===sh){qe((t==null?void 0:t.type)===ah,g,"argument-error");const w=await gx(g,b,t);return dw(g,w)}return dw(g,b)},"PHONE_PROVIDER").catch(g=>Promise.reject(g))).sessionInfo}}finally{t==null||t._reset()}}async function gx(n,e,t){qe(t.type===ah,n,"argument-error");const r=await t.verify();qe(typeof r=="string",n,"argument-error");const i={...e};if("phoneEnrollmentInfo"in i){const l=i.phoneEnrollmentInfo.phoneNumber,c=i.phoneEnrollmentInfo.captchaResponse,u=i.phoneEnrollmentInfo.clientType,p=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:r,captchaResponse:c,clientType:u,recaptchaVersion:p}}),i}else if("phoneSignInInfo"in i){const l=i.phoneSignInInfo.captchaResponse,c=i.phoneSignInInfo.clientType,u=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:l,clientType:c,recaptchaVersion:u}}),i}else return Object.assign(i,{recaptchaToken:r}),i}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZC(n,e){return e?$a(e):(qe(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy extends _f{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return vd(e,this._buildIdpRequest())}_linkToIdToken(e,t){return vd(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return vd(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function eR(n){return I1(n.auth,new Yy(n),n.bypassAuthState)}function tR(n){const{auth:e,user:t}=n;return qe(t,e,"internal-error"),_C(t,new Yy(n),n.bypassAuthState)}async function nR(n){const{auth:e,user:t}=n;return qe(t,e,"internal-error"),wC(t,new Yy(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t,r,i,l=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:l,error:c,type:u}=e;if(c){this.reject(c);return}const p={auth:this.auth,requestUri:t,sessionId:r,tenantId:l||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(p))}catch(g){this.reject(g)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return eR;case"linkViaPopup":case"linkViaRedirect":return nR;case"reauthViaPopup":case"reauthViaRedirect":return tR;default:Li(this.auth,"internal-error")}}resolve(e){Wa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rR=new Vh(2e3,1e4);class fd extends O1{constructor(e,t,r,i,l){super(e,t,i,l),this.provider=r,this.authWindow=null,this.pollId=null,fd.currentPopupAction&&fd.currentPopupAction.cancel(),fd.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return qe(e,this.auth,"internal-error"),e}async onExecution(){Wa(this.filter.length===1,"Popup operations only handle one event");const e=Ky();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ks(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(ks(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fd.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ks(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,rR.get())};e()}}fd.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR="pendingRedirect",wp=new Map;class iR extends O1{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=wp.get(this.auth._key());if(!e){try{const r=await aR(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}wp.set(this.auth._key(),e)}return this.bypassAuthState||wp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function aR(n,e){const t=cR(e),r=lR(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function oR(n,e){wp.set(n._key(),e)}function lR(n){return $a(n._redirectPersistence)}function cR(n){return bp(sR,n.config.apiKey,n.name)}async function dR(n,e,t=!1){if(cs(n.app))return Promise.reject(sa(n));const r=ua(n),i=ZC(r,e),c=await new iR(r,i,t).execute();return c&&!t&&(delete c.user._redirectEventId,await r._persistUserIfCurrent(c.user),await r._setRedirectUser(null,e)),c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uR=600*1e3;class hR{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!mR(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!M1(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(ks(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=uR&&this.cachedEventUids.clear(),this.cachedEventUids.has(gw(e))}saveEventToCache(e){this.cachedEventUids.add(gw(e)),this.lastProcessedEventTime=Date.now()}}function gw(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function M1({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function mR(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return M1(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pR(n,e={}){return li(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gR=/^https?/;async function xR(n){if(n.config.emulator)return;const{authorizedDomains:e}=await pR(n);for(const t of e)try{if(yR(t))return}catch{}Li(n,"unauthorized-domain")}function yR(n){const e=Jx(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const c=new URL(n);return c.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&c.hostname===r}if(!gR.test(t))return!1;if(fR.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vR=new Vh(3e4,6e4);function xw(){const n=Un().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function bR(n){return new Promise((e,t)=>{var i,l,c;function r(){xw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xw(),t(ks(n,"network-request-failed"))},timeout:vR.get()})}if((l=(i=Un().gapi)==null?void 0:i.iframes)!=null&&l.Iframe)e(gapi.iframes.getContext());else if((c=Un().gapi)!=null&&c.load)r();else{const u=y1("iframefcb");return Un()[u]=()=>{gapi.load?r():t(ks(n,"network-request-failed"))},Hy(`${Qk()}?onload=${u}`).catch(p=>t(p))}}).catch(e=>{throw _p=null,e})}let _p=null;function wR(n){return _p=_p||bR(n),_p}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _R=new Vh(5e3,15e3),NR="__/auth/iframe",IR="emulator/auth/iframe",ER={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},TR=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function AR(n){const e=n.config;qe(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?zy(e,IR):`https://${n.config.authDomain}/${NR}`,r={apiKey:e.apiKey,appName:n.name,v:gc},i=TR.get(n.config.apiHost);i&&(r.eid=i);const l=n._getFrameworks();return l.length&&(r.fw=l.join(",")),`${t}?${Vd(r).slice(1)}`}async function SR(n){const e=await wR(n),t=Un().gapi;return qe(t,n,"internal-error"),e.open({where:document.body,url:AR(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ER,dontclear:!0},r=>new Promise(async(i,l)=>{await r.restyle({setHideOnLeave:!1});const c=ks(n,"network-request-failed"),u=Un().setTimeout(()=>{l(c)},_R.get());function p(){Un().clearTimeout(u),i(r)}r.ping(p).then(p,()=>{l(c)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},kR=500,CR=600,RR="_blank",DR="http://localhost";class yw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function PR(n,e,t,r=kR,i=CR){const l=Math.max((window.screen.availHeight-i)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const p={...jR,width:r.toString(),height:i.toString(),top:l,left:c},g=Zn().toLowerCase();t&&(u=u1(g)?RR:t),c1(g)&&(e=e||DR,p.scrollbars="yes");const b=Object.entries(p).reduce((N,[D,z])=>`${N}${D}=${z},`,"");if($k(g)&&u!=="_self")return OR(e||"",u),new yw(null);const w=window.open(e||"",u,b);qe(w,n,"popup-blocked");try{w.focus()}catch{}return new yw(w)}function OR(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MR="__/auth/handler",VR="emulator/auth/handler",LR=encodeURIComponent("fac");async function vw(n,e,t,r,i,l){qe(n.config.authDomain,n,"auth-domain-config-required"),qe(n.config.apiKey,n,"invalid-api-key");const c={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:gc,eventId:i};if(e instanceof _1){e.setDefaultLanguage(n.languageCode),c.providerId=e.providerId||"",a2(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[b,w]of Object.entries({}))c[b]=w}if(e instanceof $h){const b=e.getScopes().filter(w=>w!=="");b.length>0&&(c.scopes=b.join(","))}n.tenantId&&(c.tid=n.tenantId);const u=c;for(const b of Object.keys(u))u[b]===void 0&&delete u[b];const p=await n._getAppCheckToken(),g=p?`#${LR}=${encodeURIComponent(p)}`:"";return`${$R(n)}?${Vd(u).slice(1)}${g}`}function $R({config:n}){return n.emulator?zy(n,VR):`https://${n.authDomain}/${MR}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xx="webStorageSupport";class FR{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=C1,this._completeRedirectFn=dR,this._overrideRedirectResult=oR}async _openPopup(e,t,r,i){var c;Wa((c=this.eventManagers[e._key()])==null?void 0:c.manager,"_initialize() not called before _openPopup()");const l=await vw(e,t,r,Jx(),i);return PR(e,l,Ky())}async _openRedirect(e,t,r,i){await this._originValidation(e);const l=await vw(e,t,r,Jx(),i);return DC(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:l}=this.eventManagers[t];return i?Promise.resolve(i):(Wa(l,"If manager is not set, promise should be"),l)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await SR(e),r=new hR(e);return t.register("authEvent",i=>(qe(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(xx,{type:xx},i=>{var c;const l=(c=i==null?void 0:i[0])==null?void 0:c[xx];l!==void 0&&t(!!l),Li(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=xR(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return g1()||d1()||Wy()}}const BR=FR;var bw="@firebase/auth",ww="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){qe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zR(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function qR(n){Rs(new us("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:c,authDomain:u}=r.options;qe(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});const p={apiKey:c,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:x1(n)},g=new Wk(r,i,l,p);return iC(g,t),g},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Rs(new us("auth-internal",e=>{const t=ua(e.getProvider("auth").getImmediate());return(r=>new UR(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Sr(bw,ww,zR(n)),Sr(bw,ww,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WR=300,HR=BN("authIdTokenMaxAge")||WR;let _w=null;const GR=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>HR)return;const i=t==null?void 0:t.token;_w!==i&&(_w=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function V1(n=Mh()){const e=Ka(n,"auth");if(e.isInitialized())return e.getImmediate();const t=b1(n,{popupRedirectResolver:BR,persistence:[UC,kC,C1]}),r=BN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(r,location.origin);if(location.origin===l.origin){const c=GR(l.toString());TC(t,c,()=>c(t.currentUser)),EC(t,u=>c(u))}}const i=LN("auth");return i&&aC(t,`http://${i}`),t}function KR(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}Hk({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const l=ks("internal-error");l.customData=i,t(l)},r.type="text/javascript",r.charset="UTF-8",KR().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});qR("Browser");var QR="firebase",YR="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sr(QR,YR,"app");var Nw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Go,L1;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,R){function M(){}M.prototype=R.prototype,k.F=R.prototype,k.prototype=new M,k.prototype.constructor=k,k.D=function(q,U,K){for(var V=Array(arguments.length-2),Fe=2;Fe<arguments.length;Fe++)V[Fe-2]=arguments[Fe];return R.prototype[U].apply(q,V)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,R,M){M||(M=0);const q=Array(16);if(typeof R=="string")for(var U=0;U<16;++U)q[U]=R.charCodeAt(M++)|R.charCodeAt(M++)<<8|R.charCodeAt(M++)<<16|R.charCodeAt(M++)<<24;else for(U=0;U<16;++U)q[U]=R[M++]|R[M++]<<8|R[M++]<<16|R[M++]<<24;R=k.g[0],M=k.g[1],U=k.g[2];let K=k.g[3],V;V=R+(K^M&(U^K))+q[0]+3614090360&4294967295,R=M+(V<<7&4294967295|V>>>25),V=K+(U^R&(M^U))+q[1]+3905402710&4294967295,K=R+(V<<12&4294967295|V>>>20),V=U+(M^K&(R^M))+q[2]+606105819&4294967295,U=K+(V<<17&4294967295|V>>>15),V=M+(R^U&(K^R))+q[3]+3250441966&4294967295,M=U+(V<<22&4294967295|V>>>10),V=R+(K^M&(U^K))+q[4]+4118548399&4294967295,R=M+(V<<7&4294967295|V>>>25),V=K+(U^R&(M^U))+q[5]+1200080426&4294967295,K=R+(V<<12&4294967295|V>>>20),V=U+(M^K&(R^M))+q[6]+2821735955&4294967295,U=K+(V<<17&4294967295|V>>>15),V=M+(R^U&(K^R))+q[7]+4249261313&4294967295,M=U+(V<<22&4294967295|V>>>10),V=R+(K^M&(U^K))+q[8]+1770035416&4294967295,R=M+(V<<7&4294967295|V>>>25),V=K+(U^R&(M^U))+q[9]+2336552879&4294967295,K=R+(V<<12&4294967295|V>>>20),V=U+(M^K&(R^M))+q[10]+4294925233&4294967295,U=K+(V<<17&4294967295|V>>>15),V=M+(R^U&(K^R))+q[11]+2304563134&4294967295,M=U+(V<<22&4294967295|V>>>10),V=R+(K^M&(U^K))+q[12]+1804603682&4294967295,R=M+(V<<7&4294967295|V>>>25),V=K+(U^R&(M^U))+q[13]+4254626195&4294967295,K=R+(V<<12&4294967295|V>>>20),V=U+(M^K&(R^M))+q[14]+2792965006&4294967295,U=K+(V<<17&4294967295|V>>>15),V=M+(R^U&(K^R))+q[15]+1236535329&4294967295,M=U+(V<<22&4294967295|V>>>10),V=R+(U^K&(M^U))+q[1]+4129170786&4294967295,R=M+(V<<5&4294967295|V>>>27),V=K+(M^U&(R^M))+q[6]+3225465664&4294967295,K=R+(V<<9&4294967295|V>>>23),V=U+(R^M&(K^R))+q[11]+643717713&4294967295,U=K+(V<<14&4294967295|V>>>18),V=M+(K^R&(U^K))+q[0]+3921069994&4294967295,M=U+(V<<20&4294967295|V>>>12),V=R+(U^K&(M^U))+q[5]+3593408605&4294967295,R=M+(V<<5&4294967295|V>>>27),V=K+(M^U&(R^M))+q[10]+38016083&4294967295,K=R+(V<<9&4294967295|V>>>23),V=U+(R^M&(K^R))+q[15]+3634488961&4294967295,U=K+(V<<14&4294967295|V>>>18),V=M+(K^R&(U^K))+q[4]+3889429448&4294967295,M=U+(V<<20&4294967295|V>>>12),V=R+(U^K&(M^U))+q[9]+568446438&4294967295,R=M+(V<<5&4294967295|V>>>27),V=K+(M^U&(R^M))+q[14]+3275163606&4294967295,K=R+(V<<9&4294967295|V>>>23),V=U+(R^M&(K^R))+q[3]+4107603335&4294967295,U=K+(V<<14&4294967295|V>>>18),V=M+(K^R&(U^K))+q[8]+1163531501&4294967295,M=U+(V<<20&4294967295|V>>>12),V=R+(U^K&(M^U))+q[13]+2850285829&4294967295,R=M+(V<<5&4294967295|V>>>27),V=K+(M^U&(R^M))+q[2]+4243563512&4294967295,K=R+(V<<9&4294967295|V>>>23),V=U+(R^M&(K^R))+q[7]+1735328473&4294967295,U=K+(V<<14&4294967295|V>>>18),V=M+(K^R&(U^K))+q[12]+2368359562&4294967295,M=U+(V<<20&4294967295|V>>>12),V=R+(M^U^K)+q[5]+4294588738&4294967295,R=M+(V<<4&4294967295|V>>>28),V=K+(R^M^U)+q[8]+2272392833&4294967295,K=R+(V<<11&4294967295|V>>>21),V=U+(K^R^M)+q[11]+1839030562&4294967295,U=K+(V<<16&4294967295|V>>>16),V=M+(U^K^R)+q[14]+4259657740&4294967295,M=U+(V<<23&4294967295|V>>>9),V=R+(M^U^K)+q[1]+2763975236&4294967295,R=M+(V<<4&4294967295|V>>>28),V=K+(R^M^U)+q[4]+1272893353&4294967295,K=R+(V<<11&4294967295|V>>>21),V=U+(K^R^M)+q[7]+4139469664&4294967295,U=K+(V<<16&4294967295|V>>>16),V=M+(U^K^R)+q[10]+3200236656&4294967295,M=U+(V<<23&4294967295|V>>>9),V=R+(M^U^K)+q[13]+681279174&4294967295,R=M+(V<<4&4294967295|V>>>28),V=K+(R^M^U)+q[0]+3936430074&4294967295,K=R+(V<<11&4294967295|V>>>21),V=U+(K^R^M)+q[3]+3572445317&4294967295,U=K+(V<<16&4294967295|V>>>16),V=M+(U^K^R)+q[6]+76029189&4294967295,M=U+(V<<23&4294967295|V>>>9),V=R+(M^U^K)+q[9]+3654602809&4294967295,R=M+(V<<4&4294967295|V>>>28),V=K+(R^M^U)+q[12]+3873151461&4294967295,K=R+(V<<11&4294967295|V>>>21),V=U+(K^R^M)+q[15]+530742520&4294967295,U=K+(V<<16&4294967295|V>>>16),V=M+(U^K^R)+q[2]+3299628645&4294967295,M=U+(V<<23&4294967295|V>>>9),V=R+(U^(M|~K))+q[0]+4096336452&4294967295,R=M+(V<<6&4294967295|V>>>26),V=K+(M^(R|~U))+q[7]+1126891415&4294967295,K=R+(V<<10&4294967295|V>>>22),V=U+(R^(K|~M))+q[14]+2878612391&4294967295,U=K+(V<<15&4294967295|V>>>17),V=M+(K^(U|~R))+q[5]+4237533241&4294967295,M=U+(V<<21&4294967295|V>>>11),V=R+(U^(M|~K))+q[12]+1700485571&4294967295,R=M+(V<<6&4294967295|V>>>26),V=K+(M^(R|~U))+q[3]+2399980690&4294967295,K=R+(V<<10&4294967295|V>>>22),V=U+(R^(K|~M))+q[10]+4293915773&4294967295,U=K+(V<<15&4294967295|V>>>17),V=M+(K^(U|~R))+q[1]+2240044497&4294967295,M=U+(V<<21&4294967295|V>>>11),V=R+(U^(M|~K))+q[8]+1873313359&4294967295,R=M+(V<<6&4294967295|V>>>26),V=K+(M^(R|~U))+q[15]+4264355552&4294967295,K=R+(V<<10&4294967295|V>>>22),V=U+(R^(K|~M))+q[6]+2734768916&4294967295,U=K+(V<<15&4294967295|V>>>17),V=M+(K^(U|~R))+q[13]+1309151649&4294967295,M=U+(V<<21&4294967295|V>>>11),V=R+(U^(M|~K))+q[4]+4149444226&4294967295,R=M+(V<<6&4294967295|V>>>26),V=K+(M^(R|~U))+q[11]+3174756917&4294967295,K=R+(V<<10&4294967295|V>>>22),V=U+(R^(K|~M))+q[2]+718787259&4294967295,U=K+(V<<15&4294967295|V>>>17),V=M+(K^(U|~R))+q[9]+3951481745&4294967295,k.g[0]=k.g[0]+R&4294967295,k.g[1]=k.g[1]+(U+(V<<21&4294967295|V>>>11))&4294967295,k.g[2]=k.g[2]+U&4294967295,k.g[3]=k.g[3]+K&4294967295}r.prototype.v=function(k,R){R===void 0&&(R=k.length);const M=R-this.blockSize,q=this.C;let U=this.h,K=0;for(;K<R;){if(U==0)for(;K<=M;)i(this,k,K),K+=this.blockSize;if(typeof k=="string"){for(;K<R;)if(q[U++]=k.charCodeAt(K++),U==this.blockSize){i(this,q),U=0;break}}else for(;K<R;)if(q[U++]=k[K++],U==this.blockSize){i(this,q),U=0;break}}this.h=U,this.o+=R},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var R=1;R<k.length-8;++R)k[R]=0;R=this.o*8;for(var M=k.length-8;M<k.length;++M)k[M]=R&255,R/=256;for(this.v(k),k=Array(16),R=0,M=0;M<4;++M)for(let q=0;q<32;q+=8)k[R++]=this.g[M]>>>q&255;return k};function l(k,R){var M=u;return Object.prototype.hasOwnProperty.call(M,k)?M[k]:M[k]=R(k)}function c(k,R){this.h=R;const M=[];let q=!0;for(let U=k.length-1;U>=0;U--){const K=k[U]|0;q&&K==R||(M[U]=K,q=!1)}this.g=M}var u={};function p(k){return-128<=k&&k<128?l(k,function(R){return new c([R|0],R<0?-1:0)}):new c([k|0],k<0?-1:0)}function g(k){if(isNaN(k)||!isFinite(k))return w;if(k<0)return O(g(-k));const R=[];let M=1;for(let q=0;k>=M;q++)R[q]=k/M|0,M*=4294967296;return new c(R,0)}function b(k,R){if(k.length==0)throw Error("number format error: empty string");if(R=R||10,R<2||36<R)throw Error("radix out of range: "+R);if(k.charAt(0)=="-")return O(b(k.substring(1),R));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const M=g(Math.pow(R,8));let q=w;for(let K=0;K<k.length;K+=8){var U=Math.min(8,k.length-K);const V=parseInt(k.substring(K,K+U),R);U<8?(U=g(Math.pow(R,U)),q=q.j(U).add(g(V))):(q=q.j(M),q=q.add(g(V)))}return q}var w=p(0),N=p(1),D=p(16777216);n=c.prototype,n.m=function(){if(L(this))return-O(this).m();let k=0,R=1;for(let M=0;M<this.g.length;M++){const q=this.i(M);k+=(q>=0?q:4294967296+q)*R,R*=4294967296}return k},n.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(z(this))return"0";if(L(this))return"-"+O(this).toString(k);const R=g(Math.pow(k,6));var M=this;let q="";for(;;){const U=xe(M,R).g;M=le(M,U.j(R));let K=((M.g.length>0?M.g[0]:M.h)>>>0).toString(k);if(M=U,z(M))return K+q;for(;K.length<6;)K="0"+K;q=K+q}},n.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function z(k){if(k.h!=0)return!1;for(let R=0;R<k.g.length;R++)if(k.g[R]!=0)return!1;return!0}function L(k){return k.h==-1}n.l=function(k){return k=le(this,k),L(k)?-1:z(k)?0:1};function O(k){const R=k.g.length,M=[];for(let q=0;q<R;q++)M[q]=~k.g[q];return new c(M,~k.h).add(N)}n.abs=function(){return L(this)?O(this):this},n.add=function(k){const R=Math.max(this.g.length,k.g.length),M=[];let q=0;for(let U=0;U<=R;U++){let K=q+(this.i(U)&65535)+(k.i(U)&65535),V=(K>>>16)+(this.i(U)>>>16)+(k.i(U)>>>16);q=V>>>16,K&=65535,V&=65535,M[U]=V<<16|K}return new c(M,M[M.length-1]&-2147483648?-1:0)};function le(k,R){return k.add(O(R))}n.j=function(k){if(z(this)||z(k))return w;if(L(this))return L(k)?O(this).j(O(k)):O(O(this).j(k));if(L(k))return O(this.j(O(k)));if(this.l(D)<0&&k.l(D)<0)return g(this.m()*k.m());const R=this.g.length+k.g.length,M=[];for(var q=0;q<2*R;q++)M[q]=0;for(q=0;q<this.g.length;q++)for(let U=0;U<k.g.length;U++){const K=this.i(q)>>>16,V=this.i(q)&65535,Fe=k.i(U)>>>16,ue=k.i(U)&65535;M[2*q+2*U]+=V*ue,ge(M,2*q+2*U),M[2*q+2*U+1]+=K*ue,ge(M,2*q+2*U+1),M[2*q+2*U+1]+=V*Fe,ge(M,2*q+2*U+1),M[2*q+2*U+2]+=K*Fe,ge(M,2*q+2*U+2)}for(k=0;k<R;k++)M[k]=M[2*k+1]<<16|M[2*k];for(k=R;k<2*R;k++)M[k]=0;return new c(M,0)};function ge(k,R){for(;(k[R]&65535)!=k[R];)k[R+1]+=k[R]>>>16,k[R]&=65535,R++}function ae(k,R){this.g=k,this.h=R}function xe(k,R){if(z(R))throw Error("division by zero");if(z(k))return new ae(w,w);if(L(k))return R=xe(O(k),R),new ae(O(R.g),O(R.h));if(L(R))return R=xe(k,O(R)),new ae(O(R.g),R.h);if(k.g.length>30){if(L(k)||L(R))throw Error("slowDivide_ only works with positive integers.");for(var M=N,q=R;q.l(k)<=0;)M=j(M),q=j(q);var U=ie(M,1),K=ie(q,1);for(q=ie(q,2),M=ie(M,2);!z(q);){var V=K.add(q);V.l(k)<=0&&(U=U.add(M),K=V),q=ie(q,1),M=ie(M,1)}return R=le(k,U.j(R)),new ae(U,R)}for(U=w;k.l(R)>=0;){for(M=Math.max(1,Math.floor(k.m()/R.m())),q=Math.ceil(Math.log(M)/Math.LN2),q=q<=48?1:Math.pow(2,q-48),K=g(M),V=K.j(R);L(V)||V.l(k)>0;)M-=q,K=g(M),V=K.j(R);z(K)&&(K=N),U=U.add(K),k=le(k,V)}return new ae(U,k)}n.B=function(k){return xe(this,k).h},n.and=function(k){const R=Math.max(this.g.length,k.g.length),M=[];for(let q=0;q<R;q++)M[q]=this.i(q)&k.i(q);return new c(M,this.h&k.h)},n.or=function(k){const R=Math.max(this.g.length,k.g.length),M=[];for(let q=0;q<R;q++)M[q]=this.i(q)|k.i(q);return new c(M,this.h|k.h)},n.xor=function(k){const R=Math.max(this.g.length,k.g.length),M=[];for(let q=0;q<R;q++)M[q]=this.i(q)^k.i(q);return new c(M,this.h^k.h)};function j(k){const R=k.g.length+1,M=[];for(let q=0;q<R;q++)M[q]=k.i(q)<<1|k.i(q-1)>>>31;return new c(M,k.h)}function ie(k,R){const M=R>>5;R%=32;const q=k.g.length-M,U=[];for(let K=0;K<q;K++)U[K]=R>0?k.i(K+M)>>>R|k.i(K+M+1)<<32-R:k.i(K+M);return new c(U,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,L1=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=g,c.fromString=b,Go=c}).apply(typeof Nw<"u"?Nw:typeof self<"u"?self:typeof window<"u"?window:{});var ip=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $1,Hu,F1,Np,ty,B1,U1,z1;(function(){var n,e=Object.defineProperty;function t(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof ip=="object"&&ip];for(var v=0;v<m.length;++v){var I=m[v];if(I&&I.Math==Math)return I}throw Error("Cannot find global object")}var r=t(this);function i(m,v){if(v)e:{var I=r;m=m.split(".");for(var C=0;C<m.length-1;C++){var Z=m[C];if(!(Z in I))break e;I=I[Z]}m=m[m.length-1],C=I[m],v=v(C),v!=C&&v!=null&&e(I,m,{configurable:!0,writable:!0,value:v})}}i("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(m){return m||function(v){var I=[],C;for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&I.push([C,v[C]]);return I}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var l=l||{},c=this||self;function u(m){var v=typeof m;return v=="object"&&m!=null||v=="function"}function p(m,v,I){return m.call.apply(m.bind,arguments)}function g(m,v,I){return g=p,g.apply(null,arguments)}function b(m,v){var I=Array.prototype.slice.call(arguments,1);return function(){var C=I.slice();return C.push.apply(C,arguments),m.apply(this,C)}}function w(m,v){function I(){}I.prototype=v.prototype,m.Z=v.prototype,m.prototype=new I,m.prototype.constructor=m,m.Ob=function(C,Z,de){for(var De=Array(arguments.length-2),ft=2;ft<arguments.length;ft++)De[ft-2]=arguments[ft];return v.prototype[Z].apply(C,De)}}var N=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function D(m){const v=m.length;if(v>0){const I=Array(v);for(let C=0;C<v;C++)I[C]=m[C];return I}return[]}function z(m,v){for(let C=1;C<arguments.length;C++){const Z=arguments[C];var I=typeof Z;if(I=I!="object"?I:Z?Array.isArray(Z)?"array":I:"null",I=="array"||I=="object"&&typeof Z.length=="number"){I=m.length||0;const de=Z.length||0;m.length=I+de;for(let De=0;De<de;De++)m[I+De]=Z[De]}else m.push(Z)}}class L{constructor(v,I){this.i=v,this.j=I,this.h=0,this.g=null}get(){let v;return this.h>0?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function O(m){c.setTimeout(()=>{throw m},0)}function le(){var m=k;let v=null;return m.g&&(v=m.g,m.g=m.g.next,m.g||(m.h=null),v.next=null),v}class ge{constructor(){this.h=this.g=null}add(v,I){const C=ae.get();C.set(v,I),this.h?this.h.next=C:this.g=C,this.h=C}}var ae=new L(()=>new xe,m=>m.reset());class xe{constructor(){this.next=this.g=this.h=null}set(v,I){this.h=v,this.g=I,this.next=null}reset(){this.next=this.g=this.h=null}}let j,ie=!1,k=new ge,R=()=>{const m=Promise.resolve(void 0);j=()=>{m.then(M)}};function M(){for(var m;m=le();){try{m.h.call(m.g)}catch(I){O(I)}var v=ae;v.j(m),v.h<100&&(v.h++,m.next=v.g,v.g=m)}ie=!1}function q(){this.u=this.u,this.C=this.C}q.prototype.u=!1,q.prototype.dispose=function(){this.u||(this.u=!0,this.N())},q.prototype[Symbol.dispose]=function(){this.dispose()},q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function U(m,v){this.type=m,this.g=this.target=v,this.defaultPrevented=!1}U.prototype.h=function(){this.defaultPrevented=!0};var K=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var m=!1,v=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const I=()=>{};c.addEventListener("test",I,v),c.removeEventListener("test",I,v)}catch{}return m})();function V(m){return/^[\s\xa0]*$/.test(m)}function Fe(m,v){U.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,v)}w(Fe,U),Fe.prototype.init=function(m,v){const I=this.type=m.type,C=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=v,v=m.relatedTarget,v||(I=="mouseover"?v=m.fromElement:I=="mouseout"&&(v=m.toElement)),this.relatedTarget=v,C?(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&Fe.Z.h.call(this)},Fe.prototype.h=function(){Fe.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var ue="closure_listenable_"+(Math.random()*1e6|0),Te=0;function Ie(m,v,I,C,Z){this.listener=m,this.proxy=null,this.src=v,this.type=I,this.capture=!!C,this.ha=Z,this.key=++Te,this.da=this.fa=!1}function fe(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function P(m,v,I){for(const C in m)v.call(I,m[C],C,m)}function H(m,v){for(const I in m)v.call(void 0,m[I],I,m)}function $(m){const v={};for(const I in m)v[I]=m[I];return v}const oe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function we(m,v){let I,C;for(let Z=1;Z<arguments.length;Z++){C=arguments[Z];for(I in C)m[I]=C[I];for(let de=0;de<oe.length;de++)I=oe[de],Object.prototype.hasOwnProperty.call(C,I)&&(m[I]=C[I])}}function he(m){this.src=m,this.g={},this.h=0}he.prototype.add=function(m,v,I,C,Z){const de=m.toString();m=this.g[de],m||(m=this.g[de]=[],this.h++);const De=me(m,v,C,Z);return De>-1?(v=m[De],I||(v.fa=!1)):(v=new Ie(v,this.src,de,!!C,Z),v.fa=I,m.push(v)),v};function ke(m,v){const I=v.type;if(I in m.g){var C=m.g[I],Z=Array.prototype.indexOf.call(C,v,void 0),de;(de=Z>=0)&&Array.prototype.splice.call(C,Z,1),de&&(fe(v),m.g[I].length==0&&(delete m.g[I],m.h--))}}function me(m,v,I,C){for(let Z=0;Z<m.length;++Z){const de=m[Z];if(!de.da&&de.listener==v&&de.capture==!!I&&de.ha==C)return Z}return-1}var $e="closure_lm_"+(Math.random()*1e6|0),pt={};function at(m,v,I,C,Z){if(Array.isArray(v)){for(let de=0;de<v.length;de++)at(m,v[de],I,C,Z);return null}return I=zt(I),m&&m[ue]?m.J(v,I,u(C)?!!C.capture:!1,Z):lt(m,v,I,!1,C,Z)}function lt(m,v,I,C,Z,de){if(!v)throw Error("Invalid event type");const De=u(Z)?!!Z.capture:!!Z;let ft=yn(m);if(ft||(m[$e]=ft=new he(m)),I=ft.add(v,I,C,De,de),I.proxy)return I;if(C=on(),I.proxy=C,C.src=m,C.listener=I,m.addEventListener)K||(Z=De),Z===void 0&&(Z=!1),m.addEventListener(v.toString(),C,Z);else if(m.attachEvent)m.attachEvent(mn(v.toString()),C);else if(m.addListener&&m.removeListener)m.addListener(C);else throw Error("addEventListener and attachEvent are unavailable.");return I}function on(){function m(I){return v.call(m.src,m.listener,I)}const v=pn;return m}function Re(m,v,I,C,Z){if(Array.isArray(v))for(var de=0;de<v.length;de++)Re(m,v[de],I,C,Z);else C=u(C)?!!C.capture:!!C,I=zt(I),m&&m[ue]?(m=m.i,de=String(v).toString(),de in m.g&&(v=m.g[de],I=me(v,I,C,Z),I>-1&&(fe(v[I]),Array.prototype.splice.call(v,I,1),v.length==0&&(delete m.g[de],m.h--)))):m&&(m=yn(m))&&(v=m.g[v.toString()],m=-1,v&&(m=me(v,I,C,Z)),(I=m>-1?v[m]:null)&&Oe(I))}function Oe(m){if(typeof m!="number"&&m&&!m.da){var v=m.src;if(v&&v[ue])ke(v.i,m);else{var I=m.type,C=m.proxy;v.removeEventListener?v.removeEventListener(I,C,m.capture):v.detachEvent?v.detachEvent(mn(I),C):v.addListener&&v.removeListener&&v.removeListener(C),(I=yn(v))?(ke(I,m),I.h==0&&(I.src=null,v[$e]=null)):fe(m)}}}function mn(m){return m in pt?pt[m]:pt[m]="on"+m}function pn(m,v){if(m.da)m=!0;else{v=new Fe(v,this);const I=m.listener,C=m.ha||m.src;m.fa&&Oe(m),m=I.call(C,v)}return m}function yn(m){return m=m[$e],m instanceof he?m:null}var Be="__closure_events_fn_"+(Math.random()*1e9>>>0);function zt(m){return typeof m=="function"?m:(m[Be]||(m[Be]=function(v){return m.handleEvent(v)}),m[Be])}function _t(){q.call(this),this.i=new he(this),this.M=this,this.G=null}w(_t,q),_t.prototype[ue]=!0,_t.prototype.removeEventListener=function(m,v,I,C){Re(this,m,v,I,C)};function Tt(m,v){var I,C=m.G;if(C)for(I=[];C;C=C.G)I.push(C);if(m=m.M,C=v.type||v,typeof v=="string")v=new U(v,m);else if(v instanceof U)v.target=v.target||m;else{var Z=v;v=new U(C,m),we(v,Z)}Z=!0;let de,De;if(I)for(De=I.length-1;De>=0;De--)de=v.g=I[De],Z=jt(de,C,!0,v)&&Z;if(de=v.g=m,Z=jt(de,C,!0,v)&&Z,Z=jt(de,C,!1,v)&&Z,I)for(De=0;De<I.length;De++)de=v.g=I[De],Z=jt(de,C,!1,v)&&Z}_t.prototype.N=function(){if(_t.Z.N.call(this),this.i){var m=this.i;for(const v in m.g){const I=m.g[v];for(let C=0;C<I.length;C++)fe(I[C]);delete m.g[v],m.h--}}this.G=null},_t.prototype.J=function(m,v,I,C){return this.i.add(String(m),v,!1,I,C)},_t.prototype.K=function(m,v,I,C){return this.i.add(String(m),v,!0,I,C)};function jt(m,v,I,C){if(v=m.i.g[String(v)],!v)return!0;v=v.concat();let Z=!0;for(let de=0;de<v.length;++de){const De=v[de];if(De&&!De.da&&De.capture==I){const ft=De.listener,dn=De.ha||De.src;De.fa&&ke(m.i,De),Z=ft.call(dn,C)!==!1&&Z}}return Z&&!C.defaultPrevented}function Yr(m,v){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=g(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(v)>2147483647?-1:c.setTimeout(m,v||0)}function ms(m){m.g=Yr(()=>{m.g=null,m.i&&(m.i=!1,ms(m))},m.l);const v=m.h;m.h=null,m.m.apply(null,v)}class ui extends q{constructor(v,I){super(),this.m=v,this.l=I,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:ms(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ms(m){q.call(this),this.h=m,this.g={}}w(Ms,q);var hi=[];function Vs(m){P(m.g,function(v,I){this.g.hasOwnProperty(I)&&Oe(v)},m),m.g={}}Ms.prototype.N=function(){Ms.Z.N.call(this),Vs(this)},Ms.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Jr=c.JSON.stringify,ma=c.JSON.parse,or=class{stringify(m){return c.JSON.stringify(m,void 0)}parse(m){return c.JSON.parse(m,void 0)}};function ps(){}function mi(){}var se={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function _e(){U.call(this,"d")}w(_e,U);function ze(){U.call(this,"c")}w(ze,U);var Qe={},J=null;function Ye(){return J=J||new _t}Qe.Ia="serverreachability";function Lt(m){U.call(this,Qe.Ia,m)}w(Lt,U);function it(m){const v=Ye();Tt(v,new Lt(v))}Qe.STAT_EVENT="statevent";function xt(m,v){U.call(this,Qe.STAT_EVENT,m),this.stat=v}w(xt,U);function Ve(m){const v=Ye();Tt(v,new xt(v,m))}Qe.Ja="timingevent";function ve(m,v){U.call(this,Qe.Ja,m),this.size=v}w(ve,U);function et(m,v){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){m()},v)}function rn(){this.g=!0}rn.prototype.ua=function(){this.g=!1};function In(m,v,I,C,Z,de){m.info(function(){if(m.g)if(de){var De="",ft=de.split("&");for(let Ht=0;Ht<ft.length;Ht++){var dn=ft[Ht].split("=");if(dn.length>1){const un=dn[0];dn=dn[1];const Tn=un.split("_");De=Tn.length>=2&&Tn[1]=="type"?De+(un+"="+dn+"&"):De+(un+"=redacted&")}}}else De=null;else De=de;return"XMLHTTP REQ ("+C+") [attempt "+Z+"]: "+v+`
`+I+`
`+De})}function yr(m,v,I,C,Z,de,De){m.info(function(){return"XMLHTTP RESP ("+C+") [ attempt "+Z+"]: "+v+`
`+I+`
`+de+" "+De})}function Vn(m,v,I,C){m.info(function(){return"XMLHTTP TEXT ("+v+"): "+ut(m,I)+(C?" "+C:"")})}function Rr(m,v){m.info(function(){return"TIMEOUT: "+v})}rn.prototype.info=function(){};function ut(m,v){if(!m.g)return v;if(!v)return null;try{const de=JSON.parse(v);if(de){for(m=0;m<de.length;m++)if(Array.isArray(de[m])){var I=de[m];if(!(I.length<2)){var C=I[1];if(Array.isArray(C)&&!(C.length<1)){var Z=C[0];if(Z!="noop"&&Z!="stop"&&Z!="close")for(let De=1;De<C.length;De++)C[De]=""}}}}return Jr(de)}catch{return v}}var Qt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},$i={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ol;function fs(){}w(fs,ps),fs.prototype.g=function(){return new XMLHttpRequest},ol=new fs;function Ls(m){return encodeURIComponent(String(m))}function pi(m){var v=1;m=m.split(":");const I=[];for(;v>0&&m.length;)I.push(m.shift()),v--;return m.length&&I.push(m.join(":")),I}function Wn(m,v,I,C){this.j=m,this.i=v,this.l=I,this.S=C||1,this.V=new Ms(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new gs}function gs(){this.i=null,this.g="",this.h=!1}var xs={},Xa={};function ys(m,v,I){m.M=1,m.A=vs(Zr(v)),m.u=I,m.R=!0,fi(m,null)}function fi(m,v){m.F=Date.now(),$s(m),m.B=Zr(m.A);var I=m.B,C=m.S;Array.isArray(C)||(C=[String(C)]),ws(I.i,"t",C),m.C=0,I=m.j.L,m.h=new gs,m.g=Dt(m.j,I?v:null,!m.u),m.P>0&&(m.O=new ui(g(m.Y,m,m.g),m.P)),v=m.V,I=m.g,C=m.ba;var Z="readystatechange";Array.isArray(Z)||(Z&&(hi[0]=Z.toString()),Z=hi);for(let de=0;de<Z.length;de++){const De=at(I,Z[de],C||v.handleEvent,!1,v.h||v);if(!De)break;v.g[De.key]=De}v=m.J?$(m.J):{},m.u?(m.v||(m.v="POST"),v["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,v)):(m.v="GET",m.g.ea(m.B,m.v,null,v)),it(),In(m.i,m.v,m.B,m.l,m.S,m.u)}Wn.prototype.ba=function(m){m=m.target;const v=this.O;v&&Ws(m)==3?v.j():this.Y(m)},Wn.prototype.Y=function(m){try{if(m==this.g)e:{const ft=Ws(this.g),dn=this.g.ya(),Ht=this.g.ca();if(!(ft<3)&&(ft!=3||this.g&&(this.h.h||this.g.la()||cl(this.g)))){this.K||ft!=4||dn==7||(dn==8||Ht<=0?it(3):it(2)),pa(this);var v=this.g.ca();this.X=v;var I=wc(this);if(this.o=v==200,yr(this.i,this.v,this.B,this.l,this.S,ft,v),this.o){if(this.U&&!this.L){t:{if(this.g){var C,Z=this.g;if((C=Z.g?Z.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(C)){var de=C;break t}}de=null}if(m=de)Vn(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Wt(this,m);else{this.o=!1,this.m=3,Ve(12),Fs(this),Fi(this);break e}}if(this.R){m=!0;let un;for(;!this.K&&this.C<I.length;)if(un=_c(this,I),un==Xa){ft==4&&(this.m=4,Ve(14),m=!1),Vn(this.i,this.l,null,"[Incomplete Response]");break}else if(un==xs){this.m=4,Ve(15),Vn(this.i,this.l,I,"[Invalid Chunk]"),m=!1;break}else Vn(this.i,this.l,un,null),Wt(this,un);if(Za(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ft!=4||I.length!=0||this.h.h||(this.m=1,Ve(16),m=!1),this.o=this.o&&m,!m)Vn(this.i,this.l,I,"[Invalid Chunked Response]"),Fs(this),Fi(this);else if(I.length>0&&!this.W){this.W=!0;var De=this.j;De.g==this&&De.aa&&!De.P&&(De.j.info("Great, no buffering proxy detected. Bytes received: "+I.length),Lr(De),De.P=!0,Ve(11))}}else Vn(this.i,this.l,I,null),Wt(this,I);ft==4&&Fs(this),this.o&&!this.K&&(ft==4?En(this.j,this):(this.o=!1,$s(this)))}else Ec(this.g),v==400&&I.indexOf("Unknown SID")>0?(this.m=3,Ve(12)):(this.m=0,Ve(13)),Fs(this),Fi(this)}}}catch{}finally{}};function wc(m){if(!Za(m))return m.g.la();const v=cl(m.g);if(v==="")return"";let I="";const C=v.length,Z=Ws(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return Fs(m),Fi(m),"";m.h.i=new c.TextDecoder}for(let de=0;de<C;de++)m.h.h=!0,I+=m.h.i.decode(v[de],{stream:!(Z&&de==C-1)});return v.length=0,m.h.g+=I,m.C=0,m.h.g}function Za(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function _c(m,v){var I=m.C,C=v.indexOf(`
`,I);return C==-1?Xa:(I=Number(v.substring(I,C)),isNaN(I)?xs:(C+=1,C+I>v.length?Xa:(v=v.slice(C,C+I),m.C=C+I,v)))}Wn.prototype.cancel=function(){this.K=!0,Fs(this)};function $s(m){m.T=Date.now()+m.H,eo(m,m.H)}function eo(m,v){if(m.D!=null)throw Error("WatchDog timer not null");m.D=et(g(m.aa,m),v)}function pa(m){m.D&&(c.clearTimeout(m.D),m.D=null)}Wn.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(Rr(this.i,this.B),this.M!=2&&(it(),Ve(17)),Fs(this),this.m=2,Fi(this)):eo(this,this.T-m)};function Fi(m){m.j.I==0||m.K||En(m.j,m)}function Fs(m){pa(m);var v=m.O;v&&typeof v.dispose=="function"&&v.dispose(),m.O=null,Vs(m.V),m.g&&(v=m.g,m.g=null,v.abort(),v.dispose())}function Wt(m,v){try{var I=m.j;if(I.I!=0&&(I.g==m||Ui(I.h,m))){if(!m.L&&Ui(I.h,m)&&I.I==3){try{var C=I.Ba.g.parse(v)}catch{C=null}if(Array.isArray(C)&&C.length==3){var Z=C;if(Z[0]==0){e:if(!I.v){if(I.g)if(I.g.F+3e3<m.F)nr(I),cn(I);else break e;Ns(I),Ve(18)}}else I.xa=Z[1],0<I.xa-I.K&&Z[2]<37500&&I.F&&I.A==0&&!I.C&&(I.C=et(g(I.Va,I),6e3));lr(I.h)<=1&&I.ta&&(I.ta=void 0)}else dr(I,11)}else if((m.L||I.g==m)&&nr(I),!V(v))for(Z=I.Ba.g.parse(v),v=0;v<Z.length;v++){let Ht=Z[v];const un=Ht[0];if(!(un<=I.K))if(I.K=un,Ht=Ht[1],I.I==2)if(Ht[0]=="c"){I.M=Ht[1],I.ba=Ht[2];const Tn=Ht[3];Tn!=null&&(I.ka=Tn,I.j.info("VER="+I.ka));const $n=Ht[4];$n!=null&&(I.za=$n,I.j.info("SVER="+I.za));const Hs=Ht[5];Hs!=null&&typeof Hs=="number"&&Hs>0&&(C=1.5*Hs,I.O=C,I.j.info("backChannelRequestTimeoutMs_="+C)),C=I;const Gs=m.g;if(Gs){const uo=Gs.g?Gs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(uo){var de=C.h;de.g||uo.indexOf("spdy")==-1&&uo.indexOf("quic")==-1&&uo.indexOf("h2")==-1||(de.j=de.l,de.g=new Set,de.h&&(no(de,de.h),de.h=null))}if(C.G){const pl=Gs.g?Gs.g.getResponseHeader("X-HTTP-Session-Id"):null;pl&&(C.wa=pl,Bt(C.J,C.G,pl))}}I.I=3,I.l&&I.l.ra(),I.aa&&(I.T=Date.now()-m.F,I.j.info("Handshake RTT: "+I.T+"ms")),C=I;var De=m;if(C.na=lo(C,C.L?C.ba:null,C.W),De.L){gi(C.h,De);var ft=De,dn=C.O;dn&&(ft.H=dn),ft.D&&(pa(ft),$s(ft)),C.g=De}else tr(C);I.i.length>0&&wi(I)}else Ht[0]!="stop"&&Ht[0]!="close"||dr(I,7);else I.I==3&&(Ht[0]=="stop"||Ht[0]=="close"?Ht[0]=="stop"?dr(I,7):ul(I):Ht[0]!="noop"&&I.l&&I.l.qa(Ht),I.A=0)}}it(4)}catch{}}var Nc=class{constructor(m,v){this.g=m,this.map=v}};function to(m){this.l=m||10,c.PerformanceNavigationTiming?(m=c.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Bi(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function lr(m){return m.h?1:m.g?m.g.size:0}function Ui(m,v){return m.h?m.h==v:m.g?m.g.has(v):!1}function no(m,v){m.g?m.g.add(v):m.h=v}function gi(m,v){m.h&&m.h==v?m.h=null:m.g&&m.g.has(v)&&m.g.delete(v)}to.prototype.cancel=function(){if(this.i=Dr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function Dr(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let v=m.i;for(const I of m.g.values())v=v.concat(I.G);return v}return D(m.i)}var ro=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vr(m,v){if(m){m=m.split("&");for(let I=0;I<m.length;I++){const C=m[I].indexOf("=");let Z,de=null;C>=0?(Z=m[I].substring(0,C),de=m[I].substring(C+1)):Z=m[I],v(Z,de?decodeURIComponent(de.replace(/\+/g," ")):"")}}}function Xr(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let v;m instanceof Xr?(this.l=m.l,xi(this,m.j),this.o=m.o,this.g=m.g,br(this,m.u),this.h=m.h,Bs(this,qi(m.i)),this.m=m.m):m&&(v=String(m).match(ro))?(this.l=!1,xi(this,v[1]||"",!0),this.o=Us(v[2]||""),this.g=Us(v[3]||"",!0),br(this,v[4]),this.h=Us(v[5]||"",!0),Bs(this,v[6]||"",!0),this.m=Us(v[7]||"")):(this.l=!1,this.i=new kt(null,this.l))}Xr.prototype.toString=function(){const m=[];var v=this.j;v&&m.push(yi(v,so,!0),":");var I=this.g;return(I||v=="file")&&(m.push("//"),(v=this.o)&&m.push(yi(v,so,!0),"@"),m.push(Ls(I).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I=this.u,I!=null&&m.push(":",String(I))),(I=this.h)&&(this.g&&I.charAt(0)!="/"&&m.push("/"),m.push(yi(I,I.charAt(0)=="/"?zi:Pr,!0))),(I=this.i.toString())&&m.push("?",I),(I=this.m)&&m.push("#",yi(I,fa)),m.join("")},Xr.prototype.resolve=function(m){const v=Zr(this);let I=!!m.j;I?xi(v,m.j):I=!!m.o,I?v.o=m.o:I=!!m.g,I?v.g=m.g:I=m.u!=null;var C=m.h;if(I)br(v,m.u);else if(I=!!m.h){if(C.charAt(0)!="/")if(this.g&&!this.h)C="/"+C;else{var Z=v.h.lastIndexOf("/");Z!=-1&&(C=v.h.slice(0,Z+1)+C)}if(Z=C,Z==".."||Z==".")C="";else if(Z.indexOf("./")!=-1||Z.indexOf("/.")!=-1){C=Z.lastIndexOf("/",0)==0,Z=Z.split("/");const de=[];for(let De=0;De<Z.length;){const ft=Z[De++];ft=="."?C&&De==Z.length&&de.push(""):ft==".."?((de.length>1||de.length==1&&de[0]!="")&&de.pop(),C&&De==Z.length&&de.push("")):(de.push(ft),C=!0)}C=de.join("/")}else C=Z}return I?v.h=C:I=m.i.toString()!=="",I?Bs(v,qi(m.i)):I=!!m.m,I&&(v.m=m.m),v};function Zr(m){return new Xr(m)}function xi(m,v,I){m.j=I?Us(v,!0):v,m.j&&(m.j=m.j.replace(/:$/,""))}function br(m,v){if(v){if(v=Number(v),isNaN(v)||v<0)throw Error("Bad port number "+v);m.u=v}else m.u=null}function Bs(m,v,I){v instanceof kt?(m.i=v,vi(m.i,m.l)):(I||(v=yi(v,es)),m.i=new kt(v,m.l))}function Bt(m,v,I){m.i.set(v,I)}function vs(m){return Bt(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function Us(m,v){return m?v?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function yi(m,v,I){return typeof m=="string"?(m=encodeURI(m).replace(v,Vt),I&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Vt(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var so=/[#\/\?@]/g,Pr=/[#\?:]/g,zi=/[#\?]/g,es=/[#\?@]/g,fa=/#/g;function kt(m,v){this.h=this.g=null,this.i=m||null,this.j=!!v}function bs(m){m.g||(m.g=new Map,m.h=0,m.i&&vr(m.i,function(v,I){m.add(decodeURIComponent(v.replace(/\+/g," ")),I)}))}n=kt.prototype,n.add=function(m,v){bs(this),this.i=null,m=Or(this,m);let I=this.g.get(m);return I||this.g.set(m,I=[]),I.push(v),this.h+=1,this};function ll(m,v){bs(m),v=Or(m,v),m.g.has(v)&&(m.i=null,m.h-=m.g.get(v).length,m.g.delete(v))}function io(m,v){return bs(m),v=Or(m,v),m.g.has(v)}n.forEach=function(m,v){bs(this),this.g.forEach(function(I,C){I.forEach(function(Z){m.call(v,Z,C,this)},this)},this)};function ga(m,v){bs(m);let I=[];if(typeof v=="string")io(m,v)&&(I=I.concat(m.g.get(Or(m,v))));else for(m=Array.from(m.g.values()),v=0;v<m.length;v++)I=I.concat(m[v]);return I}n.set=function(m,v){return bs(this),this.i=null,m=Or(this,m),io(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[v]),this.h+=1,this},n.get=function(m,v){return m?(m=ga(this,m),m.length>0?String(m[0]):v):v};function ws(m,v,I){ll(m,v),I.length>0&&(m.i=null,m.g.set(Or(m,v),D(I)),m.h+=I.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],v=Array.from(this.g.keys());for(let C=0;C<v.length;C++){var I=v[C];const Z=Ls(I);I=ga(this,I);for(let de=0;de<I.length;de++){let De=Z;I[de]!==""&&(De+="="+Ls(I[de])),m.push(De)}}return this.i=m.join("&")};function qi(m){const v=new kt;return v.i=m.i,m.g&&(v.g=new Map(m.g),v.h=m.h),v}function Or(m,v){return v=String(v),m.j&&(v=v.toLowerCase()),v}function vi(m,v){v&&!m.j&&(bs(m),m.i=null,m.g.forEach(function(I,C){const Z=C.toLowerCase();C!=Z&&(ll(this,C),ws(this,Z,I))},m)),m.j=v}function Pn(m,v){const I=new rn;if(c.Image){const C=new Image;C.onload=b(fn,I,"TestLoadImage: loaded",!0,v,C),C.onerror=b(fn,I,"TestLoadImage: error",!1,v,C),C.onabort=b(fn,I,"TestLoadImage: abort",!1,v,C),C.ontimeout=b(fn,I,"TestLoadImage: timeout",!1,v,C),c.setTimeout(function(){C.ontimeout&&C.ontimeout()},1e4),C.src=m}else v(!1)}function zs(m,v){const I=new rn,C=new AbortController,Z=setTimeout(()=>{C.abort(),fn(I,"TestPingServer: timeout",!1,v)},1e4);fetch(m,{signal:C.signal}).then(de=>{clearTimeout(Z),de.ok?fn(I,"TestPingServer: ok",!0,v):fn(I,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(Z),fn(I,"TestPingServer: error",!1,v)})}function fn(m,v,I,C,Z){try{Z&&(Z.onload=null,Z.onerror=null,Z.onabort=null,Z.ontimeout=null),C(I)}catch{}}function xa(){this.g=new or}function Mr(m){this.i=m.Sb||null,this.h=m.ab||!1}w(Mr,ps),Mr.prototype.g=function(){return new Vr(this.i,this.h)};function Vr(m,v){_t.call(this),this.H=m,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}w(Vr,_t),n=Vr.prototype,n.open=function(m,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=v,this.readyState=1,cr(this)},n.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const v={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(v.body=m),(this.H||c).fetch(new Request(this.D,v)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Wi(this)),this.readyState=0},n.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,cr(this)),this.g&&(this.readyState=3,cr(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ao(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function ao(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}n.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var v=m.value?m.value:new Uint8Array(0);(v=this.B.decode(v,{stream:!m.done}))&&(this.response=this.responseText+=v)}m.done?Wi(this):cr(this),this.readyState==3&&ao(this)}},n.Oa=function(m){this.g&&(this.response=this.responseText=m,Wi(this))},n.Na=function(m){this.g&&(this.response=m,Wi(this))},n.ga=function(){this.g&&Wi(this)};function Wi(m){m.readyState=4,m.l=null,m.j=null,m.B=null,cr(m)}n.setRequestHeader=function(m,v){this.A.append(m,v)},n.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],v=this.h.entries();for(var I=v.next();!I.done;)I=I.value,m.push(I[0]+": "+I[1]),I=v.next();return m.join(`\r
`)};function cr(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(Vr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function Ic(m){let v="";return P(m,function(I,C){v+=C,v+=":",v+=I,v+=`\r
`}),v}function It(m,v,I){e:{for(C in I){var C=!1;break e}C=!0}C||(I=Ic(I),typeof m=="string"?I!=null&&Ls(I):Bt(m,v,I))}function He(m){_t.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}w(He,_t);var ya=/^https?$/i,oo=["POST","PUT"];n=He.prototype,n.Fa=function(m){this.H=m},n.ea=function(m,v,I,C){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);v=v?v.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ol.g(),this.g.onreadystatechange=N(g(this.Ca,this));try{this.B=!0,this.g.open(v,String(m),!0),this.B=!1}catch(de){vn(this,de);return}if(m=I||"",I=new Map(this.headers),C)if(Object.getPrototypeOf(C)===Object.prototype)for(var Z in C)I.set(Z,C[Z]);else if(typeof C.keys=="function"&&typeof C.get=="function")for(const de of C.keys())I.set(de,C.get(de));else throw Error("Unknown input type for opt_headers: "+String(C));C=Array.from(I.keys()).find(de=>de.toLowerCase()=="content-type"),Z=c.FormData&&m instanceof c.FormData,!(Array.prototype.indexOf.call(oo,v,void 0)>=0)||C||Z||I.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[de,De]of I)this.g.setRequestHeader(de,De);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(de){vn(this,de)}};function vn(m,v){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=v,m.o=5,$t(m),Ct(m)}function $t(m){m.A||(m.A=!0,Tt(m,"complete"),Tt(m,"error"))}n.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,Tt(this,"complete"),Tt(this,"abort"),Ct(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ct(this,!0)),He.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?qs(this):this.Xa())},n.Xa=function(){qs(this)};function qs(m){if(m.h&&typeof l<"u"){if(m.v&&Ws(m)==4)setTimeout(m.Ca.bind(m),0);else if(Tt(m,"readystatechange"),Ws(m)==4){m.h=!1;try{const de=m.ca();e:switch(de){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var I;if(!(I=v)){var C;if(C=de===0){let De=String(m.D).match(ro)[1]||null;!De&&c.self&&c.self.location&&(De=c.self.location.protocol.slice(0,-1)),C=!ya.test(De?De.toLowerCase():"")}I=C}if(I)Tt(m,"complete"),Tt(m,"success");else{m.o=6;try{var Z=Ws(m)>2?m.g.statusText:""}catch{Z=""}m.l=Z+" ["+m.ca()+"]",$t(m)}}finally{Ct(m)}}}}function Ct(m,v){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const I=m.g;m.g=null,v||Tt(m,"ready");try{I.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ws(m){return m.g?m.g.readyState:0}n.ca=function(){try{return Ws(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(m){if(this.g){var v=this.g.responseText;return m&&v.indexOf(m)==0&&(v=v.substring(m.length)),ma(v)}};function cl(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function Ec(m){const v={};m=(m.g&&Ws(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let C=0;C<m.length;C++){if(V(m[C]))continue;var I=pi(m[C]);const Z=I[0];if(I=I[1],typeof I!="string")continue;I=I.trim();const de=v[Z]||[];v[Z]=de,de.push(I)}H(v,function(C){return C.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function bi(m,v,I){return I&&I.internalChannelParams&&I.internalChannelParams[m]||v}function dl(m){this.za=0,this.i=[],this.j=new rn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=bi("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=bi("baseRetryDelayMs",5e3,m),this.Za=bi("retryDelaySeedMs",1e4,m),this.Ta=bi("forwardChannelMaxRetries",2,m),this.va=bi("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new to(m&&m.concurrentRequestLimit),this.Ba=new xa,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=dl.prototype,n.ka=8,n.I=1,n.connect=function(m,v,I,C){Ve(0),this.W=m,this.H=v||{},I&&C!==void 0&&(this.H.OSID=I,this.H.OAID=C),this.F=this.X,this.J=lo(this,null,this.W),wi(this)};function ul(m){if(sn(m),m.I==3){var v=m.V++,I=Zr(m.J);if(Bt(I,"SID",m.M),Bt(I,"RID",v),Bt(I,"TYPE","terminate"),_s(m,I),v=new Wn(m,m.j,v),v.M=2,v.A=vs(Zr(I)),I=!1,c.navigator&&c.navigator.sendBeacon)try{I=c.navigator.sendBeacon(v.A.toString(),"")}catch{}!I&&c.Image&&(new Image().src=v.A,I=!0),I||(v.g=Dt(v.j,null),v.g.ea(v.A)),v.F=Date.now(),$s(v)}ba(m)}function cn(m){m.g&&(Lr(m),m.g.cancel(),m.g=null)}function sn(m){cn(m),m.v&&(c.clearTimeout(m.v),m.v=null),nr(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&c.clearTimeout(m.m),m.m=null)}function wi(m){if(!Bi(m.h)&&!m.m){m.m=!0;var v=m.Ea;j||R(),ie||(j(),ie=!0),k.add(v,m),m.D=0}}function Tc(m,v){return lr(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=v.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=et(g(m.Ea,m,v),ts(m,m.D)),m.D++,!0)}n.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const Z=new Wn(this,this.j,m);let de=this.o;if(this.U&&(de?(de=$(de),we(de,this.U)):de=this.U),this.u!==null||this.R||(Z.J=de,de=null),this.S)e:{for(var v=0,I=0;I<this.i.length;I++){t:{var C=this.i[I];if("__data__"in C.map&&(C=C.map.__data__,typeof C=="string")){C=C.length;break t}C=void 0}if(C===void 0)break;if(v+=C,v>4096){v=I;break e}if(v===4096||I===this.i.length-1){v=I+1;break e}}v=1e3}else v=1e3;v=hl(this,Z,v),I=Zr(this.J),Bt(I,"RID",m),Bt(I,"CVER",22),this.G&&Bt(I,"X-HTTP-Session-Id",this.G),_s(this,I),de&&(this.R?v="headers="+Ls(Ic(de))+"&"+v:this.u&&It(I,this.u,de)),no(this.h,Z),this.Ra&&Bt(I,"TYPE","init"),this.S?(Bt(I,"$req",v),Bt(I,"SID","null"),Z.U=!0,ys(Z,I,null)):ys(Z,I,v),this.I=2}}else this.I==3&&(m?va(this,m):this.i.length==0||Bi(this.h)||va(this))};function va(m,v){var I;v?I=v.l:I=m.V++;const C=Zr(m.J);Bt(C,"SID",m.M),Bt(C,"RID",I),Bt(C,"AID",m.K),_s(m,C),m.u&&m.o&&It(C,m.u,m.o),I=new Wn(m,m.j,I,m.D+1),m.u===null&&(I.J=m.o),v&&(m.i=v.G.concat(m.i)),v=hl(m,I,1e3),I.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),no(m.h,I),ys(I,C,v)}function _s(m,v){m.H&&P(m.H,function(I,C){Bt(v,C,I)}),m.l&&P({},function(I,C){Bt(v,C,I)})}function hl(m,v,I){I=Math.min(m.i.length,I);const C=m.l?g(m.l.Ka,m.l,m):null;e:{var Z=m.i;let ft=-1;for(;;){const dn=["count="+I];ft==-1?I>0?(ft=Z[0].g,dn.push("ofs="+ft)):ft=0:dn.push("ofs="+ft);let Ht=!0;for(let un=0;un<I;un++){var de=Z[un].g;const Tn=Z[un].map;if(de-=ft,de<0)ft=Math.max(0,Z[un].g-100),Ht=!1;else try{de="req"+de+"_"||"";try{var De=Tn instanceof Map?Tn:Object.entries(Tn);for(const[$n,Hs]of De){let Gs=Hs;u(Hs)&&(Gs=Jr(Hs)),dn.push(de+$n+"="+encodeURIComponent(Gs))}}catch($n){throw dn.push(de+"type="+encodeURIComponent("_badmap")),$n}}catch{C&&C(Tn)}}if(Ht){De=dn.join("&");break e}}De=void 0}return m=m.i.splice(0,I),v.G=m,De}function tr(m){if(!m.g&&!m.v){m.Y=1;var v=m.Da;j||R(),ie||(j(),ie=!0),k.add(v,m),m.A=0}}function Ns(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=et(g(m.Da,m),ts(m,m.A)),m.A++,!0)}n.Da=function(){if(this.v=null,$r(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=et(g(this.Wa,this),m)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ve(10),cn(this),$r(this))};function Lr(m){m.B!=null&&(c.clearTimeout(m.B),m.B=null)}function $r(m){m.g=new Wn(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var v=Zr(m.na);Bt(v,"RID","rpc"),Bt(v,"SID",m.M),Bt(v,"AID",m.K),Bt(v,"CI",m.F?"0":"1"),!m.F&&m.ia&&Bt(v,"TO",m.ia),Bt(v,"TYPE","xmlhttp"),_s(m,v),m.u&&m.o&&It(v,m.u,m.o),m.O&&(m.g.H=m.O);var I=m.g;m=m.ba,I.M=1,I.A=vs(Zr(v)),I.u=null,I.R=!0,fi(I,m)}n.Va=function(){this.C!=null&&(this.C=null,cn(this),Ns(this),Ve(19))};function nr(m){m.C!=null&&(c.clearTimeout(m.C),m.C=null)}function En(m,v){var I=null;if(m.g==v){nr(m),Lr(m),m.g=null;var C=2}else if(Ui(m.h,v))I=v.G,gi(m.h,v),C=1;else return;if(m.I!=0){if(v.o)if(C==1){I=v.u?v.u.length:0,v=Date.now()-v.F;var Z=m.D;C=Ye(),Tt(C,new ve(C,I)),wi(m)}else tr(m);else if(Z=v.m,Z==3||Z==0&&v.X>0||!(C==1&&Tc(m,v)||C==2&&Ns(m)))switch(I&&I.length>0&&(v=m.h,v.i=v.i.concat(I)),Z){case 1:dr(m,5);break;case 4:dr(m,10);break;case 3:dr(m,6);break;default:dr(m,2)}}}function ts(m,v){let I=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(I*=2),I*v}function dr(m,v){if(m.j.info("Error code "+v),v==2){var I=g(m.bb,m),C=m.Ua;const Z=!C;C=new Xr(C||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||xi(C,"https"),vs(C),Z?Pn(C.toString(),I):zs(C.toString(),I)}else Ve(2);m.I=0,m.l&&m.l.pa(v),ba(m),sn(m)}n.bb=function(m){m?(this.j.info("Successfully pinged google.com"),Ve(2)):(this.j.info("Failed to ping google.com"),Ve(1))};function ba(m){if(m.I=0,m.ja=[],m.l){const v=Dr(m.h);(v.length!=0||m.i.length!=0)&&(z(m.ja,v),z(m.ja,m.i),m.h.i.length=0,D(m.i),m.i.length=0),m.l.oa()}}function lo(m,v,I){var C=I instanceof Xr?Zr(I):new Xr(I);if(C.g!="")v&&(C.g=v+"."+C.g),br(C,C.u);else{var Z=c.location;C=Z.protocol,v=v?v+"."+Z.hostname:Z.hostname,Z=+Z.port;const de=new Xr(null);C&&xi(de,C),v&&(de.g=v),Z&&br(de,Z),I&&(de.h=I),C=de}return I=m.G,v=m.wa,I&&v&&Bt(C,I,v),Bt(C,"VER",m.ka),_s(m,C),C}function Dt(m,v,I){if(v&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return v=m.Aa&&!m.ma?new He(new Mr({ab:I})):new He(m.ma),v.Fa(m.L),v}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _i(){}n=_i.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function co(){}co.prototype.g=function(m,v){return new Ln(m,v)};function Ln(m,v){_t.call(this),this.g=new dl(v),this.l=m,this.h=v&&v.messageUrlParams||null,m=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(m?m["X-WebChannel-Content-Type"]=v.messageContentType:m={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.sa&&(m?m["X-WebChannel-Client-Profile"]=v.sa:m={"X-WebChannel-Client-Profile":v.sa}),this.g.U=m,(m=v&&v.Qb)&&!V(m)&&(this.g.u=m),this.A=v&&v.supportsCrossDomainXhr||!1,this.v=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!V(v)&&(this.g.G=v,m=this.h,m!==null&&v in m&&(m=this.h,v in m&&delete m[v])),this.j=new Ni(this)}w(Ln,_t),Ln.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ln.prototype.close=function(){ul(this.g)},Ln.prototype.o=function(m){var v=this.g;if(typeof m=="string"){var I={};I.__data__=m,m=I}else this.v&&(I={},I.__data__=Jr(m),m=I);v.i.push(new Nc(v.Ya++,m)),v.I==3&&wi(v)},Ln.prototype.N=function(){this.g.l=null,delete this.j,ul(this.g),delete this.g,Ln.Z.N.call(this)};function ml(m){_e.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var v=m.__sm__;if(v){e:{for(const I in v){m=I;break e}m=void 0}(this.i=m)&&(m=this.i,v=v!==null&&m in v?v[m]:void 0),this.data=v}else this.data=m}w(ml,_e);function Ac(){ze.call(this),this.status=1}w(Ac,ze);function Ni(m){this.g=m}w(Ni,_i),Ni.prototype.ra=function(){Tt(this.g,"a")},Ni.prototype.qa=function(m){Tt(this.g,new ml(m))},Ni.prototype.pa=function(m){Tt(this.g,new Ac)},Ni.prototype.oa=function(){Tt(this.g,"b")},co.prototype.createWebChannel=co.prototype.g,Ln.prototype.send=Ln.prototype.o,Ln.prototype.open=Ln.prototype.m,Ln.prototype.close=Ln.prototype.close,z1=function(){return new co},U1=function(){return Ye()},B1=Qe,ty={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Qt.NO_ERROR=0,Qt.TIMEOUT=8,Qt.HTTP_ERROR=6,Np=Qt,$i.COMPLETE="complete",F1=$i,mi.EventType=se,se.OPEN="a",se.CLOSE="b",se.ERROR="c",se.MESSAGE="d",_t.prototype.listen=_t.prototype.J,Hu=mi,He.prototype.listenOnce=He.prototype.K,He.prototype.getLastError=He.prototype.Ha,He.prototype.getLastErrorCode=He.prototype.ya,He.prototype.getStatus=He.prototype.ca,He.prototype.getResponseJson=He.prototype.La,He.prototype.getResponseText=He.prototype.la,He.prototype.send=He.prototype.ea,He.prototype.setWithCredentials=He.prototype.Fa,$1=He}).apply(typeof ip<"u"?ip:typeof self<"u"?self:typeof window<"u"?window:{});const Iw="@firebase/firestore",Ew="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gr.UNAUTHENTICATED=new gr(null),gr.GOOGLE_CREDENTIALS=new gr("google-credentials-uid"),gr.FIRST_PARTY=new gr("first-party-uid"),gr.MOCK_USER=new gr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $d="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=new bf("@firebase/firestore");function ld(){return nc.logLevel}function Ae(n,...e){if(nc.logLevel<=Ot.DEBUG){const t=e.map(Jy);nc.debug(`Firestore (${$d}): ${n}`,...t)}}function Wr(n,...e){if(nc.logLevel<=Ot.ERROR){const t=e.map(Jy);nc.error(`Firestore (${$d}): ${n}`,...t)}}function rc(n,...e){if(nc.logLevel<=Ot.WARN){const t=e.map(Jy);nc.warn(`Firestore (${$d}): ${n}`,...t)}}function Jy(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xe(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,q1(n,r,t)}function q1(n,e,t){let r=`FIRESTORE (${$d}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Wr(r),new Error(r)}function rt(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||q1(e,i,r)}function vt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ye={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pe extends oi{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class JR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(gr.UNAUTHENTICATED)))}shutdown(){}}class XR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ZR{constructor(e){this.t=e,this.currentUser=gr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){rt(this.o===void 0,42304);let r=this.i;const i=p=>this.i!==r?(r=this.i,t(p)):Promise.resolve();let l=new ia;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new ia,e.enqueueRetryable((()=>i(this.currentUser)))};const c=()=>{const p=l;e.enqueueRetryable((async()=>{await p.promise,await i(this.currentUser)}))},u=p=>{Ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((p=>u(p))),setTimeout((()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?u(p):(Ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new ia)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(Ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(rt(typeof r.accessToken=="string",31837,{l:r}),new W1(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return rt(e===null||typeof e=="string",2055,{h:e}),new gr(e)}}class eD{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=gr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class tD{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new eD(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(gr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Tw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nD{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,cs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){rt(this.o===void 0,3512);const r=l=>{l.error!=null&&Ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const c=l.token!==this.m;return this.m=l.token,Ae("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>r(l)))};const i=l=>{Ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>i(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?i(l):Ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Tw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(rt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Tw(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rD(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=rD(40);for(let l=0;l<i.length;++l)r.length<20&&i[l]<t&&(r+=e.charAt(i[l]%62))}return r}}function yt(n,e){return n<e?-1:n>e?1:0}function ny(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),l=e.charAt(r);if(i!==l)return yx(i)===yx(l)?yt(i,l):yx(i)?1:-1}return yt(n.length,e.length)}const sD=55296,iD=57343;function yx(n){const e=n.charCodeAt(0);return e>=sD&&e<=iD}function Nd(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}function H1(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aw="__name__";class Zi{constructor(e,t,r){t===void 0?t=0:t>e.length&&Xe(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&Xe(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Zi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Zi?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const l=Zi.compareSegments(e.get(i),t.get(i));if(l!==0)return l}return yt(e.length,t.length)}static compareSegments(e,t){const r=Zi.isNumericId(e),i=Zi.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Zi.extractNumericId(e).compare(Zi.extractNumericId(t)):ny(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Go.fromString(e.substring(4,e.length-2))}}class Gt extends Zi{construct(e,t,r){return new Gt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Pe(ye.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new Gt(t)}static emptyPath(){return new Gt([])}}const aD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Nn extends Zi{construct(e,t,r){return new Nn(e,t,r)}static isValidIdentifier(e){return aD.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Nn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Aw}static keyField(){return new Nn([Aw])}static fromServerFormat(e){const t=[];let r="",i=0;const l=()=>{if(r.length===0)throw new Pe(ye.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let c=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Pe(ye.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const p=e[i+1];if(p!=="\\"&&p!=="."&&p!=="`")throw new Pe(ye.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=p,i+=2}else u==="`"?(c=!c,i++):u!=="."||c?(r+=u,i++):(l(),i++)}if(l(),c)throw new Pe(ye.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Nn(t)}static emptyPath(){return new Nn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e){this.path=e}static fromPath(e){return new Me(Gt.fromString(e))}static fromName(e){return new Me(Gt.fromString(e).popFirst(5))}static empty(){return new Me(Gt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Gt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Gt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Me(new Gt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G1(n,e,t){if(!t)throw new Pe(ye.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function oD(n,e,t,r){if(e===!0&&r===!0)throw new Pe(ye.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Sw(n){if(!Me.isDocumentKey(n))throw new Pe(ye.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function jw(n){if(Me.isDocumentKey(n))throw new Pe(ye.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function K1(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ef(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Xe(12329,{type:typeof n})}function Hr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Pe(ye.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ef(n);throw new Pe(ye.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Bh(n,e){if(!K1(n))throw new Pe(ye.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,l="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const c=n[r];if(i&&typeof c!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(l!==void 0&&c!==l.value){t=`Expected '${r}' field to equal '${l.value}'`;break}}if(t)throw new Pe(ye.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kw=-62135596800,Cw=1e6;class Jt{static now(){return Jt.fromMillis(Date.now())}static fromDate(e){return Jt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Cw);return new Jt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<kw)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Cw}_compareTo(e){return this.seconds===e.seconds?yt(this.nanoseconds,e.nanoseconds):yt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Jt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Bh(e,Jt._jsonSchema))return new Jt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-kw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Jt._jsonSchemaVersion="firestore/timestamp/1.0",Jt._jsonSchema={type:zn("string",Jt._jsonSchemaVersion),seconds:zn("number"),nanoseconds:zn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{static fromTimestamp(e){return new ot(e)}static min(){return new ot(new Jt(0,0))}static max(){return new ot(new Jt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wh=-1;class Kp{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function ry(n){return n.fields.find((e=>e.kind===2))}function Vl(n){return n.fields.filter((e=>e.kind!==2))}Kp.UNKNOWN_ID=-1;class Ip{constructor(e,t){this.fieldPath=e,this.kind=t}}class _h{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new _h(0,Ds.min())}}function lD(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ot.fromTimestamp(r===1e9?new Jt(t+1,0):new Jt(t,r));return new Ds(i,Me.empty(),e)}function Q1(n){return new Ds(n.readTime,n.key,wh)}class Ds{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ds(ot.min(),Me.empty(),wh)}static max(){return new Ds(ot.max(),Me.empty(),wh)}}function Zy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Me.comparator(n.documentKey,e.documentKey),t!==0?t:yt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class J1{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xc(n){if(n.code!==ye.FAILED_PRECONDITION||n.message!==Y1)throw n;Ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Xe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ee(((r,i)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(r,i)},this.catchCallback=l=>{this.wrapFailure(t,l).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ee?t:ee.resolve(t)}catch(t){return ee.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ee.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ee.reject(t)}static resolve(e){return new ee(((t,r)=>{t(e)}))}static reject(e){return new ee(((t,r)=>{r(e)}))}static waitFor(e){return new ee(((t,r)=>{let i=0,l=0,c=!1;e.forEach((u=>{++i,u.next((()=>{++l,c&&l===i&&t()}),(p=>r(p)))})),c=!0,l===i&&t()}))}static or(e){let t=ee.resolve(!1);for(const r of e)t=t.next((i=>i?ee.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,l)=>{r.push(t.call(this,i,l))})),this.waitFor(r)}static mapArray(e,t){return new ee(((r,i)=>{const l=e.length,c=new Array(l);let u=0;for(let p=0;p<l;p++){const g=p;t(e[g]).next((b=>{c[g]=b,++u,u===l&&r(c)}),(b=>i(b)))}}))}static doWhile(e,t){return new ee(((r,i)=>{const l=()=>{e()===!0?t().next((()=>{l()}),i):r()};l()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const As="SimpleDb";class Tf{static open(e,t,r,i){try{return new Tf(t,e.transaction(i,r))}catch(l){throw new oh(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ia,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new oh(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const i=e0(r.target.error);this.S.reject(new oh(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Ae(As,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new dD(t)}}class Ko{static delete(e){return Ae(As,"Removing database:",e),Fl(VN().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!vf())return!1;if(Ko.F())return!0;const e=Zn(),t=Ko.M(e),r=0<t&&t<10,i=X1(e),l=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||l)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Ko.M(Zn())===12.2&&Wr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Ae(As,"Opening database:",this.name),this.db=await new Promise(((t,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=l=>{const c=l.target.result;t(c)},i.onblocked=()=>{r(new oh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=l=>{const c=l.target.error;c.name==="VersionError"?r(new Pe(ye.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):c.name==="InvalidStateError"?r(new Pe(ye.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c)):r(new oh(e,c))},i.onupgradeneeded=l=>{Ae(As,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const c=l.target.result;this.N.k(c,i.transaction,l.oldVersion,this.version).next((()=>{Ae(As,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){const l=t==="readonly";let c=0;for(;;){++c;try{this.db=await this.L(e);const u=Tf.open(this.db,e,l?"readonly":"readwrite",r),p=i(u).next((g=>(u.C(),g))).catch((g=>(u.abort(g),ee.reject(g)))).toPromise();return p.catch((()=>{})),await u.D,p}catch(u){const p=u,g=p.name!=="FirebaseError"&&c<3;if(Ae(As,"Transaction failed with error:",p.message,"Retrying:",g),this.close(),!g)return Promise.reject(p)}}}close(){this.db&&this.db.close(),this.db=void 0}}function X1(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class cD{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Fl(this.U.delete())}}class oh extends Pe{constructor(e,t){super(ye.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function sl(n){return n.name==="IndexedDbTransactionError"}class dD{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(Ae(As,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(Ae(As,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Fl(r)}add(e){return Ae(As,"ADD",this.store.name,e,e),Fl(this.store.add(e))}get(e){return Fl(this.store.get(e)).next((t=>(t===void 0&&(t=null),Ae(As,"GET",this.store.name,e,t),t)))}delete(e){return Ae(As,"DELETE",this.store.name,e),Fl(this.store.delete(e))}count(){return Ae(As,"COUNT",this.store.name),Fl(this.store.count())}J(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){const l=i.getAll(r.range);return new ee(((c,u)=>{l.onerror=p=>{u(p.target.error)},l.onsuccess=p=>{c(p.target.result)}}))}{const l=this.cursor(r),c=[];return this.H(l,((u,p)=>{c.push(p)})).next((()=>c))}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new ee(((i,l)=>{r.onerror=c=>{l(c.target.error)},r.onsuccess=c=>{i(c.target.result)}}))}Z(e,t){Ae(As,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const i=this.cursor(r);return this.H(i,((l,c,u)=>u.delete()))}ee(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.H(i,t)}te(e){const t=this.cursor({});return new ee(((r,i)=>{t.onerror=l=>{const c=e0(l.target.error);i(c)},t.onsuccess=l=>{const c=l.target.result;c?e(c.primaryKey,c.value).next((u=>{u?c.continue():r()})):r()}}))}H(e,t){const r=[];return new ee(((i,l)=>{e.onerror=c=>{l(c.target.error)},e.onsuccess=c=>{const u=c.target.result;if(!u)return void i();const p=new cD(u),g=t(u.primaryKey,u.value,p);if(g instanceof ee){const b=g.catch((w=>(p.done(),ee.reject(w))));r.push(b)}p.isDone?i():p.G===null?u.continue():u.continue(p.G)}})).next((()=>ee.waitFor(r)))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Fl(n){return new ee(((e,t)=>{n.onsuccess=r=>{const i=r.target.result;e(i)},n.onerror=r=>{const i=e0(r.target.error);t(i)}}))}let Rw=!1;function e0(n){const e=Ko.M(Zn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Pe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Rw||(Rw=!0,setTimeout((()=>{throw r}),0)),r}}return n}const lh="IndexBackfiller";class uD{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Ae(lh,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();Ae(lh,`Documents written: ${t}`)}catch(t){sl(t)?Ae(lh,"Ignoring IndexedDB error during index backfill: ",t):await xc(t)}await this.re(6e4)}))}}class hD{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const r=new Set;let i=t,l=!0;return ee.doWhile((()=>l===!0&&i>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((c=>{if(c!==null&&!r.has(c))return Ae(lh,`Processing collection: ${c}`),this.oe(e,c,i).next((u=>{i-=u,r.add(c)}));l=!1})))).next((()=>t-i))}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next((l=>{const c=l.changes;return this.localStore.indexManager.updateIndexEntries(e,c).next((()=>this._e(i,l))).next((u=>(Ae(lh,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u)))).next((()=>c.size))}))))}_e(e,t){let r=e;return t.changes.forEach(((i,l)=>{const c=Q1(l);Zy(c,r)>0&&(r=c)})),new Ds(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}si.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gl=-1;function Af(n){return n==null}function Nh(n){return n===0&&1/n==-1/0}function mD(n){return typeof n=="number"&&Number.isInteger(n)&&!Nh(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qp="";function jr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Dw(e)),e=pD(n.get(t),e);return Dw(e)}function pD(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const l=n.charAt(i);switch(l){case"\0":t+="";break;case Qp:t+="";break;default:t+=l}}return t}function Dw(n){return n+Qp+""}function ea(n){const e=n.length;if(rt(e>=2,64408,{path:n}),e===2)return rt(n.charAt(0)===Qp&&n.charAt(1)==="",56145,{path:n}),Gt.emptyPath();const t=e-2,r=[];let i="";for(let l=0;l<e;){const c=n.indexOf(Qp,l);switch((c<0||c>t)&&Xe(50515,{path:n}),n.charAt(c+1)){case"":const u=n.substring(l,c);let p;i.length===0?p=u:(i+=u,p=i,i=""),r.push(p);break;case"":i+=n.substring(l,c),i+="\0";break;case"":i+=n.substring(l,c+1);break;default:Xe(61167,{path:n})}l=c+2}return new Gt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ll="remoteDocuments",Uh="owner",nd="owner",Ih="mutationQueues",fD="userId",Mi="mutations",Pw="batchId",ql="userMutationsIndex",Ow=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ep(n,e){return[n,jr(e)]}function Z1(n,e,t){return[n,jr(e),t]}const gD={},Id="documentMutations",Yp="remoteDocumentsV14",xD=["prefixPath","collectionGroup","readTime","documentId"],Tp="documentKeyIndex",yD=["prefixPath","collectionGroup","documentId"],eI="collectionGroupIndex",vD=["collectionGroup","readTime","prefixPath","documentId"],Eh="remoteDocumentGlobal",sy="remoteDocumentGlobalKey",Ed="targets",tI="queryTargetsIndex",bD=["canonicalId","targetId"],Td="targetDocuments",wD=["targetId","path"],t0="documentTargetsIndex",_D=["path","targetId"],Jp="targetGlobalKey",Kl="targetGlobal",Th="collectionParents",ND=["collectionId","parent"],Ad="clientMetadata",ID="clientId",Sf="bundles",ED="bundleId",jf="namedQueries",TD="name",n0="indexConfiguration",AD="indexId",iy="collectionGroupIndex",SD="collectionGroup",ch="indexState",jD=["indexId","uid"],nI="sequenceNumberIndex",kD=["uid","sequenceNumber"],dh="indexEntries",CD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],rI="documentKeyIndex",RD=["indexId","uid","orderedDocumentKey"],kf="documentOverlays",DD=["userId","collectionPath","documentId"],ay="collectionPathOverlayIndex",PD=["userId","collectionPath","largestBatchId"],sI="collectionGroupOverlayIndex",OD=["userId","collectionGroup","largestBatchId"],r0="globals",MD="name",iI=[Ih,Mi,Id,Ll,Ed,Uh,Kl,Td,Ad,Eh,Th,Sf,jf],VD=[...iI,kf],aI=[Ih,Mi,Id,Yp,Ed,Uh,Kl,Td,Ad,Eh,Th,Sf,jf,kf],oI=aI,s0=[...oI,n0,ch,dh],LD=s0,lI=[...s0,r0],$D=lI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy extends J1{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function er(n,e){const t=vt(n);return Ko.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mw(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function il(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function cI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e,t){this.comparator=e,this.root=t||xr.EMPTY}insert(e,t){return new xn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xr.BLACK,null,null))}remove(e){return new xn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ap(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ap(this.root,e,this.comparator,!1)}getReverseIterator(){return new ap(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ap(this.root,e,this.comparator,!0)}}class ap{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?r(e.key,t):1,t&&i&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xr{constructor(e,t,r,i,l){this.key=e,this.value=t,this.color=r??xr.RED,this.left=i??xr.EMPTY,this.right=l??xr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,l){return new xr(e??this.key,t??this.value,r??this.color,i??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const l=r(e,i.key);return i=l<0?i.copy(null,null,null,i.left.insert(e,t,r),null):l===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return xr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return xr.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Xe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Xe(27949);return e+(this.isRed()?0:1)}}xr.EMPTY=null,xr.RED=!0,xr.BLACK=!1;xr.EMPTY=new class{constructor(){this.size=0}get key(){throw Xe(57766)}get value(){throw Xe(16141)}get color(){throw Xe(16727)}get left(){throw Xe(29726)}get right(){throw Xe(36894)}copy(e,t,r,i,l){return this}insert(e,t,r){return new xr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e){this.comparator=e,this.data=new xn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vw(this.data.getIterator())}getIteratorFrom(e){return new Vw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Zt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,l=r.getNext().key;if(this.comparator(i,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Zt(this.comparator);return t.data=e,t}}class Vw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function rd(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e){this.fields=e,e.sort(Nn.comparator)}static empty(){return new ds([])}unionWith(e){let t=new Zt(Nn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ds(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Nd(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new dI("Invalid base64 string: "+l):l}})(e);return new qn(t)}static fromUint8Array(e){const t=(function(i){let l="";for(let c=0;c<i.length;++c)l+=String.fromCharCode(i[c]);return l})(e);return new qn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return yt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qn.EMPTY_BYTE_STRING=new qn("");const FD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ha(n){if(rt(!!n,39018),typeof n=="string"){let e=0;const t=FD.exec(n);if(rt(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:gn(n.seconds),nanos:gn(n.nanos)}}function gn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ga(n){return typeof n=="string"?qn.fromBase64String(n):qn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uI="server_timestamp",hI="__type__",mI="__previous_value__",pI="__local_write_time__";function i0(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[hI])==null?void 0:r.stringValue)===uI}function Cf(n){const e=n.mapValue.fields[mI];return i0(e)?Cf(e):e}function Ah(n){const e=Ha(n.mapValue.fields[pI].timestampValue);return new Jt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e,t,r,i,l,c,u,p,g,b){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=l,this.forceLongPolling=c,this.autoDetectLongPolling=u,this.longPollingOptions=p,this.useFetchStreams=g,this.isUsingEmulator=b}}const Xp="(default)";class sc{constructor(e,t){this.projectId=e,this.database=t||Xp}static empty(){return new sc("","")}get isDefaultDatabase(){return this.database===Xp}isEqual(e){return e instanceof sc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0="__type__",fI="__max__",qo={mapValue:{fields:{__type__:{stringValue:fI}}}},o0="__vector__",Sd="value",Ap={nullValue:"NULL_VALUE"};function Jo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?i0(n)?4:gI(n)?9007199254740991:Rf(n)?10:11:Xe(28295,{value:n})}function la(n,e){if(n===e)return!0;const t=Jo(n);if(t!==Jo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ah(n).isEqual(Ah(e));case 3:return(function(i,l){if(typeof i.timestampValue=="string"&&typeof l.timestampValue=="string"&&i.timestampValue.length===l.timestampValue.length)return i.timestampValue===l.timestampValue;const c=Ha(i.timestampValue),u=Ha(l.timestampValue);return c.seconds===u.seconds&&c.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,l){return Ga(i.bytesValue).isEqual(Ga(l.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,l){return gn(i.geoPointValue.latitude)===gn(l.geoPointValue.latitude)&&gn(i.geoPointValue.longitude)===gn(l.geoPointValue.longitude)})(n,e);case 2:return(function(i,l){if("integerValue"in i&&"integerValue"in l)return gn(i.integerValue)===gn(l.integerValue);if("doubleValue"in i&&"doubleValue"in l){const c=gn(i.doubleValue),u=gn(l.doubleValue);return c===u?Nh(c)===Nh(u):isNaN(c)&&isNaN(u)}return!1})(n,e);case 9:return Nd(n.arrayValue.values||[],e.arrayValue.values||[],la);case 10:case 11:return(function(i,l){const c=i.mapValue.fields||{},u=l.mapValue.fields||{};if(Mw(c)!==Mw(u))return!1;for(const p in c)if(c.hasOwnProperty(p)&&(u[p]===void 0||!la(c[p],u[p])))return!1;return!0})(n,e);default:return Xe(52216,{left:n})}}function Sh(n,e){return(n.values||[]).find((t=>la(t,e)))!==void 0}function Xo(n,e){if(n===e)return 0;const t=Jo(n),r=Jo(e);if(t!==r)return yt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return yt(n.booleanValue,e.booleanValue);case 2:return(function(l,c){const u=gn(l.integerValue||l.doubleValue),p=gn(c.integerValue||c.doubleValue);return u<p?-1:u>p?1:u===p?0:isNaN(u)?isNaN(p)?0:-1:1})(n,e);case 3:return Lw(n.timestampValue,e.timestampValue);case 4:return Lw(Ah(n),Ah(e));case 5:return ny(n.stringValue,e.stringValue);case 6:return(function(l,c){const u=Ga(l),p=Ga(c);return u.compareTo(p)})(n.bytesValue,e.bytesValue);case 7:return(function(l,c){const u=l.split("/"),p=c.split("/");for(let g=0;g<u.length&&g<p.length;g++){const b=yt(u[g],p[g]);if(b!==0)return b}return yt(u.length,p.length)})(n.referenceValue,e.referenceValue);case 8:return(function(l,c){const u=yt(gn(l.latitude),gn(c.latitude));return u!==0?u:yt(gn(l.longitude),gn(c.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return $w(n.arrayValue,e.arrayValue);case 10:return(function(l,c){var N,D,z,L;const u=l.fields||{},p=c.fields||{},g=(N=u[Sd])==null?void 0:N.arrayValue,b=(D=p[Sd])==null?void 0:D.arrayValue,w=yt(((z=g==null?void 0:g.values)==null?void 0:z.length)||0,((L=b==null?void 0:b.values)==null?void 0:L.length)||0);return w!==0?w:$w(g,b)})(n.mapValue,e.mapValue);case 11:return(function(l,c){if(l===qo.mapValue&&c===qo.mapValue)return 0;if(l===qo.mapValue)return 1;if(c===qo.mapValue)return-1;const u=l.fields||{},p=Object.keys(u),g=c.fields||{},b=Object.keys(g);p.sort(),b.sort();for(let w=0;w<p.length&&w<b.length;++w){const N=ny(p[w],b[w]);if(N!==0)return N;const D=Xo(u[p[w]],g[b[w]]);if(D!==0)return D}return yt(p.length,b.length)})(n.mapValue,e.mapValue);default:throw Xe(23264,{he:t})}}function Lw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return yt(n,e);const t=Ha(n),r=Ha(e),i=yt(t.seconds,r.seconds);return i!==0?i:yt(t.nanos,r.nanos)}function $w(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const l=Xo(t[i],r[i]);if(l)return l}return yt(t.length,r.length)}function jd(n){return ly(n)}function ly(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Ha(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Ga(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Me.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const l of t.values||[])i?i=!1:r+=",",r+=ly(l);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",l=!0;for(const c of r)l?l=!1:i+=",",i+=`${c}:${ly(t.fields[c])}`;return i+"}"})(n.mapValue):Xe(61005,{value:n})}function Sp(n){switch(Jo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Cf(n);return e?16+Sp(e):16;case 5:return 2*n.stringValue.length;case 6:return Ga(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,l)=>i+Sp(l)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return il(r.fields,((l,c)=>{i+=l.length+Sp(c)})),i})(n.mapValue);default:throw Xe(13486,{value:n})}}function jh(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function cy(n){return!!n&&"integerValue"in n}function kh(n){return!!n&&"arrayValue"in n}function Fw(n){return!!n&&"nullValue"in n}function Bw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function jp(n){return!!n&&"mapValue"in n}function Rf(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[a0])==null?void 0:r.stringValue)===o0}function uh(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return il(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=uh(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=uh(n.arrayValue.values[t]);return e}return{...n}}function gI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===fI}const xI={mapValue:{fields:{[a0]:{stringValue:o0},[Sd]:{arrayValue:{}}}}};function UD(n){return"nullValue"in n?Ap:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?jh(sc.empty(),Me.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Rf(n)?xI:{mapValue:{}}:Xe(35942,{value:n})}function zD(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?jh(sc.empty(),Me.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?xI:"mapValue"in n?Rf(n)?{mapValue:{}}:qo:Xe(61959,{value:n})}function Uw(n,e){const t=Xo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function zw(n,e){const t=Xo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e){this.value=e}static empty(){return new Tr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!jp(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=uh(t)}setAll(e){let t=Nn.emptyPath(),r={},i=[];e.forEach(((c,u)=>{if(!t.isImmediateParentOf(u)){const p=this.getFieldsMap(t);this.applyChanges(p,r,i),r={},i=[],t=u.popLast()}c?r[u.lastSegment()]=uh(c):i.push(u.lastSegment())}));const l=this.getFieldsMap(t);this.applyChanges(l,r,i)}delete(e){const t=this.field(e.popLast());jp(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return la(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];jp(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){il(t,((i,l)=>e[i]=l));for(const i of r)delete e[i]}clone(){return new Tr(uh(this.value))}}function yI(n){const e=[];return il(n.fields,((t,r)=>{const i=new Nn([t]);if(jp(r)){const l=yI(r.mapValue).fields;if(l.length===0)e.push(i);else for(const c of l)e.push(i.child(c))}else e.push(i)})),new ds(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e,t,r,i,l,c,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=l,this.data=c,this.documentState=u}static newInvalidDocument(e){return new kn(e,0,ot.min(),ot.min(),ot.min(),Tr.empty(),0)}static newFoundDocument(e,t,r,i){return new kn(e,1,t,ot.min(),r,i,0)}static newNoDocument(e,t){return new kn(e,2,t,ot.min(),ot.min(),Tr.empty(),0)}static newUnknownDocument(e,t){return new kn(e,3,t,ot.min(),ot.min(),Tr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ot.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Tr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Tr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ot.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof kn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new kn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd{constructor(e,t){this.position=e,this.inclusive=t}}function qw(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const l=e[i],c=n.position[i];if(l.field.isKeyField()?r=Me.comparator(Me.fromName(c.referenceValue),t.key):r=Xo(c,t.data.field(l.field)),l.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ww(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!la(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e,t="asc"){this.field=e,this.dir=t}}function qD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{}class Mt extends vI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new WD(e,t,r):t==="array-contains"?new KD(e,r):t==="in"?new EI(e,r):t==="not-in"?new QD(e,r):t==="array-contains-any"?new YD(e,r):new Mt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new HD(e,r):new GD(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Xo(t,this.value)):t!==null&&Jo(this.value)===Jo(t)&&this.matchesComparison(Xo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Xt extends vI{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Xt(e,t)}matches(e){return Cd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Cd(n){return n.op==="and"}function dy(n){return n.op==="or"}function l0(n){return bI(n)&&Cd(n)}function bI(n){for(const e of n.filters)if(e instanceof Xt)return!1;return!0}function uy(n){if(n instanceof Mt)return n.field.canonicalString()+n.op.toString()+jd(n.value);if(l0(n))return n.filters.map((e=>uy(e))).join(",");{const e=n.filters.map((t=>uy(t))).join(",");return`${n.op}(${e})`}}function wI(n,e){return n instanceof Mt?(function(r,i){return i instanceof Mt&&r.op===i.op&&r.field.isEqual(i.field)&&la(r.value,i.value)})(n,e):n instanceof Xt?(function(r,i){return i instanceof Xt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((l,c,u)=>l&&wI(c,i.filters[u])),!0):!1})(n,e):void Xe(19439)}function _I(n,e){const t=n.filters.concat(e);return Xt.create(t,n.op)}function NI(n){return n instanceof Mt?(function(t){return`${t.field.canonicalString()} ${t.op} ${jd(t.value)}`})(n):n instanceof Xt?(function(t){return t.op.toString()+" {"+t.getFilters().map(NI).join(" ,")+"}"})(n):"Filter"}class WD extends Mt{constructor(e,t,r){super(e,t,r),this.key=Me.fromName(r.referenceValue)}matches(e){const t=Me.comparator(e.key,this.key);return this.matchesComparison(t)}}class HD extends Mt{constructor(e,t){super(e,"in",t),this.keys=II("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class GD extends Mt{constructor(e,t){super(e,"not-in",t),this.keys=II("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function II(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((r=>Me.fromName(r.referenceValue)))}class KD extends Mt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return kh(t)&&Sh(t.arrayValue,this.value)}}class EI extends Mt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Sh(this.value.arrayValue,t)}}class QD extends Mt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Sh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Sh(this.value.arrayValue,t)}}class YD extends Mt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!kh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Sh(this.value.arrayValue,r)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(e,t=null,r=[],i=[],l=null,c=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=l,this.startAt=c,this.endAt=u,this.Te=null}}function hy(n,e=null,t=[],r=[],i=null,l=null,c=null){return new JD(n,e,t,r,i,l,c)}function ic(n){const e=vt(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>uy(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(l){return l.field.canonicalString()+l.dir})(r))).join(","),Af(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>jd(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>jd(r))).join(",")),e.Te=t}return e.Te}function zh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!qD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ww(n.startAt,e.startAt)&&Ww(n.endAt,e.endAt)}function ef(n){return Me.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function tf(n,e){return n.filters.filter((t=>t instanceof Mt&&t.field.isEqual(e)))}function Hw(n,e,t){let r=Ap,i=!0;for(const l of tf(n,e)){let c=Ap,u=!0;switch(l.op){case"<":case"<=":c=UD(l.value);break;case"==":case"in":case">=":c=l.value;break;case">":c=l.value,u=!1;break;case"!=":case"not-in":c=Ap}Uw({value:r,inclusive:i},{value:c,inclusive:u})<0&&(r=c,i=u)}if(t!==null){for(let l=0;l<n.orderBy.length;++l)if(n.orderBy[l].field.isEqual(e)){const c=t.position[l];Uw({value:r,inclusive:i},{value:c,inclusive:t.inclusive})<0&&(r=c,i=t.inclusive);break}}return{value:r,inclusive:i}}function Gw(n,e,t){let r=qo,i=!0;for(const l of tf(n,e)){let c=qo,u=!0;switch(l.op){case">=":case">":c=zD(l.value),u=!1;break;case"==":case"in":case"<=":c=l.value;break;case"<":c=l.value,u=!1;break;case"!=":case"not-in":c=qo}zw({value:r,inclusive:i},{value:c,inclusive:u})>0&&(r=c,i=u)}if(t!==null){for(let l=0;l<n.orderBy.length;++l)if(n.orderBy[l].field.isEqual(e)){const c=t.position[l];zw({value:r,inclusive:i},{value:c,inclusive:t.inclusive})>0&&(r=c,i=t.inclusive);break}}return{value:r,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(e,t=null,r=[],i=[],l=null,c="F",u=null,p=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=l,this.limitType=c,this.startAt=u,this.endAt=p,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function XD(n,e,t,r,i,l,c,u){return new qh(n,e,t,r,i,l,c,u)}function Wh(n){return new qh(n)}function Kw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function TI(n){return n.collectionGroup!==null}function hh(n){const e=vt(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let u=new Zt(Nn.comparator);return c.filters.forEach((p=>{p.getFlattenedFilters().forEach((g=>{g.isInequality()&&(u=u.add(g.field))}))})),u})(e).forEach((l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new Zp(l,r))})),t.has(Nn.keyField().canonicalString())||e.Ie.push(new Zp(Nn.keyField(),r))}return e.Ie}function ai(n){const e=vt(n);return e.Ee||(e.Ee=ZD(e,hh(n))),e.Ee}function ZD(n,e){if(n.limitType==="F")return hy(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const l=i.dir==="desc"?"asc":"desc";return new Zp(i.field,l)}));const t=n.endAt?new kd(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new kd(n.startAt.position,n.startAt.inclusive):null;return hy(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function my(n,e){const t=n.filters.concat([e]);return new qh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function py(n,e,t){return new qh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Df(n,e){return zh(ai(n),ai(e))&&n.limitType===e.limitType}function AI(n){return`${ic(ai(n))}|lt:${n.limitType}`}function cd(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>NI(i))).join(", ")}]`),Af(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>jd(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>jd(i))).join(",")),`Target(${r})`})(ai(n))}; limitType=${n.limitType})`}function Hh(n,e){return e.isFoundDocument()&&(function(r,i){const l=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(l):Me.isDocumentKey(r.path)?r.path.isEqual(l):r.path.isImmediateParentOf(l)})(n,e)&&(function(r,i){for(const l of hh(r))if(!l.field.isKeyField()&&i.data.field(l.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const l of r.filters)if(!l.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(c,u,p){const g=qw(c,u,p);return c.inclusive?g<=0:g<0})(r.startAt,hh(r),i)||r.endAt&&!(function(c,u,p){const g=qw(c,u,p);return c.inclusive?g>=0:g>0})(r.endAt,hh(r),i))})(n,e)}function eP(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function SI(n){return(e,t)=>{let r=!1;for(const i of hh(n)){const l=tP(i,e,t);if(l!==0)return l;r=r||i.field.isKeyField()}return 0}}function tP(n,e,t){const r=n.field.isKeyField()?Me.comparator(e.key,t.key):(function(l,c,u){const p=c.data.field(l),g=u.data.field(l);return p!==null&&g!==null?Xo(p,g):Xe(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Xe(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,l]of r)if(this.equalsFn(i,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let l=0;l<i.length;l++)if(this.equalsFn(i[l][0],e))return void(i[l]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){il(this.inner,((t,r)=>{for(const[i,l]of r)e(i,l)}))}isEmpty(){return cI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP=new xn(Me.comparator);function Ss(){return nP}const jI=new xn(Me.comparator);function Gu(...n){let e=jI;for(const t of n)e=e.insert(t.key,t);return e}function kI(n){let e=jI;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function ta(){return mh()}function CI(){return mh()}function mh(){return new Qa((n=>n.toString()),((n,e)=>n.isEqual(e)))}const rP=new xn(Me.comparator),sP=new Zt(Me.comparator);function St(...n){let e=sP;for(const t of n)e=e.add(t);return e}const iP=new Zt(yt);function aP(){return iP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c0(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nh(e)?"-0":e}}function RI(n){return{integerValue:""+n}}function oP(n,e){return mD(e)?RI(e):c0(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(){this._=void 0}}function lP(n,e,t){return n instanceof Ch?(function(i,l){const c={fields:{[hI]:{stringValue:uI},[pI]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return l&&i0(l)&&(l=Cf(l)),l&&(c.fields[mI]=l),{mapValue:c}})(t,e):n instanceof ac?PI(n,e):n instanceof Rd?OI(n,e):(function(i,l){const c=DI(i,l),u=Qw(c)+Qw(i.Ae);return cy(c)&&cy(i.Ae)?RI(u):c0(i.serializer,u)})(n,e)}function cP(n,e,t){return n instanceof ac?PI(n,e):n instanceof Rd?OI(n,e):t}function DI(n,e){return n instanceof Rh?(function(r){return cy(r)||(function(l){return!!l&&"doubleValue"in l})(r)})(e)?e:{integerValue:0}:null}class Ch extends Pf{}class ac extends Pf{constructor(e){super(),this.elements=e}}function PI(n,e){const t=MI(e);for(const r of n.elements)t.some((i=>la(i,r)))||t.push(r);return{arrayValue:{values:t}}}class Rd extends Pf{constructor(e){super(),this.elements=e}}function OI(n,e){let t=MI(e);for(const r of n.elements)t=t.filter((i=>!la(i,r)));return{arrayValue:{values:t}}}class Rh extends Pf{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Qw(n){return gn(n.integerValue||n.doubleValue)}function MI(n){return kh(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VI{constructor(e,t){this.field=e,this.transform=t}}function dP(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof ac&&i instanceof ac||r instanceof Rd&&i instanceof Rd?Nd(r.elements,i.elements,la):r instanceof Rh&&i instanceof Rh?la(r.Ae,i.Ae):r instanceof Ch&&i instanceof Ch})(n.transform,e.transform)}class uP{constructor(e,t){this.version=e,this.transformResults=t}}class Ar{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ar}static exists(e){return new Ar(void 0,e)}static updateTime(e){return new Ar(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function kp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Of{}function LI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Mf(n.key,Ar.none()):new Fd(n.key,n.data,Ar.none());{const t=n.data,r=Tr.empty();let i=new Zt(Nn.comparator);for(let l of e.fields)if(!i.has(l)){let c=t.field(l);c===null&&l.length>1&&(l=l.popLast(),c=t.field(l)),c===null?r.delete(l):r.set(l,c),i=i.add(l)}return new Ya(n.key,r,new ds(i.toArray()),Ar.none())}}function hP(n,e,t){n instanceof Fd?(function(i,l,c){const u=i.value.clone(),p=Jw(i.fieldTransforms,l,c.transformResults);u.setAll(p),l.convertToFoundDocument(c.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Ya?(function(i,l,c){if(!kp(i.precondition,l))return void l.convertToUnknownDocument(c.version);const u=Jw(i.fieldTransforms,l,c.transformResults),p=l.data;p.setAll($I(i)),p.setAll(u),l.convertToFoundDocument(c.version,p).setHasCommittedMutations()})(n,e,t):(function(i,l,c){l.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,t)}function ph(n,e,t,r){return n instanceof Fd?(function(l,c,u,p){if(!kp(l.precondition,c))return u;const g=l.value.clone(),b=Xw(l.fieldTransforms,p,c);return g.setAll(b),c.convertToFoundDocument(c.version,g).setHasLocalMutations(),null})(n,e,t,r):n instanceof Ya?(function(l,c,u,p){if(!kp(l.precondition,c))return u;const g=Xw(l.fieldTransforms,p,c),b=c.data;return b.setAll($I(l)),b.setAll(g),c.convertToFoundDocument(c.version,b).setHasLocalMutations(),u===null?null:u.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((w=>w.field)))})(n,e,t,r):(function(l,c,u){return kp(l.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):u})(n,e,t)}function mP(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),l=DI(r.transform,i||null);l!=null&&(t===null&&(t=Tr.empty()),t.set(r.field,l))}return t||null}function Yw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Nd(r,i,((l,c)=>dP(l,c)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fd extends Of{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ya extends Of{constructor(e,t,r,i,l=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function $I(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Jw(n,e,t){const r=new Map;rt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const l=n[i],c=l.transform,u=e.data.field(l.field);r.set(l.field,cP(c,u,t[i]))}return r}function Xw(n,e,t){const r=new Map;for(const i of n){const l=i.transform,c=t.data.field(i.field);r.set(i.field,lP(l,c,e))}return r}class Mf extends Of{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class FI extends Of{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const l=this.mutations[i];l.key.isEqual(e.key)&&hP(l,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ph(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ph(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=CI();return this.mutations.forEach((i=>{const l=e.get(i.key),c=l.overlayedDocument;let u=this.applyToLocalView(c,l.mutatedFields);u=t.has(i.key)?null:u;const p=LI(c,u);p!==null&&r.set(i.key,p),c.isValidDocument()||c.convertToNoDocument(ot.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),St())}isEqual(e){return this.batchId===e.batchId&&Nd(this.mutations,e.mutations,((t,r)=>Yw(t,r)))&&Nd(this.baseMutations,e.baseMutations,((t,r)=>Yw(t,r)))}}class u0{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){rt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return rP})();const l=e.mutations;for(let c=0;c<l.length;c++)i=i.insert(l[c].key,r[c].version);return new u0(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bn,Ft;function fP(n){switch(n){case ye.OK:return Xe(64938);case ye.CANCELLED:case ye.UNKNOWN:case ye.DEADLINE_EXCEEDED:case ye.RESOURCE_EXHAUSTED:case ye.INTERNAL:case ye.UNAVAILABLE:case ye.UNAUTHENTICATED:return!1;case ye.INVALID_ARGUMENT:case ye.NOT_FOUND:case ye.ALREADY_EXISTS:case ye.PERMISSION_DENIED:case ye.FAILED_PRECONDITION:case ye.ABORTED:case ye.OUT_OF_RANGE:case ye.UNIMPLEMENTED:case ye.DATA_LOSS:return!0;default:return Xe(15467,{code:n})}}function BI(n){if(n===void 0)return Wr("GRPC error has no .code"),ye.UNKNOWN;switch(n){case Bn.OK:return ye.OK;case Bn.CANCELLED:return ye.CANCELLED;case Bn.UNKNOWN:return ye.UNKNOWN;case Bn.DEADLINE_EXCEEDED:return ye.DEADLINE_EXCEEDED;case Bn.RESOURCE_EXHAUSTED:return ye.RESOURCE_EXHAUSTED;case Bn.INTERNAL:return ye.INTERNAL;case Bn.UNAVAILABLE:return ye.UNAVAILABLE;case Bn.UNAUTHENTICATED:return ye.UNAUTHENTICATED;case Bn.INVALID_ARGUMENT:return ye.INVALID_ARGUMENT;case Bn.NOT_FOUND:return ye.NOT_FOUND;case Bn.ALREADY_EXISTS:return ye.ALREADY_EXISTS;case Bn.PERMISSION_DENIED:return ye.PERMISSION_DENIED;case Bn.FAILED_PRECONDITION:return ye.FAILED_PRECONDITION;case Bn.ABORTED:return ye.ABORTED;case Bn.OUT_OF_RANGE:return ye.OUT_OF_RANGE;case Bn.UNIMPLEMENTED:return ye.UNIMPLEMENTED;case Bn.DATA_LOSS:return ye.DATA_LOSS;default:return Xe(39323,{code:n})}}(Ft=Bn||(Bn={}))[Ft.OK=0]="OK",Ft[Ft.CANCELLED=1]="CANCELLED",Ft[Ft.UNKNOWN=2]="UNKNOWN",Ft[Ft.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ft[Ft.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ft[Ft.NOT_FOUND=5]="NOT_FOUND",Ft[Ft.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ft[Ft.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ft[Ft.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ft[Ft.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ft[Ft.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ft[Ft.ABORTED=10]="ABORTED",Ft[Ft.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ft[Ft.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ft[Ft.INTERNAL=13]="INTERNAL",Ft[Ft.UNAVAILABLE=14]="UNAVAILABLE",Ft[Ft.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xP=new Go([4294967295,4294967295],0);function Zw(n){const e=gP().encode(n),t=new L1;return t.update(e),new Uint8Array(t.digest())}function e_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new Go([t,r],0),new Go([i,l],0)]}class m0{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ku(`Invalid padding: ${t}`);if(r<0)throw new Ku(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ku(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ku(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Go.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Go.fromNumber(r)));return i.compare(xP)===1&&(i=new Go([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Zw(e),[r,i]=e_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(r,i,l);if(!this.we(c))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),c=new m0(l,i,t);return r.forEach((u=>c.insert(u))),c}insert(e){if(this.ge===0)return;const t=Zw(e),[r,i]=e_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(r,i,l);this.Se(c)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ku extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e,t,r,i,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Gh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Vf(ot.min(),i,new xn(yt),Ss(),St())}}class Gh{constructor(e,t,r,i,l){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Gh(r,t,St(),St(),St())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}}class UI{constructor(e,t){this.targetId=e,this.Ce=t}}class zI{constructor(e,t,r=qn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class t_{constructor(){this.ve=0,this.Fe=n_(),this.Me=qn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=St(),t=St(),r=St();return this.Fe.forEach(((i,l)=>{switch(l){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Xe(38017,{changeType:l})}})),new Gh(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=n_()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,rt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class yP{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ss(),this.Je=op(),this.He=op(),this.Ye=new xn(yt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:Xe(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const l=i.target;if(ef(l))if(r===0){const c=new Me(l.path);this.et(t,c,kn.newNoDocument(c,ot.min()))}else rt(r===1,20013,{expectedCount:r});else{const c=this._t(t);if(c!==r){const u=this.ut(e),p=u?this.ct(u,e,c):1;if(p!==0){this.it(t);const g=p===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,g)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:l=0}=t;let c,u;try{c=Ga(r).toUint8Array()}catch(p){if(p instanceof dI)return rc("Decoding the base64 bloom filter in existence filter failed ("+p.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw p}try{u=new m0(c,i,l)}catch(p){return rc(p instanceof Ku?"BloomFilter error: ":"Applying bloom filter failed: ",p),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((l=>{const c=this.Ge.ht(),u=`projects/${c.projectId}/databases/${c.database}/documents/${l.path.canonicalString()}`;e.mightContain(u)||(this.et(t,l,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((l,c)=>{const u=this.ot(c);if(u){if(l.current&&ef(u.target)){const p=new Me(u.target.path);this.It(p).has(c)||this.Et(c,p)||this.et(c,p,kn.newNoDocument(p,e))}l.Be&&(t.set(c,l.ke()),l.qe())}}));let r=St();this.He.forEach(((l,c)=>{let u=!0;c.forEachWhile((p=>{const g=this.ot(p);return!g||g.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(l))})),this.je.forEach(((l,c)=>c.setReadTime(e)));const i=new Vf(e,t,this.Ye,this.je,r);return this.je=Ss(),this.Je=op(),this.He=op(),this.Ye=new xn(yt),i}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new t_,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Zt(yt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Zt(yt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ae("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new t_),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function op(){return new xn(Me.comparator)}function n_(){return new xn(Me.comparator)}const vP={asc:"ASCENDING",desc:"DESCENDING"},bP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wP={and:"AND",or:"OR"};class _P{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function fy(n,e){return n.useProto3Json||Af(e)?e:{value:e}}function Dd(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function NP(n,e){return Dd(n,e.toTimestamp())}function Gr(n){return rt(!!n,49232),ot.fromTimestamp((function(t){const r=Ha(t);return new Jt(r.seconds,r.nanos)})(n))}function p0(n,e){return gy(n,e).canonicalString()}function gy(n,e){const t=(function(i){return new Gt(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function WI(n){const e=Gt.fromString(n);return rt(eE(e),10190,{key:e.toString()}),e}function nf(n,e){return p0(n.databaseId,e.path)}function Ql(n,e){const t=WI(e);if(t.get(1)!==n.databaseId.projectId)throw new Pe(ye.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Pe(ye.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Me(KI(t))}function HI(n,e){return p0(n.databaseId,e)}function GI(n){const e=WI(n);return e.length===4?Gt.emptyPath():KI(e)}function xy(n){return new Gt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function KI(n){return rt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function r_(n,e,t){return{name:nf(n,e),fields:t.value.mapValue.fields}}function IP(n,e,t){const r=Ql(n,e.name),i=Gr(e.updateTime),l=e.createTime?Gr(e.createTime):ot.min(),c=new Tr({mapValue:{fields:e.fields}}),u=kn.newFoundDocument(r,i,l,c);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function EP(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(g){return g==="NO_CHANGE"?0:g==="ADD"?1:g==="REMOVE"?2:g==="CURRENT"?3:g==="RESET"?4:Xe(39313,{state:g})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],l=(function(g,b){return g.useProto3Json?(rt(b===void 0||typeof b=="string",58123),qn.fromBase64String(b||"")):(rt(b===void 0||b instanceof Buffer||b instanceof Uint8Array,16193),qn.fromUint8Array(b||new Uint8Array))})(n,e.targetChange.resumeToken),c=e.targetChange.cause,u=c&&(function(g){const b=g.code===void 0?ye.UNKNOWN:BI(g.code);return new Pe(b,g.message||"")})(c);t=new zI(r,i,l,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ql(n,r.document.name),l=Gr(r.document.updateTime),c=r.document.createTime?Gr(r.document.createTime):ot.min(),u=new Tr({mapValue:{fields:r.document.fields}}),p=kn.newFoundDocument(i,l,c,u),g=r.targetIds||[],b=r.removedTargetIds||[];t=new Cp(g,b,p.key,p)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Ql(n,r.document),l=r.readTime?Gr(r.readTime):ot.min(),c=kn.newNoDocument(i,l),u=r.removedTargetIds||[];t=new Cp([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Ql(n,r.document),l=r.removedTargetIds||[];t=new Cp([],l,i,null)}else{if(!("filter"in e))return Xe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:l}=r,c=new pP(i,l),u=r.targetId;t=new UI(u,c)}}return t}function rf(n,e){let t;if(e instanceof Fd)t={update:r_(n,e.key,e.value)};else if(e instanceof Mf)t={delete:nf(n,e.key)};else if(e instanceof Ya)t={update:r_(n,e.key,e.data),updateMask:CP(e.fieldMask)};else{if(!(e instanceof FI))return Xe(16599,{Vt:e.type});t={verify:nf(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(l,c){const u=c.transform;if(u instanceof Ch)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ac)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Rd)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Rh)return{fieldPath:c.field.canonicalString(),increment:u.Ae};throw Xe(20930,{transform:c.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,l){return l.updateTime!==void 0?{updateTime:NP(i,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Xe(27497)})(n,e.precondition)),t}function yy(n,e){const t=e.currentDocument?(function(l){return l.updateTime!==void 0?Ar.updateTime(Gr(l.updateTime)):l.exists!==void 0?Ar.exists(l.exists):Ar.none()})(e.currentDocument):Ar.none(),r=e.updateTransforms?e.updateTransforms.map((i=>(function(c,u){let p=null;if("setToServerValue"in u)rt(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),p=new Ch;else if("appendMissingElements"in u){const b=u.appendMissingElements.values||[];p=new ac(b)}else if("removeAllFromArray"in u){const b=u.removeAllFromArray.values||[];p=new Rd(b)}else"increment"in u?p=new Rh(c,u.increment):Xe(16584,{proto:u});const g=Nn.fromServerFormat(u.fieldPath);return new VI(g,p)})(n,i))):[];if(e.update){e.update.name;const i=Ql(n,e.update.name),l=new Tr({mapValue:{fields:e.update.fields}});if(e.updateMask){const c=(function(p){const g=p.fieldPaths||[];return new ds(g.map((b=>Nn.fromServerFormat(b))))})(e.updateMask);return new Ya(i,l,c,t,r)}return new Fd(i,l,t,r)}if(e.delete){const i=Ql(n,e.delete);return new Mf(i,t)}if(e.verify){const i=Ql(n,e.verify);return new FI(i,t)}return Xe(1463,{proto:e})}function TP(n,e){return n&&n.length>0?(rt(e!==void 0,14353),n.map((t=>(function(i,l){let c=i.updateTime?Gr(i.updateTime):Gr(l);return c.isEqual(ot.min())&&(c=Gr(l)),new uP(c,i.transformResults||[])})(t,e)))):[]}function QI(n,e){return{documents:[HI(n,e.path)]}}function YI(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=HI(n,i);const l=(function(g){if(g.length!==0)return ZI(Xt.create(g,"and"))})(e.filters);l&&(t.structuredQuery.where=l);const c=(function(g){if(g.length!==0)return g.map((b=>(function(N){return{field:dd(N.field),direction:SP(N.dir)}})(b)))})(e.orderBy);c&&(t.structuredQuery.orderBy=c);const u=fy(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(g){return{before:g.inclusive,values:g.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(g){return{before:!g.inclusive,values:g.position}})(e.endAt)),{ft:t,parent:i}}function JI(n){let e=GI(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){rt(r===1,65062);const b=t.from[0];b.allDescendants?i=b.collectionId:e=e.child(b.collectionId)}let l=[];t.where&&(l=(function(w){const N=XI(w);return N instanceof Xt&&l0(N)?N.getFilters():[N]})(t.where));let c=[];t.orderBy&&(c=(function(w){return w.map((N=>(function(z){return new Zp(ud(z.field),(function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(z.direction))})(N)))})(t.orderBy));let u=null;t.limit&&(u=(function(w){let N;return N=typeof w=="object"?w.value:w,Af(N)?null:N})(t.limit));let p=null;t.startAt&&(p=(function(w){const N=!!w.before,D=w.values||[];return new kd(D,N)})(t.startAt));let g=null;return t.endAt&&(g=(function(w){const N=!w.before,D=w.values||[];return new kd(D,N)})(t.endAt)),XD(e,i,c,l,u,"F",p,g)}function AP(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xe(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function XI(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ud(t.unaryFilter.field);return Mt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=ud(t.unaryFilter.field);return Mt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=ud(t.unaryFilter.field);return Mt.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=ud(t.unaryFilter.field);return Mt.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Xe(61313);default:return Xe(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Mt.create(ud(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Xe(58110);default:return Xe(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Xt.create(t.compositeFilter.filters.map((r=>XI(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Xe(1026)}})(t.compositeFilter.op))})(n):Xe(30097,{filter:n})}function SP(n){return vP[n]}function jP(n){return bP[n]}function kP(n){return wP[n]}function dd(n){return{fieldPath:n.canonicalString()}}function ud(n){return Nn.fromServerFormat(n.fieldPath)}function ZI(n){return n instanceof Mt?(function(t){if(t.op==="=="){if(Bw(t.value))return{unaryFilter:{field:dd(t.field),op:"IS_NAN"}};if(Fw(t.value))return{unaryFilter:{field:dd(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Bw(t.value))return{unaryFilter:{field:dd(t.field),op:"IS_NOT_NAN"}};if(Fw(t.value))return{unaryFilter:{field:dd(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dd(t.field),op:jP(t.op),value:t.value}}})(n):n instanceof Xt?(function(t){const r=t.getFilters().map((i=>ZI(i)));return r.length===1?r[0]:{compositeFilter:{op:kP(t.op),filters:r}}})(n):Xe(54877,{filter:n})}function CP(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function eE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e,t,r,i,l=ot.min(),c=ot.min(),u=qn.EMPTY_BYTE_STRING,p=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=u,this.expectedCount=p}withSequenceNumber(e){return new Fa(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Fa(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Fa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Fa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tE{constructor(e){this.yt=e}}function RP(n,e){let t;if(e.document)t=IP(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Me.fromSegments(e.noDocument.path),i=lc(e.noDocument.readTime);t=kn.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Xe(56709);{const r=Me.fromSegments(e.unknownDocument.path),i=lc(e.unknownDocument.version);t=kn.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime((function(i){const l=new Jt(i[0],i[1]);return ot.fromTimestamp(l)})(e.readTime)),t}function s_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:sf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(l,c){return{name:nf(l,c.key),fields:c.data.value.mapValue.fields,updateTime:Dd(l,c.version.toTimestamp()),createTime:Dd(l,c.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:oc(e.version)};else{if(!e.isUnknownDocument())return Xe(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:oc(e.version)}}return r}function sf(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function oc(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function lc(n){const e=new Jt(n.seconds,n.nanoseconds);return ot.fromTimestamp(e)}function Bl(n,e){const t=(e.baseMutations||[]).map((l=>yy(n.yt,l)));for(let l=0;l<e.mutations.length-1;++l){const c=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const u=e.mutations[l+1];c.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const r=e.mutations.map((l=>yy(n.yt,l))),i=Jt.fromMillis(e.localWriteTimeMs);return new d0(e.batchId,i,t,r)}function Qu(n){const e=lc(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?lc(n.lastLimboFreeSnapshotVersion):ot.min();let r;return r=(function(l){return l.documents!==void 0})(n.query)?(function(l){const c=l.documents.length;return rt(c===1,1966,{count:c}),ai(Wh(GI(l.documents[0])))})(n.query):(function(l){return ai(JI(l))})(n.query),new Fa(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,qn.fromBase64String(n.resumeToken))}function nE(n,e){const t=oc(e.snapshotVersion),r=oc(e.lastLimboFreeSnapshotVersion);let i;i=ef(e.target)?QI(n.yt,e.target):YI(n.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ic(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function rE(n){const e=JI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?py(e,e.limit,"L"):e}function vx(n,e){return new h0(e.largestBatchId,yy(n.yt,e.overlayMutation))}function i_(n,e){const t=e.path.lastSegment();return[n,jr(e.path.popLast()),t]}function a_(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:oc(r.readTime),documentKey:jr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{getBundleMetadata(e,t){return o_(e).get(t).next((r=>{if(r)return(function(l){return{id:l.bundleId,createTime:lc(l.createTime),version:l.version}})(r)}))}saveBundleMetadata(e,t){return o_(e).put((function(i){return{bundleId:i.id,createTime:oc(Gr(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return l_(e).get(t).next((r=>{if(r)return(function(l){return{name:l.name,query:rE(l.bundledQuery),readTime:lc(l.readTime)}})(r)}))}saveNamedQuery(e,t){return l_(e).put((function(i){return{name:i.name,readTime:oc(Gr(i.readTime)),bundledQuery:i.bundledQuery}})(t))}}function o_(n){return er(n,Sf)}function l_(n){return er(n,jf)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new Lf(e,r)}getOverlay(e,t){return Pu(e).get(i_(this.userId,t)).next((r=>r?vx(this.serializer,r):null))}getOverlays(e,t){const r=ta();return ee.forEach(t,(i=>this.getOverlay(e,i).next((l=>{l!==null&&r.set(i,l)})))).next((()=>r))}saveOverlays(e,t,r){const i=[];return r.forEach(((l,c)=>{const u=new h0(t,c);i.push(this.St(e,u))})),ee.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach((c=>i.add(jr(c.getCollectionPath()))));const l=[];return i.forEach((c=>{const u=IDBKeyRange.bound([this.userId,c,r],[this.userId,c,r+1],!1,!0);l.push(Pu(e).Z(ay,u))})),ee.waitFor(l)}getOverlaysForCollection(e,t,r){const i=ta(),l=jr(t),c=IDBKeyRange.bound([this.userId,l,r],[this.userId,l,Number.POSITIVE_INFINITY],!0);return Pu(e).J(ay,c).next((u=>{for(const p of u){const g=vx(this.serializer,p);i.set(g.getKey(),g)}return i}))}getOverlaysForCollectionGroup(e,t,r,i){const l=ta();let c;const u=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Pu(e).ee({index:sI,range:u},((p,g,b)=>{const w=vx(this.serializer,g);l.size()<i||w.largestBatchId===c?(l.set(w.getKey(),w),c=w.largestBatchId):b.done()})).next((()=>l))}St(e,t){return Pu(e).put((function(i,l,c){const[u,p,g]=i_(l,c.mutation.key);return{userId:l,collectionPath:p,documentId:g,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:rf(i.yt,c.mutation)}})(this.serializer,this.userId,t))}}function Pu(n){return er(n,kf)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{bt(e){return er(e,r0)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const r=t==null?void 0:t.value;return r?qn.fromUint8Array(r):qn.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(gn(e.integerValue));else if("doubleValue"in e){const r=gn(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Nh(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ha(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ga(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?gI(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Rf(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Xe(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){var c,u;const r=e.fields||{};this.Ft(t,53);const i=Sd,l=((u=(c=r[i].arrayValue)==null?void 0:c.values)==null?void 0:u.length)||0;this.Ft(t,15),t.Mt(gn(l)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),Me.fromName(e).path.forEach((r=>{this.Ft(t,60),this.Ut(r,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ul.Kt=new Ul;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sd=255;function OP(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function c_(n){const e=64-(function(r){let i=0;for(let l=0;l<8;++l){const c=OP(255&r[l]);if(i+=c,c!==8)break}return i})(n);return Math.ceil(e/8)}class MP{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const i=t.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Ht()}Xt(e){const t=this.en(e),r=c_(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}nn(e){const t=this.en(e),r=c_(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}rn(){this.sn(sd),this.sn(255)}_n(){this.an(sd),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(l){const c=new DataView(new ArrayBuffer(8));return c.setFloat64(0,l,!1),new Uint8Array(c.buffer)})(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===sd?(this.sn(sd),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===sd?(this.an(sd),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class VP{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class LP{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Ou{constructor(){this.cn=new MP,this.ln=new VP(this.cn),this.hn=new LP(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zl{constructor(e,t,r,i){this.Tn=e,this.In=t,this.En=r,this.dn=i}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new zl(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Rp(this.En),directionalValue:Rp(this.dn),orderedDocumentKey:Rp(t),documentKey:r.path.toArray()}}Vn(e,t,r){const i=this.Rn(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}}function Ro(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=d_(n.En,e.En),t!==0?t:(t=d_(n.dn,e.dn),t!==0?t:Me.comparator(n.In,e.In)))}function d_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Rp(n){return HN()?(function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r})(n):n}function u_(n){return typeof n!="string"?n:(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(n)}class h_{constructor(e){this.mn=new Zt(((t,r)=>Nn.comparator(t.field,r.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(rt(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=ry(e);if(t!==void 0&&!this.wn(t))return!1;const r=Vl(e);let i=new Set,l=0,c=0;for(;l<r.length&&this.wn(r[l]);++l)i=i.add(r[l].fieldPath.canonicalString());if(l===r.length)return!0;if(this.mn.size>0){const u=this.mn.getIterator().getNext();if(!i.has(u.field.canonicalString())){const p=r[l];if(!this.Sn(u,p)||!this.bn(this.fn[c++],p))return!1}++l}for(;l<r.length;++l){const u=r[l];if(c>=this.fn.length||!this.bn(this.fn[c++],u))return!1}return!0}Dn(){if(this.pn)return null;let e=new Zt(Nn.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ip(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ip(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ip(r.field,r.dir==="asc"?0:1)));return new Kp(Kp.UNKNOWN_ID,this.collectionId,t,_h.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sE(n){var t,r;if(rt(n instanceof Mt||n instanceof Xt,20012),n instanceof Mt){if(n instanceof EI){const i=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map((l=>Mt.create(n.field,"==",l))))||[];return Xt.create(i,"or")}return n}const e=n.filters.map((i=>sE(i)));return Xt.create(e,n.op)}function $P(n){if(n.getFilters().length===0)return[];const e=wy(sE(n));return rt(iE(e),7391),vy(e)||by(e)?[e]:e.getFilters()}function vy(n){return n instanceof Mt}function by(n){return n instanceof Xt&&l0(n)}function iE(n){return vy(n)||by(n)||(function(t){if(t instanceof Xt&&dy(t)){for(const r of t.getFilters())if(!vy(r)&&!by(r))return!1;return!0}return!1})(n)}function wy(n){if(rt(n instanceof Mt||n instanceof Xt,34018),n instanceof Mt)return n;if(n.filters.length===1)return wy(n.filters[0]);const e=n.filters.map((r=>wy(r)));let t=Xt.create(e,n.op);return t=af(t),iE(t)?t:(rt(t instanceof Xt,64498),rt(Cd(t),40251),rt(t.filters.length>1,57927),t.filters.reduce(((r,i)=>f0(r,i))))}function f0(n,e){let t;return rt(n instanceof Mt||n instanceof Xt,38388),rt(e instanceof Mt||e instanceof Xt,25473),t=n instanceof Mt?e instanceof Mt?(function(i,l){return Xt.create([i,l],"and")})(n,e):m_(n,e):e instanceof Mt?m_(e,n):(function(i,l){if(rt(i.filters.length>0&&l.filters.length>0,48005),Cd(i)&&Cd(l))return _I(i,l.getFilters());const c=dy(i)?i:l,u=dy(i)?l:i,p=c.filters.map((g=>f0(g,u)));return Xt.create(p,"or")})(n,e),af(t)}function m_(n,e){if(Cd(e))return _I(e,n.getFilters());{const t=e.filters.map((r=>f0(n,r)));return Xt.create(t,"or")}}function af(n){if(rt(n instanceof Mt||n instanceof Xt,11850),n instanceof Mt)return n;const e=n.getFilters();if(e.length===1)return af(e[0]);if(bI(n))return n;const t=e.map((i=>af(i))),r=[];return t.forEach((i=>{i instanceof Mt?r.push(i):i instanceof Xt&&(i.op===n.op?r.push(...i.filters):r.push(i))})),r.length===1?r[0]:Xt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FP{constructor(){this.Cn=new g0}addToCollectionParentIndex(e,t){return this.Cn.add(t),ee.resolve()}getCollectionParents(e,t){return ee.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ee.resolve()}deleteFieldIndex(e,t){return ee.resolve()}deleteAllFieldIndexes(e){return ee.resolve()}createTargetIndexes(e,t){return ee.resolve()}getDocumentsMatchingTarget(e,t){return ee.resolve(null)}getIndexType(e,t){return ee.resolve(0)}getFieldIndexes(e,t){return ee.resolve([])}getNextCollectionGroupToUpdate(e){return ee.resolve(null)}getMinOffset(e,t){return ee.resolve(Ds.min())}getMinOffsetFromCollectionGroup(e,t){return ee.resolve(Ds.min())}updateCollectionGroup(e,t,r){return ee.resolve()}updateIndexEntries(e,t){return ee.resolve()}}class g0{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Zt(Gt.comparator),l=!i.has(r);return this.index[t]=i.add(r),l}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Zt(Gt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p_="IndexedDbIndexManager",lp=new Uint8Array(0);class BP{constructor(e,t){this.databaseId=t,this.vn=new g0,this.Fn=new Qa((r=>ic(r)),((r,i)=>zh(r,i))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const l={collectionId:r,parent:jr(i)};return f_(e).put(l)}return ee.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[H1(t),""],!1,!0);return f_(e).J(i).next((l=>{for(const c of l){if(c.collectionId!==t)break;r.push(ea(c.parent))}return r}))}addFieldIndex(e,t){const r=Mu(e),i=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map((p=>[p.fieldPath.canonicalString(),p.kind]))}})(t);delete i.indexId;const l=r.add(i);if(t.indexState){const c=ad(e);return l.next((u=>{c.put(a_(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return l.next()}deleteFieldIndex(e,t){const r=Mu(e),i=ad(e),l=id(e);return r.delete(t.indexId).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Mu(e),r=id(e),i=ad(e);return t.Z().next((()=>r.Z())).next((()=>i.Z()))}createTargetIndexes(e,t){return ee.forEach(this.Mn(t),(r=>this.getIndexType(e,r).next((i=>{if(i===0||i===1){const l=new h_(r).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))))}getDocumentsMatchingTarget(e,t){const r=id(e);let i=!0;const l=new Map;return ee.forEach(this.Mn(t),(c=>this.xn(e,c).next((u=>{i&&(i=!!u),l.set(c,u)})))).next((()=>{if(i){let c=St();const u=[];return ee.forEach(l,((p,g)=>{Ae(p_,`Using index ${(function(ae){return`id=${ae.indexId}|cg=${ae.collectionGroup}|f=${ae.fields.map((xe=>`${xe.fieldPath}:${xe.kind}`)).join(",")}`})(p)} to execute ${ic(t)}`);const b=(function(ae,xe){const j=ry(xe);if(j===void 0)return null;for(const ie of tf(ae,j.fieldPath))switch(ie.op){case"array-contains-any":return ie.value.arrayValue.values||[];case"array-contains":return[ie.value]}return null})(g,p),w=(function(ae,xe){const j=new Map;for(const ie of Vl(xe))for(const k of tf(ae,ie.fieldPath))switch(k.op){case"==":case"in":j.set(ie.fieldPath.canonicalString(),k.value);break;case"not-in":case"!=":return j.set(ie.fieldPath.canonicalString(),k.value),Array.from(j.values())}return null})(g,p),N=(function(ae,xe){const j=[];let ie=!0;for(const k of Vl(xe)){const R=k.kind===0?Hw(ae,k.fieldPath,ae.startAt):Gw(ae,k.fieldPath,ae.startAt);j.push(R.value),ie&&(ie=R.inclusive)}return new kd(j,ie)})(g,p),D=(function(ae,xe){const j=[];let ie=!0;for(const k of Vl(xe)){const R=k.kind===0?Gw(ae,k.fieldPath,ae.endAt):Hw(ae,k.fieldPath,ae.endAt);j.push(R.value),ie&&(ie=R.inclusive)}return new kd(j,ie)})(g,p),z=this.On(p,g,N),L=this.On(p,g,D),O=this.Nn(p,g,w),le=this.Bn(p.indexId,b,z,N.inclusive,L,D.inclusive,O);return ee.forEach(le,(ge=>r.Y(ge,t.limit).next((ae=>{ae.forEach((xe=>{const j=Me.fromSegments(xe.documentKey);c.has(j)||(c=c.add(j),u.push(j))}))}))))})).next((()=>u))}return ee.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=$P(Xt.create(e.filters,"and")).map((r=>hy(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,r,i,l,c,u){const p=(t!=null?t.length:1)*Math.max(r.length,l.length),g=p/(t!=null?t.length:1),b=[];for(let w=0;w<p;++w){const N=t?this.Ln(t[w/g]):lp,D=this.kn(e,N,r[w%g],i),z=this.qn(e,N,l[w%g],c),L=u.map((O=>this.kn(e,N,O,!0)));b.push(...this.createRange(D,z,L))}return b}kn(e,t,r,i){const l=new zl(e,Me.empty(),t,r);return i?l:l.An()}qn(e,t,r,i){const l=new zl(e,Me.empty(),t,r);return i?l.An():l}xn(e,t){const r=new h_(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next((l=>{let c=null;for(const u of l)r.yn(u)&&(!c||u.fields.length>c.fields.length)&&(c=u);return c}))}getIndexType(e,t){let r=2;const i=this.Mn(t);return ee.forEach(i,(l=>this.xn(e,l).next((c=>{c?r!==0&&c.fields.length<(function(p){let g=new Zt(Nn.comparator),b=!1;for(const w of p.filters)for(const N of w.getFlattenedFilters())N.field.isKeyField()||(N.op==="array-contains"||N.op==="array-contains-any"?b=!0:g=g.add(N.field));for(const w of p.orderBy)w.field.isKeyField()||(g=g.add(w.field));return g.size+(b?1:0)})(l)&&(r=1):r=0})))).next((()=>(function(c){return c.limit!==null})(t)&&i.length>1&&r===2?1:r))}Qn(e,t){const r=new Ou;for(const i of Vl(e)){const l=t.data.field(i.fieldPath);if(l==null)return null;const c=r.Pn(i.kind);Ul.Kt.Dt(l,c)}return r.un()}Ln(e){const t=new Ou;return Ul.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new Ou;return Ul.Kt.Dt(jh(this.databaseId,t),r.Pn((function(l){const c=Vl(l);return c.length===0?0:c[c.length-1].kind})(e))),r.un()}Nn(e,t,r){if(r===null)return[];let i=[];i.push(new Ou);let l=0;for(const c of Vl(e)){const u=r[l++];for(const p of i)if(this.Un(t,c.fieldPath)&&kh(u))i=this.Kn(i,c,u);else{const g=p.Pn(c.kind);Ul.Kt.Dt(u,g)}}return this.Wn(i)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const i=[...e],l=[];for(const c of r.arrayValue.values||[])for(const u of i){const p=new Ou;p.seed(u.un()),Ul.Kt.Dt(c,p.Pn(t.kind)),l.push(p)}return l}Un(e,t){return!!e.filters.find((r=>r instanceof Mt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in")))}getFieldIndexes(e,t){const r=Mu(e),i=ad(e);return(t?r.J(iy,IDBKeyRange.bound(t,t)):r.J()).next((l=>{const c=[];return ee.forEach(l,(u=>i.get([u.indexId,this.uid]).next((p=>{c.push((function(b,w){const N=w?new _h(w.sequenceNumber,new Ds(lc(w.readTime),new Me(ea(w.documentKey)),w.largestBatchId)):_h.empty(),D=b.fields.map((([z,L])=>new Ip(Nn.fromServerFormat(z),L)));return new Kp(b.indexId,b.collectionGroup,D,N)})(u,p))})))).next((()=>c))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((r,i)=>{const l=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return l!==0?l:yt(r.collectionGroup,i.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,r){const i=Mu(e),l=ad(e);return this.Gn(e).next((c=>i.J(iy,IDBKeyRange.bound(t,t)).next((u=>ee.forEach(u,(p=>l.put(a_(p.indexId,this.uid,c,r))))))))}updateIndexEntries(e,t){const r=new Map;return ee.forEach(t,((i,l)=>{const c=r.get(i.collectionGroup);return(c?ee.resolve(c):this.getFieldIndexes(e,i.collectionGroup)).next((u=>(r.set(i.collectionGroup,u),ee.forEach(u,(p=>this.zn(e,i,p).next((g=>{const b=this.jn(l,p);return g.isEqual(b)?ee.resolve():this.Jn(e,l,p,g,b)})))))))}))}Hn(e,t,r,i){return id(e).put(i.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,i){return id(e).delete(i.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const i=id(e);let l=new Zt(Ro);return i.ee({index:rI,range:IDBKeyRange.only([r.indexId,this.uid,Rp(this.$n(r,t))])},((c,u)=>{l=l.add(new zl(r.indexId,t,u_(u.arrayValue),u_(u.directionalValue)))})).next((()=>l))}jn(e,t){let r=new Zt(Ro);const i=this.Qn(t,e);if(i==null)return r;const l=ry(t);if(l!=null){const c=e.data.field(l.fieldPath);if(kh(c))for(const u of c.arrayValue.values||[])r=r.add(new zl(t.indexId,e.key,this.Ln(u),i))}else r=r.add(new zl(t.indexId,e.key,lp,i));return r}Jn(e,t,r,i,l){Ae(p_,"Updating index entries for document '%s'",t.key);const c=[];return(function(p,g,b,w,N){const D=p.getIterator(),z=g.getIterator();let L=rd(D),O=rd(z);for(;L||O;){let le=!1,ge=!1;if(L&&O){const ae=b(L,O);ae<0?ge=!0:ae>0&&(le=!0)}else L!=null?ge=!0:le=!0;le?(w(O),O=rd(z)):ge?(N(L),L=rd(D)):(L=rd(D),O=rd(z))}})(i,l,Ro,(u=>{c.push(this.Hn(e,t,r,u))}),(u=>{c.push(this.Yn(e,t,r,u))})),ee.waitFor(c)}Gn(e){let t=1;return ad(e).ee({index:nI,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((r,i,l)=>{l.done(),t=i.sequenceNumber+1})).next((()=>t))}createRange(e,t,r){r=r.sort(((c,u)=>Ro(c,u))).filter(((c,u,p)=>!u||Ro(c,p[u-1])!==0));const i=[];i.push(e);for(const c of r){const u=Ro(c,e),p=Ro(c,t);if(u===0)i[0]=e.An();else if(u>0&&p<0)i.push(c),i.push(c.An());else if(p>0)break}i.push(t);const l=[];for(let c=0;c<i.length;c+=2){if(this.Zn(i[c],i[c+1]))return[];const u=i[c].Vn(this.uid,lp,Me.empty()),p=i[c+1].Vn(this.uid,lp,Me.empty());l.push(IDBKeyRange.bound(u,p))}return l}Zn(e,t){return Ro(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(g_)}getMinOffset(e,t){return ee.mapArray(this.Mn(t),(r=>this.xn(e,r).next((i=>i||Xe(44426))))).next(g_)}}function f_(n){return er(n,Th)}function id(n){return er(n,dh)}function Mu(n){return er(n,n0)}function ad(n){return er(n,ch)}function g_(n){rt(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Zy(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Ds(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},aE=41943040;class Er{static withCacheSize(e){return new Er(e,Er.DEFAULT_COLLECTION_PERCENTILE,Er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oE(n,e,t){const r=n.store(Mi),i=n.store(Id),l=[],c=IDBKeyRange.only(t.batchId);let u=0;const p=r.ee({range:c},((b,w,N)=>(u++,N.delete())));l.push(p.next((()=>{rt(u===1,47070,{batchId:t.batchId})})));const g=[];for(const b of t.mutations){const w=Z1(e,b.key.path,t.batchId);l.push(i.delete(w)),g.push(b.key)}return ee.waitFor(l).next((()=>g))}function of(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Xe(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Er.DEFAULT_COLLECTION_PERCENTILE=10,Er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Er.DEFAULT=new Er(aE,Er.DEFAULT_COLLECTION_PERCENTILE,Er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Er.DISABLED=new Er(-1,0,0);class $f{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Xn={}}static wt(e,t,r,i){rt(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new $f(l,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Do(e).ee({index:ql,range:r},((i,l,c)=>{t=!1,c.done()})).next((()=>t))}addMutationBatch(e,t,r,i){const l=hd(e),c=Do(e);return c.add({}).next((u=>{rt(typeof u=="number",49019);const p=new d0(u,t,r,i),g=(function(D,z,L){const O=L.baseMutations.map((ge=>rf(D.yt,ge))),le=L.mutations.map((ge=>rf(D.yt,ge)));return{userId:z,batchId:L.batchId,localWriteTimeMs:L.localWriteTime.toMillis(),baseMutations:O,mutations:le}})(this.serializer,this.userId,p),b=[];let w=new Zt(((N,D)=>yt(N.canonicalString(),D.canonicalString())));for(const N of i){const D=Z1(this.userId,N.key.path,u);w=w.add(N.key.path.popLast()),b.push(c.put(g)),b.push(l.put(D,gD))}return w.forEach((N=>{b.push(this.indexManager.addToCollectionParentIndex(e,N))})),e.addOnCommittedListener((()=>{this.Xn[u]=p.keys()})),ee.waitFor(b).next((()=>p))}))}lookupMutationBatch(e,t){return Do(e).get(t).next((r=>r?(rt(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Bl(this.serializer,r)):null))}er(e,t){return this.Xn[t]?ee.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((r=>{if(r){const i=r.keys();return this.Xn[t]=i,i}return null}))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let l=null;return Do(e).ee({index:ql,range:i},((c,u,p)=>{u.userId===this.userId&&(rt(u.batchId>=r,47524,{tr:r}),l=Bl(this.serializer,u)),p.done()})).next((()=>l))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Gl;return Do(e).ee({index:ql,range:t,reverse:!0},((i,l,c)=>{r=l.batchId,c.done()})).next((()=>r))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Gl],[this.userId,Number.POSITIVE_INFINITY]);return Do(e).J(ql,t).next((r=>r.map((i=>Bl(this.serializer,i)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Ep(this.userId,t.path),i=IDBKeyRange.lowerBound(r),l=[];return hd(e).ee({range:i},((c,u,p)=>{const[g,b,w]=c,N=ea(b);if(g===this.userId&&t.path.isEqual(N))return Do(e).get(w).next((D=>{if(!D)throw Xe(61480,{nr:c,batchId:w});rt(D.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:D.userId,batchId:w}),l.push(Bl(this.serializer,D))}));p.done()})).next((()=>l))}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Zt(yt);const i=[];return t.forEach((l=>{const c=Ep(this.userId,l.path),u=IDBKeyRange.lowerBound(c),p=hd(e).ee({range:u},((g,b,w)=>{const[N,D,z]=g,L=ea(D);N===this.userId&&l.path.isEqual(L)?r=r.add(z):w.done()}));i.push(p)})),ee.waitFor(i).next((()=>this.rr(e,r)))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,l=Ep(this.userId,r),c=IDBKeyRange.lowerBound(l);let u=new Zt(yt);return hd(e).ee({range:c},((p,g,b)=>{const[w,N,D]=p,z=ea(N);w===this.userId&&r.isPrefixOf(z)?z.length===i&&(u=u.add(D)):b.done()})).next((()=>this.rr(e,u)))}rr(e,t){const r=[],i=[];return t.forEach((l=>{i.push(Do(e).get(l).next((c=>{if(c===null)throw Xe(35274,{batchId:l});rt(c.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:c.userId,batchId:l}),r.push(Bl(this.serializer,c))})))})),ee.waitFor(i).next((()=>r))}removeMutationBatch(e,t){return oE(e.le,this.userId,t).next((r=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),ee.forEach(r,(i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ee.resolve();const r=IDBKeyRange.lowerBound((function(c){return[c]})(this.userId)),i=[];return hd(e).ee({range:r},((l,c,u)=>{if(l[0]===this.userId){const p=ea(l[1]);i.push(p)}else u.done()})).next((()=>{rt(i.length===0,56720,{sr:i.map((l=>l.canonicalString()))})}))}))}containsKey(e,t){return lE(e,this.userId,t)}_r(e){return cE(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Gl,lastStreamToken:""}))}}function lE(n,e,t){const r=Ep(e,t.path),i=r[1],l=IDBKeyRange.lowerBound(r);let c=!1;return hd(n).ee({range:l,X:!0},((u,p,g)=>{const[b,w,N]=u;b===e&&w===i&&(c=!0),g.done()})).next((()=>c))}function Do(n){return er(n,Mi)}function hd(n){return er(n,Id)}function cE(n){return er(n,Ih)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new cc(0)}static cr(){return new cc(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const r=new cc(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>ot.fromTimestamp(new Jt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,r){return this.lr(e).next((i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.hr(e,i))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>od(e).delete(t.targetId))).next((()=>this.lr(e))).next((r=>(rt(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r))))}removeTargets(e,t,r){let i=0;const l=[];return od(e).ee(((c,u)=>{const p=Qu(u);p.sequenceNumber<=t&&r.get(p.targetId)===null&&(i++,l.push(this.removeTargetData(e,p)))})).next((()=>ee.waitFor(l))).next((()=>i))}forEachTarget(e,t){return od(e).ee(((r,i)=>{const l=Qu(i);t(l)}))}lr(e){return y_(e).get(Jp).next((t=>(rt(t!==null,2888),t)))}hr(e,t){return y_(e).put(Jp,t)}Pr(e,t){return od(e).put(nE(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const r=ic(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let l=null;return od(e).ee({range:i,index:tI},((c,u,p)=>{const g=Qu(u);zh(t,g.target)&&(l=g,p.done())})).next((()=>l))}addMatchingKeys(e,t,r){const i=[],l=Uo(e);return t.forEach((c=>{const u=jr(c.path);i.push(l.put({targetId:r,path:u})),i.push(this.referenceDelegate.addReference(e,r,c))})),ee.waitFor(i)}removeMatchingKeys(e,t,r){const i=Uo(e);return ee.forEach(t,(l=>{const c=jr(l.path);return ee.waitFor([i.delete([r,c]),this.referenceDelegate.removeReference(e,r,l)])}))}removeMatchingKeysForTargetId(e,t){const r=Uo(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Uo(e);let l=St();return i.ee({range:r,X:!0},((c,u,p)=>{const g=ea(c[1]),b=new Me(g);l=l.add(b)})).next((()=>l))}containsKey(e,t){const r=jr(t.path),i=IDBKeyRange.bound([r],[H1(r)],!1,!0);let l=0;return Uo(e).ee({index:t0,X:!0,range:i},(([c,u],p,g)=>{c!==0&&(l++,g.done())})).next((()=>l>0))}At(e,t){return od(e).get(t).next((r=>r?Qu(r):null))}}function od(n){return er(n,Ed)}function y_(n){return er(n,Kl)}function Uo(n){return er(n,Td)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v_="LruGarbageCollector",zP=1048576;function b_([n,e],[t,r]){const i=yt(n,t);return i===0?yt(e,r):i}class qP{constructor(e){this.Ir=e,this.buffer=new Zt(b_),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();b_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class dE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ae(v_,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){sl(t)?Ae(v_,"Ignoring IndexedDB error during garbage collection: ",t):await xc(t)}await this.Vr(3e5)}))}}class WP{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return ee.resolve(si.ce);const r=new qP(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ae("LruGarbageCollector","Garbage collection skipped; disabled"),ee.resolve(x_)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),x_):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,l,c,u,p,g;const b=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((w=>(w>this.params.maximumSequenceNumbersToCollect?(Ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${w}`),i=this.params.maximumSequenceNumbersToCollect):i=w,c=Date.now(),this.nthSequenceNumber(e,i)))).next((w=>(r=w,u=Date.now(),this.removeTargets(e,r,t)))).next((w=>(l=w,p=Date.now(),this.removeOrphanedDocuments(e,r)))).next((w=>(g=Date.now(),ld()<=Ot.DEBUG&&Ae("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-b}ms
	Determined least recently used ${i} in `+(u-c)+`ms
	Removed ${l} targets in `+(p-u)+`ms
	Removed ${w} documents in `+(g-p)+`ms
Total Duration: ${g-b}ms`),ee.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:l,documentsRemoved:w}))))}}function uE(n,e){return new WP(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP{constructor(e,t){this.db=e,this.garbageCollector=uE(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((r,i)=>t(i)))}addReference(e,t,r){return cp(e,r)}removeReference(e,t,r){return cp(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return cp(e,t)}br(e,t){return(function(i,l){let c=!1;return cE(i).te((u=>lE(i,u,l).next((p=>(p&&(c=!0),ee.resolve(!p)))))).next((()=>c))})(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let l=0;return this.Sr(e,((c,u)=>{if(u<=t){const p=this.br(e,c).next((g=>{if(!g)return l++,r.getEntry(e,c).next((()=>(r.removeEntry(c,ot.min()),Uo(e).delete((function(w){return[0,jr(w.path)]})(c)))))}));i.push(p)}})).next((()=>ee.waitFor(i))).next((()=>r.apply(e))).next((()=>l))}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return cp(e,t)}Sr(e,t){const r=Uo(e);let i,l=si.ce;return r.ee({index:t0},(([c,u],{path:p,sequenceNumber:g})=>{c===0?(l!==si.ce&&t(new Me(ea(i)),l),l=g,i=p):l=si.ce})).next((()=>{l!==si.ce&&t(new Me(ea(i)),l)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function cp(n,e){return Uo(n).put((function(r,i){return{targetId:0,path:jr(r.path),sequenceNumber:i}})(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(){this.changes=new Qa((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,kn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?ee.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Pl(e).put(r)}removeEntry(e,t,r){return Pl(e).delete((function(l,c){const u=l.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],sf(c),u[u.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next((r=>(r.byteSize+=t,this.Dr(e,r))))}getEntry(e,t){let r=kn.newInvalidDocument(t);return Pl(e).ee({index:Tp,range:IDBKeyRange.only(Vu(t))},((i,l)=>{r=this.Cr(t,l)})).next((()=>r))}vr(e,t){let r={size:0,document:kn.newInvalidDocument(t)};return Pl(e).ee({index:Tp,range:IDBKeyRange.only(Vu(t))},((i,l)=>{r={document:this.Cr(t,l),size:of(l)}})).next((()=>r))}getEntries(e,t){let r=Ss();return this.Fr(e,t,((i,l)=>{const c=this.Cr(i,l);r=r.insert(i,c)})).next((()=>r))}Mr(e,t){let r=Ss(),i=new xn(Me.comparator);return this.Fr(e,t,((l,c)=>{const u=this.Cr(l,c);r=r.insert(l,u),i=i.insert(l,of(c))})).next((()=>({documents:r,Or:i})))}Fr(e,t,r){if(t.isEmpty())return ee.resolve();let i=new Zt(N_);t.forEach((p=>i=i.add(p)));const l=IDBKeyRange.bound(Vu(i.first()),Vu(i.last())),c=i.getIterator();let u=c.getNext();return Pl(e).ee({index:Tp,range:l},((p,g,b)=>{const w=Me.fromSegments([...g.prefixPath,g.collectionGroup,g.documentId]);for(;u&&N_(u,w)<0;)r(u,null),u=c.getNext();u&&u.isEqual(w)&&(r(u,g),u=c.hasNext()?c.getNext():null),u?b.j(Vu(u)):b.done()})).next((()=>{for(;u;)r(u,null),u=c.hasNext()?c.getNext():null}))}getDocumentsMatchingQuery(e,t,r,i,l){const c=t.path,u=[c.popLast().toArray(),c.lastSegment(),sf(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],p=[c.popLast().toArray(),c.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Pl(e).J(IDBKeyRange.bound(u,p,!0)).next((g=>{l==null||l.incrementDocumentReadCount(g.length);let b=Ss();for(const w of g){const N=this.Cr(Me.fromSegments(w.prefixPath.concat(w.collectionGroup,w.documentId)),w);N.isFoundDocument()&&(Hh(t,N)||i.has(N.key))&&(b=b.insert(N.key,N))}return b}))}getAllFromCollectionGroup(e,t,r,i){let l=Ss();const c=__(t,r),u=__(t,Ds.max());return Pl(e).ee({index:eI,range:IDBKeyRange.bound(c,u,!0)},((p,g,b)=>{const w=this.Cr(Me.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);l=l.insert(w.key,w),l.size===i&&b.done()})).next((()=>l))}newChangeBuffer(e){return new KP(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return w_(e).get(sy).next((t=>(rt(!!t,20021),t)))}Dr(e,t){return w_(e).put(sy,t)}Cr(e,t){if(t){const r=RP(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ot.min())))return r}return kn.newInvalidDocument(e)}}function mE(n){return new GP(n)}class KP extends hE{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Qa((r=>r.toString()),((r,i)=>r.isEqual(i)))}applyChanges(e){const t=[];let r=0,i=new Zt(((l,c)=>yt(l.canonicalString(),c.canonicalString())));return this.changes.forEach(((l,c)=>{const u=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,u.readTime)),c.isValidDocument()){const p=s_(this.Nr.serializer,c);i=i.add(l.path.popLast());const g=of(p);r+=g-u.size,t.push(this.Nr.addEntry(e,l,p))}else if(r-=u.size,this.trackRemovals){const p=s_(this.Nr.serializer,c.convertToNoDocument(ot.min()));t.push(this.Nr.addEntry(e,l,p))}})),i.forEach((l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))})),t.push(this.Nr.updateMetadata(e,r)),ee.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:r,Or:i})=>(i.forEach(((l,c)=>{this.Br.set(l,{size:c,readTime:r.get(l).readTime})})),r)))}}function w_(n){return er(n,Eh)}function Pl(n){return er(n,Yp)}function Vu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function __(n,e){const t=e.documentKey.path.toArray();return[n,sf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function N_(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let l=0;l<t.length-2&&l<r.length-2;++l)if(i=yt(t[l],r[l]),i)return i;return i=yt(t.length,r.length),i||(i=yt(t[t.length-2],r[r.length-2]),i||yt(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pE{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&ph(r.mutation,i,ds.empty(),Jt.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,St()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=St()){const i=ta();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((l=>{let c=Gu();return l.forEach(((u,p)=>{c=c.insert(u,p.overlayedDocument)})),c}))))}getOverlayedDocuments(e,t){const r=ta();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,St())))}populateOverlays(e,t,r){const i=[];return r.forEach((l=>{t.has(l)||i.push(l)})),this.documentOverlayCache.getOverlays(e,i).next((l=>{l.forEach(((c,u)=>{t.set(c,u)}))}))}computeViews(e,t,r,i){let l=Ss();const c=mh(),u=(function(){return mh()})();return t.forEach(((p,g)=>{const b=r.get(g.key);i.has(g.key)&&(b===void 0||b.mutation instanceof Ya)?l=l.insert(g.key,g):b!==void 0?(c.set(g.key,b.mutation.getFieldMask()),ph(b.mutation,g,b.mutation.getFieldMask(),Jt.now())):c.set(g.key,ds.empty())})),this.recalculateAndSaveOverlays(e,l).next((p=>(p.forEach(((g,b)=>c.set(g,b))),t.forEach(((g,b)=>u.set(g,new QP(b,c.get(g)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=mh();let i=new xn(((c,u)=>c-u)),l=St();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((c=>{for(const u of c)u.keys().forEach((p=>{const g=t.get(p);if(g===null)return;let b=r.get(p)||ds.empty();b=u.applyToLocalView(g,b),r.set(p,b);const w=(i.get(u.batchId)||St()).add(p);i=i.insert(u.batchId,w)}))})).next((()=>{const c=[],u=i.getReverseIterator();for(;u.hasNext();){const p=u.getNext(),g=p.key,b=p.value,w=CI();b.forEach((N=>{if(!l.has(N)){const D=LI(t.get(N),r.get(N));D!==null&&w.set(N,D),l=l.add(N)}})),c.push(this.documentOverlayCache.saveOverlays(e,g,w))}return ee.waitFor(c)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(c){return Me.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):TI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((l=>{const c=i-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-l.size):ee.resolve(ta());let u=wh,p=l;return c.next((g=>ee.forEach(g,((b,w)=>(u<w.largestBatchId&&(u=w.largestBatchId),l.get(b)?ee.resolve():this.remoteDocumentCache.getEntry(e,b).next((N=>{p=p.insert(b,N)}))))).next((()=>this.populateOverlays(e,g,l))).next((()=>this.computeViews(e,p,g,St()))).next((b=>({batchId:u,changes:kI(b)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Me(t)).next((r=>{let i=Gu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const l=t.collectionGroup;let c=Gu();return this.indexManager.getCollectionParents(e,l).next((u=>ee.forEach(u,(p=>{const g=(function(w,N){return new qh(N,null,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)})(t,p.child(l));return this.getDocumentsMatchingCollectionQuery(e,g,r,i).next((b=>{b.forEach(((w,N)=>{c=c.insert(w,N)}))}))})).next((()=>c))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((c=>(l=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,l,i)))).next((c=>{l.forEach(((p,g)=>{const b=g.getKey();c.get(b)===null&&(c=c.insert(b,kn.newInvalidDocument(b)))}));let u=Gu();return c.forEach(((p,g)=>{const b=l.get(p);b!==void 0&&ph(b.mutation,g,ds.empty(),Jt.now()),Hh(t,g)&&(u=u.insert(p,g))})),u}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ee.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Gr(i.createTime)}})(t)),ee.resolve()}getNamedQuery(e,t){return ee.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:rE(i.bundledQuery),readTime:Gr(i.readTime)}})(t)),ee.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(){this.overlays=new xn(Me.comparator),this.qr=new Map}getOverlay(e,t){return ee.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ta();return ee.forEach(t,(i=>this.getOverlay(e,i).next((l=>{l!==null&&r.set(i,l)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,l)=>{this.St(e,t,l)})),ee.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(r)),ee.resolve()}getOverlaysForCollection(e,t,r){const i=ta(),l=t.length+1,c=new Me(t.child("")),u=this.overlays.getIteratorFrom(c);for(;u.hasNext();){const p=u.getNext().value,g=p.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===l&&p.largestBatchId>r&&i.set(p.getKey(),p)}return ee.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let l=new xn(((g,b)=>g-b));const c=this.overlays.getIterator();for(;c.hasNext();){const g=c.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>r){let b=l.get(g.largestBatchId);b===null&&(b=ta(),l=l.insert(g.largestBatchId,b)),b.set(g.getKey(),g)}}const u=ta(),p=l.getIterator();for(;p.hasNext()&&(p.getNext().value.forEach(((g,b)=>u.set(g,b))),!(u.size()>=i)););return ee.resolve(u)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const c=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new h0(t,r));let l=this.qr.get(t);l===void 0&&(l=St(),this.qr.set(t,l)),this.qr.set(t,l.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(){this.sessionToken=qn.EMPTY_BYTE_STRING}getSessionToken(e){return ee.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ee.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(){this.Qr=new Zt(ar.$r),this.Ur=new Zt(ar.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new ar(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new ar(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new Me(new Gt([])),r=new ar(t,e),i=new ar(t,e+1),l=[];return this.Ur.forEachInRange([r,i],(c=>{this.Gr(c),l.push(c.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Me(new Gt([])),r=new ar(t,e),i=new ar(t,e+1);let l=St();return this.Ur.forEachInRange([r,i],(c=>{l=l.add(c.key)})),l}containsKey(e){const t=new ar(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ar{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Me.comparator(e.key,t.key)||yt(e.Yr,t.Yr)}static Kr(e,t){return yt(e.Yr,t.Yr)||Me.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Zt(ar.$r)}checkEmpty(e){return ee.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new d0(l,t,r,i);this.mutationQueue.push(c);for(const u of i)this.Zr=this.Zr.add(new ar(u.key,l)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return ee.resolve(c)}lookupMutationBatch(e,t){return ee.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ei(r),l=i<0?0:i;return ee.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return ee.resolve(this.mutationQueue.length===0?Gl:this.tr-1)}getAllMutationBatches(e){return ee.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ar(t,0),i=new ar(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([r,i],(c=>{const u=this.Xr(c.Yr);l.push(u)})),ee.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Zt(yt);return t.forEach((i=>{const l=new ar(i,0),c=new ar(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,c],(u=>{r=r.add(u.Yr)}))})),ee.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let l=r;Me.isDocumentKey(l)||(l=l.child(""));const c=new ar(new Me(l),0);let u=new Zt(yt);return this.Zr.forEachWhile((p=>{const g=p.key.path;return!!r.isPrefixOf(g)&&(g.length===i&&(u=u.add(p.Yr)),!0)}),c),ee.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){rt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return ee.forEach(t.mutations,(i=>{const l=new ar(i.key,t.batchId);return r=r.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new ar(t,0),i=this.Zr.firstAfterOrEqual(r);return ee.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ee.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(e){this.ri=e,this.docs=(function(){return new xn(Me.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),l=i?i.size:0,c=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:c}),this.size+=c-l,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return ee.resolve(r?r.document.mutableCopy():kn.newInvalidDocument(t))}getEntries(e,t){let r=Ss();return t.forEach((i=>{const l=this.docs.get(i);r=r.insert(i,l?l.document.mutableCopy():kn.newInvalidDocument(i))})),ee.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let l=Ss();const c=t.path,u=new Me(c.child("__id-9223372036854775808__")),p=this.docs.getIteratorFrom(u);for(;p.hasNext();){const{key:g,value:{document:b}}=p.getNext();if(!c.isPrefixOf(g.path))break;g.path.length>c.length+1||Zy(Q1(b),r)<=0||(i.has(b.key)||Hh(t,b))&&(l=l.insert(b.key,b.mutableCopy()))}return ee.resolve(l)}getAllFromCollectionGroup(e,t,r,i){Xe(9500)}ii(e,t){return ee.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new t4(this)}getSize(e){return ee.resolve(this.size)}}class t4 extends hE{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),ee.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4{constructor(e){this.persistence=e,this.si=new Qa((t=>ic(t)),zh),this.lastRemoteSnapshotVersion=ot.min(),this.highestTargetId=0,this.oi=0,this._i=new x0,this.targetCount=0,this.ai=cc.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),ee.resolve()}getLastRemoteSnapshotVersion(e){return ee.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ee.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ee.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),ee.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new cc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ee.resolve()}updateTargetData(e,t){return this.Pr(t),ee.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ee.resolve()}removeTargets(e,t,r){let i=0;const l=[];return this.si.forEach(((c,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(c),l.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),ee.waitFor(l).next((()=>i))}getTargetCount(e){return ee.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return ee.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),ee.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const i=this.persistence.referenceDelegate,l=[];return i&&t.forEach((c=>{l.push(i.markPotentiallyOrphaned(e,c))})),ee.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ee.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return ee.resolve(r)}containsKey(e,t){return ee.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e,t){this.ui={},this.overlays={},this.ci=new si(0),this.li=!1,this.li=!0,this.hi=new XP,this.referenceDelegate=e(this),this.Pi=new n4(this),this.indexManager=new FP,this.remoteDocumentCache=(function(i){return new e4(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new tE(t),this.Ii=new YP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new JP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new ZP(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Ae("MemoryPersistence","Starting transaction:",e);const i=new r4(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((l=>this.referenceDelegate.di(i).next((()=>l)))).toPromise().then((l=>(i.raiseOnCommittedEvent(),l)))}Ai(e,t){return ee.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class r4 extends J1{constructor(e){super(),this.currentSequenceNumber=e}}class Ff{constructor(e){this.persistence=e,this.Ri=new x0,this.Vi=null}static mi(e){return new Ff(e)}get fi(){if(this.Vi)return this.Vi;throw Xe(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),ee.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),ee.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ee.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((l=>this.fi.add(l.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ee.forEach(this.fi,(r=>{const i=Me.fromPath(r);return this.gi(e,i).next((l=>{l||t.removeEntry(i,ot.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return ee.or([()=>ee.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class lf{constructor(e,t){this.persistence=e,this.pi=new Qa((r=>jr(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=uE(this,t)}static mi(e,t){return new lf(e,t)}Ei(){}di(e){return ee.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return ee.forEach(this.pi,((r,i)=>this.br(e,r,i).next((l=>l?ee.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),l=i.newChangeBuffer();return i.ii(e,(c=>this.br(e,c,t).next((u=>{u||(r++,l.removeEntry(c,ot.min()))})))).next((()=>l.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ee.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),ee.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),ee.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ee.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Sp(e.data.value)),t}br(e,t,r){return ee.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return ee.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4{constructor(e){this.serializer=e}k(e,t,r,i){const l=new Tf("createOrUpgrade",t);r<1&&i>=1&&((function(p){p.createObjectStore(Uh)})(e),(function(p){p.createObjectStore(Ih,{keyPath:fD}),p.createObjectStore(Mi,{keyPath:Pw,autoIncrement:!0}).createIndex(ql,Ow,{unique:!0}),p.createObjectStore(Id)})(e),I_(e),(function(p){p.createObjectStore(Ll)})(e));let c=ee.resolve();return r<3&&i>=3&&(r!==0&&((function(p){p.deleteObjectStore(Td),p.deleteObjectStore(Ed),p.deleteObjectStore(Kl)})(e),I_(e)),c=c.next((()=>(function(p){const g=p.store(Kl),b={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ot.min().toTimestamp(),targetCount:0};return g.put(Jp,b)})(l)))),r<4&&i>=4&&(r!==0&&(c=c.next((()=>(function(p,g){return g.store(Mi).J().next((w=>{p.deleteObjectStore(Mi),p.createObjectStore(Mi,{keyPath:Pw,autoIncrement:!0}).createIndex(ql,Ow,{unique:!0});const N=g.store(Mi),D=w.map((z=>N.put(z)));return ee.waitFor(D)}))})(e,l)))),c=c.next((()=>{(function(p){p.createObjectStore(Ad,{keyPath:ID})})(e)}))),r<5&&i>=5&&(c=c.next((()=>this.yi(l)))),r<6&&i>=6&&(c=c.next((()=>((function(p){p.createObjectStore(Eh)})(e),this.wi(l))))),r<7&&i>=7&&(c=c.next((()=>this.Si(l)))),r<8&&i>=8&&(c=c.next((()=>this.bi(e,l)))),r<9&&i>=9&&(c=c.next((()=>{(function(p){p.objectStoreNames.contains("remoteDocumentChanges")&&p.deleteObjectStore("remoteDocumentChanges")})(e)}))),r<10&&i>=10&&(c=c.next((()=>this.Di(l)))),r<11&&i>=11&&(c=c.next((()=>{(function(p){p.createObjectStore(Sf,{keyPath:ED})})(e),(function(p){p.createObjectStore(jf,{keyPath:TD})})(e)}))),r<12&&i>=12&&(c=c.next((()=>{(function(p){const g=p.createObjectStore(kf,{keyPath:DD});g.createIndex(ay,PD,{unique:!1}),g.createIndex(sI,OD,{unique:!1})})(e)}))),r<13&&i>=13&&(c=c.next((()=>(function(p){const g=p.createObjectStore(Yp,{keyPath:xD});g.createIndex(Tp,yD),g.createIndex(eI,vD)})(e))).next((()=>this.Ci(e,l))).next((()=>e.deleteObjectStore(Ll)))),r<14&&i>=14&&(c=c.next((()=>this.Fi(e,l)))),r<15&&i>=15&&(c=c.next((()=>(function(p){p.createObjectStore(n0,{keyPath:AD,autoIncrement:!0}).createIndex(iy,SD,{unique:!1}),p.createObjectStore(ch,{keyPath:jD}).createIndex(nI,kD,{unique:!1}),p.createObjectStore(dh,{keyPath:CD}).createIndex(rI,RD,{unique:!1})})(e)))),r<16&&i>=16&&(c=c.next((()=>{t.objectStore(ch).clear()})).next((()=>{t.objectStore(dh).clear()}))),r<17&&i>=17&&(c=c.next((()=>{(function(p){p.createObjectStore(r0,{keyPath:MD})})(e)}))),r<18&&i>=18&&HN()&&(c=c.next((()=>{t.objectStore(ch).clear()})).next((()=>{t.objectStore(dh).clear()}))),c}wi(e){let t=0;return e.store(Ll).ee(((r,i)=>{t+=of(i)})).next((()=>{const r={byteSize:t};return e.store(Eh).put(sy,r)}))}yi(e){const t=e.store(Ih),r=e.store(Mi);return t.J().next((i=>ee.forEach(i,(l=>{const c=IDBKeyRange.bound([l.userId,Gl],[l.userId,l.lastAcknowledgedBatchId]);return r.J(ql,c).next((u=>ee.forEach(u,(p=>{rt(p.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:p.batchId});const g=Bl(this.serializer,p);return oE(e,l.userId,g).next((()=>{}))}))))}))))}Si(e){const t=e.store(Td),r=e.store(Ll);return e.store(Kl).get(Jp).next((i=>{const l=[];return r.ee(((c,u)=>{const p=new Gt(c),g=(function(w){return[0,jr(w)]})(p);l.push(t.get(g).next((b=>b?ee.resolve():(w=>t.put({targetId:0,path:jr(w),sequenceNumber:i.highestListenSequenceNumber}))(p))))})).next((()=>ee.waitFor(l)))}))}bi(e,t){e.createObjectStore(Th,{keyPath:ND});const r=t.store(Th),i=new g0,l=c=>{if(i.add(c)){const u=c.lastSegment(),p=c.popLast();return r.put({collectionId:u,parent:jr(p)})}};return t.store(Ll).ee({X:!0},((c,u)=>{const p=new Gt(c);return l(p.popLast())})).next((()=>t.store(Id).ee({X:!0},(([c,u,p],g)=>{const b=ea(u);return l(b.popLast())}))))}Di(e){const t=e.store(Ed);return t.ee(((r,i)=>{const l=Qu(i),c=nE(this.serializer,l);return t.put(c)}))}Ci(e,t){const r=t.store(Ll),i=[];return r.ee(((l,c)=>{const u=t.store(Yp),p=(function(w){return w.document?new Me(Gt.fromString(w.document.name).popFirst(5)):w.noDocument?Me.fromSegments(w.noDocument.path):w.unknownDocument?Me.fromSegments(w.unknownDocument.path):Xe(36783)})(c).path.toArray(),g={prefixPath:p.slice(0,p.length-2),collectionGroup:p[p.length-2],documentId:p[p.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};i.push(u.put(g))})).next((()=>ee.waitFor(i)))}Fi(e,t){const r=t.store(Mi),i=mE(this.serializer),l=new y0(Ff.mi,this.serializer.yt);return r.J().next((c=>{const u=new Map;return c.forEach((p=>{let g=u.get(p.userId)??St();Bl(this.serializer,p).keys().forEach((b=>g=g.add(b))),u.set(p.userId,g)})),ee.forEach(u,((p,g)=>{const b=new gr(g),w=Lf.wt(this.serializer,b),N=l.getIndexManager(b),D=$f.wt(b,this.serializer,N,l.referenceDelegate);return new pE(i,D,w,N).recalculateAndSaveOverlaysForDocumentKeys(new oy(t,si.ce),p).next()}))}))}}function I_(n){n.createObjectStore(Td,{keyPath:wD}).createIndex(t0,_D,{unique:!0}),n.createObjectStore(Ed,{keyPath:"targetId"}).createIndex(tI,bD,{unique:!0}),n.createObjectStore(Kl)}const Po="IndexedDbPersistence",bx=18e5,wx=5e3,_x="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",i4="main";class v0{constructor(e,t,r,i,l,c,u,p,g,b,w=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=l,this.window=c,this.document=u,this.xi=g,this.Oi=b,this.Ni=w,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=N=>Promise.resolve(),!v0.v())throw new Pe(ye.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new HP(this,i),this.$i=t+i4,this.serializer=new tE(p),this.Ui=new Ko(this.$i,this.Ni,new s4(this.serializer)),this.hi=new PP,this.Pi=new UP(this.referenceDelegate,this.serializer),this.remoteDocumentCache=mE(this.serializer),this.Ii=new DP,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,b===!1&&Wr(Po,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Pe(ye.FAILED_PRECONDITION,_x);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new si(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>dp(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(sl(e))return Ae(Po,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Ae(Po,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Lu(e).get(nd).next((t=>ee.resolve(this.es(t))))}ts(e){return dp(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,bx)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const r=er(t,Ad);return r.J().next((i=>{const l=this.ss(i,bx),c=i.filter((u=>l.indexOf(u)===-1));return ee.forEach(c,(u=>r.delete(u.clientId))).next((()=>c))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?ee.resolve(!0):Lu(e).get(nd).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,wx)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new Pe(ye.FAILED_PRECONDITION,_x);return!1}}return!(!this.networkEnabled||!this.inForeground)||dp(e).J().next((r=>this.ss(r,wx).find((i=>{if(this.clientId!==i.clientId){const l=!this.networkEnabled&&i.networkEnabled,c=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(l||c&&u)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&Ae(Po,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Uh,Ad],(e=>{const t=new oy(e,si.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>dp(e).J().next((t=>this.ss(t,bx).map((r=>r.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return $f.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new BP(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Lf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){Ae(Po,"Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",l=(function(p){return p===18?$D:p===17?lI:p===16?LD:p===15?s0:p===14?oI:p===13?aI:p===12?VD:p===11?iI:void Xe(60245)})(this.Ni);let c;return this.Ui.runTransaction(e,i,l,(u=>(c=new oy(u,this.ci?this.ci.next():si.ce),t==="readwrite-primary"?this.Hi(c).next((p=>!!p||this.Yi(c))).next((p=>{if(!p)throw Wr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new Pe(ye.FAILED_PRECONDITION,Y1);return r(c)})).next((p=>this.Xi(c).next((()=>p)))):this.Is(c).next((()=>r(c)))))).then((u=>(c.raiseOnCommittedEvent(),u)))}Is(e){return Lu(e).get(nd).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,wx)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Pe(ye.FAILED_PRECONDITION,_x)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Lu(e).put(nd,t)}static v(){return Ko.v()}Zi(e){const t=Lu(e);return t.get(nd).next((r=>this.es(r)?(Ae(Po,"Releasing primary lease."),t.delete(nd)):ee.resolve()))}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Wr(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;WN()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return Ae(Po,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Wr(Po,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Wr("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Lu(n){return er(n,Uh)}function dp(n){return er(n,Ad)}function a4(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=St(),i=St();for(const l of t.docChanges)switch(l.type){case 0:r=r.add(l.doc.key);break;case 1:i=i.add(l.doc.key)}return new b0(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return WN()?8:X1(Zn())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const l={result:null};return this.ys(e,t).next((c=>{l.result=c})).next((()=>{if(!l.result)return this.ws(e,t,i,r).next((c=>{l.result=c}))})).next((()=>{if(l.result)return;const c=new o4;return this.Ss(e,t,c).next((u=>{if(l.result=u,this.Vs)return this.bs(e,t,c,u.size)}))})).next((()=>l.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(ld()<=Ot.DEBUG&&Ae("QueryEngine","SDK will not create cache indexes for query:",cd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ee.resolve()):(ld()<=Ot.DEBUG&&Ae("QueryEngine","Query:",cd(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(ld()<=Ot.DEBUG&&Ae("QueryEngine","The SDK decides to create cache indexes for query:",cd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ai(t))):ee.resolve())}ys(e,t){if(Kw(t))return ee.resolve(null);let r=ai(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=py(t,null,"F"),r=ai(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((l=>{const c=St(...l);return this.ps.getDocuments(e,c).next((u=>this.indexManager.getMinOffset(e,r).next((p=>{const g=this.Ds(t,u);return this.Cs(t,g,c,p.readTime)?this.ys(e,py(t,null,"F")):this.vs(e,g,t,p)}))))})))))}ws(e,t,r,i){return Kw(t)||i.isEqual(ot.min())?ee.resolve(null):this.ps.getDocuments(e,r).next((l=>{const c=this.Ds(t,l);return this.Cs(t,c,r,i)?ee.resolve(null):(ld()<=Ot.DEBUG&&Ae("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),cd(t)),this.vs(e,c,t,lD(i,wh)).next((u=>u)))}))}Ds(e,t){let r=new Zt(SI(e));return t.forEach(((i,l)=>{Hh(e,l)&&(r=r.add(l))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(i)>0)}Ss(e,t,r){return ld()<=Ot.DEBUG&&Ae("QueryEngine","Using full collection scan to execute query:",cd(t)),this.ps.getDocumentsMatchingQuery(e,t,Ds.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((l=>(t.forEach((c=>{l=l.insert(c.key,c)})),l)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w0="LocalStore",l4=3e8;class c4{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new xn(yt),this.xs=new Qa((l=>ic(l)),zh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new pE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function gE(n,e,t,r){return new c4(n,e,t,r)}async function xE(n,e){const t=vt(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((l=>(i=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((l=>{const c=[],u=[];let p=St();for(const g of i){c.push(g.batchId);for(const b of g.mutations)p=p.add(b.key)}for(const g of l){u.push(g.batchId);for(const b of g.mutations)p=p.add(b.key)}return t.localDocuments.getDocuments(r,p).next((g=>({Ls:g,removedBatchIds:c,addedBatchIds:u})))}))}))}function d4(n,e){const t=vt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,p,g,b){const w=g.batch,N=w.keys();let D=ee.resolve();return N.forEach((z=>{D=D.next((()=>b.getEntry(p,z))).next((L=>{const O=g.docVersions.get(z);rt(O!==null,48541),L.version.compareTo(O)<0&&(w.applyToRemoteDocument(L,g),L.isValidDocument()&&(L.setReadTime(g.commitVersion),b.addEntry(L)))}))})),D.next((()=>u.mutationQueue.removeMutationBatch(p,w)))})(t,r,e,l).next((()=>l.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let p=St();for(let g=0;g<u.mutationResults.length;++g)u.mutationResults[g].transformResults.length>0&&(p=p.add(u.batch.mutations[g].key));return p})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function yE(n){const e=vt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function u4(n,e){const t=vt(n),r=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const c=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const u=[];e.targetChanges.forEach(((b,w)=>{const N=i.get(w);if(!N)return;u.push(t.Pi.removeMatchingKeys(l,b.removedDocuments,w).next((()=>t.Pi.addMatchingKeys(l,b.addedDocuments,w))));let D=N.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(w)!==null?D=D.withResumeToken(qn.EMPTY_BYTE_STRING,ot.min()).withLastLimboFreeSnapshotVersion(ot.min()):b.resumeToken.approximateByteSize()>0&&(D=D.withResumeToken(b.resumeToken,r)),i=i.insert(w,D),(function(L,O,le){return L.resumeToken.approximateByteSize()===0||O.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=l4?!0:le.addedDocuments.size+le.modifiedDocuments.size+le.removedDocuments.size>0})(N,D,b)&&u.push(t.Pi.updateTargetData(l,D))}));let p=Ss(),g=St();if(e.documentUpdates.forEach((b=>{e.resolvedLimboDocuments.has(b)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(l,b))})),u.push(h4(l,c,e.documentUpdates).next((b=>{p=b.ks,g=b.qs}))),!r.isEqual(ot.min())){const b=t.Pi.getLastRemoteSnapshotVersion(l).next((w=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,r)));u.push(b)}return ee.waitFor(u).next((()=>c.apply(l))).next((()=>t.localDocuments.getLocalViewOfDocuments(l,p,g))).next((()=>p))})).then((l=>(t.Ms=i,l)))}function h4(n,e,t){let r=St(),i=St();return t.forEach((l=>r=r.add(l))),e.getEntries(n,r).next((l=>{let c=Ss();return t.forEach(((u,p)=>{const g=l.get(u);p.isFoundDocument()!==g.isFoundDocument()&&(i=i.add(u)),p.isNoDocument()&&p.version.isEqual(ot.min())?(e.removeEntry(u,p.readTime),c=c.insert(u,p)):!g.isValidDocument()||p.version.compareTo(g.version)>0||p.version.compareTo(g.version)===0&&g.hasPendingWrites?(e.addEntry(p),c=c.insert(u,p)):Ae(w0,"Ignoring outdated watch update for ",u,". Current version:",g.version," Watch version:",p.version)})),{ks:c,qs:i}}))}function m4(n,e){const t=vt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Gl),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function p4(n,e){const t=vt(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((l=>l?(i=l,ee.resolve(i)):t.Pi.allocateTargetId(r).next((c=>(i=new Fa(e,c,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function _y(n,e,t){const r=vt(n),i=r.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",l,(c=>r.persistence.referenceDelegate.removeTarget(c,i)))}catch(c){if(!sl(c))throw c;Ae(w0,`Failed to update sequence numbers for target ${e}: ${c}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function E_(n,e,t){const r=vt(n);let i=ot.min(),l=St();return r.persistence.runTransaction("Execute query","readwrite",(c=>(function(p,g,b){const w=vt(p),N=w.xs.get(b);return N!==void 0?ee.resolve(w.Ms.get(N)):w.Pi.getTargetData(g,b)})(r,c,ai(e)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(c,u.targetId).next((p=>{l=p}))})).next((()=>r.Fs.getDocumentsMatchingQuery(c,e,t?i:ot.min(),t?l:St()))).next((u=>(f4(r,eP(e),u),{documents:u,Qs:l})))))}function f4(n,e,t){let r=n.Os.get(e)||ot.min();t.forEach(((i,l)=>{l.readTime.compareTo(r)>0&&(r=l.readTime)})),n.Os.set(e,r)}class T_{constructor(){this.activeTargetIds=aP()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vE{constructor(){this.Mo=new T_,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new T_,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_="ConnectivityMonitor";class S_{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ae(A_,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ae(A_,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let up=null;function Ny(){return up===null?up=(function(){return 268435456+Math.round(2147483648*Math.random())})():up++,"0x"+up.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nx="RestConnection",x4={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class y4{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Xp?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,l){const c=Ny(),u=this.zo(e,t.toUriEncodedString());Ae(Nx,`Sending RPC '${e}' ${c}:`,u,r);const p={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(p,i,l);const{host:g}=new URL(u),b=tl(g);return this.Jo(e,u,p,r,b).then((w=>(Ae(Nx,`Received RPC '${e}' ${c}: `,w),w)),(w=>{throw rc(Nx,`RPC '${e}' ${c} failed with error: `,w,"url: ",u,"request:",r),w}))}Ho(e,t,r,i,l,c){return this.Go(e,t,r,i,l)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+$d})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,l)=>e[l]=i)),r&&r.headers.forEach(((i,l)=>e[l]=i))}zo(e,t){const r=x4[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ir="WebChannelConnection";class b4 extends y4{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,l){const c=Ny();return new Promise(((u,p)=>{const g=new $1;g.setWithCredentials(!0),g.listenOnce(F1.COMPLETE,(()=>{try{switch(g.getLastErrorCode()){case Np.NO_ERROR:const w=g.getResponseJson();Ae(Ir,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(w)),u(w);break;case Np.TIMEOUT:Ae(Ir,`RPC '${e}' ${c} timed out`),p(new Pe(ye.DEADLINE_EXCEEDED,"Request time out"));break;case Np.HTTP_ERROR:const N=g.getStatus();if(Ae(Ir,`RPC '${e}' ${c} failed with status:`,N,"response text:",g.getResponseText()),N>0){let D=g.getResponseJson();Array.isArray(D)&&(D=D[0]);const z=D==null?void 0:D.error;if(z&&z.status&&z.message){const L=(function(le){const ge=le.toLowerCase().replace(/_/g,"-");return Object.values(ye).indexOf(ge)>=0?ge:ye.UNKNOWN})(z.status);p(new Pe(L,z.message))}else p(new Pe(ye.UNKNOWN,"Server responded with status "+g.getStatus()))}else p(new Pe(ye.UNAVAILABLE,"Connection failed."));break;default:Xe(9055,{l_:e,streamId:c,h_:g.getLastErrorCode(),P_:g.getLastError()})}}finally{Ae(Ir,`RPC '${e}' ${c} completed.`)}}));const b=JSON.stringify(i);Ae(Ir,`RPC '${e}' ${c} sending request:`,i),g.send(t,"POST",b,r,15)}))}T_(e,t,r){const i=Ny(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=z1(),u=U1(),p={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(p.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(p.useFetchStreams=!0),this.jo(p.initMessageHeaders,t,r),p.encodeInitMessageHeaders=!0;const b=l.join("");Ae(Ir,`Creating RPC '${e}' stream ${i}: ${b}`,p);const w=c.createWebChannel(b,p);this.I_(w);let N=!1,D=!1;const z=new v4({Yo:O=>{D?Ae(Ir,`Not sending because RPC '${e}' stream ${i} is closed:`,O):(N||(Ae(Ir,`Opening RPC '${e}' stream ${i} transport.`),w.open(),N=!0),Ae(Ir,`RPC '${e}' stream ${i} sending:`,O),w.send(O))},Zo:()=>w.close()}),L=(O,le,ge)=>{O.listen(le,(ae=>{try{ge(ae)}catch(xe){setTimeout((()=>{throw xe}),0)}}))};return L(w,Hu.EventType.OPEN,(()=>{D||(Ae(Ir,`RPC '${e}' stream ${i} transport opened.`),z.o_())})),L(w,Hu.EventType.CLOSE,(()=>{D||(D=!0,Ae(Ir,`RPC '${e}' stream ${i} transport closed`),z.a_(),this.E_(w))})),L(w,Hu.EventType.ERROR,(O=>{D||(D=!0,rc(Ir,`RPC '${e}' stream ${i} transport errored. Name:`,O.name,"Message:",O.message),z.a_(new Pe(ye.UNAVAILABLE,"The operation could not be completed")))})),L(w,Hu.EventType.MESSAGE,(O=>{var le;if(!D){const ge=O.data[0];rt(!!ge,16349);const ae=ge,xe=(ae==null?void 0:ae.error)||((le=ae[0])==null?void 0:le.error);if(xe){Ae(Ir,`RPC '${e}' stream ${i} received error:`,xe);const j=xe.status;let ie=(function(M){const q=Bn[M];if(q!==void 0)return BI(q)})(j),k=xe.message;ie===void 0&&(ie=ye.INTERNAL,k="Unknown error status: "+j+" with message "+xe.message),D=!0,z.a_(new Pe(ie,k)),w.close()}else Ae(Ir,`RPC '${e}' stream ${i} received:`,ge),z.u_(ge)}})),L(u,B1.STAT_EVENT,(O=>{O.stat===ty.PROXY?Ae(Ir,`RPC '${e}' stream ${i} detected buffering proxy`):O.stat===ty.NOPROXY&&Ae(Ir,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{z.__()}),0),z}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w4(){return typeof window<"u"?window:null}function Dp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bf(n){return new _P(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(e,t,r=1e3,i=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&Ae("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j_="PersistentStream";class wE{constructor(e,t,r,i,l,c,u,p){this.Mi=e,this.S_=r,this.b_=i,this.connection=l,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=u,this.listener=p,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new bE(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ye.RESOURCE_EXHAUSTED?(Wr(t.toString()),Wr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ye.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new Pe(ye.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ae(j_,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Ae(j_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class _4 extends wE{constructor(e,t,r,i,l,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,c),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=EP(this.serializer,e),r=(function(l){if(!("targetChange"in l))return ot.min();const c=l.targetChange;return c.targetIds&&c.targetIds.length?ot.min():c.readTime?Gr(c.readTime):ot.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=xy(this.serializer),t.addTarget=(function(l,c){let u;const p=c.target;if(u=ef(p)?{documents:QI(l,p)}:{query:YI(l,p).ft},u.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){u.resumeToken=qI(l,c.resumeToken);const g=fy(l,c.expectedCount);g!==null&&(u.expectedCount=g)}else if(c.snapshotVersion.compareTo(ot.min())>0){u.readTime=Dd(l,c.snapshotVersion.toTimestamp());const g=fy(l,c.expectedCount);g!==null&&(u.expectedCount=g)}return u})(this.serializer,e);const r=AP(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=xy(this.serializer),t.removeTarget=e,this.q_(t)}}class N4 extends wE{constructor(e,t,r,i,l,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,c),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return rt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,rt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){rt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=TP(e.writeResults,e.commitTime),r=Gr(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=xy(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>rf(this.serializer,r)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I4{}class E4 extends I4{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Pe(ye.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,c])=>this.connection.Go(e,gy(t,r),i,l,c))).catch((l=>{throw l.name==="FirebaseError"?(l.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Pe(ye.UNKNOWN,l.toString())}))}Ho(e,t,r,i,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,u])=>this.connection.Ho(e,gy(t,r),i,c,u,l))).catch((c=>{throw c.name==="FirebaseError"?(c.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new Pe(ye.UNKNOWN,c.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class T4{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Wr(t),this.aa=!1):Ae("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dc="RemoteStore";class A4{constructor(e,t,r,i,l){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((c=>{r.enqueueAndForget((async()=>{yc(this)&&(Ae(dc,"Restarting streams for network reachability change."),await(async function(p){const g=vt(p);g.Ea.add(4),await Kh(g),g.Ra.set("Unknown"),g.Ea.delete(4),await Uf(g)})(this))}))})),this.Ra=new T4(r,i)}}async function Uf(n){if(yc(n))for(const e of n.da)await e(!0)}async function Kh(n){for(const e of n.da)await e(!1)}function _E(n,e){const t=vt(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),E0(t)?I0(t):Bd(t).O_()&&N0(t,e))}function _0(n,e){const t=vt(n),r=Bd(t);t.Ia.delete(e),r.O_()&&NE(t,e),t.Ia.size===0&&(r.O_()?r.L_():yc(t)&&t.Ra.set("Unknown"))}function N0(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ot.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bd(n).Y_(e)}function NE(n,e){n.Va.Ue(e),Bd(n).Z_(e)}function I0(n){n.Va=new yP({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Bd(n).start(),n.Ra.ua()}function E0(n){return yc(n)&&!Bd(n).x_()&&n.Ia.size>0}function yc(n){return vt(n).Ea.size===0}function IE(n){n.Va=void 0}async function S4(n){n.Ra.set("Online")}async function j4(n){n.Ia.forEach(((e,t)=>{N0(n,e)}))}async function k4(n,e){IE(n),E0(n)?(n.Ra.ha(e),I0(n)):n.Ra.set("Unknown")}async function C4(n,e,t){if(n.Ra.set("Online"),e instanceof zI&&e.state===2&&e.cause)try{await(async function(i,l){const c=l.cause;for(const u of l.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,c),i.Ia.delete(u),i.Va.removeTarget(u))})(n,e)}catch(r){Ae(dc,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await cf(n,r)}else if(e instanceof Cp?n.Va.Ze(e):e instanceof UI?n.Va.st(e):n.Va.tt(e),!t.isEqual(ot.min()))try{const r=await yE(n.localStore);t.compareTo(r)>=0&&await(function(l,c){const u=l.Va.Tt(c);return u.targetChanges.forEach(((p,g)=>{if(p.resumeToken.approximateByteSize()>0){const b=l.Ia.get(g);b&&l.Ia.set(g,b.withResumeToken(p.resumeToken,c))}})),u.targetMismatches.forEach(((p,g)=>{const b=l.Ia.get(p);if(!b)return;l.Ia.set(p,b.withResumeToken(qn.EMPTY_BYTE_STRING,b.snapshotVersion)),NE(l,p);const w=new Fa(b.target,p,g,b.sequenceNumber);N0(l,w)})),l.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){Ae(dc,"Failed to raise snapshot:",r),await cf(n,r)}}async function cf(n,e,t){if(!sl(e))throw e;n.Ea.add(1),await Kh(n),n.Ra.set("Offline"),t||(t=()=>yE(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Ae(dc,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Uf(n)}))}function EE(n,e){return e().catch((t=>cf(n,t,e)))}async function Qh(n){const e=vt(n),t=Zo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Gl;for(;R4(e);)try{const i=await m4(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,D4(e,i)}catch(i){await cf(e,i)}TE(e)&&AE(e)}function R4(n){return yc(n)&&n.Ta.length<10}function D4(n,e){n.Ta.push(e);const t=Zo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function TE(n){return yc(n)&&!Zo(n).x_()&&n.Ta.length>0}function AE(n){Zo(n).start()}async function P4(n){Zo(n).ra()}async function O4(n){const e=Zo(n);for(const t of n.Ta)e.ea(t.mutations)}async function M4(n,e,t){const r=n.Ta.shift(),i=u0.from(r,e,t);await EE(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await Qh(n)}async function V4(n,e){e&&Zo(n).X_&&await(async function(r,i){if((function(c){return fP(c)&&c!==ye.ABORTED})(i.code)){const l=r.Ta.shift();Zo(r).B_(),await EE(r,(()=>r.remoteSyncer.rejectFailedWrite(l.batchId,i))),await Qh(r)}})(n,e),TE(n)&&AE(n)}async function k_(n,e){const t=vt(n);t.asyncQueue.verifyOperationInProgress(),Ae(dc,"RemoteStore received new credentials");const r=yc(t);t.Ea.add(3),await Kh(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Uf(t)}async function L4(n,e){const t=vt(n);e?(t.Ea.delete(2),await Uf(t)):e||(t.Ea.add(2),await Kh(t),t.Ra.set("Unknown"))}function Bd(n){return n.ma||(n.ma=(function(t,r,i){const l=vt(t);return l.sa(),new _4(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)})(n.datastore,n.asyncQueue,{Xo:S4.bind(null,n),t_:j4.bind(null,n),r_:k4.bind(null,n),H_:C4.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),E0(n)?I0(n):n.Ra.set("Unknown")):(await n.ma.stop(),IE(n))}))),n.ma}function Zo(n){return n.fa||(n.fa=(function(t,r,i){const l=vt(t);return l.sa(),new N4(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:P4.bind(null,n),r_:V4.bind(null,n),ta:O4.bind(null,n),na:M4.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Qh(n)):(await n.fa.stop(),n.Ta.length>0&&(Ae(dc,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(e,t,r,i,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=l,this.deferred=new ia,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,l){const c=Date.now()+r,u=new T0(e,t,c,i,l);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Pe(ye.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function A0(n,e){if(Wr("AsyncQueue",`${e}: ${n}`),sl(n))return new Pe(ye.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{static emptySet(e){return new bd(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Me.comparator(t.key,r.key):(t,r)=>Me.comparator(t.key,r.key),this.keyedMap=Gu(),this.sortedSet=new xn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof bd)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,l=r.getNext().key;if(!i.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new bd;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(){this.ga=new xn(Me.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Xe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Pd{constructor(e,t,r,i,l,c,u,p,g){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=l,this.fromCache=c,this.syncStateChanged=u,this.excludesMetadataChanges=p,this.hasCachedResults=g}static fromInitialDocuments(e,t,r,i,l){const c=[];return t.forEach((u=>{c.push({type:0,doc:u})})),new Pd(e,t,bd.emptySet(t),c,r,i,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Df(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class F4{constructor(){this.queries=R_(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=vt(t),l=i.queries;i.queries=R_(),l.forEach(((c,u)=>{for(const p of u.Sa)p.onError(r)}))})(this,new Pe(ye.ABORTED,"Firestore shutting down"))}}function R_(){return new Qa((n=>AI(n)),Df)}async function S0(n,e){const t=vt(n);let r=3;const i=e.query;let l=t.queries.get(i);l?!l.ba()&&e.Da()&&(r=2):(l=new $4,r=e.Da()?0:1);try{switch(r){case 0:l.wa=await t.onListen(i,!0);break;case 1:l.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(c){const u=A0(c,`Initialization of query '${cd(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&k0(t)}async function j0(n,e){const t=vt(n),r=e.query;let i=3;const l=t.queries.get(r);if(l){const c=l.Sa.indexOf(e);c>=0&&(l.Sa.splice(c,1),l.Sa.length===0?i=e.Da()?0:1:!l.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function B4(n,e){const t=vt(n);let r=!1;for(const i of e){const l=i.query,c=t.queries.get(l);if(c){for(const u of c.Sa)u.Fa(i)&&(r=!0);c.wa=i}}r&&k0(t)}function U4(n,e,t){const r=vt(n),i=r.queries.get(e);if(i)for(const l of i.Sa)l.onError(t);r.queries.delete(e)}function k0(n){n.Ca.forEach((e=>{e.next()}))}var Iy,D_;(D_=Iy||(Iy={})).Ma="default",D_.Cache="cache";class C0{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Pd(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Pd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Iy.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SE{constructor(e){this.key=e}}class jE{constructor(e){this.key=e}}class z4{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=St(),this.mutatedKeys=St(),this.eu=SI(e),this.tu=new bd(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new C_,i=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,c=i,u=!1;const p=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,g=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((b,w)=>{const N=i.get(b),D=Hh(this.query,w)?w:null,z=!!N&&this.mutatedKeys.has(N.key),L=!!D&&(D.hasLocalMutations||this.mutatedKeys.has(D.key)&&D.hasCommittedMutations);let O=!1;N&&D?N.data.isEqual(D.data)?z!==L&&(r.track({type:3,doc:D}),O=!0):this.su(N,D)||(r.track({type:2,doc:D}),O=!0,(p&&this.eu(D,p)>0||g&&this.eu(D,g)<0)&&(u=!0)):!N&&D?(r.track({type:0,doc:D}),O=!0):N&&!D&&(r.track({type:1,doc:N}),O=!0,(p||g)&&(u=!0)),O&&(D?(c=c.add(D),l=L?l.add(b):l.delete(b)):(c=c.delete(b),l=l.delete(b)))})),this.query.limit!==null)for(;c.size>this.query.limit;){const b=this.query.limitType==="F"?c.last():c.first();c=c.delete(b.key),l=l.delete(b.key),r.track({type:1,doc:b})}return{tu:c,iu:r,Cs:u,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort(((b,w)=>(function(D,z){const L=O=>{switch(O){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xe(20277,{Rt:O})}};return L(D)-L(z)})(b.type,w.type)||this.eu(b.doc,w.doc))),this.ou(r),i=i??!1;const u=t&&!i?this._u():[],p=this.Xa.size===0&&this.current&&!i?1:0,g=p!==this.Za;return this.Za=p,c.length!==0||g?{snapshot:new Pd(this.query,e.tu,l,c,e.mutatedKeys,p===0,g,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new C_,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=St(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new jE(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new SE(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=St();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Pd.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const R0="SyncEngine";class q4{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class W4{constructor(e){this.key=e,this.hu=!1}}class H4{constructor(e,t,r,i,l,c){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=l,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new Qa((u=>AI(u)),Df),this.Iu=new Map,this.Eu=new Set,this.du=new xn(Me.comparator),this.Au=new Map,this.Ru=new x0,this.Vu={},this.mu=new Map,this.fu=cc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function G4(n,e,t=!0){const r=OE(n);let i;const l=r.Tu.get(e);return l?(r.sharedClientState.addLocalQueryTarget(l.targetId),i=l.view.lu()):i=await kE(r,e,t,!0),i}async function K4(n,e){const t=OE(n);await kE(t,e,!0,!1)}async function kE(n,e,t,r){const i=await p4(n.localStore,ai(e)),l=i.targetId,c=n.sharedClientState.addLocalQueryTarget(l,t);let u;return r&&(u=await Q4(n,e,l,c==="current",i.resumeToken)),n.isPrimaryClient&&t&&_E(n.remoteStore,i),u}async function Q4(n,e,t,r,i){n.pu=(w,N,D)=>(async function(L,O,le,ge){let ae=O.view.ru(le);ae.Cs&&(ae=await E_(L.localStore,O.query,!1).then((({documents:k})=>O.view.ru(k,ae))));const xe=ge&&ge.targetChanges.get(O.targetId),j=ge&&ge.targetMismatches.get(O.targetId)!=null,ie=O.view.applyChanges(ae,L.isPrimaryClient,xe,j);return O_(L,O.targetId,ie.au),ie.snapshot})(n,w,N,D);const l=await E_(n.localStore,e,!0),c=new z4(e,l.Qs),u=c.ru(l.documents),p=Gh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),g=c.applyChanges(u,n.isPrimaryClient,p);O_(n,t,g.au);const b=new q4(e,t,c);return n.Tu.set(e,b),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),g.snapshot}async function Y4(n,e,t){const r=vt(n),i=r.Tu.get(e),l=r.Iu.get(i.targetId);if(l.length>1)return r.Iu.set(i.targetId,l.filter((c=>!Df(c,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await _y(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&_0(r.remoteStore,i.targetId),Ey(r,i.targetId)})).catch(xc)):(Ey(r,i.targetId),await _y(r.localStore,i.targetId,!0))}async function J4(n,e){const t=vt(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),_0(t.remoteStore,r.targetId))}async function X4(n,e,t){const r=ME(n);try{const i=await(function(c,u){const p=vt(c),g=Jt.now(),b=u.reduce(((D,z)=>D.add(z.key)),St());let w,N;return p.persistence.runTransaction("Locally write mutations","readwrite",(D=>{let z=Ss(),L=St();return p.Ns.getEntries(D,b).next((O=>{z=O,z.forEach(((le,ge)=>{ge.isValidDocument()||(L=L.add(le))}))})).next((()=>p.localDocuments.getOverlayedDocuments(D,z))).next((O=>{w=O;const le=[];for(const ge of u){const ae=mP(ge,w.get(ge.key).overlayedDocument);ae!=null&&le.push(new Ya(ge.key,ae,yI(ae.value.mapValue),Ar.exists(!0)))}return p.mutationQueue.addMutationBatch(D,g,le,u)})).next((O=>{N=O;const le=O.applyToLocalDocumentSet(w,L);return p.documentOverlayCache.saveOverlays(D,O.batchId,le)}))})).then((()=>({batchId:N.batchId,changes:kI(w)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(c,u,p){let g=c.Vu[c.currentUser.toKey()];g||(g=new xn(yt)),g=g.insert(u,p),c.Vu[c.currentUser.toKey()]=g})(r,i.batchId,t),await Yh(r,i.changes),await Qh(r.remoteStore)}catch(i){const l=A0(i,"Failed to persist write");t.reject(l)}}async function CE(n,e){const t=vt(n);try{const r=await u4(t.localStore,e);e.targetChanges.forEach(((i,l)=>{const c=t.Au.get(l);c&&(rt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?c.hu=!0:i.modifiedDocuments.size>0?rt(c.hu,14607):i.removedDocuments.size>0&&(rt(c.hu,42227),c.hu=!1))})),await Yh(t,r,e)}catch(r){await xc(r)}}function P_(n,e,t){const r=vt(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((l,c)=>{const u=c.view.va(e);u.snapshot&&i.push(u.snapshot)})),(function(c,u){const p=vt(c);p.onlineState=u;let g=!1;p.queries.forEach(((b,w)=>{for(const N of w.Sa)N.va(u)&&(g=!0)})),g&&k0(p)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Z4(n,e,t){const r=vt(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),l=i&&i.key;if(l){let c=new xn(Me.comparator);c=c.insert(l,kn.newNoDocument(l,ot.min()));const u=St().add(l),p=new Vf(ot.min(),new Map,new xn(yt),c,u);await CE(r,p),r.du=r.du.remove(l),r.Au.delete(e),D0(r)}else await _y(r.localStore,e,!1).then((()=>Ey(r,e,t))).catch(xc)}async function e5(n,e){const t=vt(n),r=e.batch.batchId;try{const i=await d4(t.localStore,e);DE(t,r,null),RE(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Yh(t,i)}catch(i){await xc(i)}}async function t5(n,e,t){const r=vt(n);try{const i=await(function(c,u){const p=vt(c);return p.persistence.runTransaction("Reject batch","readwrite-primary",(g=>{let b;return p.mutationQueue.lookupMutationBatch(g,u).next((w=>(rt(w!==null,37113),b=w.keys(),p.mutationQueue.removeMutationBatch(g,w)))).next((()=>p.mutationQueue.performConsistencyCheck(g))).next((()=>p.documentOverlayCache.removeOverlaysForBatchId(g,b,u))).next((()=>p.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,b))).next((()=>p.localDocuments.getDocuments(g,b)))}))})(r.localStore,e);DE(r,e,t),RE(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Yh(r,i)}catch(i){await xc(i)}}function RE(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function DE(n,e,t){const r=vt(n);let i=r.Vu[r.currentUser.toKey()];if(i){const l=i.get(e);l&&(t?l.reject(t):l.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Ey(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||PE(n,r)}))}function PE(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(_0(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),D0(n))}function O_(n,e,t){for(const r of t)r instanceof SE?(n.Ru.addReference(r.key,e),n5(n,r)):r instanceof jE?(Ae(R0,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||PE(n,r.key)):Xe(19791,{wu:r})}function n5(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Ae(R0,"New document in limbo: "+t),n.Eu.add(r),D0(n))}function D0(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Me(Gt.fromString(e)),r=n.fu.next();n.Au.set(r,new W4(t)),n.du=n.du.insert(t,r),_E(n.remoteStore,new Fa(ai(Wh(t.path)),r,"TargetPurposeLimboResolution",si.ce))}}async function Yh(n,e,t){const r=vt(n),i=[],l=[],c=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,p)=>{c.push(r.pu(p,e,t).then((g=>{var b;if((g||t)&&r.isPrimaryClient){const w=g?!g.fromCache:(b=t==null?void 0:t.targetChanges.get(p.targetId))==null?void 0:b.current;r.sharedClientState.updateQueryState(p.targetId,w?"current":"not-current")}if(g){i.push(g);const w=b0.As(p.targetId,g);l.push(w)}})))})),await Promise.all(c),r.Pu.H_(i),await(async function(p,g){const b=vt(p);try{await b.persistence.runTransaction("notifyLocalViewChanges","readwrite",(w=>ee.forEach(g,(N=>ee.forEach(N.Es,(D=>b.persistence.referenceDelegate.addReference(w,N.targetId,D))).next((()=>ee.forEach(N.ds,(D=>b.persistence.referenceDelegate.removeReference(w,N.targetId,D)))))))))}catch(w){if(!sl(w))throw w;Ae(w0,"Failed to update sequence numbers: "+w)}for(const w of g){const N=w.targetId;if(!w.fromCache){const D=b.Ms.get(N),z=D.snapshotVersion,L=D.withLastLimboFreeSnapshotVersion(z);b.Ms=b.Ms.insert(N,L)}}})(r.localStore,l))}async function r5(n,e){const t=vt(n);if(!t.currentUser.isEqual(e)){Ae(R0,"User change. New user:",e.toKey());const r=await xE(t.localStore,e);t.currentUser=e,(function(l,c){l.mu.forEach((u=>{u.forEach((p=>{p.reject(new Pe(ye.CANCELLED,c))}))})),l.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Yh(t,r.Ls)}}function s5(n,e){const t=vt(n),r=t.Au.get(e);if(r&&r.hu)return St().add(r.key);{let i=St();const l=t.Iu.get(e);if(!l)return i;for(const c of l){const u=t.Tu.get(c);i=i.unionWith(u.view.nu)}return i}}function OE(n){const e=vt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=CE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=s5.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Z4.bind(null,e),e.Pu.H_=B4.bind(null,e.eventManager),e.Pu.yu=U4.bind(null,e.eventManager),e}function ME(n){const e=vt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=e5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=t5.bind(null,e),e}class Dh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Bf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return gE(this.persistence,new fE,e.initialUser,this.serializer)}Cu(e){return new y0(Ff.mi,this.serializer)}Du(e){return new vE}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Dh.provider={build:()=>new Dh};class i5 extends Dh{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){rt(this.persistence.referenceDelegate instanceof lf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new dE(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Er.withCacheSize(this.cacheSizeBytes):Er.DEFAULT;return new y0((r=>lf.mi(r,t)),this.serializer)}}class a5 extends Dh{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await ME(this.xu.syncEngine),await Qh(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return gE(this.persistence,new fE,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new dE(r,e.asyncQueue,t)}Mu(e,t){const r=new hD(t,this.persistence);return new uD(e.asyncQueue,r)}Cu(e){const t=a4(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Er.withCacheSize(this.cacheSizeBytes):Er.DEFAULT;return new v0(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,w4(),Dp(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new vE}}class df{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>P_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=r5.bind(null,this.syncEngine),await L4(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new F4})()}createDatastore(e){const t=Bf(e.databaseInfo.databaseId),r=(function(l){return new b4(l)})(e.databaseInfo);return(function(l,c,u,p){return new E4(l,c,u,p)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,l,c,u){return new A4(r,i,l,c,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>P_(this.syncEngine,t,0)),(function(){return S_.v()?new S_:new g4})())}createSyncEngine(e,t){return(function(i,l,c,u,p,g,b){const w=new H4(i,l,c,u,p,g);return b&&(w.gu=!0),w})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(i){const l=vt(i);Ae(dc,"RemoteStore shutting down."),l.Ea.add(5),await Kh(l),l.Aa.shutdown(),l.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}df.provider={build:()=>new df};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Wr("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el="FirestoreClient";class o5{constructor(e,t,r,i,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=gr.UNAUTHENTICATED,this.clientId=Xy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(r,(async c=>{Ae(el,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,(c=>(Ae(el,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ia;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=A0(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ix(n,e){n.asyncQueue.verifyOperationInProgress(),Ae(el,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await xE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function M_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await l5(n);Ae(el,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>k_(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>k_(e.remoteStore,i))),n._onlineComponents=e}async function l5(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ae(el,"Using user provided OfflineComponentProvider");try{await Ix(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===ye.FAILED_PRECONDITION||i.code===ye.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;rc("Error using user provided cache. Falling back to memory cache: "+t),await Ix(n,new Dh)}}else Ae(el,"Using default OfflineComponentProvider"),await Ix(n,new i5(void 0));return n._offlineComponents}async function VE(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ae(el,"Using user provided OnlineComponentProvider"),await M_(n,n._uninitializedComponentsProvider._online)):(Ae(el,"Using default OnlineComponentProvider"),await M_(n,new df))),n._onlineComponents}function c5(n){return VE(n).then((e=>e.syncEngine))}async function uf(n){const e=await VE(n),t=e.eventManager;return t.onListen=G4.bind(null,e.syncEngine),t.onUnlisten=Y4.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=K4.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=J4.bind(null,e.syncEngine),t}function d5(n,e,t={}){const r=new ia;return n.asyncQueue.enqueueAndForget((async()=>(function(l,c,u,p,g){const b=new P0({next:N=>{b.Nu(),c.enqueueAndForget((()=>j0(l,w)));const D=N.docs.has(u);!D&&N.fromCache?g.reject(new Pe(ye.UNAVAILABLE,"Failed to get document because the client is offline.")):D&&N.fromCache&&p&&p.source==="server"?g.reject(new Pe(ye.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):g.resolve(N)},error:N=>g.reject(N)}),w=new C0(Wh(u.path),b,{includeMetadataChanges:!0,qa:!0});return S0(l,w)})(await uf(n),n.asyncQueue,e,t,r))),r.promise}function u5(n,e,t={}){const r=new ia;return n.asyncQueue.enqueueAndForget((async()=>(function(l,c,u,p,g){const b=new P0({next:N=>{b.Nu(),c.enqueueAndForget((()=>j0(l,w))),N.fromCache&&p.source==="server"?g.reject(new Pe(ye.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):g.resolve(N)},error:N=>g.reject(N)}),w=new C0(u,b,{includeMetadataChanges:!0,qa:!0});return S0(l,w)})(await uf(n),n.asyncQueue,e,t,r))),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $E="firestore.googleapis.com",L_=!0;class $_{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Pe(ye.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=$E,this.ssl=L_}else this.host=e.host,this.ssl=e.ssl??L_;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=aE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<zP)throw new Pe(ye.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}oD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LE(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Pe(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Pe(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Pe(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zf{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $_({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Pe(ye.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Pe(ye.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $_(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new JR;switch(r.type){case"firstParty":return new tD(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Pe(ye.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=V_.get(t);r&&(Ae("ComponentProvider","Removing Datastore"),V_.delete(t),r.terminate())})(this),Promise.resolve()}}function h5(n,e,t,r={}){var g;n=Hr(n,zf);const i=tl(e),l=n._getSettings(),c={...l,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;i&&(Vy(`https://${u}`),Ly("Firestore",!0)),l.host!==$E&&l.host!==u&&rc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const p={...l,host:u,ssl:i,emulatorOptions:r};if(!za(p,c)&&(n._setSettings(p),r.mockUserToken)){let b,w;if(typeof r.mockUserToken=="string")b=r.mockUserToken,w=gr.MOCK_USER;else{b=UN(r.mockUserToken,(g=n._app)==null?void 0:g.options.projectId);const N=r.mockUserToken.sub||r.mockUserToken.user_id;if(!N)throw new Pe(ye.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new gr(N)}n._authCredentials=new XR(new W1(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new vc(this.firestore,e,this._query)}}class Cn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Qo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Cn(this.firestore,e,this._key)}toJSON(){return{type:Cn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Bh(t,Cn._jsonSchema))return new Cn(e,r||null,new Me(Gt.fromString(t.referencePath)))}}Cn._jsonSchemaVersion="firestore/documentReference/1.0",Cn._jsonSchema={type:zn("string",Cn._jsonSchemaVersion),referencePath:zn("string")};class Qo extends vc{constructor(e,t,r){super(e,t,Wh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Cn(this.firestore,null,new Me(e))}withConverter(e){return new Qo(this.firestore,e,this._path)}}function hn(n,e,...t){if(n=Kt(n),G1("collection","path",e),n instanceof zf){const r=Gt.fromString(e,...t);return jw(r),new Qo(n,null,r)}{if(!(n instanceof Cn||n instanceof Qo))throw new Pe(ye.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Gt.fromString(e,...t));return jw(r),new Qo(n.firestore,null,r)}}function bt(n,e,...t){if(n=Kt(n),arguments.length===1&&(e=Xy.newId()),G1("doc","path",e),n instanceof zf){const r=Gt.fromString(e,...t);return Sw(r),new Cn(n,null,new Me(r))}{if(!(n instanceof Cn||n instanceof Qo))throw new Pe(ye.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Gt.fromString(e,...t));return Sw(r),new Cn(n.firestore,n instanceof Qo?n.converter:null,new Me(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_="AsyncQueue";class B_{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new bE(this,"async_queue_retry"),this._c=()=>{const r=Dp();r&&Ae(F_,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Dp();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Dp();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new ia;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!sl(e))throw e;Ae(F_,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Wr("INTERNAL UNHANDLED ERROR: ",U_(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=T0.createAndSchedule(this,e,t,r,(l=>this.hc(l)));return this.tc.push(i),i}uc(){this.nc&&Xe(47125,{Pc:U_(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function U_(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z_(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const l of r)if(l in i&&typeof i[l]=="function")return!0;return!1})(n,["next","error","complete"])}class ca extends zf{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new B_,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new B_(e),this._firestoreClient=void 0,await e}}}function FE(n,e){const t=typeof n=="object"?n:Mh(),r=typeof n=="string"?n:Xp,i=Ka(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const l=$N("firestore");l&&h5(i,...l)}return i}function qf(n){if(n._terminated)throw new Pe(ye.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||BE(n),n._firestoreClient}function BE(n){var r,i,l;const e=n._freezeSettings(),t=(function(u,p,g,b){return new BD(u,p,g,b.host,b.ssl,b.experimentalForceLongPolling,b.experimentalAutoDetectLongPolling,LE(b.experimentalLongPollingOptions),b.useFetchStreams,b.isUsingEmulator)})(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((l=e.localCache)!=null&&l._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new o5(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(u){const p=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(p),_online:p}})(n._componentsProvider))}function m5(n,e){rc("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return p5(n,df.provider,{build:r=>new a5(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function p5(n,e,t){if((n=Hr(n,ca))._firestoreClient||n._terminated)throw new Pe(ye.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Pe(ye.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},BE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ri(qn.fromBase64String(e))}catch(t){throw new Pe(ye.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ri(qn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ri._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Bh(e,ri._jsonSchema))return ri.fromBase64String(e.bytes)}}ri._jsonSchemaVersion="firestore/bytes/1.0",ri._jsonSchema={type:zn("string",ri._jsonSchemaVersion),bytes:zn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Pe(ye.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Nn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Pe(ye.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Pe(ye.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return yt(this._lat,e._lat)||yt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:aa._jsonSchemaVersion}}static fromJSON(e){if(Bh(e,aa._jsonSchema))return new aa(e.latitude,e.longitude)}}aa._jsonSchemaVersion="firestore/geoPoint/1.0",aa._jsonSchema={type:zn("string",aa._jsonSchemaVersion),latitude:zn("number"),longitude:zn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let l=0;l<r.length;++l)if(r[l]!==i[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:oa._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Bh(e,oa._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new oa(e.vectorValues);throw new Pe(ye.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}oa._jsonSchemaVersion="firestore/vectorValue/1.0",oa._jsonSchema={type:zn("string",oa._jsonSchemaVersion),vectorValues:zn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f5=/^__.*__$/;class g5{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ya(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fd(e,this.data,t,this.fieldTransforms)}}class UE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ya(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function zE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xe(40011,{Ac:n})}}class Gf{constructor(e,t,r,i,l,c){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Gf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return hf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(zE(this.Ac)&&f5.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class x5{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Bf(e)}Cc(e,t,r,i=!1){return new Gf({Ac:e,methodName:t,Dc:r,path:Nn.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kf(n){const e=n._freezeSettings(),t=Bf(n._databaseId);return new x5(n._databaseId,!!e.ignoreUndefinedProperties,t)}function qE(n,e,t,r,i,l={}){const c=n.Cc(l.merge||l.mergeFields?2:0,e,t,i);M0("Data must be an object, but it was:",c,r);const u=WE(r,c);let p,g;if(l.merge)p=new ds(c.fieldMask),g=c.fieldTransforms;else if(l.mergeFields){const b=[];for(const w of l.mergeFields){const N=Ty(e,w,t);if(!c.contains(N))throw new Pe(ye.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);GE(b,N)||b.push(N)}p=new ds(b),g=c.fieldTransforms.filter((w=>p.covers(w.field)))}else p=null,g=c.fieldTransforms;return new g5(new Tr(u),p,g)}class Qf extends Hf{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Qf}}function y5(n,e,t){return new Gf({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class O0 extends Hf{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=y5(this,e,!0),r=this.vc.map((l=>Ud(l,t))),i=new ac(r);return new VI(e.path,i)}isEqual(e){return e instanceof O0&&za(this.vc,e.vc)}}function v5(n,e,t,r){const i=n.Cc(1,e,t);M0("Data must be an object, but it was:",i,r);const l=[],c=Tr.empty();il(r,((p,g)=>{const b=V0(e,p,t);g=Kt(g);const w=i.yc(b);if(g instanceof Qf)l.push(b);else{const N=Ud(g,w);N!=null&&(l.push(b),c.set(b,N))}}));const u=new ds(l);return new UE(c,u,i.fieldTransforms)}function b5(n,e,t,r,i,l){const c=n.Cc(1,e,t),u=[Ty(e,r,t)],p=[i];if(l.length%2!=0)throw new Pe(ye.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<l.length;N+=2)u.push(Ty(e,l[N])),p.push(l[N+1]);const g=[],b=Tr.empty();for(let N=u.length-1;N>=0;--N)if(!GE(g,u[N])){const D=u[N];let z=p[N];z=Kt(z);const L=c.yc(D);if(z instanceof Qf)g.push(D);else{const O=Ud(z,L);O!=null&&(g.push(D),b.set(D,O))}}const w=new ds(g);return new UE(b,w,c.fieldTransforms)}function w5(n,e,t,r=!1){return Ud(t,n.Cc(r?4:3,e))}function Ud(n,e){if(HE(n=Kt(n)))return M0("Unsupported field value:",e,n),WE(n,e);if(n instanceof Hf)return(function(r,i){if(!zE(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const l=r._toFieldTransform(i);l&&i.fieldTransforms.push(l)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const l=[];let c=0;for(const u of r){let p=Ud(u,i.wc(c));p==null&&(p={nullValue:"NULL_VALUE"}),l.push(p),c++}return{arrayValue:{values:l}}})(n,e)}return(function(r,i){if((r=Kt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return oP(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const l=Jt.fromDate(r);return{timestampValue:Dd(i.serializer,l)}}if(r instanceof Jt){const l=new Jt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Dd(i.serializer,l)}}if(r instanceof aa)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ri)return{bytesValue:qI(i.serializer,r._byteString)};if(r instanceof Cn){const l=i.databaseId,c=r.firestore._databaseId;if(!c.isEqual(l))throw i.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:p0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof oa)return(function(c,u){return{mapValue:{fields:{[a0]:{stringValue:o0},[Sd]:{arrayValue:{values:c.toArray().map((g=>{if(typeof g!="number")throw u.Sc("VectorValues must only contain numeric values.");return c0(u.serializer,g)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Ef(r)}`)})(n,e)}function WE(n,e){const t={};return cI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):il(n,((r,i)=>{const l=Ud(i,e.mc(r));l!=null&&(t[r]=l)})),{mapValue:{fields:t}}}function HE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Jt||n instanceof aa||n instanceof ri||n instanceof Cn||n instanceof Hf||n instanceof oa)}function M0(n,e,t){if(!HE(t)||!K1(t)){const r=Ef(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Ty(n,e,t){if((e=Kt(e))instanceof Wf)return e._internalPath;if(typeof e=="string")return V0(n,e);throw hf("Field path arguments must be of type string or ",n,!1,void 0,t)}const _5=new RegExp("[~\\*/\\[\\]]");function V0(n,e,t){if(e.search(_5)>=0)throw hf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Wf(...e.split("."))._internalPath}catch{throw hf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function hf(n,e,t,r,i){const l=r&&!r.isEmpty(),c=i!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let p="";return(l||c)&&(p+=" (found",l&&(p+=` in field ${r}`),c&&(p+=` in document ${i}`),p+=")"),new Pe(ye.INVALID_ARGUMENT,u+n+p)}function GE(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KE{constructor(e,t,r,i,l){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new Cn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new N5(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(L0("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class N5 extends KE{data(){return super.data()}}function L0(n,e){return typeof e=="string"?V0(n,e):e instanceof Wf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Pe(ye.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class $0{}class I5 extends $0{}function Ps(n,e,...t){let r=[];e instanceof $0&&r.push(e),r=r.concat(t),(function(l){const c=l.filter((p=>p instanceof F0)).length,u=l.filter((p=>p instanceof Yf)).length;if(c>1||c>0&&u>0)throw new Pe(ye.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)n=i._apply(n);return n}class Yf extends I5{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Yf(e,t,r)}_apply(e){const t=this._parse(e);return YE(e._query,t),new vc(e.firestore,e.converter,my(e._query,t))}_parse(e){const t=Kf(e.firestore);return(function(l,c,u,p,g,b,w){let N;if(g.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new Pe(ye.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on documentId().`);if(b==="in"||b==="not-in"){W_(w,b);const z=[];for(const L of w)z.push(q_(p,l,L));N={arrayValue:{values:z}}}else N=q_(p,l,w)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||W_(w,b),N=w5(u,c,w,b==="in"||b==="not-in");return Mt.create(g,b,N)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function bc(n,e,t){const r=e,i=L0("where",n);return Yf._create(i,r,t)}class F0 extends $0{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new F0(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:Xt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,l){let c=i;const u=l.getFlattenedFilters();for(const p of u)YE(c,p),c=my(c,p)})(e._query,t),new vc(e.firestore,e.converter,my(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function q_(n,e,t){if(typeof(t=Kt(t))=="string"){if(t==="")throw new Pe(ye.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!TI(e)&&t.indexOf("/")!==-1)throw new Pe(ye.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Gt.fromString(t));if(!Me.isDocumentKey(r))throw new Pe(ye.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return jh(n,new Me(r))}if(t instanceof Cn)return jh(n,t._key);throw new Pe(ye.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ef(t)}.`)}function W_(n,e){if(!Array.isArray(n)||n.length===0)throw new Pe(ye.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function YE(n,e){const t=(function(i,l){for(const c of i)for(const u of c.getFlattenedFilters())if(l.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new Pe(ye.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Pe(ye.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class E5{convertValue(e,t="none"){switch(Jo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return gn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ga(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Xe(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return il(e,((i,l)=>{r[i]=this.convertValue(l,t)})),r}convertVectorValue(e){var r,i,l;const t=(l=(i=(r=e.fields)==null?void 0:r[Sd].arrayValue)==null?void 0:i.values)==null?void 0:l.map((c=>gn(c.doubleValue)));return new oa(t)}convertGeoPoint(e){return new aa(gn(e.latitude),gn(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Cf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ah(e));default:return null}}convertTimestamp(e){const t=Ha(e);return new Jt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Gt.fromString(e);rt(eE(r),9688,{name:e});const i=new sc(r.get(1),r.get(3)),l=new Me(r.popFirst(5));return i.isEqual(t)||Wr(`Document ${l} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Yu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Yl extends KE{constructor(e,t,r,i,l,c){super(e,t,r,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Pp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(L0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(ye.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Yl._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Yl._jsonSchemaVersion="firestore/documentSnapshot/1.0",Yl._jsonSchema={type:zn("string",Yl._jsonSchemaVersion),bundleSource:zn("string","DocumentSnapshot"),bundleName:zn("string"),bundle:zn("string")};class Pp extends Yl{data(e={}){return super.data(e)}}class Jl{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Yu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Pp(this._firestore,this._userDataWriter,r.key,r,new Yu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Pe(ye.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,l){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map((u=>{const p=new Pp(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Yu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:p,oldIndex:-1,newIndex:c++}}))}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>l||u.type!==3)).map((u=>{const p=new Pp(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Yu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let g=-1,b=-1;return u.type!==0&&(g=c.indexOf(u.doc.key),c=c.delete(u.doc.key)),u.type!==1&&(c=c.add(u.doc),b=c.indexOf(u.doc.key)),{type:T5(u.type),doc:p,oldIndex:g,newIndex:b}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(ye.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Jl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Xy.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((l=>{l._document!==null&&(t.push(l._document),r.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),i.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function T5(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xe(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(n){n=Hr(n,Cn);const e=Hr(n.firestore,ca);return d5(qf(e),n._key).then((t=>ZE(e,n,t)))}Jl._jsonSchemaVersion="firestore/querySnapshot/1.0",Jl._jsonSchema={type:zn("string",Jl._jsonSchemaVersion),bundleSource:zn("string","QuerySnapshot"),bundleName:zn("string"),bundle:zn("string")};class B0 extends E5{constructor(e){super(),this.firestore=e}convertBytes(e){return new ri(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Cn(this.firestore,null,t)}}function XE(n){n=Hr(n,vc);const e=Hr(n.firestore,ca),t=qf(e),r=new B0(e);return QE(n._query),u5(t,n._query).then((i=>new Jl(e,r,n,i)))}function Os(n,e,t){n=Hr(n,Cn);const r=Hr(n.firestore,ca),i=JE(n.converter,e,t);return Jf(r,[qE(Kf(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ar.none())])}function kr(n,e,t,...r){n=Hr(n,Cn);const i=Hr(n.firestore,ca),l=Kf(i);let c;return c=typeof(e=Kt(e))=="string"||e instanceof Wf?b5(l,"updateDoc",n._key,e,t,r):v5(l,"updateDoc",n._key,e),Jf(i,[c.toMutation(n._key,Ar.exists(!0))])}function uc(n){return Jf(Hr(n.firestore,ca),[new Mf(n._key,Ar.none())])}function A5(n,e){const t=Hr(n.firestore,ca),r=bt(n),i=JE(n.converter,e);return Jf(t,[qE(Kf(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ar.exists(!1))]).then((()=>r))}function ci(n,...e){var p,g,b;n=Kt(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||z_(e[r])||(t=e[r++]);const i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(z_(e[r])){const w=e[r];e[r]=(p=w.next)==null?void 0:p.bind(w),e[r+1]=(g=w.error)==null?void 0:g.bind(w),e[r+2]=(b=w.complete)==null?void 0:b.bind(w)}let l,c,u;if(n instanceof Cn)c=Hr(n.firestore,ca),u=Wh(n._key.path),l={next:w=>{e[r]&&e[r](ZE(c,n,w))},error:e[r+1],complete:e[r+2]};else{const w=Hr(n,vc);c=Hr(w.firestore,ca),u=w._query;const N=new B0(c);l={next:D=>{e[r]&&e[r](new Jl(c,N,w,D))},error:e[r+1],complete:e[r+2]},QE(n._query)}return(function(N,D,z,L){const O=new P0(L),le=new C0(D,O,z);return N.asyncQueue.enqueueAndForget((async()=>S0(await uf(N),le))),()=>{O.Nu(),N.asyncQueue.enqueueAndForget((async()=>j0(await uf(N),le)))}})(qf(c),u,i,l)}function Jf(n,e){return(function(r,i){const l=new ia;return r.asyncQueue.enqueueAndForget((async()=>X4(await c5(r),i,l))),l.promise})(qf(n),e)}function ZE(n,e,t){const r=t.docs.get(e._key),i=new B0(n);return new Yl(n,i,e._key,r,new Yu(t.hasPendingWrites,t.fromCache),e.converter)}function hc(...n){return new O0("arrayUnion",n)}(function(e,t=!0){(function(i){$d=i})(gc),Rs(new us("firestore",((r,{instanceIdentifier:i,options:l})=>{const c=r.getProvider("app").getImmediate(),u=new ca(new ZR(r.getProvider("auth-internal")),new nD(c,r.getProvider("app-check-internal")),(function(g,b){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new Pe(ye.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sc(g.options.projectId,b)})(c,i),c);return l={useFetchStreams:t,...l},u._setSettings(l),u}),"PUBLIC").setMultipleInstances(!0)),Sr(Iw,Ew,e),Sr(Iw,Ew,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT="firebasestorage.googleapis.com",tT="storageBucket",S5=120*1e3,j5=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn extends oi{constructor(e,t,r=0){super(Ex(e),`Firebase Storage: ${t} (${Ex(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Dn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ex(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Rn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Rn||(Rn={}));function Ex(n){return"storage/"+n}function U0(){const n="An unknown error occurred, please check the error payload for server response.";return new Dn(Rn.UNKNOWN,n)}function k5(n){return new Dn(Rn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function C5(n){return new Dn(Rn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function R5(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Dn(Rn.UNAUTHENTICATED,n)}function D5(){return new Dn(Rn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function P5(n){return new Dn(Rn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function O5(){return new Dn(Rn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function M5(){return new Dn(Rn.CANCELED,"User canceled the upload/download.")}function V5(n){return new Dn(Rn.INVALID_URL,"Invalid URL '"+n+"'.")}function L5(n){return new Dn(Rn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function $5(){return new Dn(Rn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+tT+"' property when initializing the app?")}function F5(){return new Dn(Rn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function B5(){return new Dn(Rn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function U5(n){return new Dn(Rn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ay(n){return new Dn(Rn.INVALID_ARGUMENT,n)}function nT(){return new Dn(Rn.APP_DELETED,"The Firebase app was deleted.")}function z5(n){return new Dn(Rn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function fh(n,e){return new Dn(Rn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function $u(n){throw new Dn(Rn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=js.makeFromUrl(e,t)}catch{return new js(e,"")}if(r.path==="")return r;throw L5(e)}static makeFromUrl(e,t){let r=null;const i="([A-Za-z0-9.\\-_]+)";function l(xe){xe.path.charAt(xe.path.length-1)==="/"&&(xe.path_=xe.path_.slice(0,-1))}const c="(/(.*))?$",u=new RegExp("^gs://"+i+c,"i"),p={bucket:1,path:3};function g(xe){xe.path_=decodeURIComponent(xe.path)}const b="v[A-Za-z0-9_]+",w=t.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",D=new RegExp(`^https?://${w}/${b}/b/${i}/o${N}`,"i"),z={bucket:1,path:3},L=t===eT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,O="([^?#]*)",le=new RegExp(`^https?://${L}/${i}/${O}`,"i"),ae=[{regex:u,indices:p,postModify:l},{regex:D,indices:z,postModify:g},{regex:le,indices:{bucket:1,path:2},postModify:g}];for(let xe=0;xe<ae.length;xe++){const j=ae[xe],ie=j.regex.exec(e);if(ie){const k=ie[j.indices.bucket];let R=ie[j.indices.path];R||(R=""),r=new js(k,R),j.postModify(r);break}}if(r==null)throw V5(e);return r}}class q5{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W5(n,e,t){let r=1,i=null,l=null,c=!1,u=0;function p(){return u===2}let g=!1;function b(...O){g||(g=!0,e.apply(null,O))}function w(O){i=setTimeout(()=>{i=null,n(D,p())},O)}function N(){l&&clearTimeout(l)}function D(O,...le){if(g){N();return}if(O){N(),b.call(null,O,...le);return}if(p()||c){N(),b.call(null,O,...le);return}r<64&&(r*=2);let ae;u===1?(u=2,ae=0):ae=(r+Math.random())*1e3,w(ae)}let z=!1;function L(O){z||(z=!0,N(),!g&&(i!==null?(O||(u=2),clearTimeout(i),w(0)):O||(u=1)))}return w(0),l=setTimeout(()=>{c=!0,L(!0)},t),L}function H5(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G5(n){return n!==void 0}function K5(n){return typeof n=="object"&&!Array.isArray(n)}function z0(n){return typeof n=="string"||n instanceof String}function H_(n){return q0()&&n instanceof Blob}function q0(){return typeof Blob<"u"}function G_(n,e,t,r){if(r<e)throw Ay(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Ay(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W0(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function rT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var Xl;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Xl||(Xl={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q5(n,e){const t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,l=e.indexOf(n)!==-1;return t||i||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y5{constructor(e,t,r,i,l,c,u,p,g,b,w,N=!0,D=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=l,this.additionalRetryCodes_=c,this.callback_=u,this.errorCallback_=p,this.timeout_=g,this.progressCallback_=b,this.connectionFactory_=w,this.retry=N,this.isUsingEmulator=D,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((z,L)=>{this.resolve_=z,this.reject_=L,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new hp(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const c=u=>{const p=u.loaded,g=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(p,g)};this.progressCallback_!==null&&l.addUploadProgressListener(c),l.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(c),this.pendingConnection_=null;const u=l.getErrorCode()===Xl.NO_ERROR,p=l.getStatus();if(!u||Q5(p,this.additionalRetryCodes_)&&this.retry){const b=l.getErrorCode()===Xl.ABORT;r(!1,new hp(!1,null,b));return}const g=this.successCodes_.indexOf(p)!==-1;r(!0,new hp(g,l))})},t=(r,i)=>{const l=this.resolve_,c=this.reject_,u=i.connection;if(i.wasSuccessCode)try{const p=this.callback_(u,u.getResponse());G5(p)?l(p):l()}catch(p){c(p)}else if(u!==null){const p=U0();p.serverResponse=u.getErrorText(),this.errorCallback_?c(this.errorCallback_(u,p)):c(p)}else if(i.canceled){const p=this.appDelete_?nT():M5();c(p)}else{const p=O5();c(p)}};this.canceled_?t(!1,new hp(!1,null,!0)):this.backoffId_=W5(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&H5(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class hp{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function J5(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function X5(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Z5(n,e){e&&(n["X-Firebase-GMPID"]=e)}function eO(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function tO(n,e,t,r,i,l,c=!0,u=!1){const p=rT(n.urlParams),g=n.url+p,b=Object.assign({},n.headers);return Z5(b,e),J5(b,t),X5(b,l),eO(b,r),new Y5(g,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,c,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nO(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function rO(...n){const e=nO();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(q0())return new Blob(n);throw new Dn(Rn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function sO(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iO(n){if(typeof atob>"u")throw U5("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Tx{constructor(e,t){this.data=e,this.contentType=t||null}}function aO(n,e){switch(n){case na.RAW:return new Tx(sT(e));case na.BASE64:case na.BASE64URL:return new Tx(iT(n,e));case na.DATA_URL:return new Tx(lO(e),cO(e))}throw U0()}function sT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const l=r,c=n.charCodeAt(++t);r=65536|(l&1023)<<10|c&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function oO(n){let e;try{e=decodeURIComponent(n)}catch{throw fh(na.DATA_URL,"Malformed data URL.")}return sT(e)}function iT(n,e){switch(n){case na.BASE64:{const i=e.indexOf("-")!==-1,l=e.indexOf("_")!==-1;if(i||l)throw fh(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case na.BASE64URL:{const i=e.indexOf("+")!==-1,l=e.indexOf("/")!==-1;if(i||l)throw fh(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=iO(e)}catch(i){throw i.message.includes("polyfill")?i:fh(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}class aT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw fh(na.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=dO(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function lO(n){const e=new aT(n);return e.base64?iT(na.BASE64,e.rest):oO(e.rest)}function cO(n){return new aT(n).contentType}function dO(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e,t){let r=0,i="";H_(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(H_(this.data_)){const r=this.data_,i=sO(r,e,t);return i===null?null:new zo(i)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new zo(r,!0)}}static getBlob(...e){if(q0()){const t=e.map(r=>r instanceof zo?r.data_:r);return new zo(rO.apply(null,t))}else{const t=e.map(c=>z0(c)?aO(na.RAW,c).data:c.data_);let r=0;t.forEach(c=>{r+=c.byteLength});const i=new Uint8Array(r);let l=0;return t.forEach(c=>{for(let u=0;u<c.length;u++)i[l++]=c[u]}),new zo(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oT(n){let e;try{e=JSON.parse(n)}catch{return null}return K5(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uO(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function hO(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function lT(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mO(n,e){return e}class qr{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||mO}}let mp=null;function pO(n){return!z0(n)||n.length<2?n:lT(n)}function cT(){if(mp)return mp;const n=[];n.push(new qr("bucket")),n.push(new qr("generation")),n.push(new qr("metageneration")),n.push(new qr("name","fullPath",!0));function e(l,c){return pO(c)}const t=new qr("name");t.xform=e,n.push(t);function r(l,c){return c!==void 0?Number(c):c}const i=new qr("size");return i.xform=r,n.push(i),n.push(new qr("timeCreated")),n.push(new qr("updated")),n.push(new qr("md5Hash",null,!0)),n.push(new qr("cacheControl",null,!0)),n.push(new qr("contentDisposition",null,!0)),n.push(new qr("contentEncoding",null,!0)),n.push(new qr("contentLanguage",null,!0)),n.push(new qr("contentType",null,!0)),n.push(new qr("metadata","customMetadata",!0)),mp=n,mp}function fO(n,e){function t(){const r=n.bucket,i=n.fullPath,l=new js(r,i);return e._makeStorageReference(l)}Object.defineProperty(n,"ref",{get:t})}function gO(n,e,t){const r={};r.type="file";const i=t.length;for(let l=0;l<i;l++){const c=t[l];r[c.local]=c.xform(r,e[c.server])}return fO(r,n),r}function dT(n,e,t){const r=oT(e);return r===null?null:gO(n,r,t)}function xO(n,e,t,r){const i=oT(e);if(i===null||!z0(i.downloadTokens))return null;const l=i.downloadTokens;if(l.length===0)return null;const c=encodeURIComponent;return l.split(",").map(g=>{const b=n.bucket,w=n.fullPath,N="/b/"+c(b)+"/o/"+c(w),D=W0(N,t,r),z=rT({alt:"media",token:g});return D+z})[0]}function yO(n,e){const t={},r=e.length;for(let i=0;i<r;i++){const l=e[i];l.writable&&(t[l.server]=n[l.local])}return JSON.stringify(t)}class uT{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hT(n){if(!n)throw U0()}function vO(n,e){function t(r,i){const l=dT(n,i,e);return hT(l!==null),l}return t}function bO(n,e){function t(r,i){const l=dT(n,i,e);return hT(l!==null),xO(l,i,n.host,n._protocol)}return t}function mT(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=D5():i=R5():t.getStatus()===402?i=C5(n.bucket):t.getStatus()===403?i=P5(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function wO(n){const e=mT(n);function t(r,i){let l=e(r,i);return r.getStatus()===404&&(l=k5(n.path)),l.serverResponse=i.serverResponse,l}return t}function _O(n,e,t){const r=e.fullServerUrl(),i=W0(r,n.host,n._protocol),l="GET",c=n.maxOperationRetryTime,u=new uT(i,l,bO(n,t),c);return u.errorHandler=wO(e),u}function NO(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function IO(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=NO(null,e)),r}function EO(n,e,t,r,i){const l=e.bucketOnlyServerUrl(),c={"X-Goog-Upload-Protocol":"multipart"};function u(){let ae="";for(let xe=0;xe<2;xe++)ae=ae+Math.random().toString().slice(2);return ae}const p=u();c["Content-Type"]="multipart/related; boundary="+p;const g=IO(e,r,i),b=yO(g,t),w="--"+p+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+b+`\r
--`+p+`\r
Content-Type: `+g.contentType+`\r
\r
`,N=`\r
--`+p+"--",D=zo.getBlob(w,r,N);if(D===null)throw F5();const z={name:g.fullPath},L=W0(l,n.host,n._protocol),O="POST",le=n.maxUploadRetryTime,ge=new uT(L,O,vO(n,t),le);return ge.urlParams=z,ge.headers=c,ge.body=D.uploadData(),ge.errorHandler=mT(e),ge}class TO{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Xl.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Xl.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Xl.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i,l){if(this.sent_)throw $u("cannot .send() more than once");if(tl(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),l!==void 0)for(const c in l)l.hasOwnProperty(c)&&this.xhr_.setRequestHeader(c,l[c].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw $u("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw $u("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw $u("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw $u("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class AO extends TO{initXhr(){this.xhr_.responseType="text"}}function pT(){return new AO}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e,t){this._service=e,t instanceof js?this._location=t:this._location=js.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new mc(e,t)}get root(){const e=new js(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lT(this._location.path)}get storage(){return this._service}get parent(){const e=uO(this._location.path);if(e===null)return null;const t=new js(this._location.bucket,e);return new mc(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw z5(e)}}function SO(n,e,t){n._throwIfRoot("uploadBytes");const r=EO(n.storage,n._location,cT(),new zo(e,!0),t);return n.storage.makeRequestWithTokens(r,pT).then(i=>({metadata:i,ref:n}))}function jO(n){n._throwIfRoot("getDownloadURL");const e=_O(n.storage,n._location,cT());return n.storage.makeRequestWithTokens(e,pT).then(t=>{if(t===null)throw B5();return t})}function kO(n,e){const t=hO(n._location.path,e),r=new js(n._location.bucket,t);return new mc(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CO(n){return/^[A-Za-z]+:\/\//.test(n)}function RO(n,e){return new mc(n,e)}function fT(n,e){if(n instanceof H0){const t=n;if(t._bucket==null)throw $5();const r=new mc(t,t._bucket);return e!=null?fT(r,e):r}else return e!==void 0?kO(n,e):n}function DO(n,e){if(e&&CO(e)){if(n instanceof H0)return RO(n,e);throw Ay("To use ref(service, url), the first argument must be a Storage instance.")}else return fT(n,e)}function K_(n,e){const t=e==null?void 0:e[tT];return t==null?null:js.makeFromBucketSpec(t,n)}function PO(n,e,t,r={}){n.host=`${e}:${t}`;const i=tl(e);i&&(Vy(`https://${n.host}/b`),Ly("Storage",!0)),n._isUsingEmulator=!0,n._protocol=i?"https":"http";const{mockUserToken:l}=r;l&&(n._overrideAuthToken=typeof l=="string"?l:UN(l,n.app.options.projectId))}class H0{constructor(e,t,r,i,l,c=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=l,this._isUsingEmulator=c,this._bucket=null,this._host=eT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=S5,this._maxUploadRetryTime=j5,this._requests=new Set,i!=null?this._bucket=js.makeFromBucketSpec(i,this._host):this._bucket=K_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=js.makeFromBucketSpec(this._url,e):this._bucket=K_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){G_("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){G_("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(cs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new mc(this,e)}_makeRequest(e,t,r,i,l=!0){if(this._deleted)return new q5(nT());{const c=tO(e,this._appId,r,i,t,this._firebaseVersion,l,this._isUsingEmulator);return this._requests.add(c),c.getPromise().then(()=>this._requests.delete(c),()=>this._requests.delete(c)),c}}async makeRequestWithTokens(e,t){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()}}const Q_="@firebase/storage",Y_="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gT="storage";function Ju(n,e,t){return n=Kt(n),SO(n,e,t)}function Xu(n){return n=Kt(n),jO(n)}function Zu(n,e){return n=Kt(n),DO(n,e)}function OO(n=Mh(),e){n=Kt(n);const r=Ka(n,gT).getImmediate({identifier:e}),i=$N("storage");return i&&MO(r,...i),r}function MO(n,e,t,r={}){PO(n,e,t,r)}function VO(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new H0(t,r,i,e,gc)}function LO(){Rs(new us(gT,VO,"PUBLIC").setMultipleInstances(!0)),Sr(Q_,Y_,""),Sr(Q_,Y_,"esm2020")}LO();const xT="@firebase/installations",G0="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yT=1e4,vT=`w:${G0}`,bT="FIS_v2",$O="https://firebaseinstallations.googleapis.com/v1",FO=3600*1e3,BO="installations",UO="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zO={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},pc=new nl(BO,UO,zO);function wT(n){return n instanceof oi&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _T({projectId:n}){return`${$O}/projects/${n}/installations`}function NT(n){return{token:n.token,requestStatus:2,expiresIn:WO(n.expiresIn),creationTime:Date.now()}}async function IT(n,e){const r=(await e.json()).error;return pc.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function ET({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function qO(n,{refreshToken:e}){const t=ET(n);return t.append("Authorization",HO(e)),t}async function TT(n){const e=await n();return e.status>=500&&e.status<600?n():e}function WO(n){return Number(n.replace("s","000"))}function HO(n){return`${bT} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GO({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=_T(n),i=ET(n),l=e.getImmediate({optional:!0});if(l){const g=await l.getHeartbeatsHeader();g&&i.append("x-firebase-client",g)}const c={fid:t,authVersion:bT,appId:n.appId,sdkVersion:vT},u={method:"POST",headers:i,body:JSON.stringify(c)},p=await TT(()=>fetch(r,u));if(p.ok){const g=await p.json();return{fid:g.fid||t,registrationStatus:2,refreshToken:g.refreshToken,authToken:NT(g.authToken)}}else throw await IT("Create Installation",p)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AT(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KO(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QO=/^[cdef][\w-]{21}$/,Sy="";function YO(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=JO(n);return QO.test(t)?t:Sy}catch{return Sy}}function JO(n){return KO(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ST=new Map;function jT(n,e){const t=Xf(n);kT(t,e),XO(t,e)}function kT(n,e){const t=ST.get(n);if(t)for(const r of t)r(e)}function XO(n,e){const t=ZO();t&&t.postMessage({key:n,fid:e}),e3()}let Wl=null;function ZO(){return!Wl&&"BroadcastChannel"in self&&(Wl=new BroadcastChannel("[Firebase] FID Change"),Wl.onmessage=n=>{kT(n.data.key,n.data.fid)}),Wl}function e3(){ST.size===0&&Wl&&(Wl.close(),Wl=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t3="firebase-installations-database",n3=1,fc="firebase-installations-store";let Ax=null;function K0(){return Ax||(Ax=wf(t3,n3,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(fc)}}})),Ax}async function mf(n,e){const t=Xf(n),i=(await K0()).transaction(fc,"readwrite"),l=i.objectStore(fc),c=await l.get(t);return await l.put(e,t),await i.done,(!c||c.fid!==e.fid)&&jT(n,e.fid),e}async function CT(n){const e=Xf(n),r=(await K0()).transaction(fc,"readwrite");await r.objectStore(fc).delete(e),await r.done}async function Zf(n,e){const t=Xf(n),i=(await K0()).transaction(fc,"readwrite"),l=i.objectStore(fc),c=await l.get(t),u=e(c);return u===void 0?await l.delete(t):await l.put(u,t),await i.done,u&&(!c||c.fid!==u.fid)&&jT(n,u.fid),u}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q0(n){let e;const t=await Zf(n.appConfig,r=>{const i=r3(r),l=s3(n,i);return e=l.registrationPromise,l.installationEntry});return t.fid===Sy?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function r3(n){const e=n||{fid:YO(),registrationStatus:0};return RT(e)}function s3(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(pc.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=i3(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:a3(n)}:{installationEntry:e}}async function i3(n,e){try{const t=await GO(n,e);return mf(n.appConfig,t)}catch(t){throw wT(t)&&t.customData.serverCode===409?await CT(n.appConfig):await mf(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function a3(n){let e=await J_(n.appConfig);for(;e.registrationStatus===1;)await AT(100),e=await J_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Q0(n);return r||t}return e}function J_(n){return Zf(n,e=>{if(!e)throw pc.create("installation-not-found");return RT(e)})}function RT(n){return o3(n)?{fid:n.fid,registrationStatus:0}:n}function o3(n){return n.registrationStatus===1&&n.registrationTime+yT<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l3({appConfig:n,heartbeatServiceProvider:e},t){const r=c3(n,t),i=qO(n,t),l=e.getImmediate({optional:!0});if(l){const g=await l.getHeartbeatsHeader();g&&i.append("x-firebase-client",g)}const c={installation:{sdkVersion:vT,appId:n.appId}},u={method:"POST",headers:i,body:JSON.stringify(c)},p=await TT(()=>fetch(r,u));if(p.ok){const g=await p.json();return NT(g)}else throw await IT("Generate Auth Token",p)}function c3(n,{fid:e}){return`${_T(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y0(n,e=!1){let t;const r=await Zf(n.appConfig,l=>{if(!DT(l))throw pc.create("not-registered");const c=l.authToken;if(!e&&h3(c))return l;if(c.requestStatus===1)return t=d3(n,e),l;{if(!navigator.onLine)throw pc.create("app-offline");const u=p3(l);return t=u3(n,u),u}});return t?await t:r.authToken}async function d3(n,e){let t=await X_(n.appConfig);for(;t.authToken.requestStatus===1;)await AT(100),t=await X_(n.appConfig);const r=t.authToken;return r.requestStatus===0?Y0(n,e):r}function X_(n){return Zf(n,e=>{if(!DT(e))throw pc.create("not-registered");const t=e.authToken;return f3(t)?{...e,authToken:{requestStatus:0}}:e})}async function u3(n,e){try{const t=await l3(n,e),r={...e,authToken:t};return await mf(n.appConfig,r),t}catch(t){if(wT(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await CT(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await mf(n.appConfig,r)}throw t}}function DT(n){return n!==void 0&&n.registrationStatus===2}function h3(n){return n.requestStatus===2&&!m3(n)}function m3(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+FO}function p3(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function f3(n){return n.requestStatus===1&&n.requestTime+yT<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g3(n){const e=n,{installationEntry:t,registrationPromise:r}=await Q0(e);return r?r.catch(console.error):Y0(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x3(n,e=!1){const t=n;return await y3(t),(await Y0(t,e)).token}async function y3(n){const{registrationPromise:e}=await Q0(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v3(n){if(!n||!n.options)throw Sx("App Configuration");if(!n.name)throw Sx("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Sx(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Sx(n){return pc.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT="installations",b3="installations-internal",w3=n=>{const e=n.getProvider("app").getImmediate(),t=v3(e),r=Ka(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},_3=n=>{const e=n.getProvider("app").getImmediate(),t=Ka(e,PT).getImmediate();return{getId:()=>g3(t),getToken:i=>x3(t,i)}};function N3(){Rs(new us(PT,w3,"PUBLIC")),Rs(new us(b3,_3,"PRIVATE"))}N3();Sr(xT,G0);Sr(xT,G0,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pf="analytics",I3="firebase_id",E3="origin",T3=60*1e3,A3="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",J0="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kr=new bf("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S3={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Cs=new nl("analytics","Analytics",S3);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j3(n){if(!n.startsWith(J0)){const e=Cs.create("invalid-gtag-resource",{gtagURL:n});return Kr.warn(e.message),""}return n}function OT(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function k3(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function C3(n,e){const t=k3("firebase-js-sdk-policy",{createScriptURL:j3}),r=document.createElement("script"),i=`${J0}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function R3(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function D3(n,e,t,r,i,l){const c=r[i];try{if(c)await e[c];else{const p=(await OT(t)).find(g=>g.measurementId===i);p&&await e[p.appId]}}catch(u){Kr.error(u)}n("config",i,l)}async function P3(n,e,t,r,i){try{let l=[];if(i&&i.send_to){let c=i.send_to;Array.isArray(c)||(c=[c]);const u=await OT(t);for(const p of c){const g=u.find(w=>w.measurementId===p),b=g&&e[g.appId];if(b)l.push(b);else{l=[];break}}}l.length===0&&(l=Object.values(e)),await Promise.all(l),n("event",r,i||{})}catch(l){Kr.error(l)}}function O3(n,e,t,r){async function i(l,...c){try{if(l==="event"){const[u,p]=c;await P3(n,e,t,u,p)}else if(l==="config"){const[u,p]=c;await D3(n,e,t,r,u,p)}else if(l==="consent"){const[u,p]=c;n("consent",u,p)}else if(l==="get"){const[u,p,g]=c;n("get",u,p,g)}else if(l==="set"){const[u]=c;n("set",u)}else n(l,...c)}catch(u){Kr.error(u)}}return i}function M3(n,e,t,r,i){let l=function(...c){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(l=window[i]),window[i]=O3(l,n,e,t),{gtagCore:l,wrappedGtag:window[i]}}function V3(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(J0)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L3=30,$3=1e3;class F3{constructor(e={},t=$3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const MT=new F3;function B3(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function U3(n){var c;const{appId:e,apiKey:t}=n,r={method:"GET",headers:B3(t)},i=A3.replace("{app-id}",e),l=await fetch(i,r);if(l.status!==200&&l.status!==304){let u="";try{const p=await l.json();(c=p.error)!=null&&c.message&&(u=p.error.message)}catch{}throw Cs.create("config-fetch-failed",{httpStatus:l.status,responseMessage:u})}return l.json()}async function z3(n,e=MT,t){const{appId:r,apiKey:i,measurementId:l}=n.options;if(!r)throw Cs.create("no-app-id");if(!i){if(l)return{measurementId:l,appId:r};throw Cs.create("no-api-key")}const c=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new H3;return setTimeout(async()=>{u.abort()},T3),VT({appId:r,apiKey:i,measurementId:l},c,u,e)}async function VT(n,{throttleEndTimeMillis:e,backoffCount:t},r,i=MT){var u;const{appId:l,measurementId:c}=n;try{await q3(r,e)}catch(p){if(c)return Kr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${p==null?void 0:p.message}]`),{appId:l,measurementId:c};throw p}try{const p=await U3(n);return i.deleteThrottleMetadata(l),p}catch(p){const g=p;if(!W3(g)){if(i.deleteThrottleMetadata(l),c)return Kr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${g==null?void 0:g.message}]`),{appId:l,measurementId:c};throw p}const b=Number((u=g==null?void 0:g.customData)==null?void 0:u.httpStatus)===503?Hb(t,i.intervalMillis,L3):Hb(t,i.intervalMillis),w={throttleEndTimeMillis:Date.now()+b,backoffCount:t+1};return i.setThrottleMetadata(l,w),Kr.debug(`Calling attemptFetch again in ${b} millis`),VT(n,w,r,i)}}function q3(n,e){return new Promise((t,r)=>{const i=Math.max(e-Date.now(),0),l=setTimeout(t,i);n.addEventListener(()=>{clearTimeout(l),r(Cs.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function W3(n){if(!(n instanceof oi)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class H3{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function G3(n,e,t,r,i){if(i&&i.global){n("event",t,r);return}else{const l=await e,c={...r,send_to:l};n("event",t,c)}}async function K3(n,e,t,r){if(r&&r.global){const i={};for(const l of Object.keys(t))i[`user_properties.${l}`]=t[l];return n("set",i),Promise.resolve()}else{const i=await e;n("config",i,{update:!0,user_properties:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q3(){if(vf())try{await $y()}catch(n){return Kr.warn(Cs.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Kr.warn(Cs.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Y3(n,e,t,r,i,l,c){const u=z3(n);u.then(N=>{t[N.measurementId]=N.appId,n.options.measurementId&&N.measurementId!==n.options.measurementId&&Kr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${N.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(N=>Kr.error(N)),e.push(u);const p=Q3().then(N=>{if(N)return r.getId()}),[g,b]=await Promise.all([u,p]);V3(l)||C3(l,g.measurementId),i("js",new Date);const w=(c==null?void 0:c.config)??{};return w[E3]="firebase",w.update=!0,b!=null&&(w[I3]=b),i("config",g.measurementId,w),g.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3{constructor(e){this.app=e}_delete(){return delete wd[this.app.options.appId],Promise.resolve()}}let wd={},Z_=[];const eN={};let jx="dataLayer",X3="gtag",tN,X0,nN=!1;function Z3(){const n=[];if(qN()&&n.push("This is a browser extension environment."),GN()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,i)=>`(${i+1}) ${r}`).join(" "),t=Cs.create("invalid-analytics-context",{errorInfo:e});Kr.warn(t.message)}}function eM(n,e,t){Z3();const r=n.options.appId;if(!r)throw Cs.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Kr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Cs.create("no-api-key");if(wd[r]!=null)throw Cs.create("already-exists",{id:r});if(!nN){R3(jx);const{wrappedGtag:l,gtagCore:c}=M3(wd,Z_,eN,jx,X3);X0=l,tN=c,nN=!0}return wd[r]=Y3(n,Z_,eN,e,tN,jx,t),new J3(n)}function tM(n=Mh()){n=Kt(n);const e=Ka(n,pf);return e.isInitialized()?e.getImmediate():nM(n)}function nM(n,e={}){const t=Ka(n,pf);if(t.isInitialized()){const i=t.getImmediate();if(za(e,t.getOptions()))return i;throw Cs.create("already-initialized")}return t.initialize({options:e})}function rM(n,e,t){n=Kt(n),K3(X0,wd[n.app.options.appId],e,t).catch(r=>Kr.error(r))}function sM(n,e,t,r){n=Kt(n),G3(X0,wd[n.app.options.appId],e,t,r).catch(i=>Kr.error(i))}const rN="@firebase/analytics",sN="0.10.19";function iM(){Rs(new us(pf,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return eM(r,i,t)},"PUBLIC")),Rs(new us("analytics-internal",n,"PRIVATE")),Sr(rN,sN),Sr(rN,sN,"esm2020");function n(e){try{const t=e.getProvider(pf).getImmediate();return{logEvent:(r,i,l)=>sM(t,r,i,l),setUserProperties:(r,i)=>rM(t,r,i)}}catch(t){throw Cs.create("interop-component-reg-failed",{reason:t})}}}iM();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aM="/firebase-messaging-sw.js",oM="/firebase-cloud-messaging-push-scope",LT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",lM="https://fcmregistrations.googleapis.com/v1",$T="google.c.a.c_id",cM="google.c.a.c_l",dM="google.c.a.ts",uM="google.c.a.e",iN=1e4;var aN;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(aN||(aN={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Ph;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(Ph||(Ph={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function hM(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),i=new Uint8Array(r.length);for(let l=0;l<r.length;++l)i[l]=r.charCodeAt(l);return i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kx="fcm_token_details_db",mM=5,oN="fcm_token_object_Store";async function pM(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(l=>l.name).includes(kx))return null;let e=null;return(await wf(kx,mM,{upgrade:async(r,i,l,c)=>{if(i<2||!r.objectStoreNames.contains(oN))return;const u=c.objectStore(oN),p=await u.index("fcmSenderId").get(n);if(await u.clear(),!!p){if(i===2){const g=p;if(!g.auth||!g.p256dh||!g.endpoint)return;e={token:g.fcmToken,createTime:g.createTime??Date.now(),subscriptionOptions:{auth:g.auth,p256dh:g.p256dh,endpoint:g.endpoint,swScope:g.swScope,vapidKey:typeof g.vapidKey=="string"?g.vapidKey:Oa(g.vapidKey)}}}else if(i===3){const g=p;e={token:g.fcmToken,createTime:g.createTime,subscriptionOptions:{auth:Oa(g.auth),p256dh:Oa(g.p256dh),endpoint:g.endpoint,swScope:g.swScope,vapidKey:Oa(g.vapidKey)}}}else if(i===4){const g=p;e={token:g.fcmToken,createTime:g.createTime,subscriptionOptions:{auth:Oa(g.auth),p256dh:Oa(g.p256dh),endpoint:g.endpoint,swScope:g.swScope,vapidKey:Oa(g.vapidKey)}}}}}})).close(),await ux(kx),await ux("fcm_vapid_details_db"),await ux("undefined"),fM(e)?e:null}function fM(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gM="firebase-messaging-database",xM=1,Oh="firebase-messaging-store";let Cx=null;function FT(){return Cx||(Cx=wf(gM,xM,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Oh)}}})),Cx}async function yM(n){const e=BT(n),r=await(await FT()).transaction(Oh).objectStore(Oh).get(e);if(r)return r;{const i=await pM(n.appConfig.senderId);if(i)return await Z0(n,i),i}}async function Z0(n,e){const t=BT(n),i=(await FT()).transaction(Oh,"readwrite");return await i.objectStore(Oh).put(e,t),await i.done,e}function BT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vM={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},Cr=new nl("messaging","Messaging",vM);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bM(n,e){const t=await tv(n),r=UT(e),i={method:"POST",headers:t,body:JSON.stringify(r)};let l;try{l=await(await fetch(ev(n.appConfig),i)).json()}catch(c){throw Cr.create("token-subscribe-failed",{errorInfo:c==null?void 0:c.toString()})}if(l.error){const c=l.error.message;throw Cr.create("token-subscribe-failed",{errorInfo:c})}if(!l.token)throw Cr.create("token-subscribe-no-token");return l.token}async function wM(n,e){const t=await tv(n),r=UT(e.subscriptionOptions),i={method:"PATCH",headers:t,body:JSON.stringify(r)};let l;try{l=await(await fetch(`${ev(n.appConfig)}/${e.token}`,i)).json()}catch(c){throw Cr.create("token-update-failed",{errorInfo:c==null?void 0:c.toString()})}if(l.error){const c=l.error.message;throw Cr.create("token-update-failed",{errorInfo:c})}if(!l.token)throw Cr.create("token-update-no-token");return l.token}async function _M(n,e){const r={method:"DELETE",headers:await tv(n)};try{const l=await(await fetch(`${ev(n.appConfig)}/${e}`,r)).json();if(l.error){const c=l.error.message;throw Cr.create("token-unsubscribe-failed",{errorInfo:c})}}catch(i){throw Cr.create("token-unsubscribe-failed",{errorInfo:i==null?void 0:i.toString()})}}function ev({projectId:n}){return`${lM}/projects/${n}/registrations`}async function tv({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function UT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const i={web:{endpoint:t,auth:e,p256dh:n}};return r!==LT&&(i.web.applicationPubKey=r),i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NM=10080*60*1e3;async function IM(n){const e=await TM(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Oa(e.getKey("auth")),p256dh:Oa(e.getKey("p256dh"))},r=await yM(n.firebaseDependencies);if(r){if(AM(r.subscriptionOptions,t))return Date.now()>=r.createTime+NM?EM(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await _M(n.firebaseDependencies,r.token)}catch(i){console.warn(i)}return lN(n.firebaseDependencies,t)}else return lN(n.firebaseDependencies,t)}async function EM(n,e){try{const t=await wM(n.firebaseDependencies,e),r={...e,token:t,createTime:Date.now()};return await Z0(n.firebaseDependencies,r),t}catch(t){throw t}}async function lN(n,e){const r={token:await bM(n,e),createTime:Date.now(),subscriptionOptions:e};return await Z0(n,r),r.token}async function TM(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:hM(e)})}function AM(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,i=e.auth===n.auth,l=e.p256dh===n.p256dh;return t&&r&&i&&l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cN(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return SM(e,n),jM(e,n),kM(e,n),e}function SM(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const i=e.notification.image;i&&(n.notification.image=i);const l=e.notification.icon;l&&(n.notification.icon=l)}function jM(n,e){e.data&&(n.data=e.data)}function kM(n,e){var i,l,c,u;if(!e.fcmOptions&&!((i=e.notification)!=null&&i.click_action))return;n.fcmOptions={};const t=((l=e.fcmOptions)==null?void 0:l.link)??((c=e.notification)==null?void 0:c.click_action);t&&(n.fcmOptions.link=t);const r=(u=e.fcmOptions)==null?void 0:u.analytics_label;r&&(n.fcmOptions.analyticsLabel=r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CM(n){return typeof n=="object"&&!!n&&$T in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RM(n){if(!n||!n.options)throw Rx("App Configuration Object");if(!n.name)throw Rx("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Rx(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Rx(n){return Cr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DM{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const i=RM(e);this.firebaseDependencies={app:e,appConfig:i,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PM(n){try{n.swRegistration=await navigator.serviceWorker.register(aM,{scope:oM}),n.swRegistration.update().catch(()=>{}),await OM(n.swRegistration)}catch(e){throw Cr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}async function OM(n){return new Promise((e,t)=>{const r=setTimeout(()=>t(new Error(`Service worker not registered after ${iN} ms`)),iN),i=n.installing||n.waiting;n.active?(clearTimeout(r),e()):i?i.onstatechange=l=>{var c;((c=l.target)==null?void 0:c.state)==="activated"&&(i.onstatechange=null,clearTimeout(r),e())}:(clearTimeout(r),t(new Error("No incoming service worker found.")))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MM(n,e){if(!e&&!n.swRegistration&&await PM(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw Cr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VM(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=LT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zT(n,e){if(!navigator)throw Cr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw Cr.create("permission-blocked");return await VM(n,e==null?void 0:e.vapidKey),await MM(n,e==null?void 0:e.serviceWorkerRegistration),IM(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LM(n,e,t){const r=$M(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[$T],message_name:t[cM],message_time:t[dM],message_device_time:Math.floor(Date.now()/1e3)})}function $M(n){switch(n){case Ph.NOTIFICATION_CLICKED:return"notification_open";case Ph.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FM(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===Ph.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(cN(t)):n.onMessageHandler.next(cN(t)));const r=t.data;CM(r)&&r[uM]==="1"&&await LM(n,t.messageType,r)}const dN="@firebase/messaging",uN="0.12.23";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BM=n=>{const e=new DM(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>FM(e,t)),e},UM=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>zT(e,r)}};function zM(){Rs(new us("messaging",BM,"PUBLIC")),Rs(new us("messaging-internal",UM,"PRIVATE")),Sr(dN,uN),Sr(dN,uN,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qM(){try{await $y()}catch{return!1}return typeof window<"u"&&vf()&&GN()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WM(n,e){if(!navigator)throw Cr.create("only-available-in-window");return n.onMessageHandler=e,()=>{n.onMessageHandler=null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HM(n=Mh()){return qM().then(e=>{if(!e)throw Cr.create("unsupported-browser")},e=>{throw Cr.create("indexed-db-unsupported")}),Ka(Kt(n),"messaging").getImmediate()}async function GM(n,e){return n=Kt(n),zT(n,e)}function KM(n,e){return n=Kt(n),WM(n,e)}zM();const qT={apiKey:"AIzaSyBm3qcPWMOt_AmyFmtW-0DfFYBnM-qjhCs",authDomain:"btw-erp.firebaseapp.com",projectId:"btw-erp",storageBucket:"btw-erp.firebasestorage.app",messagingSenderId:"700838936930",appId:"1:700838936930:web:00474b6818f67f872aec3b",measurementId:"G-HDRN5MET3X"},Jh=By(qT),Od=V1(Jh),st=FE(Jh),eh=OO(Jh);tM(Jh);let jy;try{jy=HM(Jh)}catch(n){console.warn("Firebase Messaging not supported:",n),jy=null}const ff=jy;try{m5(st).catch(n=>{n.code==="failed-precondition"?console.warn("Multiple tabs open, persistence can only be enabled in one tab at a time."):n.code==="unimplemented"&&console.warn("Current browser doesn't support persistence.")})}catch(n){console.warn("Firestore persistence error:",n)}async function hN(n){var e;try{let t=Ps(hn(st,"projects"));n&&(t=Ps(hn(st,"projects"),bc("tenantId","==",n)));const i=(await XE(t)).docs.map(c=>({...c.data(),id:c.id})),l={};for(const c of i){const u=new Set;(e=c.tasks)==null||e.forEach(p=>{p.assigneeId&&u.add(p.assigneeId)});for(const p of u){l[p]||(l[p]={});const g=(c.tasks||[]).filter(z=>z.assigneeId===p).length,b=(c.financials||[]).filter(z=>z.adminApproved&&z.clientApproved&&z.vendorId===p),w=b.filter(z=>z.receivedByName&&z.receivedByName.includes(p)).reduce((z,L)=>z+L.amount,0),N=b.filter(z=>z.vendorId===p).reduce((z,L)=>z+L.amount,0),D=w-N;l[p][c.id]={projectName:c.name,taskCount:g,netAmount:D}}}for(const[c,u]of Object.entries(l))try{await kr(bt(st,"users",c),{projectMetrics:u})}catch(p){p.code!=="not-found"&&console.warn(` Could not update metrics for vendor ${c}:`,p.message)}}catch(t){console.error(" Error syncing vendor metrics:",t)}}const ky=hn(st,"projects"),gf=n=>Array.isArray(n)?n.map(e=>gf(e)).filter(e=>e!==void 0):n!==null&&typeof n=="object"?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,gf(t)]).filter(([e,t])=>t!==void 0)):n,QM=async n=>{try{const e=bt(ky),t=gf(n);return await Os(e,t),e.id}catch(e){throw console.error("Error creating project:",e),e}},nv=async(n,e)=>{try{const t=gf(e);await kr(bt(st,"projects",n),t)}catch(t){throw console.error("Error updating project:",t),t}},WT=async n=>{try{await uc(bt(st,"projects",n))}catch(e){throw console.error("Error deleting project:",e),e}},YM=(n,e)=>{let t=Ps(ky);return e&&(t=Ps(ky,bc("tenantId","==",e))),ci(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in projects collection listener:",r)})},mN=hn(st,"users"),Cy=async n=>{try{const e=await da(bt(st,"users",n));if(e.exists()){const r={...e.data(),id:e.id};if(!r.tenantId){console.warn(` User ${n} missing tenantId. Assigning UID as tenantId.`),r.tenantId=n;try{await kr(bt(st,"users",n),{tenantId:n}),console.log(` Updated user ${n} with tenantId in Firestore`)}catch{console.warn(` Could not persist tenantId to Firestore for ${n}, will use in-memory value`)}}return r}console.log(`User ${n} not found in users collection, checking clients...`);const t=await da(bt(st,"clients",n));if(t.exists()){const r={...t.data(),id:t.id};if(!r.tenantId){console.warn(` Client ${n} missing tenantId. Assigning UID as tenantId.`),r.tenantId=n;try{await kr(bt(st,"clients",n),{tenantId:n}),console.log(` Updated client ${n} with tenantId in Firestore`)}catch{console.warn(` Could not persist tenantId to Firestore for ${n}, will use in-memory value`)}}return r}return console.warn(`User document not found for ID: ${n}. Make sure to create a user profile in Firestore.`),null}catch(e){throw e.code==="failed-precondition"?console.error(`Firebase offline: ${e.message}`):console.error("Error fetching user:",e),e}},HT=async(n,e)=>{try{console.log(` Phone login - UID: ${n}, Phone: ${e}`);const t=bt(st,"users",n),r=await da(t);if(r.exists()){const p=r.data();return console.log(` Found user by UID: ${n}`),p}console.log(" UID not found, searching vendors by phone...");const i=hn(st,"vendors"),l=e.replace(/\D/g,"");console.log(` Searching with normalized phone: "${l}"`);const c=Ps(i,bc("phone","==",l)),u=await XE(c);if(!u.empty){const p=u.docs[0].data(),g=u.docs[0].id;console.log(` Found vendor by phone: ${l}, oldID: ${g}`);let b=p;if(b.tenantId||(b.tenantId=n),g!==n){console.log(` Migrating document from ${g} to real UID: ${n}`);const w={...p,id:n,tenantId:n};b=w,await Os(bt(st,"users",n),w),await Os(bt(st,"vendors",n),w),console.log(` Deleting old documents with ID: ${g}`),await uc(bt(st,"users",g)),await uc(bt(st,"vendors",g)),console.log(` Deleted old documents with ID: ${g}`)}return b}return console.log(` No vendor found with phone: ${l}`),null}catch(t){return console.error("Error claiming phone profile:",t),null}},JM=(n,e)=>{let t=[],r=[],i=Ps(mN);e&&(i=Ps(mN,bc("tenantId","==",e)));const l=ci(i,c=>{t=c.docs.map(p=>({...p.data(),id:p.id})),n(t)},c=>{console.error(" Error in users collection listener:",c)});return r.push(l),()=>{r.forEach(c=>c())}},XM=(n,e)=>{let t=Ps(hn(st,"designers"));return e&&(t=Ps(hn(st,"designers"),bc("tenantId","==",e))),ci(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in designers collection listener:",r)})},ZM=(n,e)=>{let t=Ps(hn(st,"vendors"));return e&&(t=Ps(hn(st,"vendors"),bc("tenantId","==",e))),ci(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in vendors collection listener:",r)})},e6=(n,e)=>{let t=Ps(hn(st,"clients"));return e&&(t=Ps(hn(st,"clients"),bc("tenantId","==",e))),ci(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in clients collection listener:",r)})},GT=()=>{const n=window.navigator,e=window.screen,t=[n.userAgent,n.language,e.width+"x"+e.height,e.colorDepth,new Date().getTimezoneOffset(),n.hardwareConcurrency||"unknown",n.deviceMemory||"unknown"].join("|");let r=0;for(let i=0;i<t.length;i++){const l=t.charCodeAt(i);r=(r<<5)-r+l,r=r&r}return Math.abs(r).toString(36)},t6=()=>{const n=navigator.userAgent.toLowerCase();return/tablet|ipad|playbook|silk|(android(?!.*mobi|phone|windows phone))/.test(n)?"tablet":/mobile|phone|windows phone|iphone|android|blackberry|opera mini/.test(n)?"mobile":"desktop"},KT=()=>{const n=navigator.userAgent;return n.includes("Firefox")?"Firefox":n.includes("Chrome")&&!n.includes("Chromium")?"Chrome":n.includes("Safari")&&!n.includes("Chrome")?"Safari":n.includes("Edge")||n.includes("Edg")?"Edge":n.includes("Opera")?"Opera":"Unknown Browser"},QT=()=>{const n=navigator.userAgent.toLowerCase();return n.includes("win")?"Windows":n.includes("mac")?"macOS":n.includes("linux")?"Linux":n.includes("android")?"Android":n.includes("iphone")||n.includes("ipad")?"iOS":"Unknown OS"},n6=()=>{const n=KT(),e=QT();return`${n} on ${e}`},r6=()=>{const n=new Date().toISOString();return{id:GT(),name:n6(),type:t6(),browser:KT(),os:QT(),lastLogin:n,createdAt:n}},s6=n=>{try{const e=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");e[n.id]=n,localStorage.setItem("rememberedDevices",JSON.stringify(e))}catch(e){console.error("Failed to save device to localStorage:",e)}},i6=()=>{try{const n=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");return Object.values(n)}catch(n){return console.error("Failed to get remembered devices:",n),[]}},a6=()=>GT(),o6=n=>{try{const e=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");delete e[n],localStorage.setItem("rememberedDevices",JSON.stringify(e))}catch(e){console.error("Failed to forget device:",e)}},l6=n=>{try{const e=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");e[n]&&(e[n].lastLogin=new Date().toISOString(),localStorage.setItem("rememberedDevices",JSON.stringify(e)))}catch(e){console.error("Failed to update device last login:",e)}},rv="erp_session",YT="erp_session_expiry",c6=1440*60*1e3,d6=1380*60*1e3,Ry=n=>{try{const e=new Date,t=new Date(e.getTime()+c6),r={user:n,loginTime:e.toISOString(),expiresAt:t.toISOString(),isAutoRestored:!1};localStorage.setItem(rv,JSON.stringify(r)),localStorage.setItem(YT,t.toISOString())}catch(e){console.error("Failed to save session:",e)}},sv=()=>{try{const n=localStorage.getItem(rv);if(!n)return null;const e=JSON.parse(n),t=new Date(e.expiresAt);return new Date>t?(JT(),null):e}catch(n){return console.error("Failed to get session:",n),null}},u6=()=>{const n=sv();if(!n)return 0;const e=new Date(n.expiresAt),t=new Date,r=e.getTime()-t.getTime();return Math.max(0,r)},h6=()=>{const n=u6();if(n<=0)return"Session expired";const e=Math.floor(n/(1e3*60*60)),t=Math.floor(n%(1e3*60*60)/(1e3*60));return e>0?`${e}h ${t}m remaining`:`${t}m remaining`},m6=()=>{const n=sv();if(!n)return!1;const e=new Date(n.loginTime);return new Date().getTime()-e.getTime()>=d6},p6=n=>{Ry(n)},JT=()=>{try{localStorage.removeItem(rv),localStorage.removeItem(YT)}catch(n){console.error("Failed to clear session:",n)}},XT=W.createContext(void 0),f6=({children:n})=>{const[e,t]=W.useState(null),[r,i]=W.useState(null),[l,c]=W.useState(!0),[u,p]=W.useState(null);W.useEffect(()=>AC(Od,async D=>{var z;try{if(D){let L=null;try{L=await Cy(D.uid),!L&&D.phoneNumber&&(L=await HT(D.uid,D.phoneNumber))}catch(O){console.warn("Could not fetch user profile:",O)}if(!L){if(D.phoneNumber){console.warn("Phone user has no profile and claim failed. Access denied."),i(null),t(null),c(!1);return}L={id:D.uid,name:((z=D.email)==null?void 0:z.split("@")[0])||"Admin",email:D.email||"",role:"Admin",phone:"",tenantId:D.uid}}i(D),t(L),Ry(L)}else{const L=sv();if(L){t(L.user),c(!1);return}i(null),t(null)}}catch(L){console.error("Auth state change error:",L),i(null),t(null)}finally{c(!1)}}),[]);const g=N=>{t(N),Ry(N);try{const{generateDeviceFingerprint:D}=require("../utils/deviceUtils"),z=D();l6(z)}catch{}},b=async()=>{try{t(null),i(null),JT(),await new Promise(N=>setTimeout(N,100)),await A1(Od)}catch(N){throw console.error("Logout error:",N),N}},w=()=>{e&&p6(e)};return a.jsx(XT.Provider,{value:{user:e,firebaseUser:r,login:g,logout:b,loading:l,adminCredentials:u,setAdminCredentials:p,extendSession:w},children:n})},ha=()=>{const n=W.useContext(XT);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},ZT=W.createContext(void 0),g6=({children:n,projects:e=[]})=>{const{user:t}=ha(),[r,i]=W.useState([]),[l,c]=W.useState([]),u=(L,O)=>{var j;const le=e.find(ie=>ie.id===O);if(!le)return!1;const ge=le.clientId===L,ae=le.leadDesignerId===L,xe=((j=le.teamMembers)==null?void 0:j.includes(L))||!1;return ge||ae||xe},p=r.filter(L=>t?L.recipientId?L.recipientId===t.id:L.projectId?u(t.id,L.projectId):!1:!1),g=p.filter(L=>!L.read).length,b=(L,O,le="info",ge,ae,xe,j)=>{let ie;typeof L=="object"?ie=L:ie={title:L,message:O,type:le,recipientId:ge,projectId:ae,projectName:xe,targetTab:j};const k={id:Math.random().toString(36).substr(2,9),title:ie.title,message:ie.message,type:ie.type||"info",recipientId:ie.recipientId,projectId:ie.projectId,projectName:ie.projectName,timestamp:new Date,read:!1,targetTab:ie.targetTab};i(R=>[k,...R]),k.recipientId?k.recipientId===(t==null?void 0:t.id)&&(c(R=>[...R,k]),setTimeout(()=>{c(R=>R.filter(M=>M.id!==k.id))},5e3)):k.projectId&&k.projectName&&t&&(c(R=>[...R,k]),setTimeout(()=>{c(R=>R.filter(M=>M.id!==k.id))},5e3))},w=L=>{i(O=>O.map(le=>le.id===L?{...le,read:!0}:le))},N=()=>{i(L=>L.map(O=>!t||O.recipientId&&O.recipientId!==t.id||!O.recipientId&&O.projectId&&!u(t.id,O.projectId)||!O.recipientId&&!O.projectId?O:{...O,read:!0}))},D=()=>{i(L=>t?L.filter(O=>!!(O.recipientId&&O.recipientId!==t.id||!O.recipientId&&O.projectId&&!u(t.id,O.projectId)||!O.recipientId&&!O.projectId)):L)},z=L=>{c(O=>O.filter(le=>le.id!==L))};return a.jsxs(ZT.Provider,{value:{notifications:p,unreadCount:g,addNotification:b,markAsRead:w,markAllAsRead:N,clearNotifications:D},children:[n,a.jsx("div",{className:"fixed bottom-6 right-6 z-[100] flex flex-col gap-2 pointer-events-none",children:l.map(L=>a.jsxs("div",{className:"bg-white rounded-lg shadow-xl border-l-4 p-4 w-80 pointer-events-auto transform transition-all animate-fade-in flex items-start gap-3",style:{borderColor:L.type==="error"?"#ef4444":L.type==="warning"?"#f59e0b":L.type==="success"?"#22c55e":"#3b82f6"},children:[a.jsxs("div",{className:"mt-0.5",children:[L.type==="success"&&a.jsx(_d,{className:"w-5 h-5 text-green-500"}),L.type==="error"&&a.jsx(Ma,{className:"w-5 h-5 text-red-500"}),L.type==="warning"&&a.jsx(kj,{className:"w-5 h-5 text-yellow-500"}),L.type==="info"&&a.jsx(jN,{className:"w-5 h-5 text-blue-500"})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-bold text-gray-800 text-sm",children:L.title}),a.jsx("p",{className:"text-xs text-gray-600 mt-1",children:L.message})]}),a.jsx("button",{onClick:()=>z(L.id),className:"text-gray-400 hover:text-gray-600",children:a.jsx(_n,{className:"w-4 h-4"})})]},L.id))})]})},al=()=>{const n=W.useContext(ZT);if(!n)throw new Error("useNotifications must be used within a NotificationProvider");return n},eA=W.createContext({loading:!1,showLoading:()=>{},hideLoading:()=>{},message:null}),x6=({children:n})=>{const[e,t]=W.useState(!1),[r,i]=W.useState(null),l=u=>{u&&i(u),t(!0);try{document.body.style.overflow="hidden"}catch{}},c=()=>{t(!1),i(null);try{document.body.style.overflow=""}catch{}};return a.jsx(eA.Provider,{value:{loading:e,showLoading:l,hideLoading:c,message:r},children:n})},Xh=()=>W.useContext(eA),ti=async(n,e,t,r="completed",i,l)=>{try{const u=new Date().toISOString();let p=i||u,g=l||u;if(p&&!/^\d{4}-\d{2}-\d{2}/.test(p))console.warn(`Invalid startDate format: ${p}, using current timestamp instead`),p=u;else if(p){const w=new Date(p);isNaN(w.getTime())&&(console.warn(`Invalid startDate value: ${p}, using current timestamp instead`),p=u)}if(g&&!/^\d{4}-\d{2}-\d{2}/.test(g))console.warn(`Invalid endDate format: ${g}, using current timestamp instead`),g=u;else if(g){const w=new Date(g);isNaN(w.getTime())&&(console.warn(`Invalid endDate value: ${g}, using current timestamp instead`),g=u)}new Date(g)<new Date(p)&&(g=p);const b={projectId:n,title:e,description:t,status:r,type:"milestone",startDate:p,endDate:g,createdAt:new Date().toISOString()};return await S6(n,b)}catch(c){throw console.error("Error logging timeline event:",c),c}},y6=async(n,e)=>{try{const t=hn(st,"projects",n,"tasks"),r=bt(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));if(await Os(r,{...i,createdAt:new Date,updatedAt:new Date}),e.assigneeId){const l=bt(st,"projects",n);try{const c=await da(bt(st,"users",e.assigneeId));c.exists()&&c.data().role==="Vendor"?await kr(l,{vendorIds:hc(e.assigneeId)}):(await da(bt(st,"vendors",e.assigneeId))).exists()&&await kr(l,{vendorIds:hc(e.assigneeId)})}catch(c){console.warn("Failed to update project vendorIds:",c)}}return r.id}catch(t){throw console.error("Error creating task:",t),t}},ni=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));if(await kr(bt(st,"projects",n,"tasks",e),{...r,updatedAt:new Date}),t.assigneeId){const i=bt(st,"projects",n);try{const l=await da(bt(st,"users",t.assigneeId));l.exists()&&l.data().role==="Vendor"?await kr(i,{vendorIds:hc(t.assigneeId)}):(await da(bt(st,"vendors",t.assigneeId))).exists()&&await kr(i,{vendorIds:hc(t.assigneeId)})}catch(l){console.warn("Failed to update project vendorIds on task update:",l)}}}catch(r){throw console.error("Error updating task:",r),r}},v6=async(n,e)=>{try{await uc(bt(st,"projects",n,"tasks",e))}catch(t){throw console.error("Error deleting task:",t),t}},iv=(n,e)=>ci(hn(st,"projects",n,"tasks"),t=>{const r=t.docs.map(i=>({...i.data(),id:i.id}));e(r)},t=>{t.code!=="permission-denied"&&console.error("Error subscribing to tasks:",t)}),b6=async(n,e)=>{try{const t=hn(st,"projects",n,"meetings"),r=bt(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await Os(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating meeting:",t),t}},w6=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));await kr(bt(st,"projects",n,"meetings",e),{...r,updatedAt:new Date})}catch(r){throw console.error("Error updating meeting:",r),r}},_6=async(n,e)=>{try{await uc(bt(st,"projects",n,"meetings",e))}catch(t){throw console.error("Error deleting meeting:",t),t}},N6=(n,e)=>ci(hn(st,"projects",n,"meetings"),t=>{const r=t.docs.map(i=>({...i.data(),id:i.id}));e(r)},t=>{t.code!=="permission-denied"&&console.error("Error subscribing to meetings:",t)}),I6=async(n,e,t)=>{try{const r=hn(st,"projects",n,"meetings",e,"comments"),i=bt(r),l=Object.fromEntries(Object.entries({...t}).filter(([c,u])=>u!==void 0));return await Os(i,{...l,createdAt:new Date}),i.id}catch(r){throw console.error("Error adding comment to meeting:",r),r}},E6=(n,e,t)=>ci(hn(st,"projects",n,"meetings",e,"comments"),r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));t(i)}),Dy=async(n,e)=>{try{const t=hn(st,"projects",n,"documents"),r=bt(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await Os(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating document:",t),t}},Fu=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));await kr(bt(st,"projects",n,"documents",e),{...r,updatedAt:new Date})}catch(r){throw console.error("Error updating document:",r),r}},T6=async(n,e)=>{try{await uc(bt(st,"projects",n,"documents",e))}catch(t){throw console.error("Error deleting document:",t),t}},tA=(n,e)=>{const t=new Map,r=[],i=ci(hn(st,"projects",n,"documents"),l=>{l.docs.forEach(c=>{const u=c.id,p=c.data();t.set(u,{...p,id:u,comments:p.comments||[]})}),t.forEach((c,u)=>{l.docs.find(p=>p.id===u)||t.delete(u)}),e(Array.from(t.values()))},l=>{l.code!=="permission-denied"&&console.error("Error subscribing to documents:",l)});return r.push(i),()=>{r.forEach(l=>l())}},A6=async(n,e,t)=>{try{const r=bt(st,"projects",n,"documents",e),i=Object.fromEntries(Object.entries({...t}).filter(([u,p])=>p!==void 0)),l=Math.random().toString(36).substr(2,9),c={id:l,userId:i.userId||"",text:i.text||"",timestamp:i.timestamp||new Date().toISOString(),...i};return await kr(r,{comments:hc(c)}),l}catch(r){throw console.error("Error adding comment:",r),r}},S6=async(n,e)=>{try{const t=hn(st,"projects",n,"timelines"),r=bt(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await Os(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating timeline:",t),t}},j6=(n,e)=>{try{const t=hn(st,"projects",n,"timelines");return ci(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));e(i)},r=>{r.code!=="permission-denied"&&console.error("Error subscribing to timelines:",r)})}catch(t){throw console.error("Error subscribing to timelines:",t),t}};/*! Capacitor: https://capacitorjs.com/ - MIT License */var Md;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Md||(Md={}));class Dx extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}const k6=n=>{var e,t;return n!=null&&n.androidBridge?"android":!((t=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},C6=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},r=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:k6(n),l=()=>i()!=="web",c=w=>{const N=g.get(w);return!!(N!=null&&N.platforms.has(i())||u(w))},u=w=>{var N;return(N=t.PluginHeaders)===null||N===void 0?void 0:N.find(D=>D.name===w)},p=w=>n.console.error(w),g=new Map,b=(w,N={})=>{const D=g.get(w);if(D)return console.warn(`Capacitor plugin "${w}" already registered. Cannot register plugins twice.`),D.proxy;const z=i(),L=u(w);let O;const le=async()=>(!O&&z in N?O=typeof N[z]=="function"?O=await N[z]():O=N[z]:e!==null&&!O&&"web"in N&&(O=typeof N.web=="function"?O=await N.web():O=N.web),O),ge=(R,M)=>{var q,U;if(L){const K=L==null?void 0:L.methods.find(V=>M===V.name);if(K)return K.rtype==="promise"?V=>t.nativePromise(w,M.toString(),V):(V,Fe)=>t.nativeCallback(w,M.toString(),V,Fe);if(R)return(q=R[M])===null||q===void 0?void 0:q.bind(R)}else{if(R)return(U=R[M])===null||U===void 0?void 0:U.bind(R);throw new Dx(`"${w}" plugin is not implemented on ${z}`,Md.Unimplemented)}},ae=R=>{let M;const q=(...U)=>{const K=le().then(V=>{const Fe=ge(V,R);if(Fe){const ue=Fe(...U);return M=ue==null?void 0:ue.remove,ue}else throw new Dx(`"${w}.${R}()" is not implemented on ${z}`,Md.Unimplemented)});return R==="addListener"&&(K.remove=async()=>M()),K};return q.toString=()=>`${R.toString()}() { [capacitor code] }`,Object.defineProperty(q,"name",{value:R,writable:!1,configurable:!1}),q},xe=ae("addListener"),j=ae("removeListener"),ie=(R,M)=>{const q=xe({eventName:R},M),U=async()=>{const V=await q;j({eventName:R,callbackId:V},M)},K=new Promise(V=>q.then(()=>V({remove:U})));return K.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await U()},K},k=new Proxy({},{get(R,M){switch(M){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return L?ie:xe;case"removeListener":return j;default:return ae(M)}}});return r[w]=k,g.set(w,{name:w,proxy:k,platforms:new Set([...Object.keys(N),...L?[z]:[]])}),k};return t.convertFileSrc||(t.convertFileSrc=w=>w),t.getPlatform=i,t.handleError=p,t.isNativePlatform=l,t.isPluginAvailable=c,t.registerPlugin=b,t.Exception=Dx,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},R6=n=>n.Capacitor=C6(n),Yo=R6(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Zh=Yo.registerPlugin;class av{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);const l=this.windowListeners[e];l&&!l.registered&&this.addWindowListener(l),r&&this.sendRetainedArgumentsForEvent(e);const c=async()=>this.removeListener(e,t);return Promise.resolve({remove:c})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){const i=this.listeners[e];if(!i){if(r){let l=this.retainedEventArguments[e];l||(l=[]),l.push(t),this.retainedEventArguments[e]=l}return}i.forEach(l=>l(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:r=>{this.notifyListeners(t,r)}}}unimplemented(e="not implemented"){return new Yo.Exception(e,Md.Unimplemented)}unavailable(e="not available"){return new Yo.Exception(e,Md.Unavailable)}async removeListener(e,t){const r=this.listeners[e];if(!r)return;const i=r.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(r=>{this.notifyListeners(e,r)}))}}const pN=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),fN=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class D6 extends av{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[i,l]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=fN(i).trim(),l=fN(l).trim(),t[i]=l}),t}async setCookie(e){try{const t=pN(e.key),r=pN(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,l=(e.path||"/").replace("path=",""),c=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${i}; path=${l}; ${c};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Zh("CapacitorCookies",{web:()=>new D6});const P6=async n=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const i=r.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},r.onerror=i=>t(i),r.readAsDataURL(n)}),O6=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,l,c)=>(i[l]=n[e[c]],i),{})},M6=(n,e=!0)=>n?Object.entries(n).reduce((r,i)=>{const[l,c]=i;let u,p;return Array.isArray(c)?(p="",c.forEach(g=>{u=e?encodeURIComponent(g):g,p+=`${l}=${u}&`}),p.slice(0,-1)):(u=e?encodeURIComponent(c):c,p=`${l}=${u}`),`${r}&${p}`},"").substr(1):null,V6=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=O6(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){const l=new URLSearchParams;for(const[c,u]of Object.entries(n.data||{}))l.set(c,u);t.body=l.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){const l=new FormData;if(n.data instanceof FormData)n.data.forEach((u,p)=>{l.append(p,u)});else for(const u of Object.keys(n.data))l.append(u,n.data[u]);t.body=l;const c=new Headers(t.headers);c.delete("content-type"),t.headers=c}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class L6 extends av{async request(e){const t=V6(e,e.webFetchExtra),r=M6(e.params,e.shouldEncodeUrlParams),i=r?`${e.url}?${r}`:e.url,l=await fetch(i,t),c=l.headers.get("content-type")||"";let{responseType:u="text"}=l.ok?e:{};c.includes("application/json")&&(u="json");let p,g;switch(u){case"arraybuffer":case"blob":g=await l.blob(),p=await P6(g);break;case"json":p=await l.json();break;case"document":case"text":default:p=await l.text()}const b={};return l.headers.forEach((w,N)=>{b[N]=w}),{data:p,headers:b,status:l.status,url:l.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Zh("CapacitorHttp",{web:()=>new L6});var gN;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(gN||(gN={}));var xN;(function(n){n.StatusBar="StatusBar",n.NavigationBar="NavigationBar"})(xN||(xN={}));class $6 extends av{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}Zh("SystemBars",{web:()=>new $6});const md=Zh("PushNotifications",{}),Px=async n=>{if(Yo.isNativePlatform())try{let e=await md.checkPermissions();return e.receive==="prompt"&&(e=await md.requestPermissions()),e.receive!=="granted"?(console.log("Push notification permission denied"),null):(await md.register(),new Promise(t=>{md.addListener("registration",async({value:r})=>{if(console.log("Push registration success, token: "+r),r&&n){const i=bt(st,"users",n);(await da(i)).exists()&&(await kr(i,{fcmTokens:hc(r)}),console.log(" Native Token saved successfully!"))}t(r)}),md.addListener("registrationError",r=>{console.error("Error on registration: "+JSON.stringify(r)),t(null)})}))}catch(e){return console.error("Error requesting native notification permission:",e),null}if(!ff)return console.log("Notification permission skipped: Messaging not supported"),null;try{console.log("Requesting notification permission for user:",n);const e=await Notification.requestPermission();if(console.log("Permission status:",e),e==="granted"){console.log("Getting FCM token...");const t=await GM(ff,{vapidKey:"BC8fFC7blIHMaLia44KI9ALElvAUqVUTn_x_GL7Ce17SVafTMdVNyMIRSnxPu6UjbkSrisqkYJb2_XZvzTCKjq0"});if(console.log("FCM Token received:",t?t.substring(0,20)+"...":"null"),t&&n){const r=bt(st,"users",n);(await da(r)).exists()?(console.log("Saving token to user profile..."),await kr(r,{fcmTokens:hc(t)}),console.log(" Token saved successfully!")):console.error("User document doesn't exist:",n)}else console.error("Token or userId missing:",{hasToken:!!t,userId:n});return t}else return console.log("Notification permission denied"),null}catch(e){return console.error("Error requesting notification permission:",e),null}},F6=n=>new Promise(e=>{if(Yo.isNativePlatform()){md.addListener("pushNotificationReceived",t=>{console.log("Push received: "+JSON.stringify(t)),n&&n({title:t.title||"New Notification",message:t.body||"",type:"info"}),e(t)});return}if(!ff){e(null);return}KM(ff,t=>{var r,i,l,c,u;if(console.log(" Foreground message received:",t),Notification.permission==="granted"){const p=((r=t.notification)==null?void 0:r.title)||"New Notification",g={body:((i=t.notification)==null?void 0:i.body)||"",icon:((l=t.notification)==null?void 0:l.icon)||"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png",tag:"notification-"+Date.now(),requireInteraction:!1,data:{url:((c=t.data)==null?void 0:c.url)||((u=t.fcmOptions)==null?void 0:u.link)||"/"}},b=new Notification(p,g);b.onclick=w=>{w.preventDefault();const N=g.data.url;window.focus(),N!=="/"&&(window.location.href=N),b.close()},console.log(" Browser notification displayed")}e(t)})}),B6=()=>"https://sendpushnotification-jl3d2uhdra-uc.a.run.app",U6=B6(),di=async(n,e,t,r)=>{try{await fetch(U6,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientId:n,title:e,body:t,url:r,icon:"/icons/icon-192x192.png"})})}catch(i){console.error("Error sending push notification:",i)}},z6=n=>n.split(" ").slice(0,2).map(e=>e.charAt(0).toUpperCase()).join(""),q6=(n,e)=>{if(e==="client")return{bg:"bg-blue-100",text:"text-blue-700",border:"border-blue-200"};if(e==="vendor")return{bg:"bg-amber-100",text:"text-amber-700",border:"border-amber-200"};if(e==="designer"||e==="team")return{bg:"bg-indigo-100",text:"text-indigo-700",border:"border-indigo-200"};if(e==="admin")return{bg:"bg-gray-800",text:"text-white",border:"border-gray-700"};const t=[{bg:"bg-red-500",text:"text-white"},{bg:"bg-blue-500",text:"text-white"},{bg:"bg-green-500",text:"text-white"},{bg:"bg-purple-500",text:"text-white"},{bg:"bg-pink-500",text:"text-white"},{bg:"bg-yellow-500",text:"text-white"},{bg:"bg-indigo-500",text:"text-white"},{bg:"bg-teal-500",text:"text-white"},{bg:"bg-orange-500",text:"text-white"},{bg:"bg-cyan-500",text:"text-white"}],r=n.split("").reduce((i,l)=>i+l.charCodeAt(0),0);return t[r%t.length]},Ba=({avatar:n,name:e,size:t="md",role:r})=>{const i=z6(e),l=q6(i,r),c={sm:"w-8 h-8 text-xs",md:"w-12 h-12 text-sm",lg:"w-16 h-16 text-lg"},u=l.border?l.border:"border-gray-200";return a.jsx("div",{className:`${c[t]} ${l.bg} rounded-full flex items-center justify-center ${l.text} font-bold border-2 ${u}`,children:i})},ra=n=>{if(n.progress!==void 0&&n.progress!==null)return Math.min(Math.max(n.progress,0),100);if(n.subtasks&&n.subtasks.length>0){const e=n.subtasks.filter(t=>t.isCompleted).length;return Math.round(e/n.subtasks.length*100)}return n.status===pe.DONE||n.status===pe.REVIEW?100:n.status===pe.IN_PROGRESS?50:0},gh=n=>{if(!n||n.length===0)return 0;const e=n.reduce((t,r)=>t+ra(r),0);return Math.round(e/n.length)},pp=(n,e=pe.TODO)=>{var i,l,c,u,p,g,b,w,N,D,z,L;if(e===pe.ABORTED||e===pe.ON_HOLD)return e;const t=n.subtasks||[];if(t.length===0)return e;const r=t.filter(O=>O.isCompleted).length;if(r===0)return pe.TODO;if(r===t.length){const O=((c=(l=(i=n.approvals)==null?void 0:i.start)==null?void 0:l.client)==null?void 0:c.status)==="approved",le=((g=(p=(u=n.approvals)==null?void 0:u.start)==null?void 0:p.admin)==null?void 0:g.status)==="approved",ge=((N=(w=(b=n.approvals)==null?void 0:b.completion)==null?void 0:w.client)==null?void 0:N.status)==="approved",ae=((L=(z=(D=n.approvals)==null?void 0:D.completion)==null?void 0:z.admin)==null?void 0:L.status)==="approved";return O&&le&&ge&&ae?pe.DONE:pe.REVIEW}return pe.IN_PROGRESS},Ox=n=>{try{const e=new Date(n);if(isNaN(e.getTime()))return n;const r=new Date().getTime()-e.getTime(),i=Math.floor(r/1e3),l=Math.floor(i/60),c=Math.floor(l/60),u=Math.floor(c/24),p=Math.floor(u/7),g=Math.floor(u/30);return i<60?"Just now":l<60?`${l} minute${l>1?"s":""} ago`:c<24?`${c} hour${c>1?"s":""} ago`:u<7?`${u} day${u>1?"s":""} ago`:p<4?`${p} week${p>1?"s":""} ago`:`${g} month${g>1?"s":""} ago`}catch{return n}},ln=n=>{if(!n)return"";try{let e;if(n.includes("-"))e=new Date(n);else if(n.includes("/")){const l=n.split("/");if(l.length===3){const c=parseInt(l[0]),u=parseInt(l[1]),p=parseInt(l[2]);if(c>12)return n;e=new Date(p,u-1,c)}else return n}else e=new Date(n);if(isNaN(e.getTime()))return n;const t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return`${t}/${r}/${i}`}catch{return n}},Py=async(n,e)=>{try{const t=hn(st,"projects",n,"finances"),r=bt(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await Os(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating financial record:",t),t}},pd=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));await kr(bt(st,"projects",n,"finances",e),{...r,updatedAt:new Date})}catch(r){throw console.error("Error updating financial record:",r),r}},W6=async(n,e)=>{try{await uc(bt(st,"projects",n,"finances",e))}catch(t){throw console.error("Error deleting financial record:",t),t}},nA=(n,e)=>ci(hn(st,"projects",n,"finances"),t=>{const r=t.docs.map(i=>({...i.data(),id:i.id}));e(r)},t=>{t.code!=="permission-denied"&&console.error("Error subscribing to financial records:",t)}),H6=()=>"https://sendemail-jl3d2uhdra-uc.a.run.app",G6=H6(),Qr=async n=>{if(!n.to||!n.subject||!n.htmlContent)return{success:!1,error:"Missing required email fields"};try{const e={to:n.to,recipientName:n.recipientName||n.to.split("@")[0],subject:n.subject,htmlContent:n.htmlContent},t=await fetch(G6,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const i=await t.json();return console.error(" Cloud Function error:",i),{success:!1,error:i.error||"Failed to send email"}}return{success:!0,messageId:(await t.json()).messageId}}catch(e){return console.error(" Error sending email:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},rA=async(n,e,t,r,i)=>{const l=`
    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
      <div style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
        <h2 style="color: #fff; margin: 0; font-size: 24px;"> Task Reminder</h2>
      </div>
      
      <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
        <p style="color: #333; font-size: 16px;">Hi <strong>${e}</strong>,</p>
        
        <p style="color: #555; font-size: 14px;">This is a friendly reminder about the following task:</p>
        
        <div style="background-color: #eff6ff; border-left: 4px solid #2563eb; padding: 15px; margin: 20px 0; border-radius: 4px;">
          <p style="margin: 8px 0; color: #333;"><strong>Task:</strong> ${t}</p>
          <p style="margin: 8px 0; color: #333;"><strong>Project:</strong> ${r}</p>
          <p style="margin: 8px 0; color: #d97706;"><strong>Due Date:</strong> ${ln(i)}</p>
        </div>
        
        <p style="color: #555; font-size: 14px;">Please update the task status at your earliest convenience.</p>
        
        <p style="margin-top: 30px; color: #999; font-size: 12px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
          Regards,<br>
          <strong>ID ERP System</strong>
        </p>
      </div>
    </div>
  `;return Qr({to:n,recipientName:e,subject:`Reminder: ${t}`,htmlContent:l})},K6=async(n,e,t,r)=>{const i=`
    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
      <div style="background: linear-gradient(135deg, #ca8a04 0%, #b45309 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
        <h2 style="color: #fff; margin: 0; font-size: 24px;"> Payment Reminder</h2>
      </div>
      
      <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
        <p style="color: #333; font-size: 16px;">Hi <strong>${e}</strong>,</p>
        
        <p style="color: #555; font-size: 14px;">This is a gentle reminder regarding pending payments for the following project:</p>
        
        <div style="background-color: #fef3c7; border-left: 4px solid #ca8a04; padding: 15px; margin: 20px 0; border-radius: 4px;">
          <p style="margin: 8px 0; color: #333;"><strong>Project:</strong> ${t}</p>
          
        </div>
        
        <p style="color: #555; font-size: 14px;">Please clear the dues at your earliest convenience to avoid any service delays.</p>
        
        <p style="margin-top: 30px; color: #999; font-size: 12px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
          Regards,<br>
          <strong>ID ERP System</strong>
        </p>
      </div>
    </div>
  `;return Qr({to:n,recipientName:e,subject:`Payment Reminder: ${t}`,htmlContent:i})};var Ja={};const Q6=async(n,e,t,r=new Set)=>{const i=new Date,l=new Date(i.getTime()+1440*60*1e3),c=new Date(i.getTime()+1500*60*1e3);for(const u of n){const p=new Date(u.dueDate),g=`${u.id}-24h-reminder`;if(p>l&&p<c&&!r.has(g)){const b=e.find(w=>w.id===u.assigneeId);if(b!=null&&b.email)try{const w=await rA(b.email,b.name,u.title,t,u.dueDate);w.success?(r.add(g),await di(b.id,"Task Due Reminder",`Task "${u.title}" is due tomorrow in project ${t}`)):console.error(" Failed to send 24-hour reminder:",w.error)}catch(w){console.error(" Error sending 24-hour reminder:",w)}}}},Y6=async(n,e,t,r,i)=>{const l=typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173",c=i?`${l}?projectId=${i}&tab=documents`:void 0;for(const u of r){if(!u.email){console.warn(` No email for recipient ${u.name}`);continue}try{const p=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #1f2937;">New Document Uploaded</h2>
          <p>Hi ${u.name},</p>
          <p><strong>${e}</strong> uploaded a new document in project <strong>${t}</strong>:</p>
          
          <div style="background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <p style="margin: 0; color: #4b5563;"><strong>Document:</strong> ${n.name}</p>
            <p style="margin: 10px 0 0 0; color: #6b7280;"><strong>Type:</strong> ${n.type}</p>
          </div>
          
          <p style="margin-top: 20px;">
            <a href="${c}" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">View Document</a>
          </p>
        </div>
      `,g=await Qr({to:u.email,recipientName:u.name,subject:`New Document Uploaded: ${n.name} - ${t}`,htmlContent:p});g.success?await di(u.id,`New Document - ${t}`,`${e} uploaded "${n.name}" (${n.type})`,c):console.error(` Failed to send document upload notification to ${u.name}:`,g.error)}catch(p){console.error(` Error sending document upload notification to ${u.name}:`,p)}}},Mx=async(n,e,t,r,i)=>{if(!e.email){console.warn(` No email for recipient ${e.name}`);return}const l=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dcfce7; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #16a34a; margin: 0;"> Task Approved</h2>
      </div>
      
      <p>Hi <strong>${e.name}</strong>,</p>
      
      <p>The task <strong>"${n}"</strong> in project <strong>${t}</strong> has been approved.</p>
      
      <div style="background-color: #f0fdf4; border-left: 4px solid #16a34a; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n}</p>
        <p style="margin: 5px 0;"><strong>Project:</strong> ${t}</p>
        <p style="margin: 5px 0;"><strong>Approval Stage:</strong> ${i}</p>
        <p style="margin: 5px 0;"><strong>Approved by:</strong> ${r}</p>
      </div>
      
      <p>Great work! The task has been successfully approved and is moving forward.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;try{const c=await Qr({to:e.email,recipientName:e.name,subject:`Task Approved: ${n}`,htmlContent:l});c.success?await di(e.id,"Task Approved",`Task "${n}" in project ${t} has been approved by ${r}`):console.error(" Failed to send task approval email:",c.error)}catch(c){console.error(" Error sending task approval email:",c)}},yN=async(n,e,t,r,i="created")=>{if(!e||e.length===0){console.warn(` No attendees for meeting ${n.title}`);return}const c=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${r}&meetingId=${n.id}&tab=meetings`,u=i==="created"?"New Meeting Scheduled":"Meeting Updated",p=i==="created"?"#0284c7":"#f59e0b",b=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${i==="created"?"#dbeafe":"#fef3c7"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${p}; margin: 0;"> ${u}</h2>
      </div>
      
      <p>Hi <strong>Team</strong>,</p>
      
      <p>${i==="created"?"A new meeting has been scheduled":"A meeting has been updated"} for project <strong>${t}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid ${p}; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Meeting Title:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type}</p>
        <p style="margin: 5px 0;"><strong>Date:</strong> ${ln(n.date)}</p>
        <p style="margin: 5px 0;"><strong>Project:</strong> ${t}</p>
        ${n.notes?`<p style="margin: 5px 0;"><strong>Notes:</strong> ${n.notes}</p>`:""}
      </div>
      
      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <p style="margin: 5px 0; font-weight: bold;">Attendees:</p>
        <ul style="margin: 10px 0; padding-left: 20px;">
          ${e.map(w=>`<li>${w.name}${w.email?` (${w.email})`:""}</li>`).join("")}
        </ul>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${c}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Meeting Details
        </a>
      </div>
      
      <p>Click the button above to view the full meeting details and any additional information in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const w of e){if(!w.email){console.warn(` No email for attendee ${w.name}`);continue}try{const N=await Qr({to:w.email,recipientName:w.name,subject:`${u}: ${n.title} - ${t}`,htmlContent:b});N.success?await di(w.id,u,`${i==="created"?"New meeting scheduled":"Meeting updated"}: ${n.title} in project ${t}`,c):console.error(` Failed to send meeting notification email to ${w.name}:`,N.error)}catch(N){console.error(` Error sending meeting notification email to ${w.name}:`,N)}}},vN=async(n,e,t,r,i="created")=>{if(!e.email){console.warn(` No email for assignee ${e.name}`);return}const c=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${r}&taskId=${n.id}&tab=plan`,u=i==="created"?"New Task Assigned":"Task Updated",p=i==="created"?"#0284c7":"#f59e0b",b=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${i==="created"?"#dbeafe":"#fef3c7"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${p}; margin: 0;"> ${u}</h2>
      </div>
      
      <p>Hi <strong>${e.name}</strong>,</p>
      
      <p>${i==="created"?"You have been assigned a new task":"A task you are assigned to has been updated"} in project <strong>${t}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid ${p}; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Category:</strong> ${n.category}</p>
        <p style="margin: 5px 0;"><strong>Priority:</strong> <span style="color: ${n.priority==="high"?"#dc2626":n.priority==="medium"?"#f59e0b":"#059669"}; font-weight: bold;">${n.priority.toUpperCase()}</span></p>
        <p style="margin: 5px 0;"><strong>Start Date:</strong> ${ln(n.startDate)}</p>
        <p style="margin: 5px 0;"><strong>Due Date:</strong> ${ln(n.dueDate)}</p>
        ${n.description?`<p style="margin: 5px 0;"><strong>Description:</strong> ${n.description}</p>`:""}
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${c}" style="display: inline-block; background-color: ${p}; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Task Details
        </a>
      </div>
      
      <p>Click the button above to view the full task details and start working on it in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;try{const w=await Qr({to:e.email,recipientName:e.name,subject:`${u}: ${n.title} - ${t}`,htmlContent:b});w.success?await di(e.id,u,`${i==="created"?"New task assigned":"Task updated"}: ${n.title} in project ${t}`,c):console.error(" Failed to send task assignment notification email:",w.error)}catch(w){console.error(" Error sending task assignment notification email:",w)}},J6=async(n,e,t,r)=>{if(!e||e.length===0){console.warn(" No recipients for task completion approval notification");return}const l=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${r}&taskId=${n.id}&tab=plan`,c=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #0284c7; margin: 0;"> Task Completion Approval Pending</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>A task has been completed and requires final approval in project <strong>${t}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Category:</strong> ${n.category}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> 100% Complete - Awaiting Final Approval</p>
        <p style="margin: 5px 0;"><strong>Due Date:</strong> ${ln(n.dueDate)}</p>
      </div>
      
      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <p style="margin: 5px 0; font-weight: bold;">Approval Required From:</p>
        <ul style="margin: 10px 0; padding-left: 20px;">
          <li>Client</li>
          <li>Admin</li>
        </ul>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${l}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          Review & Approve Completion
        </a>
      </div>
      
      <p>Click the button above to review the completed task and provide your final approval in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const u of e){if(!u.email){console.warn(` No email for recipient ${u.name}`);continue}try{const p=await Qr({to:u.email,recipientName:u.name,subject:`Task Completion Approval: ${n.title} - ${t}`,htmlContent:c});p.success?await di(u.id,"Task Completion Approval Pending",`Task "${n.title}" in project ${t} requires completion approval`,l):console.error(` Failed to send task completion approval notification to ${u.name}:`,p.error)}catch(p){console.error(` Error sending task completion approval notification to ${u.name}:`,p)}}},X6=async(n,e,t,r,i,l)=>{if(!r||r.length===0){console.warn(" No recipients for task comment notification");return}const u=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${l}&taskId=${n.id}&tab=plan`,p=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #0284c7; margin: 0;"> New Comment on Task</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p><strong>${t}</strong> added a comment to task <strong>"${n.title}"</strong> in project <strong>${i}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Category:</strong> ${n.category}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${n.status}</p>
        <p style="margin: 5px 0;"><strong>Commenter:</strong> ${t}</p>
      </div>
      
      <div style="background-color: #fff8f0; border-left: 4px solid #ea580c; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0 10px 0; font-weight: bold;">Comment:</p>
        <p style="margin: 0; white-space: pre-wrap; color: #333;">${e.text}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Task & Comments
        </a>
      </div>
      
      <p>Click the button above to view the full task and all comments in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const g of r)if(g.id!==e.userId){if(!g.email){console.warn(` No email for recipient ${g.name}`);continue}try{const b=await Qr({to:g.email,recipientName:g.name,subject:`New Comment on Task: ${n.title} - ${i}`,htmlContent:p});b.success?await di(g.id,`New Comment on Task - ${i}`,`${t} commented on "${n.title}": ${e.text.substring(0,80)}${e.text.length>80?"...":""}`,u):console.error(` Failed to send task comment notification to ${g.name}:`,b.error)}catch(b){console.error(` Error sending task comment notification to ${g.name}:`,b)}}},Z6=async(n,e,t,r,i,l)=>{if(!r||r.length===0){console.warn(" No recipients for document comment notification");return}const u=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${l}&tab=documents&docId=${n.id}`,p=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #0284c7; margin: 0;"> New Comment on Document</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p><strong>${t}</strong> added a comment to document <strong>"${n.name}"</strong> in project <strong>${i}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Document:</strong> ${n.name}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type||"Not specified"}</p>
        <p style="margin: 5px 0;"><strong>Commenter:</strong> ${t}</p>
        <p style="margin: 5px 0;"><strong>Admin Approval:</strong> ${n.approvalStatus||"Pending"}</p>
      </div>
      
      <div style="background-color: #fff8f0; border-left: 4px solid #ea580c; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0 10px 0; font-weight: bold;">Comment:</p>
        <p style="margin: 0; white-space: pre-wrap; color: #333;">${e.text}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Document & Comments
        </a>
      </div>
      
      <p>Click the button above to view the full document and all comments in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const g of r)if(g.id!==e.userId){if(!g.email){console.warn(` No email for recipient ${g.name}`);continue}try{const b=await Qr({to:g.email,recipientName:g.name,subject:`New Comment on Document: ${n.name} - ${i}`,htmlContent:p});b.success?await di(g.id,"New Comment on Document",`${t} commented on document "${n.name}" in project ${i}: ${e.text.substring(0,50)}${e.text.length>50?"...":""}`,u):console.error(` Failed to send document comment notification to ${g.name}:`,b.error)}catch(b){console.error(` Error sending document comment notification to ${g.name}:`,b)}}},bN=async(n,e,t,r,i,l="approved")=>{if(!t||t.length===0){console.warn(" No recipients for document admin approval notification");return}const u=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${i}&tab=documents&docId=${n.id}`,p=l==="approved",g=p?"#dcfce7":"#fee2e2",b=p?"#16a34a":"#dc2626",w=p?"Approved":"Rejected",D=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${g}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${b}; margin: 0;">${p?"":""} Document ${w} by Admin</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>Document <strong>"${n.name}"</strong> has been <strong>${l}</strong> by admin <strong>${e}</strong> in project <strong>${r}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Document:</strong> ${n.name}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type||"Not specified"}</p>
        <p style="margin: 5px 0;"><strong>Admin:</strong> ${e}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${w}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View All Documents
        </a>
      </div>
      
      <p>Click the button above to view all documents and their approval status in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const z of t){if(!z.email){console.warn(` No email for recipient ${z.name}`);continue}try{const L=await Qr({to:z.email,recipientName:z.name,subject:`Document ${w} by Admin: ${n.name} - ${r}`,htmlContent:D});L.success?await di(z.id,`Document ${w} by Admin`,`Document "${n.name}" in project ${r} has been ${l} by ${e}`,u):console.error(` Failed to send document admin approval notification to ${z.name}:`,L.error)}catch(L){console.error(` Error sending document admin approval notification to ${z.name}:`,L)}}},wN=async(n,e,t,r,i,l="approved")=>{if(!t||t.length===0){console.warn(" No recipients for document client approval notification");return}const u=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${i}&tab=documents`,p=l==="approved",g=p?"#dcfce7":"#fee2e2",b=p?"#16a34a":"#dc2626",w=p?"Approved":"Rejected",D=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${g}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${b}; margin: 0;">${p?"":""} Document ${w} by Client</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>Document <strong>"${n.name}"</strong> has been <strong>${l}</strong> by client <strong>${e}</strong> in project <strong>${r}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Document:</strong> ${n.name}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type||"Not specified"}</p>
        <p style="margin: 5px 0;"><strong>Client:</strong> ${e}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${w}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View All Documents
        </a>
      </div>
      
      <p>Click the button above to view all documents and their approval status in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const z of t){if(!z.email){console.warn(` No email for recipient ${z.name}`);continue}try{const L=await Qr({to:z.email,recipientName:z.name,subject:`Document ${w} by Client: ${n.name} - ${r}`,htmlContent:D});L.success?await di(z.id,`Document ${w} by Client`,`Document "${n.name}" in project ${r} has been ${l} by ${e}`,u):console.error(` Failed to send document client approval notification to ${z.name}:`,L.error)}catch(L){console.error(` Error sending document client approval notification to ${z.name}:`,L)}}},Vx=async(n,e,t,r,i,l="approved",c="admin",u="expense")=>{if(!t||t.length===0){console.warn(" No recipients for financial approval notification");return}const g=`${typeof window<"u"?window.location.origin:Ja.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${i}&tab=financials`,b=l==="approved",w=b?"#dcfce7":"#fee2e2",N=b?"#16a34a":"#dc2626",D=b?"":"";let z="Financial Record";u==="additional-budget"?z="Additional Budget":u==="expense"?z="Expense":u==="payment"&&(z="Payment");const L=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${w}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${N}; margin: 0;">${D} ${z} ${l==="approved"?"Approved":"Rejected"}</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>A ${z.toLowerCase()} has been <strong>${l}</strong> by <strong>${e}</strong> (${c}) in project <strong>${r}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Type:</strong> ${z}</p>
        <p style="margin: 5px 0;"><strong>Description:</strong> ${n.description}</p>
        <p style="margin: 5px 0;"><strong>Amount:</strong> ${n.amount.toLocaleString()}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${n.status}</p>
        <p style="margin: 5px 0;"><strong>Approved By:</strong> ${e}</p>
        <p style="margin: 5px 0;"><strong>Approval Status:</strong> ${l==="approved"?"Approved ":"Rejected "}</p>
      </div>

      ${u==="additional-budget"?`
        <div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 4px;">
          <p style="margin: 5px 0; font-weight: bold;"> Additional Budget</p>
          <p style="margin: 5px 0;">This is a request to increase the project budget by ${n.amount.toLocaleString()}. Approval from both Client and Admin is required.</p>
        </div>
      `:""}
      
      <div style="margin: 20px 0;">
        <a href="${g}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Financial Records
        </a>
      </div>
      
      <p>Click the button above to view all financial records and their approval status in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const O of t){if(!O.email){console.warn(` No email for recipient ${O.name}`);continue}try{const le=await Qr({to:O.email,recipientName:O.name,subject:`${z} ${l==="approved"?"Approved":"Rejected"}: ${n.description} - ${r}`,htmlContent:L});le.success?await di(O.id,`${z} ${l==="approved"?"Approved":"Rejected"}`,`${z} "${n.description}" in project ${r} has been ${l} by ${e}`,g):console.error(` Failed to send financial approval notification to ${O.name}:`,le.error)}catch(le){console.error(` Error sending financial approval notification to ${O.name}:`,le)}}},eV=async(n,e,t,r,i)=>{const l=`/projects?projectId=${n.id}`;for(const c of i){if(!c.email){console.warn(` No email for recipient ${c.name}`);continue}try{const u=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #1f2937;">New Comment on Meeting</h2>
          <p>Hi ${c.name},</p>
          <p><strong>${t}</strong> commented on a meeting in project <strong>${r}</strong>:</p>
          
          <div style="background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <p style="margin: 0; color: #4b5563;"><strong>Meeting:</strong> ${n.title}</p>
            <p style="margin: 10px 0 0 0; color: #6b7280;">"${e.text}"</p>
          </div>
          
          <p style="margin-top: 20px;">
            <a href="${l}" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">View Meeting</a>
          </p>
        </div>
      `,p=await Qr({to:c.email,recipientName:c.name,subject:`New Comment on Meeting: ${n.title} - ${r}`,htmlContent:u});p.success?await di(c.id,`New Comment on Meeting - ${r}`,`${t} commented on "${n.title}": ${e.text.substring(0,100)}${e.text.length>100?"...":""}`,l):console.error(` Failed to send meeting comment notification to ${c.name}:`,p.error)}catch(u){console.error(` Error sending meeting comment notification to ${c.name}:`,u)}}},fp=({currentField:n,currentOrder:e,fields:t,onSort:r})=>a.jsxs("div",{className:"flex items-center gap-1 bg-white/50 rounded-lg px-2 py-1 border border-gray-100",children:[a.jsx("select",{value:n,onChange:i=>r(i.target.value,e),className:"text-[10px] font-bold bg-transparent border-none focus:ring-0 cursor-pointer text-gray-500 hover:text-gray-700 p-0","aria-label":"Sort field",title:"Sort field",children:t.map(i=>a.jsx("option",{value:i.value,children:i.label},i.value))}),a.jsx("button",{onClick:()=>r(n,e==="asc"?"desc":"asc"),className:"p-0.5 hover:bg-gray-200 rounded transition-colors text-gray-400 hover:text-gray-600",title:`Sort ${e==="asc"?"Descending":"Ascending"}`,children:e==="asc"?a.jsx(iS,{className:"w-3 h-3"}):a.jsx(nS,{className:"w-3 h-3"})})]}),tV=({projects:n,users:e,onSelectProject:t,onSelectTask:r})=>{const{user:i}=ha(),[l,c]=W.useState(new Map),[u,p]=W.useState(new Map),[g,b]=W.useState(new Map),[w,N]=W.useState({}),[D,z]=W.useState({}),[L,O]=W.useState(new Set),[le,ge]=W.useState({field:"activity",order:"desc"}),[ae,xe]=W.useState({field:"activity",order:"desc"}),[j,ie]=W.useState({field:"activity",order:"desc"});if(!i)return null;const k=async(P,H)=>{var we;const $=((we=P.subtasks)==null?void 0:we.map(he=>({...he,isCompleted:!0})))||[];let oe=P.status;P.status===pe.REVIEW?oe=pe.DONE:oe=pe.REVIEW;try{await ni(H.id,P.id,{subtasks:$,status:oe})}catch(he){console.error("Error completing task:",he)}};W.useEffect(()=>{if(n.length===0)return;const P=[];return n.forEach(H=>{const $=iv(H.id,he=>{c(ke=>new Map(ke).set(H.id,he))});P.push($);const oe=tA(H.id,he=>{p(ke=>new Map(ke).set(H.id,he))});P.push(oe);const we=nA(H.id,he=>{b(ke=>new Map(ke).set(H.id,he))});P.push(we)}),()=>{P.forEach(H=>H())}},[n]),W.useEffect(()=>{const P=async()=>{for(const he of n){const ke=l.get(he.id)||he.tasks||[];await Q6(ke,e,he.name,L)}},H=new Date,$=new Date;$.setDate($.getDate()+1),$.setHours(8,0,0,0);const oe=$.getTime()-H.getTime(),we=setTimeout(()=>{P();const he=setInterval(P,1440*60*1e3);return()=>clearInterval(he)},Math.max(0,oe));return()=>clearTimeout(we)},[n,l,e,L]);const R=P=>{var H;return l.get(P)||((H=n.find($=>$.id===P))==null?void 0:H.tasks)||[]},M=P=>P?typeof P=="string"?new Date(P).getTime():P.toDate&&typeof P.toDate=="function"?P.toDate().getTime():P instanceof Date?P.getTime():new Date(P).getTime()||0:0,q=P=>{var he,ke,me,$e,pt,at,lt,on;const $=(R(P.id)||[]).reduce((Re,Oe)=>{var Be,zt,_t,Tt;const mn=M((Tt=(_t=(zt=(Be=Oe.comments)==null?void 0:Be.slice)==null?void 0:zt.call(Be,-1))==null?void 0:_t[0])==null?void 0:Tt.timestamp),pn=M(Oe.completedAt||Oe.modifiedAt||Oe.lastModified||Oe.createdAt||Oe.timestamp),yn=Math.max(mn||0,pn||0);return Math.max(Re,yn||0)},0),oe=M(($e=(me=(ke=(he=P.documents)==null?void 0:he.slice)==null?void 0:ke.call(he,-1))==null?void 0:me[0])==null?void 0:$e.uploadDate),we=M(P.updatedAt||P.modifiedAt||P.lastModified||((on=(lt=(at=(pt=P.activityLog)==null?void 0:pt.slice)==null?void 0:at.call(pt,-1))==null?void 0:lt[0])==null?void 0:on.timestamp)||P.createdAt||oe);return Math.max(we||0,$||0)},U=(P,H)=>{var he,ke,me,$e;const $=M(($e=(me=(ke=(he=P.comments)==null?void 0:he.slice)==null?void 0:ke.call(he,-1))==null?void 0:me[0])==null?void 0:$e.timestamp),oe=M(P.completedAt||P.modifiedAt||P.createdAt||P.timestamp),we=H?q(H):0;return Math.max($||0,oe||0,we||0)},K=P=>{var H,$,oe;try{const we=((oe=($=(H=P==null?void 0:P.approvals)==null?void 0:H.completion)==null?void 0:$.admin)==null?void 0:oe.status)==="approved",he=P.status===pe.DONE,ke=P.status===pe.REVIEW;return we&&(he||ke)}catch{return!1}},V=P=>{var H;return u.get(P)||((H=n.find($=>$.id===P))==null?void 0:H.documents)||[]},Fe=P=>{var H;return g.get(P)||((H=n.find($=>$.id===P))==null?void 0:H.financials)||[]},ue=P=>{const H=[],$=R(P.id),oe=V(P.id),we=Fe(P.id);return $.forEach(he=>{var ke,me;i.role===F.ADMIN?(he.approvals.start.admin.status==="pending"&&H.push({label:`Start: ${he.title}`,type:"task",projectName:P.name,projectId:P.id,task:he}),he.approvals.completion.admin.status==="pending"&&H.push({label:`End: ${he.title}`,type:"task",projectName:P.name,projectId:P.id,task:he})):i.role===F.CLIENT?(he.approvals.start.client.status==="pending"&&H.push({label:`Start: ${he.title}`,type:"task",projectName:P.name,projectId:P.id,task:he}),he.approvals.completion.client.status==="pending"&&H.push({label:`End: ${he.title}`,type:"task",projectName:P.name,projectId:P.id,task:he})):i.role===F.DESIGNER&&(((ke=he.approvals.start.designer)==null?void 0:ke.status)==="pending"&&H.push({label:`Start: ${he.title}`,type:"task",projectName:P.name,projectId:P.id,task:he}),((me=he.approvals.completion.designer)==null?void 0:me.status)==="pending"&&H.push({label:`End: ${he.title}`,type:"task",projectName:P.name,projectId:P.id,task:he}))}),oe.forEach(he=>{i.role===F.ADMIN?he.approvalStatus==="pending"&&H.push({label:`Doc: ${he.name}`,type:"doc",projectName:P.name,projectId:P.id}):i.role===F.CLIENT&&he.approvalStatus==="approved"&&(he.clientApprovalStatus==="pending"||!he.clientApprovalStatus)&&(Array.isArray(he.sharedWith)&&he.sharedWith.includes(i.id)||P.clientId===i.id||(P.clientIds||[]).includes(i.id))&&H.push({label:`Doc: ${he.name}`,type:"doc",projectName:P.name,projectId:P.id})}),we.forEach(he=>{i.role===F.ADMIN?(he.isAdditionalBudget&&he.adminApprovalForAdditionalBudget==="pending"&&H.push({label:`Budget: ${he.description}`,type:"fin",projectName:P.name,projectId:P.id}),he.isClientPayment&&he.adminApprovalForPayment==="pending"&&H.push({label:`Payment: ${he.description}`,type:"fin",projectName:P.name,projectId:P.id})):i.role===F.CLIENT&&(he.isAdditionalBudget&&he.clientApprovalForAdditionalBudget==="pending"&&H.push({label:`Budget: ${he.description}`,type:"fin",projectName:P.name,projectId:P.id}),he.isClientPayment&&he.clientApprovalForPayment==="pending"&&H.push({label:`Payment: ${he.description}`,type:"fin",projectName:P.name,projectId:P.id}))}),H};let Te=n,Ie=[];if(i.role===F.CLIENT)Te=n.filter(P=>[P.clientId,...P.clientIds||[]].filter(Boolean).includes(i.id));else if(i.role===F.DESIGNER){const P=new Set(n.filter(H=>H.leadDesignerId===i.id||(H.teamMembers||[]).includes(i.id)||(H.clientIds||[]).includes(i.id)).map(H=>H.id));Te=n.filter(H=>P.has(H.id)),Ie=n.flatMap(H=>R(H.id).map($=>({task:$,project:H}))).filter(H=>H.task.assigneeId===i.id)}else if(i.role===F.VENDOR){Ie=n.flatMap(H=>R(H.id).map($=>({task:$,project:H}))).filter(H=>H.task.assigneeId===i.id);const P=new Set(Ie.map(H=>H.project.id));Te=n.filter(H=>P.has(H.id)||(H.vendorIds||[]).includes(i.id)||(H.teamMembers||[]).includes(i.id))}const fe=({title:P,value:H,icon:$,color:oe,onClick:we})=>a.jsxs("div",{onClick:we,className:`bg-white p-5 md:p-6 rounded-xl border border-gray-100 flex items-center justify-between hover:shadow-sm transition-shadow ${we?"cursor-pointer hover:border-gray-300":""}`,children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wide mb-1",children:P}),a.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:H})]}),a.jsx("div",{className:`p-3 rounded-lg ${oe} bg-opacity-10`,children:a.jsx($,{className:`w-6 h-6 ${oe.replace("bg-","text-")}`})})]});return a.jsxs("div",{className:"space-y-2 animate-fade-in max-w-7xl pb-12",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1 mt-4",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:(i.role===F.ADMIN,"Dashboard")}),a.jsx("div",{className:"flex items-center gap-3",children:a.jsx("span",{className:"text-sm text-gray-500 font-medium px-4 py-1.5 bg-white rounded-full border border-gray-200",children:new Date().toLocaleDateString("en-IN",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:i.role===F.VENDOR?a.jsx(fe,{title:"My Tasks",value:Ie.length,icon:ep,color:"bg-blue-500",onClick:()=>{const P=document.querySelector('[data-section="vendor-tasks"]');P==null||P.scrollIntoView({behavior:"smooth"})}}):i.role===F.CLIENT?a.jsx(fe,{title:"Completed Tasks",value:Te.flatMap(P=>R(P.id)).filter(P=>P.status===pe.DONE).length,icon:xp,color:"bg-green-500",onClick:()=>{const P=document.querySelector('[data-section="project-overview"]');P==null||P.scrollIntoView({behavior:"smooth"})}}):null}),(i.role===F.ADMIN||i.role===F.DESIGNER||i.role===F.CLIENT)&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-[600px]",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[a.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[a.jsx(Fx,{className:"w-4 h-4 text-blue-500"}),"Active Projects"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(fp,{currentField:le.field,currentOrder:le.order,onSort:(P,H)=>ge({field:P,order:H}),fields:[{value:"activity",label:"Recent"},{value:"name",label:"Name"},{value:"progress",label:"Progress"}]}),a.jsx("span",{className:"text-sm font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full",children:Te.length})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:Te.length===0?a.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No active projects"}):[...Te].sort((P,H)=>{let $=0;return le.field==="activity"?$=q(P)-q(H):le.field==="name"?$=P.name.localeCompare(H.name):le.field==="progress"&&($=gh(R(P.id))-gh(R(H.id))),le.order==="desc"?-$:$}).map(P=>{var he,ke;const H=gh(R(P.id)),oe=R(P.id).filter(me=>me.status!==pe.DONE&&!K(me)),we=D[P.id];return a.jsxs("div",{className:"rounded-lg border border-gray-50 hover:border-blue-200 hover:bg-blue-50/30 transition-all",children:[a.jsxs("div",{onClick:()=>t==null?void 0:t(P),className:"p-3 cursor-pointer group",children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-blue-600",children:P.name}),a.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:((he=P.clientIds)==null?void 0:he.map(me=>{var $e;return($e=e.find(pt=>pt.id===me))==null?void 0:$e.name}).filter(Boolean).join(", "))||((ke=e.find(me=>me.id===P.clientId))==null?void 0:ke.name)||"No Client"})]}),a.jsx(Va,{className:"w-4 h-4 text-gray-300 group-hover:text-blue-400"})]}),a.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[a.jsx("div",{className:"flex-1 bg-gray-100 rounded-full h-1",children:a.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${H}%`}})}),a.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[H,"%"]})]})]}),oe.length>0&&a.jsxs("div",{className:"border-t border-gray-50",children:[a.jsxs("button",{onClick:me=>{me.stopPropagation(),z($e=>({...$e,[P.id]:!$e[P.id]}))},className:"w-full px-3 py-2 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[a.jsxs("span",{className:"text-xs font-semibold text-gray-600 flex items-center gap-1",children:[a.jsx(ep,{className:"w-3 h-3"}),"Pending Tasks (",oe.length,")"]}),a.jsx(mS,{className:`w-3 h-3 text-gray-400 transition-transform ${we?"rotate-180":""}`})]}),we&&a.jsxs("div",{className:"px-3 py-2 space-y-1 bg-gray-50/50",children:[oe.slice(0,5).map(me=>a.jsxs("div",{className:"w-full flex items-center justify-between px-2 py-1.5 rounded text-xs hover:bg-white transition-colors group/task",children:[a.jsxs("button",{onClick:()=>r==null?void 0:r(me,P),className:"flex-1 text-left flex items-start gap-2 min-w-0",children:[a.jsx("div",{className:`w-2 h-2 rounded-full mt-0.5 flex-shrink-0 ${me.status===pe.DONE?"bg-green-500":me.status===pe.IN_PROGRESS?"bg-blue-500":"bg-gray-300"}`}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-gray-700 truncate font-medium",children:me.title}),me.dueDate&&a.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:ln(me.dueDate)})]})]}),me.status!==pe.DONE&&a.jsx("button",{onClick:$e=>{$e.stopPropagation(),k(me,P)},className:"ml-2 p-1 text-gray-300 hover:text-green-500 opacity-0 group-hover/task:opacity-100 transition-all",title:"Mark as Done",children:a.jsx(xp,{className:"w-4 h-4"})})]},me.id)),oe.length>5&&a.jsxs("p",{className:"text-xs text-gray-400 text-center py-1",children:["+",oe.length-5," more tasks"]})]})]})]},P.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-auto max-h-[500px] lg:h-[600px] lg:max-h-none",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[a.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[a.jsx(ep,{className:"w-4 h-4 text-amber-500"}),"Tasks"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(fp,{currentField:ae.field,currentOrder:ae.order,onSort:(P,H)=>xe({field:P,order:H}),fields:[{value:"activity",label:"Recent"},{value:"dueDate",label:"Due Date"},{value:"title",label:"Title"}]}),a.jsx("span",{className:"text-sm font-bold text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:i.role===F.DESIGNER?Ie.filter(P=>P.task.status!==pe.DONE&&!K(P.task)).length:Te.reduce((P,H)=>P+R(H.id).filter($=>$.status!==pe.DONE&&!K($)).length,0)})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:(i.role===F.DESIGNER?Ie.filter(P=>P.task.status!==pe.DONE&&!K(P.task)).length===0:Te.every(P=>R(P.id).filter(H=>H.status!==pe.DONE&&!K(H)).length===0))?a.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"All tasks completed! "}):(i.role===F.DESIGNER?Ie.filter(P=>P.task.status!==pe.DONE&&!K(P.task)).map(({task:P,project:H})=>({...P,projectName:H.name,project:H})):Te.flatMap(P=>R(P.id).filter(H=>H.status!==pe.DONE&&!K(H)).map(H=>({...H,projectName:P.name,project:P})))).sort((P,H)=>{let $=0;return ae.field==="activity"?$=U(P,P.project)-U(H,H.project):ae.field==="dueDate"?$=new Date(P.dueDate).getTime()-new Date(H.dueDate).getTime():ae.field==="title"&&($=P.title.localeCompare(H.title)),ae.order==="desc"?-$:$}).map(P=>{const H=e.find($=>$.id===P.assigneeId);return a.jsx("div",{className:"p-3 rounded-lg border border-gray-50 hover:border-amber-200 hover:bg-amber-50/30 transition-all cursor-pointer group relative",children:a.jsxs("div",{onClick:()=>r==null?void 0:r(P,P.project),children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-amber-600",children:P.title}),a.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[a.jsx("p",{className:"text-xs text-gray-500 truncate",children:P.projectName}),a.jsx("span",{className:"text-xs text-gray-300",children:""}),a.jsx("p",{className:"text-xs text-blue-500 font-medium truncate",children:(H==null?void 0:H.name)||"Unassigned"})]})]}),a.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded shrink-0 ${P.status===pe.IN_PROGRESS?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"}`,children:P.status})]}),a.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[a.jsxs("span",{className:"text-xs text-gray-400 font-medium",children:["Due: ",ln(P.dueDate)]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-400"}),a.jsxs("span",{className:"text-xs font-bold text-gray-500",children:[ra(P),"%"]})]})]})]})},P.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-auto max-h-[500px] lg:h-[600px] lg:max-h-none",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[a.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[a.jsx(xp,{className:"w-4 h-4 text-rose-500"}),"Pending Approvals"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(fp,{currentField:"activity",currentOrder:le.order,onSort:(P,H)=>ge($=>({...$,order:H})),fields:[{value:"activity",label:"Recent"}]}),a.jsx("span",{className:"text-sm font-bold text-rose-600 bg-rose-50 px-2 py-0.5 rounded-full",children:Te.reduce((P,H)=>P+ue(H).length,0)})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:Te.every(P=>ue(P).length===0)?a.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No pending approvals"}):Te.flatMap(P=>ue(P).map(H=>({...H,project:P}))).sort((P,H)=>{const $=q(P.project)-q(H.project);return le.order==="desc"?-$:$}).map((P,H)=>a.jsx("div",{onClick:()=>{P.type==="task"&&P.task?r==null||r(P.task,P.project):t==null||t(P.project,{initialTab:"documents"})},className:"p-3 rounded-lg border border-gray-50 hover:border-rose-200 hover:bg-rose-50/30 transition-all cursor-pointer group",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:`shrink-0 mt-0.5 ${P.type==="task"?"text-blue-500":P.type==="doc"?"text-purple-500":"text-amber-500"}`,children:P.type==="task"?a.jsx(ep,{className:"w-4 h-4"}):P.type==="doc"?a.jsx(Pa,{className:"w-4 h-4"}):a.jsx(TS,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-rose-600",children:P.label}),a.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:P.projectName})]}),a.jsx(Ma,{className:"w-4 h-4 text-rose-400 shrink-0"})]})},H))})]})]}),i.role===F.VENDOR&&a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:a.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-100 lg:col-span-3","data-section":"vendor-tasks",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h3",{className:"text-sm font-bold text-gray-800",children:["Your Active Tasks",a.jsx("span",{className:"ml-2 text-sm text-gray-400 font-normal",children:"Real-time synced"})]}),a.jsx(fp,{currentField:j.field,currentOrder:j.order,onSort:(P,H)=>ie({field:P,order:H}),fields:[{value:"activity",label:"Recent"},{value:"dueDate",label:"Due Date"},{value:"title",label:"Title"}]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-gray-50 text-gray-500 text-sm font-semibold",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 rounded-l-lg",children:"Task"}),a.jsx("th",{className:"px-4 py-3",children:"Project"}),a.jsx("th",{className:"px-4 py-3",children:"Due"}),a.jsx("th",{className:"px-4 py-3 rounded-r-lg",children:"Status"})]})}),a.jsxs("tbody",{className:"divide-y divide-gray-50",children:[Ie.filter(P=>P.task.status!==pe.DONE).sort((P,H)=>{let $=0;if(j.field==="activity"){const oe=U(P.task,P.project),we=U(H.task,H.project);$=oe-we}else j.field==="dueDate"?$=new Date(P.task.dueDate).getTime()-new Date(H.task.dueDate).getTime():j.field==="title"&&($=P.task.title.localeCompare(H.task.title));return j.order==="desc"?-$:$}).map(({task:P,project:H})=>a.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer group",children:[a.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",onClick:()=>r==null?void 0:r(P,H),children:P.title}),a.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",onClick:()=>r==null?void 0:r(P,H),children:H.name}),a.jsx("td",{className:"px-4 py-3 text-gray-500 text-sm",onClick:()=>r==null?void 0:r(P,H),children:ln(P.dueDate)}),a.jsx("td",{className:"px-4 py-3 flex items-center justify-between",children:a.jsx("span",{className:`px-2.5 py-1 rounded-md text-sm font-semibold uppercase transition-colors
                          ${P.status===pe.IN_PROGRESS?"bg-blue-100 text-blue-700":P.status===pe.TODO?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,onClick:()=>r==null?void 0:r(P,H),children:P.status})})]},P.id)),Ie.filter(P=>P.task.status!==pe.DONE).length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"text-center py-8 text-gray-400 text-sm",children:"All caught up! "})})]})]})})]})})]})};var Mn=EN();const xf=["General","Design and Planning","Execution"],sA=()=>{const[n,e]=W.useState({loading:!1,error:null,success:!1});return{...n,createNewProject:async l=>{e({loading:!0,error:null,success:!1});try{const c=await QM(l);return e({loading:!1,error:null,success:!0}),c}catch(c){throw e({loading:!1,error:c.message,success:!1}),c}},updateExistingProject:async(l,c)=>{e({loading:!0,error:null,success:!1});try{await nv(l,c),e({loading:!1,error:null,success:!0})}catch(u){throw e({loading:!1,error:u.message,success:!1}),u}},deleteExistingProject:async l=>{e({loading:!0,error:null,success:!1});try{await WT(l),e({loading:!1,error:null,success:!0})}catch(c){throw e({loading:!1,error:c.message,success:!1}),c}}}},nV=n=>{const[e,t]=W.useState({loading:!1,error:null,success:!1});return{...e,createNewRecord:async c=>{t({loading:!0,error:null,success:!1});try{const u=await Py(n,c);return t({loading:!1,error:null,success:!0}),u}catch(u){throw t({loading:!1,error:u.message,success:!1}),u}},updateExistingRecord:async(c,u)=>{t({loading:!0,error:null,success:!1});try{await pd(n,c,u),t({loading:!1,error:null,success:!0})}catch(p){throw t({loading:!1,error:p.message,success:!1}),p}},deleteExistingRecord:async c=>{t({loading:!0,error:null,success:!1});try{await W6(n,c),t({loading:!1,error:null,success:!0})}catch(u){throw t({loading:!1,error:u.message,success:!1}),u}}}},rV=async(n,e)=>{try{const t=Zu(eh,e),r=await Ju(t,n);return await Xu(r.ref)}catch(t){throw console.error("Error uploading file:",t),t}},sV=[{id:pe.TODO,label:"Scheduled Tasks",color:"border-t-4 border-gray-400"},{id:pe.IN_PROGRESS,label:"In Process",color:"border-t-4 border-blue-500"},{id:pe.REVIEW,label:"In Review",color:"border-t-4 border-purple-500"},{id:pe.ON_HOLD,label:"On Hold",color:"border-t-4 border-yellow-500"},{id:pe.DONE,label:"Completed",color:"border-t-4 border-green-500"}],iV=({tasks:n,users:e,onUpdateTaskStatus:t,onUpdateTaskPriority:r,onEditTask:i,onCompleteTask:l})=>{const{user:c}=ha(),{addNotification:u}=al(),[p,g]=W.useState(null),b=ae=>ae===pe.ABORTED||ae===pe.ON_HOLD,w=(ae,xe)=>{const j=n.find(ie=>ie.id===xe);if(j&&b(j.status)){ae.preventDefault();return}g(xe),ae.dataTransfer.effectAllowed="move"},N=ae=>{ae.preventDefault()},D=(ae,xe)=>{ae.preventDefault(),!(!p||!t)&&(t(p,xe),g(null))},z=(ae,xe)=>{if(ae.stopPropagation(),b(xe.status))return;if(O(xe)&&xe.status!==pe.DONE){u("Locked","Cannot update task. Dependencies not met.","error");return}let j=xe.status;xe.status===pe.TODO?j=pe.IN_PROGRESS:xe.status===pe.IN_PROGRESS?j=pe.REVIEW:xe.status===pe.REVIEW&&(j=pe.DONE),t(xe.id,j)},L=ae=>{const xe=e.find(j=>j.id===ae);return xe?a.jsx(Ba,{avatar:xe.avatar,name:xe.name,size:"sm",role:String(xe.role).toLowerCase()}):a.jsx(Ba,{avatar:"",name:"Unassigned",size:"sm"})},O=ae=>ae.status===pe.DONE||!ae.dependencies||ae.dependencies.length===0?!1:n.filter(j=>{var ie;return(ie=ae.dependencies)==null?void 0:ie.includes(j.id)}).some(j=>j.status!==pe.DONE),le=ae=>{switch(ae){case pe.TODO:return"bg-gray-100 text-gray-600";case pe.IN_PROGRESS:return"bg-blue-100 text-blue-600";case pe.REVIEW:return"bg-purple-100 text-purple-600";case pe.DONE:return"bg-green-100 text-green-600";case pe.OVERDUE:return"bg-red-100 text-red-600";case pe.ABORTED:return"bg-black text-white";case pe.ON_HOLD:return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100"}},ge=ae=>ae.sort((xe,j)=>{var ie,k;return(ie=xe.dependencies)!=null&&ie.includes(j.id)?1:(k=j.dependencies)!=null&&k.includes(xe.id)?-1:new Date(xe.dueDate).getTime()-new Date(j.dueDate).getTime()});return a.jsx("div",{className:"flex h-full overflow-x-auto gap-4 p-3 pb-6 items-start",children:sV.map(ae=>{let xe;ae.id===pe.IN_PROGRESS?xe=n.filter(ie=>ie.status===pe.IN_PROGRESS||ie.status===pe.OVERDUE||ie.status===pe.ABORTED):xe=n.filter(ie=>ie.status===ae.id);const j=ge(xe);return a.jsxs("div",{className:`flex-shrink-0 w-80 bg-gray-50 rounded-lg p-4 flex flex-col h-full max-h-[calc(100vh-250px)] border border-gray-200 ${ae.color}`,onDragOver:N,onDrop:ie=>D(ie,ae.id),children:[a.jsx("div",{className:"flex justify-between items-center mb-3 px-1",children:a.jsxs("h3",{className:"font-bold text-gray-900 text-sm flex items-center gap-2",children:[ae.label,a.jsx("span",{className:"bg-white border border-gray-200 text-gray-600 text-xs px-2.5 py-0.5 rounded-full",children:j.length})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-1",children:[j.map(ie=>{const k=O(ie)&&ie.status!==pe.DONE,R=b(ie.status),M=ra(ie),q=(c==null?void 0:c.id)===ie.assigneeId;return a.jsxs("div",{draggable:!k&&!R&&(c==null?void 0:c.role)!==F.CLIENT,onDragStart:U=>!k&&!R&&(c==null?void 0:c.role)!==F.CLIENT&&w(U,ie.id),onClick:()=>i(ie),className:`bg-white p-3 md:p-4 rounded-lg shadow-sm border cursor-grab active:cursor-grabbing hover:shadow-md transition-all group relative
                       ${k?"border-red-200 bg-red-50/50 cursor-not-allowed opacity-75":"border-gray-200"}
                       ${R?"border-gray-300 bg-gray-100 opacity-80 cursor-not-allowed":""}
                       ${ie.status===pe.DONE?"opacity-70 bg-gray-50":""}
                    `,children:[R&&a.jsx("div",{className:"absolute top-1 right-1 text-gray-500",title:`Frozen: ${ie.status}`,children:ie.status===pe.ABORTED?a.jsx(Mo,{className:"w-3 h-3"}):a.jsx(Bx,{className:"w-3 h-3"})}),a.jsxs("div",{className:"flex justify-between items-center gap-1 mb-2",children:[a.jsxs("div",{className:"flex items-center gap-0.5",children:[k&&a.jsx("span",{title:"Locked by dependencies",className:"flex items-center",children:a.jsx(xh,{className:"w-3 h-3 text-red-400 flex-shrink-0"})}),a.jsx("span",{className:"text-xs font-medium text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded border border-gray-200 flex-shrink-0",children:ie.category})]}),a.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-bold uppercase flex-shrink-0 ${le(ie.status)}`,children:ie.status})]}),a.jsxs("div",{className:"flex justify-between items-start gap-0.5 mb-2",children:[a.jsx("h4",{className:`font-bold text-sm group-hover:text-blue-600 transition-colors line-clamp-2 ${k||R?"text-gray-500":"text-gray-900"}`,children:ie.title}),(q||(c==null?void 0:c.role)===F.ADMIN)&&!k&&!R&&ie.status!==pe.DONE&&(c==null?void 0:c.role)!==F.CLIENT&&a.jsxs("div",{className:"flex items-center",children:[a.jsx("button",{onClick:U=>{U.stopPropagation(),l(ie)},className:"text-gray-300 hover:text-green-500 transition-colors p-0.5 flex-shrink-0 mr-1",title:"Mark as Done",children:a.jsx(_d,{className:"w-4 h-4 text-green-500"})}),a.jsx("button",{onClick:U=>z(U,ie),className:"text-gray-300 hover:text-blue-500 transition-colors p-0.5 flex-shrink-0",title:"Advance Status",children:a.jsx(Hl,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs",children:[a.jsx("span",{className:"text-gray-400 font-medium",children:"Progress"}),a.jsxs("span",{className:"text-gray-600 font-bold",children:[M,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5 mb-3",children:a.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${ie.status===pe.DONE?"bg-green-500":R?"bg-gray-400":"bg-blue-500"}`,style:{width:`${M}%`}})}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-50",children:[a.jsx("div",{className:"flex items-center gap-1",children:L(ie.assigneeId)}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[a.jsx(Mp,{className:"w-3 h-3"}),a.jsx("span",{children:ln(ie.dueDate)})]})]})]},ie.id)}),j.length===0&&a.jsx("div",{className:"h-16 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-sm text-gray-400 italic bg-white",children:"Drop items here"})]})]},ae.id)})})},aV=({isOpen:n,onClose:e,onSubmit:t,onUpdate:r,teamMembers:i,isLoading:l=!1,editingMeeting:c=null})=>{const[u,p]=W.useState({date:new Date().toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),[g,b]=W.useState(!1),[w,N]=W.useState(!1);W.useEffect(()=>{p(c?{date:c.date,title:c.title,type:c.type,attendees:c.attendees,notes:c.notes}:{date:new Date().toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),b(!1)},[c,n]);const D=()=>!u.date||!u.title||!u.type?(b(!0),!1):!0,z=async O=>{if(O.preventDefault(),!!D())try{N(!0),c&&r?await r({...c,...u}):await t(u),c||p({date:new Date().toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),b(!1),e()}catch(le){console.error("Error saving meeting:",le)}finally{N(!1)}},L=O=>{p(le=>({...le,attendees:le.attendees.includes(O)?le.attendees.filter(ge=>ge!==O):[...le.attendees,O]}))};return n?Mn.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[90]",onClick:e}),a.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100] p-2 md:p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-[95vh] md:max-h-[90vh] overflow-y-auto animate-fade-in",onClick:O=>O.stopPropagation(),children:[a.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 flex justify-between items-center flex-shrink-0",children:[a.jsx("h2",{className:"text-2xl md:text-xl font-bold text-gray-800",children:c?"Edit Meeting":"Add Meeting"}),a.jsx("button",{onClick:e,title:"Close modal",className:"p-1 hover:bg-gray-100 rounded-md transition-colors flex-shrink-0",children:a.jsx(_n,{className:"w-5 h-5 md:w-4 md:h-4 text-gray-500"})})]}),a.jsxs("form",{onSubmit:z,className:"p-3 md:p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"meeting-date",className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{id:"meeting-date",type:"date",title:"Select meeting date",value:u.date||"",onChange:O=>p(le=>({...le,date:O.target.value})),className:`w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800
                  ${g&&!u.date?"border-red-500":"border-gray-200"}`}),g&&!u.date&&a.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting date is required"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Title ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"e.g., Client Kickoff, Site Visit Review",value:u.title,onChange:O=>p(le=>({...le,title:O.target.value})),className:`w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800
                  ${g&&!u.title?"border-red-500":"border-gray-200"}`}),g&&!u.title&&a.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting title is required"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Type ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"e.g., Discovery, Progress Review, Site Visit, Vendor Meet, Design Presentation",value:u.type,onChange:O=>p(le=>({...le,type:O.target.value})),className:`w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800
                  ${g&&!u.type?"border-red-500":"border-gray-200"}`}),g&&!u.type&&a.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting type is required"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-2",children:[a.jsx(Fp,{className:"w-4 h-4 inline mr-1"}),"Add Attendees"]}),i.length===0?a.jsx("p",{className:"text-base md:text-base text-gray-500 bg-gray-50 p-2 rounded-md",children:"No team members available. Add members to the project first."}):a.jsx("div",{className:"grid grid-cols-2 gap-1.5 max-h-[200px] overflow-y-auto border border-gray-200 rounded-md p-2 bg-gray-50",children:i.map(O=>a.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-md transition-colors text-left cursor-pointer bg-white border border-gray-200 hover:border-gray-300",children:[a.jsx("input",{type:"checkbox",checked:u.attendees.includes(O.id),onChange:()=>L(O.id),title:`Add ${O.name} to meeting`,className:"w-4 h-4 rounded cursor-pointer"}),a.jsx(Ba,{name:O.name,avatar:O.avatar,size:"sm",role:String(O.role).toLowerCase()}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"text-base md:text-sm font-medium text-gray-800 truncate",children:O.name}),a.jsx("div",{className:"text-base md:text-sm text-gray-500 truncate",children:O.role})]})]},O.id))}),u.attendees.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsxs("p",{className:"text-base md:text-sm font-semibold text-gray-700 mb-2",children:["Selected Attendees (",u.attendees.length,"):"]}),a.jsx("div",{className:"bg-white border border-gray-200 rounded-md p-2 space-y-1.5",children:u.attendees.map(O=>{const le=i.find(ge=>ge.id===O);return le?a.jsxs("div",{className:"flex items-center justify-between bg-gray-50 px-2 py-1.5 rounded border border-gray-100",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ba,{name:le.name,avatar:le.avatar,size:"sm",role:String(le.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("div",{className:"text-base md:text-sm font-medium text-gray-800",children:le.name}),a.jsx("div",{className:"text-base md:text-sm text-gray-500",children:le.role})]})]}),a.jsx("button",{type:"button",onClick:()=>L(le.id),className:"text-red-500 hover:text-red-700 p-0.5",title:`Remove ${le.name} from meeting`,children:a.jsx(_n,{className:"w-2.5 h-2.5"})})]},O):null})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:"Notes"}),a.jsx("textarea",{placeholder:"Add any notes, decisions, or action items from the meeting",value:u.notes,onChange:O=>p(le=>({...le,notes:O.target.value})),rows:3,className:"w-full px-2 py-1.5 text-base md:text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:border-gray-800 resize-none"})]}),a.jsxs("div",{className:"flex gap-2 justify-end pt-3 border-t border-gray-200",children:[a.jsx("button",{type:"button",onClick:e,disabled:w||l,className:"px-3 py-1.5 border border-gray-300 rounded-md text-gray-700 font-medium text-base md:text-xs hover:bg-gray-50 transition-colors disabled:opacity-50 focus:outline-none focus:ring-1 focus:ring-gray-800",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:w||l,className:"px-3 py-1.5 bg-gray-800 text-white rounded-md font-medium text-base md:text-xs hover:bg-gray-900 transition-colors disabled:opacity-50 flex items-center gap-1.5 focus:outline-none focus:ring-1 focus:ring-gray-800",children:[c?a.jsx(kN,{className:"w-4 h-4 md:w-3 md:h-3"}):a.jsx(Oi,{className:"w-4 h-4 md:w-3 md:h-3"}),w||l?"Saving...":c?"Update Meeting":"Add Meeting"]})]})]})]})})]}),document.body):null},Pt=({size:n="md",color:e="currentColor",className:t=""})=>{const r={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return console.log("Spinner rendered:",{size:n,color:e,className:t,sizeClass:r[n]}),a.jsx("div",{className:`spinner ${r[n]} ${t}`,style:{display:"inline-block",width:n==="sm"?"12px":n==="lg"?"20px":"16px",height:n==="sm"?"12px":n==="lg"?"20px":"16px",border:"2px solid",borderColor:`${e}40`,borderTopColor:e,borderRightColor:e,borderRadius:"50%",animation:"spin 0.6s linear infinite"}})},Bu=48,Lx='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"%3E%3Ccircle cx="12" cy="12" r="12" fill="%23e5e7eb"/%3E%3C/svg%3E',oV=({project:n,users:e,onUpdateProject:t,onBack:r,initialTab:i,initialTask:l,onCloseTask:c})=>{var am,om,lm,rs,fo,Hd,Gd,Kd,Qd,Rc,cm,dm,wa,Dc,go,Pc,Yd,gl,_a,Oc,Jd,xl,Xd,Zd,eu,tu,nu,ru,Ti,Mc,Vc,um,hm,xo,mm,su,iu,en,Lc,yl,yo,au,$c,vo,vl,Na,ou,pm,fm,lu,bl,wl,Fc,Bc,Uc,zc,gm,cu,xm,ym,qc,Ai,du,Ia,Is,bo,Qs,Wc,vm,bm,Ki,wo,Ea,_l,Hc,Ta,Si,tn,Yt,ji,Gn,ur,Qi,Aa,hr,Nl,uu,hu,Il,mu,Ys,El,Gc,pu,wm,ki;const{user:u}=ha(),{addNotification:p}=al(),{updateExistingProject:g,deleteExistingProject:b}=sA(),{updateExistingRecord:w,deleteExistingRecord:N}=nV(n.id),{showLoading:D,hideLoading:z}=Xh(),[L,O]=W.useState("plan"),[le,ge]=W.useState("list"),[ae,xe]=W.useState(!!l),[j,ie]=W.useState(l||null),[k,R]=W.useState(!0),M=W.useRef(ae);W.useEffect(()=>{M.current&&!ae&&c&&c(),M.current=ae},[ae,c]);const[q,U]=W.useState(!1),[K,V]=W.useState("details"),[Fe,ue]=W.useState(null),[Te,Ie]=W.useState(!1),[fe,P]=W.useState(""),[H,$]=W.useState(new Set),oe=W.useRef(null),we=W.useRef(null),[he,ke]=W.useState(null),[me,$e]=W.useState(null),[pt,at]=W.useState(!1),[lt,on]=W.useState({name:"",type:"other",sharedWith:[]}),[Re,Oe]=W.useState([]),[mn,pn]=W.useState(!1),yn=W.useRef(null),[Be,zt]=W.useState(null),[_t,Tt]=W.useState(!1),[jt,Yr]=W.useState(""),[ms,ui]=W.useState(!1),[Ms,hi]=W.useState(!1),[Vs,Jr]=W.useState(null),[ma,or]=W.useState([]),[ps,mi]=W.useState(!1),[se,_e]=W.useState(!1),[ze,Qe]=W.useState(null),[J,Ye]=W.useState({date:new Date().toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0}),[Lt,it]=W.useState(""),[xt,Ve]=W.useState(""),[ve,et]=W.useState(""),[rn,In]=W.useState(""),[yr,Vn]=W.useState(!1),[Rr,ut]=W.useState(!1),[Qt,$i]=W.useState("all"),[ol,fs]=W.useState(!1),[Ls,pi]=W.useState(!1),[Wn,gs]=W.useState(""),[xs,Xa]=W.useState("member"),[ys,fi]=W.useState(!1),[wc,Za]=W.useState(null),[_c,$s]=W.useState(!1),[eo,pa]=W.useState({}),[Fi,Fs]=W.useState({}),[Wt,Nc]=W.useState({}),[to,Bi]=W.useState(!1),[lr,Ui]=W.useState(null),[no,gi]=W.useState(!1),[Dr,ro]=W.useState(!1),[vr,Xr]=W.useState(null),[Zr,xi]=W.useState(!1),[br,Bs]=W.useState(null),[Bt,vs]=W.useState(!1),[Us,yi]=W.useState(null),[Vt,so]=W.useState(null),[Pr,zi]=W.useState(null),[es,fa]=W.useState(n.designerChargePercentage??0),[kt,bs]=W.useState(!1);W.useEffect(()=>{fa(n.designerChargePercentage??0)},[n.designerChargePercentage]);const ll=()=>{$t&&es!==(n.designerChargePercentage??0)&&(t({...n,designerChargePercentage:es}),p("Designer Charges Updated","Designer Charges percent saved.","success",void 0,n.id,n.name))},[io,ga]=W.useState(!1),[ws,qi]=W.useState(""),[Or,vi]=W.useState(""),[Pn,zs]=W.useState([]),[fn,xa]=W.useState([]),[Mr,Vr]=W.useState([]),[ao,Wi]=W.useState([]),[cr,Ic]=W.useState([]),It=cr,He=ao,ya=W.useMemo(()=>(u==null?void 0:u.role)===F.VENDOR?He.filter(_=>_.assigneeId===u.id):He,[He,u==null?void 0:u.id,u==null?void 0:u.role]);if(W.useEffect(()=>{const _=new URLSearchParams(window.location.search).get("taskId");if(_&&He.length>0){const E=He.find(S=>S.id===_);E&&(ie(E),xe(!0),window.history.replaceState({},document.title,window.location.pathname))}},[He]),W.useEffect(()=>{const _=new URLSearchParams(window.location.search).get("meetingId");if(_&&Pn.length>0){const E=Pn.find(S=>S.id===_);E&&(O("meetings"),Za(E),fi(!0),window.history.replaceState({},document.title,window.location.pathname))}},[Pn]),W.useEffect(()=>{const h=async()=>{const _=new Date().toISOString().split("T")[0],E=He.filter(A=>A.dueDate<_&&A.status!==pe.DONE&&A.status!==pe.OVERDUE&&A.status!==pe.ABORTED&&A.status!==pe.ON_HOLD&&A.status!==pe.REVIEW);if(E.length>0)for(const A of E)await ni(n.id,A.id,{status:pe.OVERDUE});const S=It.filter(A=>A.status==="pending"&&A.date<_);if(S.length>0)for(const A of S)await w(A.id,{...A,status:"overdue"})};n&&(He.length>0||It.length>0)&&h()},[He,It,n.id]),W.useEffect(()=>{oe.current&&oe.current.scrollIntoView({behavior:"smooth"})},[j==null?void 0:j.comments]),W.useEffect(()=>{const h=N6(n.id,_=>{zs(_),_.forEach(E=>{E6(n.id,E.id,S=>{pa(A=>({...A,[E.id]:S}))})})});return()=>h()},[n.id]),W.useEffect(()=>{const h=tA(n.id,_=>{xa(_)});return()=>h()},[n.id]),W.useEffect(()=>{const h=j6(n.id,_=>{Vr(_)});return()=>h()},[n.id]),W.useEffect(()=>{if(_t&&Be){const h=fn.find(_=>_.id===Be.id);h&&zt(h)}},[fn,_t,Be==null?void 0:Be.id]),W.useEffect(()=>{const h=iv(n.id,_=>{Wi(_)});return()=>h()},[n.id]),W.useEffect(()=>{if(ae&&j&&j.id){const h=ao.find(_=>_.id===j.id);h&&ie(h)}},[ao,ae,j==null?void 0:j.id]),W.useEffect(()=>{const h=nA(n.id,_=>{Ic(_)});return()=>h()},[n.id]),W.useEffect(()=>{const h=async()=>{try{const _=It.filter(S=>S.type==="income"&&S.category==="Additional Budget").reduce((S,A)=>S+A.amount,0),E=(n.initialBudget||n.budget)+_;await kr(bt(st,"projects",n.id),{budget:E}),t({...n,budget:E})}catch(_){console.error(" Error syncing project budget in real-time:",_)}};(It.length>0||n.financials.length>0)&&h()},[It,n.id]),W.useEffect(()=>{i&&O(i)},[i]),W.useEffect(()=>{if(we.current){const h=we.current.querySelector(`[data-tab-id="${L}"]`);h&&h.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}},[L]),W.useEffect(()=>{(u==null?void 0:u.role)===F.VENDOR&&(L==="discovery"||L==="timeline"||L==="financials")&&O("plan")},[u==null?void 0:u.role,L]),!u)return null;const oo=u.role===F.CLIENT,vn=u.role===F.VENDOR,$t=u.role===F.ADMIN,qs=u.role===F.DESIGNER&&n.leadDesignerId===u.id,Ct=$t,Ws=!0,cl=!vn,[Ec,bi]=W.useState(null),[dl,ul]=W.useState(null),cn=(h,_)=>{if(!h)return"Unknown User";if(h===u.id)return u.name||"You";if(_&&_.trim())return _;const E=e.find(S=>S.id===h);if(E!=null&&E.name)return E.name;if(h===n.leadDesignerId){const S=e.find(A=>A.id===h);if(S!=null&&S.name)return S.name}if(h===n.clientId){const S=e.find(A=>A.id===h);if(S!=null&&S.name)return S.name}return"Unknown User"},sn=W.useMemo(()=>{const h=new Set;return n.clientId&&h.add(n.clientId),n.clientIds&&n.clientIds.forEach(_=>h.add(_)),n.leadDesignerId&&h.add(n.leadDesignerId),n.vendorIds&&n.vendorIds.forEach(_=>h.add(_)),n.hiddenVendors&&n.hiddenVendors.forEach(_=>h.add(_)),e.filter(_=>_.role===F.ADMIN).forEach(_=>h.add(_.id)),n.tasks.forEach(_=>{_.assigneeId&&h.add(_.assigneeId)}),n.teamMembers&&n.teamMembers.forEach(_=>h.add(_)),e.filter(_=>h.has(_.id))},[n,e]),wi=async h=>{try{$s(!0);const _=await b6(n.id,h);if(h.attendees&&h.attendees.length>0){const E=sn.filter(A=>h.attendees.includes(A.id)),S={...h,id:_};await yN(S,E,n.name,n.id,"created")}p("Success","Meeting added successfully","success")}catch(_){throw console.error("Error creating meeting:",_),p("Error","Failed to add meeting","error"),_}finally{$s(!1)}},Tc=h=>{try{Jr(h),or(h.sharedWith||[]),hi(!0)}catch(_){console.error("Error opening share edit modal:",_)}},va=async h=>{try{if($s(!0),await w6(n.id,h.id,h),h.attendees&&h.attendees.length>0){const _=sn.filter(E=>h.attendees.includes(E.id));await yN(h,_,n.name,n.id,"updated")}p("Success","Meeting updated successfully","success")}catch(_){throw console.error("Error updating meeting:",_),p("Error","Failed to update meeting","error"),_}finally{$s(!1)}},_s=async h=>{const _=Fi[h];if(!_||!_.trim()){p("Validation Error","Please enter a comment","error");return}if(!Wt[h])try{Nc(Y=>({...Y,[h]:!0}));let E=u.name||"Unknown User";const S=e.find(Y=>Y.id===u.id);S!=null&&S.name&&(E=S.name);const A={userId:u.id,userName:E,text:_,timestamp:new Date().toISOString()};await I6(n.id,h,A);const re=Pn.find(Y=>Y.id===h);if(re){const Y=[],X=e.filter(Ge=>Ge.role===F.ADMIN&&Ge.tenantId===u.tenantId&&Ge.id!==u.id);if(Y.push(...X),re.attendees&&re.attendees.length>0){const Ge=e.filter(Ce=>re.attendees.includes(Ce.id)&&Ce.id!==u.id);Y.push(...Ge)}const Se=Y.filter((Ge,Ce,nt)=>nt.findIndex(ht=>ht.id===Ge.id)===Ce);Se.length>0&&await eV(re,{...A,id:"temp"},E,n.name,Se)}Fs(Y=>({...Y,[h]:""})),p("Success","Comment added successfully","success")}catch(E){console.error("Error adding meeting comment:",E),p("Error","Failed to add comment","error")}finally{Nc(E=>({...E,[h]:!1}))}},hl=async(h,_)=>{try{await _6(n.id,h),p("Success",`Meeting "${_}" deleted successfully`,"success")}catch(E){console.error("Error deleting meeting:",E),p("Error","Failed to delete meeting","error")}},tr=async()=>{gi(!1);try{await b(n.id),p("Success","Project deleted successfully","success"),r()}catch(h){console.error("Error deleting project:",h),p("Error","Failed to delete project","error")}},Ns=()=>{gi(!0)},Lr=(h,_,E,S)=>{const A=e.filter(Ce=>Ce.role===F.ADMIN),re=e.find(Ce=>Ce.id===n.leadDesignerId),X=Array.from(new Set([n.clientId,...n.clientIds||[]].filter(Boolean))).map(Ce=>e.find(nt=>nt.id===Ce)).filter(Ce=>!!Ce),Se=[...A,re,...X];n.teamMembers&&n.teamMembers.forEach(Ce=>{const nt=e.find(ht=>ht.id===Ce);nt&&nt.role!==F.VENDOR&&Se.push(nt)}),Array.from(new Set(Se.filter(Ce=>!!Ce&&Ce.id!==E&&Ce.role!==F.VENDOR))).forEach(Ce=>{p(h,_,"info",Ce.id,n.id,n.name,S)})},$r=(h,_,E,S="info",A)=>{h&&h!==u.id&&p(_,E,S,h,n.id,n.name,A)},nr=(h,_,E="info")=>({id:Math.random().toString(36).substr(2,9),userId:u.id,action:h,details:_,timestamp:new Date().toISOString(),type:E}),En=h=>h===pe.ABORTED||h===pe.ON_HOLD,ts=h=>En(h.status)?!0:!h.dependencies||h.dependencies.length===0?!1:He.filter(E=>{var S;return(S=h.dependencies)==null?void 0:S.includes(E.id)}).some(E=>E.status!==pe.DONE),dr=h=>h.dependencies?He.filter(_=>{var E;return((E=h.dependencies)==null?void 0:E.includes(_.id))&&_.status!==pe.DONE}):[],ba=h=>h?typeof h=="string"?new Date(h).getTime():h.toDate&&typeof h.toDate=="function"?h.toDate().getTime():h instanceof Date?h.getTime():new Date(h).getTime()||0:0,lo=h=>ba(h.approvalDate||h.clientApprovedDate||h.uploadDate||h.approvalDate||h.rejectionDate||h.uploadDate),Dt=(h,_=!1)=>`
    w-full p-2 border rounded-lg transition-all focus:outline-none placeholder-gray-400
    ${_?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-white text-gray-900"}
    ${h?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}
  `,_i=h=>{if(u.role===F.VENDOR&&h.assigneeId!==u.id){p("Access Restricted","You can only view details of tasks assigned to you.","warning");return}const _={start:{client:{status:"pending"},admin:{status:"pending"}},completion:{client:{status:"pending"},admin:{status:"pending"}}};ie({...h,approvals:h.approvals||_}),xe(!0),U(!1)},co=async()=>{if(!Wn){p("Validation Error","Please select at least one user","error");return}const h=Wn.split(",").filter(Boolean);try{if(xs==="client"){const _=h.filter(S=>S!==n.clientId&&!(n.clientIds||[]).includes(S));if(_.length===0){p("Info","All selected clients are already added","info");return}const E=[...n.clientIds||[],..._];_.forEach(S=>{const A=e.find(Y=>Y.id===S),re=nr("Client Added",`${A==null?void 0:A.name} added as client to project`);$r(S,"Added to Project",`You have been added as a client to "${n.name}"`,"success","dashboard")}),t({...n,clientIds:E}),p("Success",`${_.length} client${_.length!==1?"s":""} added`,"success")}else if(xs==="member"){const _=h.filter(S=>!(n.teamMembers||[]).includes(S));if(_.length===0){p("Info","All selected members are already added","info");return}const E=[...n.teamMembers||[],..._];_.forEach(S=>{const A=e.find(Y=>Y.id===S),re=nr("Team Member Added",`${A==null?void 0:A.name} added as team member to project`);$r(S,"Added to Project",`You have been added to "${n.name}"`,"success","dashboard")}),t({...n,teamMembers:E}),p("Success",`${_.length} member${_.length!==1?"s":""} added`,"success")}pi(!1),gs("")}catch(_){console.error("Error adding member:",_),p("Error","Failed to add member.","error")}},[Ln,ml]=W.useState(!1),Ac=async()=>{var h;if(Re.length===0&&!lt.name){pn(!0),p("Validation Error",`Please select files or enter a name for "${n.name}".`,"error",void 0,n.id,n.name);return}ml(!0);try{const _=Re.length>0?Re:[{name:lt.name}],E=[];for(const A of _){const re=A.name||lt.name;let Y="other";A.type&&(A.type.startsWith("image/")?Y="image":A.type==="application/pdf"&&(Y="pdf"));let X="";if(A instanceof File&&A.size)try{const ht=`projects/${n.id}/documents/${Date.now()}_${A.name}`;X=await rV(A,ht)}catch(ht){console.error("Upload failed, falling back to local preview:",ht),X=URL.createObjectURL(A),p("Warning",`Failed to upload "${re}" to storage. Using local preview.`,"warning")}else X="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iI2VmZWZlZiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjI0IiBmaWxsPSIjYWFhIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QbGFjZWhvbGRlcjwvdGV4dD48L3N2Zz4=";const Se={name:re,type:Y,url:X,uploadedBy:u.id,uploadDate:new Date().toISOString(),sharedWith:lt.sharedWith.length>0?lt.sharedWith:[F.ADMIN,F.DESIGNER,F.CLIENT],approvalStatus:"pending"},Ge=await Dy(n.id,Se);E.push(Ge);const Ce=lt.sharedWith.length>0?lt.sharedWith.map(ht=>{if(ht===F.ADMIN||ht===F.DESIGNER||ht===F.CLIENT)return ht;const mt=e.find(wt=>wt.id===ht);return(mt==null?void 0:mt.name)||ht}).join(", "):"Admin, Designer, Client",nt=new Date().toISOString();await ti(n.id,`Document Uploaded: ${re}`,`${re} (${Y}) uploaded by ${u.name}. Shared with: ${Ce}`,"completed",nt,nt)}if(lt.attachToTaskId&&E.length>0){const A=He.find(re=>re.id===lt.attachToTaskId);if(A){const re=A.documents||[],Y=E.filter(X=>!re.includes(X));if(Y.length>0){const X=[...re,...Y];await ni(n.id,A.id,{...A,documents:X}),(j==null?void 0:j.id)===A.id&&ie({...j,documents:X});const Se=He.map(Ge=>Ge.id===A.id?{...Ge,documents:X}:Ge);t({...n,tasks:Se})}}}const S=nr("Document Uploaded",`Uploaded ${E.length} document(s)`);t({...n,activityLog:[S,...n.activityLog||[]]});for(let A=0;A<E.length;A++){const re={id:E[A],name:((h=Re[A])==null?void 0:h.name)||lt.name,type:lt.type,url:"",uploadedBy:u.id,uploadDate:new Date().toISOString(),sharedWith:lt.sharedWith.length>0?lt.sharedWith:[F.ADMIN,F.DESIGNER,F.CLIENT],approvalStatus:"pending"},Y=[],X=e.filter(nt=>nt.role===F.ADMIN&&nt.tenantId===u.tenantId);Y.push(...X);const Se=lt.sharedWith.filter(nt=>nt!==F.ADMIN&&nt!==F.DESIGNER&&nt!==F.CLIENT),Ge=e.filter(nt=>Se.includes(nt.id));Y.push(...Ge);const Ce=Y.filter((nt,ht,mt)=>mt.findIndex(wt=>wt.id===nt.id)===ht&&nt.id!==u.id);Ce.length>0&&await Y6(re,u.name,n.name,Ce,n.id)}Lr("Files Added",`${u.name} uploaded ${E.length} document(s) to "${n.name}"`,u.id,"documents"),at(!1),on({name:"",type:"other",sharedWith:[]}),Oe([]),pn(!1),p("Success",`${E.length} document(s) uploaded successfully to "${n.name}"`,"success",void 0,n.id,n.name)}catch(_){console.error("Document upload error:",_),p("Error","Unable to upload document(s). Please check file size and try again.","error",void 0,n.id,n.name)}finally{ml(!1)}},Ni=h=>{const _=document.createElement("a");_.href=h.url,_.download=h.name,document.body.appendChild(_),_.click(),document.body.removeChild(_),p("Download Started",`Downloading ${h.name}...`,"success")},m=h=>{yi(h),vs(!0)},v=async()=>{var _;if(!Us)return;const h=Us;try{await T6(n.id,h.id);const E=He.map(A=>{var re;return(re=A.documents)!=null&&re.includes(h.id)?{...A,documents:A.documents.filter(Y=>Y!==h.id)}:A});(_=j==null?void 0:j.documents)!=null&&_.includes(h.id)&&ie({...j,documents:j.documents.filter(A=>A!==h.id)});const S=E.filter(A=>{var re,Y;return A.documents&&A.documents.length!==((Y=(re=He.find(X=>X.id===A.id))==null?void 0:re.documents)==null?void 0:Y.length)});for(const A of S)await ni(n.id,A.id,{documents:A.documents});t({...n,tasks:E}),p("Success",`Document "${h.name}" deleted successfully`,"success"),Tt(!1)}catch(E){console.error("Error deleting document:",E),p("Error","Failed to delete document","error")}finally{vs(!1),yi(null)}},I=h=>{const _=fn.find(E=>E.id===h.id)||h;zt(_),Tt(!0)},C=async h=>{var _;if(!me){$e(`approve-doc-${h.id}`);try{await Fu(n.id,h.id,{approvalStatus:"approved",approvedBy:u.id,approvalDate:new Date().toISOString()}),await new Promise(A=>setTimeout(A,500));const E=new Set;n.leadDesignerId&&E.add(n.leadDesignerId),h.uploadedBy&&E.add(h.uploadedBy),(h.sharedWith||[]).forEach(A=>E.add(A)),n.clientId&&((_=h.sharedWith)!=null&&_.includes(n.clientId))&&E.add(n.clientId),e.filter(A=>A.role===F.ADMIN&&A.tenantId===u.tenantId).forEach(A=>E.add(A.id));const S=e.filter(A=>E.has(A.id));S.length>0&&await bN(h,u.name||"Unknown User",S,n.name,n.id,"approved"),p("Success",`Document "${h.name}" approved`,"success")}catch(E){console.error("Error approving document:",E),p("Error","Failed to approve document","error")}finally{$e(null)}}},Z=async h=>{if(!me){$e(`reject-doc-${h.id}`);try{await Fu(n.id,h.id,{approvalStatus:"rejected",rejectedBy:u.id,rejectionDate:new Date().toISOString()}),await new Promise(S=>setTimeout(S,500));const _=new Set;e.filter(S=>S.role===F.ADMIN).forEach(S=>_.add(S.id)),n.leadDesignerId&&_.add(n.leadDesignerId),h.uploadedBy&&_.add(h.uploadedBy),(h.sharedWith||[]).forEach(S=>{S!==u.id&&_.add(S)});const E=e.filter(S=>_.has(S.id));E.length>0&&await bN(h,u.name||"Unknown User",E,n.name,n.id,"rejected"),p("Success",`Document "${h.name}" rejected`,"success")}catch(_){console.error("Error rejecting document:",_),p("Error","Failed to reject document","error")}finally{$e(null)}}},de=async h=>{if(!me){$e(`client-approve-doc-${h.id}`);try{await Fu(n.id,h.id,{clientApprovalStatus:"approved",clientApprovedBy:u.id,clientApprovedDate:new Date().toISOString()}),await new Promise(E=>setTimeout(E,500));const _=e.filter(E=>{var S;return!!(E.id===n.leadDesignerId||(S=h.sharedWith)!=null&&S.includes(E.id)&&E.id!==u.id)});_.length>0&&await wN(h,u.name||"Unknown User",_,n.name,n.id,"approved"),p("Success",`Document "${h.name}" approved by you`,"success")}catch(_){console.error("Error approving document as client:",_),p("Error","Failed to approve document","error")}finally{$e(null)}}},De=async h=>{if(!me){$e(`client-reject-doc-${h.id}`);try{await Fu(n.id,h.id,{clientApprovalStatus:"rejected",clientApprovedBy:u.id,clientApprovedDate:new Date().toISOString()}),await new Promise(E=>setTimeout(E,500));const _=e.filter(E=>{var S;return!!(E.id===n.leadDesignerId||(S=h.sharedWith)!=null&&S.includes(E.id)&&E.id!==u.id)});_.length>0&&await wN(h,u.name||"Unknown User",_,n.name,n.id,"rejected"),p("Success",`Document "${h.name}" rejected by you`,"success")}catch(_){console.error("Error rejecting document as client:",_),p("Error","Failed to reject document","error")}finally{$e(null)}}},ft=async()=>{if(!(!jt.trim()||!Be)&&!ms)try{ui(!0);const h={userId:u.id,userName:u.name||"Unknown User",text:jt,timestamp:new Date().toISOString()};await A6(n.id,Be.id,h);const _={...h,id:Math.random().toString(36).substr(2,9)},E=e.filter(re=>{var Y;return!!(re.id===n.leadDesignerId||re.role===F.ADMIN&&re.tenantId===u.tenantId||re.id===n.clientId||(Y=Be.sharedWith)!=null&&Y.includes(re.id))});E.length>0&&await Z6(Be,_,u.name||"Unknown User",E,n.name,n.id),Yr("");const S=new Date().toISOString();await ti(n.id,`Document Comment: ${Be.name}`,`${u.name} commented: "${jt.substring(0,100)}..."`,"completed",S,S);const A=nr("Document Comment",`Added comment to "${Be.name}"`);t({...n,activityLog:[A,...n.activityLog||[]]}),p("Success",`Comment added to "${Be.name}"`,"success")}catch(h){console.error("Document comment error:",h),p("Error","Unable to add comment. Please try again.","error")}finally{ui(!1)}},dn=h=>{if(h){const _=It.find(E=>E.id===h);if(_){if(Ye(_),Qe(h),_.category==="Others"?it(_.description||""):it(""),_.type==="income"){if(_.paidByRole)et(_.paidByRole),In(_.paidTo||"");else if(_.paidByOther)et("other"),In(_.paidByOther||"");else if(_.paidTo){const E=e.find(S=>S.name===_.paidTo);E?E.role===F.CLIENT?et("client"):E.role===F.VENDOR?et("vendor"):E.role===F.DESIGNER?et("designer"):E.role===F.ADMIN&&et("admin"):et("other"),In(_.paidTo||"")}if(_.receivedByRole)et(_.receivedByRole),Ve(_.receivedBy||_.receivedByName||"");else if(_.receivedBy){const E=e.find(S=>S.name===_.receivedBy);E?E.role===F.VENDOR?et("vendor-received"):E.role===F.DESIGNER?et("designer-received"):E.role===F.ADMIN&&et("admin-received"):et("other-received"),Ve(_.receivedBy||"")}}else if(_.type==="expense"){if(_.paidByOther&&Ye({..._,paidBy:"other"}),_.receivedByRole)et(_.receivedByRole),Ve(_.receivedByName||_.receivedBy||"");else if(_.receivedBy){const E=e.find(S=>S.name===_.receivedBy);E?E.role===F.CLIENT?et("client"):E.role===F.VENDOR?et("vendor"):E.role===F.DESIGNER?et("designer"):E.role===F.ADMIN&&et("admin"):et("other"),Ve(_.receivedBy||"")}}}}else Ye({date:new Date().toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0,paymentMode:void 0}),Qe(null),In(""),Ve(""),et(""),it("");_e(!0),Vn(!1)},Ht=async()=>{var _;const h=J.category==="Others"?Lt:J.category;if(!J.amount||!J.description||!h||!J.date){Vn(!0),p("Validation Error",`Please fill all required fields for "${n.name}"`,"error",void 0,n.id,n.name);return}if(!Rr){if(!ze&&It.some(S=>S.vendorName===J.vendorName&&S.amount===Number(J.amount)&&S.type===J.type&&S.date===J.date&&S.description===J.description)){p("Duplicate Detected","This transaction already exists. Please check the records above.","warning",void 0,n.id,n.name);return}ut(!0);try{let E=[...It],S;if(ze){let A={...It.find(X=>X.id===ze),...J,amount:Number(J.amount),paidBy:J.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":J.paidBy:J.paidBy,paidByRole:J.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":void 0:void 0,paidTo:J.type==="income"?J.vendorName||rn:rn||J.paidTo,paidByOther:J.type==="income"&&ve==="other"?rn:J.paidByOther,receivedBy:J.type==="income"?ve==="vendor-received"||ve==="designer-received"||ve==="admin-received"||ve==="other-received"||ve==="admin"||ve==="client"||ve==="vendor"||ve==="designer"?xt:J.receivedBy:xt||J.receivedBy,receivedByRole:ve==="client-received"?"client-received":ve==="vendor-received"?"vendor-received":ve==="designer-received"?"designer-received":ve==="admin-received"?"admin-received":ve==="other-received"?"other-received":ve==="client"?"client-received":ve==="vendor"?"vendor-received":ve==="designer"?"designer-received":ve==="admin"?"admin-received":ve==="other"?"other-received":void 0,receivedByName:J.type==="expense"||J.type==="income"?xt:J.receivedByName};(A.type==="income"&&A.status==="paid"||A.type==="expense"&&A.status==="paid")&&(A.status="paid");let re="in-progress";A.status==="paid"?re="completed":A.status==="overdue"&&(re="in-progress");const Y=`Type: ${A.type} | Amount: ${A.amount.toLocaleString()} | Category: ${A.category} | Mode: ${A.paymentMode||"N/A"} | Status: ${A.status}${A.vendorName?` | Vendor: ${A.vendorName}`:""}`;await ti(n.id,`Transaction Updated: ${A.description}`,Y,re,A.date,A.date),E=E.map(X=>X.id===ze?A:X),S=nr("Financial",`Updated transaction: ${A.description} (${A.type} - ${A.amount.toLocaleString()})`)}else{const A={id:Math.random().toString(36).substr(2,9),date:J.date,timestamp:new Date().toISOString(),description:J.description,amount:Number(J.amount),type:J.type,status:J.status||"pending",category:h,vendorName:J.vendorName,paidBy:J.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":void 0:J.paidBy,paidByRole:J.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":void 0:void 0,paidTo:J.type==="income"?J.vendorName||rn:J.paidTo,paidByOther:J.type==="income"&&ve==="other"?rn:J.paidByOther,receivedBy:J.type==="income"?ve==="vendor-received"||ve==="designer-received"||ve==="admin-received"||ve==="other-received"||ve==="admin"||ve==="client"||ve==="vendor"||ve==="designer"?xt:void 0:xt||J.receivedBy,receivedByRole:ve==="client-received"?"client-received":ve==="vendor-received"?"vendor-received":ve==="designer-received"?"designer-received":ve==="admin-received"?"admin-received":ve==="other-received"?"other-received":ve==="client"?"client-received":ve==="vendor"?"vendor-received":ve==="designer"?"designer-received":ve==="admin"?"admin-received":ve==="other"?"other-received":void 0,receivedByName:J.type==="expense"||J.type==="income"?xt:void 0,paymentMode:J.paymentMode,adminApproved:J.adminApproved,clientApproved:J.clientApproved,isAdditionalBudget:J.type==="income"&&h==="Additional Budget",clientApprovalForAdditionalBudget:J.type==="income"&&h==="Additional Budget"?J.clientApprovalForAdditionalBudget||"pending":void 0,adminApprovalForAdditionalBudget:J.type==="income"&&h==="Additional Budget"?J.adminApprovalForAdditionalBudget||"pending":void 0,isClientPayment:J.type==="income"&&h!=="Additional Budget",clientApprovalForPayment:J.type==="income"&&h!=="Additional Budget"?J.clientApprovalForPayment||"pending":void 0,adminApprovalForPayment:J.type==="income"&&h!=="Additional Budget"?J.adminApprovalForPayment||"pending":void 0};let re="planned";A.status==="paid"?re="completed":(A.status==="pending"||A.status==="overdue")&&(re="in-progress");const Y=`Type: ${A.type} | Amount: ${A.amount.toLocaleString()} | Category: ${A.category} | Mode: ${A.paymentMode||"N/A"} | Status: ${A.status} | Paid By: ${A.paidBy||"N/A"}${A.vendorName?` | Vendor: ${A.vendorName}`:""}`;await ti(n.id,`Financial: ${A.type==="income"?"Income":"Expense"} - ${A.description}`,Y,re,A.date,A.date),E.push(A),S=nr("Financial",`Added ${A.type}: ${A.amount.toLocaleString()} for ${A.description}`)}try{if(ze){const A=E.find(re=>re.id===ze);A&&await pd(n.id,ze,A)}else{const A=E[E.length-1],re=await Py(n.id,{date:A.date,timestamp:A.timestamp,description:A.description,amount:A.amount,type:A.type,status:A.status,category:A.category,vendorName:A.vendorName,paidBy:A.paidBy,paidByRole:A.paidByRole,paidTo:A.paidTo,paidByOther:A.paidByOther,receivedBy:A.receivedBy,receivedByRole:A.receivedByRole,receivedByName:A.receivedByName,paymentMode:A.paymentMode,adminApproved:A.adminApproved,clientApproved:A.clientApproved,isAdditionalBudget:A.isAdditionalBudget,clientApprovalForAdditionalBudget:A.clientApprovalForAdditionalBudget,adminApprovalForAdditionalBudget:A.adminApprovalForAdditionalBudget,isClientPayment:A.isClientPayment,clientApprovalForPayment:A.clientApprovalForPayment,adminApprovalForPayment:A.adminApprovalForPayment});A.id=re}}catch(A){throw console.error("Database save error:",A),new Error("Failed to save transaction to database")}t({...n,financials:ze?n.financials:E,activityLog:[S,...n.activityLog||[]]}),Lr("Budget Update",`${ze?"Updated":"New"} transaction "${J.description}" in "${n.name}"`,u.id,"financials"),Ye({date:new Date().toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0}),_e(!1),Qe(null),Vn(!1),ut(!1),In(""),Ve(""),et(""),it(""),p("Success",`Transaction ${ze?"updated":"added"} and saved to database.`,"success",void 0,n.id,n.name)}catch(E){const S=(_=E.message)!=null&&_.includes("database")?"Failed to save transaction. Please try again.":"Transaction saved locally. Please refresh the page or contact support if changes don't appear.";p("Error",S,"error",void 0,n.id,n.name),_e(!1),Qe(null),ut(!1),In(""),Ve(""),et(""),it(""),console.error("Transaction save error:",E)}}},un=async(h,_,E)=>{if(!me){$e(`approve-budget-${h}-${_}-${E}`);try{const S=_==="client"?"clientApprovalForAdditionalBudget":"adminApprovalForAdditionalBudget",A=cr.some(Y=>Y.id===h);A&&await pd(n.id,h,{[S]:E});const re=It.find(Y=>Y.id===h);if(re){const Y={...re,[S]:E},X=E==="approved"?"Approved":"Rejected",Se=_==="client"?"Client":"Admin",Ge=_==="client"?E==="approved":Y.clientApprovalForAdditionalBudget==="approved",Ce=_==="admin"?E==="approved":Y.adminApprovalForAdditionalBudget==="approved",nt=Ge&&Ce;if(nt&&re.status!=="paid"){const mt=n.budget+re.amount;let wt={...n,budget:mt,initialBudget:n.initialBudget||n.budget};t(wt),A&&await pd(n.id,h,{status:"paid"})}await ti(n.id,nt?`Additional Budget Approved: ${re.amount.toLocaleString()}`:`Additional Budget ${X}`,nt?`Budget increased by ${re.amount.toLocaleString()}. Both Client and Admin have approved. New Total: ${(n.budget+re.amount).toLocaleString()}`:`${Se} ${E==="approved"?"approved":"rejected"} additional budget of ${re.amount.toLocaleString()}`,nt?"completed":"in-progress",new Date().toISOString(),new Date().toISOString());const ht=e.filter(mt=>mt.id===n.leadDesignerId||mt.id===n.clientId||mt.role===F.ADMIN&&mt.tenantId===u.tenantId);ht.length>0&&await Vx(re,u.name||"Unknown User",ht,n.name,n.id,E,_,"additional-budget")}p("Success",`Additional budget ${E==="approved"?"approved":"rejected"} by ${_==="client"?"Client":"Admin"}`,"success",void 0,n.id,n.name)}catch(S){console.error("Approval error:",S),p("Error","Unable to process approval. Please try again.","error",void 0,n.id,n.name)}finally{$e(null)}}},Tn=async(h,_,E)=>{if(!me){$e(`approve-payment-${h}-${_}-${E}`);try{const S=_==="client"?"clientApprovalForPayment":"adminApprovalForPayment";cr.some(Y=>Y.id===h)&&await pd(n.id,h,{[S]:E});const re=It.find(Y=>Y.id===h);if(re){const Y=E==="approved"?"Confirmed":"Disputed",X=_==="client"?"Client":"Admin",Se=new Date().toISOString();await ti(n.id,`Payment ${Y}`,`${X} ${E==="approved"?"confirmed":"disputed"} payment of ${re.amount.toLocaleString()} for ${re.description}`,E==="approved"?"completed":"in-progress",Se,Se);const Ge=e.filter(Ce=>Ce.id===n.leadDesignerId||Ce.id===n.clientId||Ce.role===F.ADMIN&&Ce.tenantId===u.tenantId);Ge.length>0&&await Vx(re,u.name||"Unknown User",Ge,n.name,n.id,E,_,"payment")}p("Success",`Payment ${E==="approved"?"confirmed":"disputed"} by ${_==="client"?"Client":"Admin"}`,"success",void 0,n.id,n.name)}catch(S){console.error("Approval error:",S),p("Error","Unable to process approval. Please try again.","error",void 0,n.id,n.name)}finally{$e(null)}}},$n=W.useCallback(async(h,_,E)=>{if(me)return;$e(`approve-expense-${h}-${_}-${E}`);const S=_==="client"?"clientApproved":"adminApproved";try{cr.some(Se=>Se.id===h)&&await pd(n.id,h,{[S]:E});const re=It.find(Se=>Se.id===h);if(re){const Se=e.filter(Ge=>Ge.id===n.leadDesignerId||Ge.id===n.clientId||Ge.role===F.ADMIN&&Ge.tenantId===u.tenantId);Se.length>0&&await Vx(re,u.name||"Unknown User",Se,n.name,n.id,E?"approved":"rejected",_,"expense")}p("Success",`Expense ${E?"approved":"rejected"} by ${_==="client"?"client":"admin"}`,"success",void 0,n.id,n.name)}catch(A){console.error("Approval error:",A),p("Error","Unable to process approval. Please try again.","error",void 0,n.id,n.name)}finally{$e(null)}},[n.id,p,cr,It,n.leadDesignerId,n.clientId,e,u.name,me]),Hs=(h,_)=>{var A;if(!j||En(j.status))return;let E=j.dependencies||[];_?E=[...E,h]:E=E.filter(re=>re!==h);let S=j.startDate;if(E.length>0){const re=He.filter(X=>E.includes(X.id)),Y=re.reduce((X,Se)=>new Date(Se.dueDate)>new Date(X)?Se.dueDate:X,((A=re[0])==null?void 0:A.dueDate)||"");Y&&(S=Y)}ie({...j,dependencies:E,startDate:S})},Gs=async()=>{var h,_,E,S,A,re,Y,X,Se,Ge,Ce,nt,ht;if(!(j!=null&&j.title)||!j.startDate||!j.dueDate){U(!0),p("Validation Error",`Please complete all required fields for "${n.name}"`,"error",void 0,n.id,n.name);return}if(En(j.status)&&!$t){p("Action Denied","This task is frozen and cannot be modified.","error");return}Ie(!0);try{const mt={start:{client:{status:"pending"},admin:{status:"pending"}},completion:{client:{status:"pending"},admin:{status:"pending"}}};let wt=j.status||pe.TODO;En(wt)||(wt=pp(j,wt));const At=!j.id,Le={id:j.id||Math.random().toString(36).substr(2,9),title:j.title,description:j.description,status:wt,category:j.category||"General",assigneeId:j.assigneeId||"",startDate:j.startDate,dueDate:j.dueDate,priority:j.priority||"medium",dependencies:j.dependencies||[],subtasks:j.subtasks||[],comments:j.comments||[],approvals:j.approvals||mt};if((h=Le.dependencies)!=null&&h.includes(Le.id)){p("Dependency Error","A task cannot depend on itself.","error");return}if(Le.status!==pe.TODO&&!En(Le.status)&&!(((S=(E=(_=Le.approvals)==null?void 0:_.start)==null?void 0:E.client)==null?void 0:S.status)==="approved"&&((Y=(re=(A=Le.approvals)==null?void 0:A.start)==null?void 0:re.admin)==null?void 0:Y.status)==="approved"&&((Ge=(Se=(X=Le.approvals)==null?void 0:X.completion)==null?void 0:Se.client)==null?void 0:Ge.status)==="approved"&&((ht=(nt=(Ce=Le.approvals)==null?void 0:Ce.completion)==null?void 0:nt.admin)==null?void 0:ht.status)==="approved")){const an=dr(Le);if(an.length>0){p("Blocked",`Cannot start task. Blocked by: ${an.map(Qn=>Qn.title).join(", ")}.`,"error");return}}let Kn=[...He];const ss=Kn.findIndex(nn=>nn.id===Le.id);let Fr;const Nt=He.find(nn=>nn.id===Le.id);if(At){Kn.push(Le),Fr=nr("Task Created",`Created new task "${Le.title}"`,"creation"),await y6(n.id,Le);const nn=Le.assigneeId?cn(Le.assigneeId):"Unassigned",an=new Date().toISOString();if(await ti(n.id,`Task Created: ${Le.title}`,`Assigned to ${nn}. Priority: ${Le.priority}, Due: ${Le.dueDate}`,"planned",an,an),Le.assigneeId){const Qn=e.find(An=>An.id===Le.assigneeId);Qn&&await vN(Le,Qn,n.name,n.id,"created"),$r(Le.assigneeId,"New Task Assignment",`You have been assigned to task "${Le.title}" in "${n.name}"`,"info","plan")}}else{ss>=0&&(Kn[ss]=Le);const nn=[];(Nt==null?void 0:Nt.status)!==Le.status&&nn.push(`Status: ${Nt==null?void 0:Nt.status}  ${Le.status}`),(Nt==null?void 0:Nt.priority)!==Le.priority&&nn.push(`Priority: ${Nt==null?void 0:Nt.priority}  ${Le.priority}`),(Nt==null?void 0:Nt.assigneeId)!==Le.assigneeId&&nn.push(`Assigned to: ${cn((Nt==null?void 0:Nt.assigneeId)||"")}  ${cn(Le.assigneeId)}`),(Nt==null?void 0:Nt.title)!==Le.title&&nn.push("Title changed"),(Nt==null?void 0:Nt.description)!==Le.description&&nn.push("Description updated");const an=nn.length>0?` (${nn.join(", ")})`:"";Fr=nr("Task Updated",`Updated task details for "${Le.title}"${an}`),await ni(n.id,Le.id,Le);const Qn=ra(Le),An=Le.assigneeId?cn(Le.assigneeId):"Unassigned",Br=`Priority: ${Le.priority} | Status: ${Le.status} | Assigned to: ${An} | Progress: ${Qn}% | Due: ${Le.dueDate}${an?" | Changes: "+an:""}`,Yn=new Date().toISOString();if(await ti(n.id,`Task Updated: ${Le.title}`,Br,Le.status===pe.DONE?"completed":"in-progress",Yn,Yn),Nt&&Nt.assigneeId!==Le.assigneeId&&Le.assigneeId){const mr=e.find(Sa=>Sa.id===Le.assigneeId);mr&&await vN(Le,mr,n.name,n.id,"updated"),$r(Le.assigneeId,"Task Reassignment",`You have been assigned to task "${Le.title}" in "${n.name}"`,"info","plan")}}Lr("Task Update",`Task "${Le.title}" ${At?"created":"updated"} in "${n.name}"`,u.id,"plan"),t(At?{...n,activityLog:[Fr,...n.activityLog||[]]}:{...n,tasks:Kn,activityLog:[Fr,...n.activityLog||[]]}),p("Task Saved",`Task "${Le.title}" has been saved in "${n.name}".`,"success",void 0,n.id,n.name),xe(!1),ie(null),U(!1),await new Promise(nn=>setTimeout(nn,500))}catch(mt){console.error("Error saving task:",mt),p("Error","Unable to save task. Please check your input and try again.","error",void 0,n.id,n.name)}finally{Ie(!1)}},uo=async()=>{if(!(lr!=null&&lr.id)){p("Error","Cannot delete a task that has not been saved yet.","error");return}try{await v6(n.id,lr.id);const h=He.filter(E=>E.id!==lr.id),_=nr("Task Deleted",`Deleted task "${lr.title}"`);t({...n,tasks:h,activityLog:[_,...n.activityLog||[]]}),p("Task Deleted",`Task "${lr.title}" has been deleted from "${n.name}".`,"success",void 0,n.id,n.name),xe(!1),ie(null),Bi(!1),Ui(null)}catch(h){console.error("Error deleting task:",h),p("Error","Unable to delete task. Please try again.","error",void 0,n.id,n.name),Bi(!1),Ui(null)}},pl=()=>{if(!(j!=null&&j.id)){p("Error","Cannot delete a task that has not been saved yet.","error");return}Ui(j),Bi(!0)},eg=async h=>{const _=e.find(E=>E.id===h.assigneeId);if(!_){p("Error","Assignee not found","error");return}if(!_.email||!_.email.trim()){p("Error",`Email not found for ${_.name}`,"error");return}ke(h.id),D("Sending reminder...");try{const E=await rA(_.email,_.name,h.title,n.name,h.dueDate);E.success?p("Success",`Email reminder sent to ${_.name}`,"success"):p("Error",E.error||"Failed to send email","error")}catch(E){console.error("Error sending reminder:",E),p("Error","Failed to send email reminder","error")}finally{ke(null),z()}},em=(h,_)=>{if(!h.phone||!h.phone.trim()){p("Error",`WhatsApp number not found for ${h.name}`,"error");return}const E=h.phone.replace(/\D/g,"");if(E.length<10){p("Error",`Invalid WhatsApp number for ${h.name}`,"error");return}const S=`https://wa.me/${E}?text=${encodeURIComponent(_)}`;window.open(S,"_blank")},Sc=h=>{const _=`${window.location.origin}${window.location.pathname}?taskId=${h}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(_).then(()=>{p("Success","Task link copied to clipboard!","success",u==null?void 0:u.id,n.id,n.name)}).catch(()=>{ho(_)}):ho(_)},ho=h=>{const _=document.createElement("textarea");_.value=h,_.style.position="fixed",_.style.opacity="0",document.body.appendChild(_),_.select();try{document.execCommand("copy"),p("Success","Task link copied to clipboard!","success",u==null?void 0:u.id,n.id,n.name)}catch{p("Error","Failed to copy task link","error",u==null?void 0:u.id,n.id,n.name)}document.body.removeChild(_)},tg=async h=>{if(!h.email||!h.email.trim()){p("Error",`Email not found for ${h.name}`,"error");return}D("Sending payment reminder...");try{const _=await K6(h.email,h.name,n.name);_.success?p("Success",`Payment reminder sent to ${h.name}`,"success"):p("Error",_.error||"Failed to send email","error")}catch(_){console.error("Error sending payment reminder:",_),p("Error","Failed to send payment reminder","error")}finally{z()}},jc=async h=>{var S;if(En(h.status)){p("Action Blocked","Task is frozen.","error");return}const _=((S=h.subtasks)==null?void 0:S.map(A=>({...A,isCompleted:!0})))||[];let E=h.status;h.status===pe.REVIEW?E=pe.DONE:E=pe.REVIEW;try{await ni(n.id,h.id,{subtasks:_,status:E}),p("Success",`Task marked as ${E}`,"success")}catch(A){console.error("Error completing task:",A),p("Error","Failed to complete task","error")}},tm=async(h,_)=>{console.log(" handleKanbanStatusUpdate called for task:",h,"new status:",_);const E=He.find(Y=>Y.id===h);if(!E){console.log(" Task not found:",h);return}if(console.log(" Found task:",E.title,"current status:",E.status),En(E.status)){console.log(" Task is frozen, cannot update"),p("Action Blocked","Task is frozen (Aborted or On Hold).","error");return}if(_!==pe.TODO&&!En(_)){const Y=dr(E);if(Y.length>0){const X=Y.map(Se=>Se.title).join(", ");p("Action Blocked",`Waiting for dependencies: ${X}`,"error");return}}const S=He.map(Y=>Y.id===h?{...Y,status:_}:Y),A=nr("Status Changed",`Task "${E.title}" moved from ${E.status} to ${_}`);try{const Y={...E,status:_},X=ra(Y);let Se="in-progress";_===pe.DONE?Se="completed":_===pe.TODO&&(Se="planned");const Ge=E.assigneeId?cn(E.assigneeId):"Unassigned",Ce=`Status: ${E.status}  ${_} | Progress: ${X}% | Priority: ${E.priority} | Assigned to: ${Ge} | Changed by: ${u.name}`,nt=new Date().toISOString();if(await ti(n.id,`Task Status: ${E.title}`,Ce,Se,nt,nt),await ni(n.id,h,{status:_}),_===pe.REVIEW||_===pe.DONE&&E.status!==pe.DONE){const mt=e.filter(wt=>wt.role===F.CLIENT||wt.role===F.ADMIN);mt.length>0&&await J6(E,mt,n.name,n.id)}let ht=n.status;_===pe.IN_PROGRESS&&(E.category==="Design and Planning"&&n.status===jn.DISCOVERY?ht=jn.PLANNING:E.category==="Execution"&&(n.status===jn.DISCOVERY||n.status===jn.PLANNING)&&(ht=jn.EXECUTION),ht!==n.status&&(await g(n.id,{status:ht}),p("Phase Updated",`Project automatically moved to ${ht}`,"success")))}catch(Y){console.error("Error updating task status:",Y),p("Error","Failed to update task status. Please try again.","error")}_===pe.DONE&&u.role===F.VENDOR?Lr("Task Completed",`"${E.title}" marked as DONE by ${u.name} in "${n.name}"`,u.id,"plan"):_===pe.REVIEW&&u.role===F.VENDOR?Lr("Review Request",`"${E.title}" submitted for review by ${u.name} in "${n.name}"`,u.id,"plan"):_!==E.status&&Lr("Status Update",`"${E.title}" moved to ${_} in "${n.name}"`,u.id,"plan");let re=n.status;_===pe.IN_PROGRESS&&(E.category==="Design and Planning"&&n.status===jn.DISCOVERY?re=jn.PLANNING:E.category==="Execution"&&(n.status===jn.DISCOVERY||n.status===jn.PLANNING)&&(re=jn.EXECUTION)),t({...n,status:re,tasks:S,activityLog:[A,...n.activityLog||[]]})},nm=async(h,_)=>{const E=He.find(A=>A.id===h);if(E&&En(E.status))return;const S=He.map(A=>A.id===h?{...A,priority:_}:A);try{await ni(n.id,h,{priority:_}),t({...n,tasks:S})}catch(A){console.error("Error updating task priority:",A),p("Error","Failed to update task priority.","error")}},rm=async(h,_)=>{const E=He.find(X=>X.id===h);if(!E)return;if(En(E.status)){p("Frozen","Task is frozen. Cannot update checklist.","error");return}if(ts(E)){p("Locked","Cannot check off items. This task is blocked by pending dependencies.","warning");return}const S=E.subtasks.map(X=>X.id===_?{...X,isCompleted:!X.isCompleted}:X),A={...E,subtasks:S},re=pp(A,E.status),Y=He.map(X=>X.id===h?{...X,subtasks:S,status:re}:X);try{await ni(n.id,h,{subtasks:S,status:re}),re!==E.status&&re===pe.REVIEW&&u.role===F.VENDOR&&Lr("Review Ready",`All items checked for "${E.title}" by ${u.name} in "${n.name}"`,u.id,"plan"),t({...n,tasks:Y})}catch(X){console.error("Error updating subtask:",X),p("Error","Failed to update checklist.","error")}},zd=async()=>{if(!fe.trim()||!j)return;if(En(j.status)){p("Frozen","Cannot comment on frozen tasks.","error");return}const h={id:Math.random().toString(36).substr(2,9),userId:u.id,userName:u.name||"Unknown User",text:fe,timestamp:new Date().toISOString()},_=[...j.comments||[],h];if(ie({...j,comments:_}),P(""),j.id)try{await ni(n.id,j.id,{comments:_});const E=e.filter(S=>S.id===j.assigneeId||S.id===n.leadDesignerId||S.role===F.ADMIN&&S.tenantId===u.tenantId||S.id===n.clientId);E.length>0&&await X6(j,h,u.name||"Unknown User",E,n.name,n.id)}catch(E){console.error("Failed to save comment",E)}},Hn=async(h,_,E)=>{var A,re,Y,X,Se,Ge,Ce,nt,ht,mt,wt,At,Le,Kn;if(!j||!j.approvals||En(j.status))return;const S=`${h}-${_}-${E||(oo?"client":"admin")}`;if(!Fe){ue(S);try{if(_==="revoke"){if(!$t){p("Access Denied","Only admins can revoke approvals","error");return}if(!E)return;const an=((Y=(re=(A=j.approvals)==null?void 0:A[h])==null?void 0:re.client)==null?void 0:Y.status)==="approved",Qn=((Ge=(Se=(X=j.approvals)==null?void 0:X[h])==null?void 0:Se.admin)==null?void 0:Ge.status)==="approved";if(an&&Qn){p("Locked","Cannot revoke approvals once both parties have approved.","error");return}const An={...j.approvals,[h]:{...j.approvals[h],[E]:{status:"pending",updatedBy:u.id,timestamp:new Date().toISOString()}}};if(ie({...j,approvals:An}),j.id)try{await ni(n.id,j.id,{approvals:An});const Br=new Date().toISOString();await ti(n.id,`Approval Revoked: ${j.title}`,`${h} approval revoked for ${E} by ${u.name}`,"in-progress",Br,Br),p("Approval Revoked",`${E} approval for ${h} stage revoked.`,"info")}catch(Br){console.error("Failed to revoke approval",Br),p("Error","Failed to revoke approval","error")}return}const ss=u.role===F.CLIENT?"client":u.role===F.ADMIN?"admin":null;if(!ss)return;const Fr=_==="approve"?"approved":"rejected";let Nt={...j.approvals,[h]:{...j.approvals[h],[ss]:{status:Fr,updatedBy:u.id,timestamp:new Date().toISOString()}}},nn=j.status;if(_==="reject")nn=h==="start"?pe.TODO:pe.IN_PROGRESS,p("Task Rejected","Status has been reset. Please review comments.","warning"),j.assigneeId&&$r(j.assigneeId,"Work Rejected",`${u.name} rejected ${h} approval for "${j.title}".`,"warning","plan");else{const an=((nt=(Ce=Nt.start)==null?void 0:Ce.client)==null?void 0:nt.status)==="approved",Qn=((mt=(ht=Nt.start)==null?void 0:ht.admin)==null?void 0:mt.status)==="approved",An=((At=(wt=Nt.completion)==null?void 0:wt.client)==null?void 0:At.status)==="approved",Br=((Kn=(Le=Nt.completion)==null?void 0:Le.admin)==null?void 0:Kn.status)==="approved";if(an&&Qn&&An&&Br){if(nn=pe.DONE,p("Task Approved","Task fully approved and marked as DONE.","success"),j.assigneeId){$r(j.assigneeId,"Work Approved",`Great job! "${j.title}" is officially approved and done in "${n.name}".`,"success","plan");const Yn=sn.find(mr=>mr.id===j.assigneeId);Yn&&Yn.email&&j.title&&await Mx(j.title,Yn,n.name,u.name,"completion")}}else if(h==="completion"){if(p("Approved",`Task completion approved by ${ss}. Waiting for others.`,"success"),j.assigneeId){const Yn=sn.find(mr=>mr.id===j.assigneeId);Yn&&Yn.email&&j.title&&await Mx(j.title,Yn,n.name,u.name,"completion")}}else if(p("Approved",`Task ${h} approved.`,"success"),j.assigneeId){const Yn=sn.find(mr=>mr.id===j.assigneeId);Yn&&Yn.email&&j.title&&await Mx(j.title,Yn,n.name,u.name,h)}}if(ie({...j,approvals:Nt,status:nn}),j.id)try{await ni(n.id,j.id,{approvals:Nt,status:nn});const an=He.map(An=>An.id===j.id?{...An,approvals:Nt,status:nn}:An);t({...n,tasks:an});const Qn=new Date().toISOString();await ti(n.id,`Approval: ${j.title}`,`${h} approval ${_}ed by ${u.name}`,"completed",Qn,Qn)}catch(an){console.error("Failed to save approval",an),p("Error","Failed to save approval status","error")}await new Promise(an=>setTimeout(an,500))}finally{ue(null)}}},ng=()=>{const h=It.filter(Y=>Y.type==="income"&&Y.status==="paid").reduce((Y,X)=>Y+X.amount,0),_=It.filter(Y=>Y.type==="income"&&(Y.status==="pending"||Y.status==="overdue")).reduce((Y,X)=>Y+X.amount,0),E=It.filter(Y=>Y.type==="expense"&&Y.status==="paid").reduce((Y,X)=>Y+X.amount,0),S=It.filter(Y=>Y.type==="expense"&&(Y.status==="pending"||Y.status==="overdue")).reduce((Y,X)=>Y+X.amount,0),A=It.filter(Y=>Y.type==="income"&&Y.category==="Additional Budget"&&Y.status==="paid").reduce((Y,X)=>Y+X.amount,0),re=It.filter(Y=>Y.type==="income"&&Y.category==="Additional Budget").reduce((Y,X)=>Y+X.amount,0);return{received:h,pendingIncome:_,paidOut:E,pendingExpenses:S,additionalBudgetReceived:A,totalAdditionalBudget:re}},{received:Ii,paidOut:Ei,pendingExpenses:qd,totalAdditionalBudget:ns}=ng(),mo=W.useMemo(()=>It.filter(h=>Qt==="all"?!0:Qt==="income"?h.type==="income":Qt==="expense"?h.type==="expense":Qt==="pending"?h.status==="pending":Qt==="overdue"?h.status==="overdue":!0).sort((h,_)=>{const E=h.timestamp?new Date(h.timestamp).getTime():new Date(h.date).getTime();return(_.timestamp?new Date(_.timestamp).getTime():new Date(_.date).getTime())-E}),[It,Qt]),Ks=h=>{const _=xf.indexOf(h);return _===-1?999:_},Hi=W.useMemo(()=>{if(He.length===0)return null;const h=He.flatMap(Y=>[new Date(Y.startDate).getTime(),new Date(Y.dueDate).getTime()]);h.push(new Date(n.startDate).getTime()),h.push(new Date(n.deadline).getTime());const _=Math.min(...h),E=Math.max(...h),S=E-_,A=1e3*60*60*24,re=Math.ceil(S/A)+5;return{minDate:_,maxDate:E,totalDays:re,dayMs:A}},[n,He]),Gi=W.useMemo(()=>{if(!Hi)return[];const h=ya.reduce((S,A)=>(S[A.category]=S[A.category]||[],S[A.category].push(A),S),{}),_=[];return Object.keys(h).sort((S,A)=>Ks(S)-Ks(A)).forEach(S=>{const A=h[S].sort((re,Y)=>new Date(re.startDate).getTime()-new Date(Y.startDate).getTime());_.push(...A)}),_.map((S,A)=>{const re=new Date(S.startDate).getTime(),Y=new Date(S.dueDate).getTime(),X=Hi.maxDate-Hi.minDate,Se=(re-Hi.minDate)/X*100,Ge=(Y-re)/X*100;return{...S,left:Se,width:Math.max(Ge,.5),index:A}})},[ya,Hi]),sm=W.useMemo(()=>{const h=new Set(He.map(_=>_.assigneeId));return e.filter(_=>_.role===F.VENDOR&&h.has(_.id))},[He,e]),kc=W.useMemo(()=>{const h=new Map;return sm.forEach(_=>h.set(_.id,_)),n.teamMembers&&n.teamMembers.forEach(_=>{const E=e.find(S=>S.id===_);E&&E.role===F.VENDOR&&h.set(E.id,E)}),Array.from(h.values())},[sm,n.teamMembers,e]),Cc=W.useMemo(()=>{if($t||qs)return kc;const h=n.hiddenVendors||[];return kc.filter(_=>!h.includes(_.id))},[kc,n.hiddenVendors,$t,qs]),fl=W.useMemo(()=>{const h={};return Cc.forEach(_=>{const E=_.specialty||"General";h[E]||(h[E]=[]),h[E].push(_)}),h},[Cc]),Wd=W.useMemo(()=>Object.keys(fl).sort((h,_)=>Ks(h)-Ks(_)),[fl]);W.useEffect(()=>{if(j&&j.id){const h=He.find(_=>_.id===j.id);h&&JSON.stringify(h.documents)!==JSON.stringify(j.documents)&&ie(_=>_&&_.id===j.id?{..._,documents:h.documents}:_)}},[He,j==null?void 0:j.id]);const po=h=>!h||h.length===0?0:h.filter(_=>fn.some(E=>E.id===_)).length,im=h=>!h||h.length===0?[]:fn.filter(_=>h.includes(_.id)),Et=j?En(j.status):!1,rg=async()=>{if(n.status===jn.ON_HOLD){const _=He.some(E=>E.category==="Execution"&&(E.status===pe.IN_PROGRESS||E.status===pe.DONE))?jn.EXECUTION:jn.PLANNING;if(window.confirm(`Resume project to ${_}?`))try{await g(n.id,{status:_}),p("Project Resumed",`Project resumed to ${_}`,"success")}catch(E){console.error(E),p("Error","Failed to resume project","error")}}else if(window.confirm("Are you sure you want to put this project ON HOLD?"))try{await g(n.id,{status:jn.ON_HOLD}),p("Project On Hold","Project status set to On Hold","warning")}catch(h){console.error(h),p("Error","Failed to update status","error")}};return a.jsxs("div",{className:"h-full flex flex-col animate-fade-in relative",children:[a.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-2 flex flex-col md:flex-row items-start md:items-center justify-between sticky top-0 z-10 shadow-sm gap-3 md:gap-0",children:[!k&&a.jsxs("div",{className:"w-full space-y-3",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 animate-pulse"}),a.jsx("div",{className:"h-4 bg-gray-100 rounded w-1/2 animate-pulse"})]}),k&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-start gap-3 md:gap-4 w-full md:w-auto flex-1",children:[a.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-800 transition-colors flex-shrink-0 mt-1",title:"Go back to project list",children:a.jsx(Va,{className:"w-5 h-5 rotate-180"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 truncate",children:n.name}),$t&&a.jsx("button",{onClick:Ns,className:"md:hidden flex items-center gap-2 px-2 py-1.5 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-xs font-medium whitespace-nowrap flex-shrink-0",title:"Delete Project",children:a.jsx(Ts,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex flex-wrap items-center gap-3 md:gap-4 text-sm md:text-xs text-gray-500 mt-4 md:mt-3",children:$t&&a.jsxs("button",{onClick:rg,className:`text-sm md:text-xs font-bold flex items-center gap-1 px-2 py-0.5 rounded-md border transition-colors whitespace-nowrap ${n.status===jn.ON_HOLD?"text-green-600 bg-green-50 border-green-100 hover:bg-green-100":"text-orange-600 bg-orange-50 border-orange-100 hover:bg-orange-100"}`,title:n.status===jn.ON_HOLD?"Resume Project":"Put Project On Hold",children:[n.status===jn.ON_HOLD?a.jsx(Lb,{className:"w-3 h-3"}):a.jsx(Bx,{className:"w-3 h-3"}),n.status===jn.ON_HOLD?"Resume":"Hold"]})}),a.jsxs("div",{className:"flex flex-wrap items-center gap-3 md:gap-4 text-base md:text-sm text-gray-600 mt-3 md:mt-3",children:[a.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[a.jsx(th,{className:"w-4 h-4 flex-shrink-0"})," Due: ",ln(n.deadline)]}),!vn&&a.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[a.jsx(Oj,{className:"w-4 h-4 flex-shrink-0"})," Budget: ",n.budget.toLocaleString()]})]})]})]}),a.jsxs("div",{className:"flex gap-2 md:gap-3 w-full md:w-auto flex-shrink-0",children:[$t&&a.jsxs("button",{onClick:Ns,className:"hidden md:flex items-center gap-2 px-3 md:px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm md:text-xs font-medium whitespace-nowrap",title:"Delete Project",children:[a.jsx(Ts,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{className:"hidden md:inline",children:"Delete"})]}),Ct&&L!=="timeline"&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>{if(L==="plan"){const h=new Date().toISOString().split("T")[0];ie({startDate:h,dueDate:h}),xe(!0),U(!1)}L==="documents"&&(at(!0),Oe([])),L==="financials"&&dn(),L==="team"&&(pi(!0),gs("")),L==="discovery"&&fi(!0)},className:"hidden md:flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm md:text-xs font-medium whitespace-nowrap flex-1 md:flex-none justify-center md:justify-start",children:[a.jsx(Oi,{className:"w-4 h-4 flex-shrink-0"}),a.jsx("span",{children:L==="plan"?"Add Task":L==="documents"?"Add Document":L==="financials"?"Add Transaction":L==="team"?"Add Member":L==="discovery"?"Add Meeting":"Add Item"})]}),a.jsx("button",{onClick:()=>{if(L==="plan"){const h=new Date().toISOString().split("T")[0];ie({startDate:h,dueDate:h}),xe(!0),U(!1)}L==="documents"&&(at(!0),Oe([])),L==="financials"&&dn(),L==="team"&&(pi(!0),gs("")),L==="discovery"&&fi(!0)},className:"md:hidden fixed bottom-6 right-6 z-40 w-14 h-14 bg-gray-900 text-white rounded-full shadow-xl flex items-center justify-center hover:bg-gray-800 transition-transform active:scale-95","aria-label":"Add Item",children:a.jsx(Oi,{className:"w-6 h-6"})})]}),!Ct&&L==="documents"&&Ws&&a.jsxs("button",{onClick:()=>{at(!0),Oe([])},className:"flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm md:text-xs font-medium whitespace-nowrap flex-1 md:flex-none justify-center md:justify-start",children:[a.jsx(Uu,{className:"w-4 h-4 flex-shrink-0"}),a.jsx("span",{className:"hidden md:inline",children:"Upload"})]})]})]})]}),a.jsx("div",{ref:we,className:"bg-gray-50 overflow-x-auto md:overflow-hidden [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded [&:hover::-webkit-scrollbar-thumb]:bg-gray-400 hover:[scrollbar-color:rgb(107_114_128)_transparent]",style:{scrollbarWidth:"thin",scrollbarColor:"transparent transparent"},children:a.jsx("div",{className:"flex gap-1 md:gap-6 px-4 md:px-6 min-w-max md:min-w-0 md:w-full md:justify-center",children:[{id:"discovery",label:"Meetings",icon:Pa,hidden:vn},{id:"plan",label:"WIP",icon:oj},{id:"documents",label:"Documents",icon:Cu},{id:"financials",label:"Financials",icon:yp,hidden:!cl},{id:"timeline",label:"Timeline",icon:Fb,hidden:vn},{id:"team",label:"Team",icon:Fp}].map(h=>h.hidden?null:a.jsx("button",{"data-tab-id":h.id,onClick:()=>O(h.id),className:`flex items-center gap-1 md:gap-1 pt-1 pb-0.5 md:pt-2 md:pb-1 px-3 md:px-5 text-base md:text-sm font-medium transition-all whitespace-nowrap flex-shrink-0 md:flex-shrink ${L===h.id?"text-gray-900":"text-gray-500 hover:text-gray-700"}`,children:a.jsxs("span",{className:`inline-flex items-center gap-1 pb-1 ${L===h.id?"border-b-2 border-gray-900":""}`,children:[a.jsx(h.icon,{className:"w-4 h-4 md:w-4 md:h-4 flex-shrink-0"}),h.label]})},h.id))})}),a.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 border-t border-gray-200",children:[L==="discovery"&&!vn&&a.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-800 mb-2",children:"Meetings"}),a.jsxs("div",{className:"flex items-center gap-3 text-base md:text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Mp,{className:"w-5 h-5 md:w-4 md:h-4 flex-shrink-0"}),a.jsxs("span",{className:"font-medium",children:[Pn.length," Meeting",Pn.length!==1?"s":""," Held"]})]}),Pn.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-gray-400",children:""}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(th,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsxs("span",{className:"whitespace-nowrap",children:["Latest: ",ln(((am=Pn[0])==null?void 0:am.date)||"")]})]})]})]})]}),a.jsx("div",{className:"space-y-3 md:space-y-4",children:Pn.length===0?a.jsx("div",{className:"text-center py-8 md:py-10 border-2 border-dashed border-gray-100 rounded-lg",children:a.jsx("p",{className:"text-base md:text-sm text-gray-400",children:"No meetings recorded yet."})}):Pn.map(h=>a.jsxs("div",{className:"border border-gray-100 rounded-lg hover:shadow-md transition-shadow bg-white overflow-hidden",children:[a.jsx("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 p-3 md:p-5",children:a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2",children:[a.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[a.jsx("h4",{className:"font-bold text-lg md:text-base text-gray-800 break-words",children:h.title}),a.jsx("span",{className:"bg-gray-100 text-gray-600 text-sm md:text-xs px-2 py-1 rounded whitespace-nowrap",children:ln(h.date)})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("span",{className:"bg-purple-100 text-purple-700 text-sm md:text-xs px-2 py-0.5 rounded-full whitespace-nowrap",children:h.type}),Ct&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{Za(h),fi(!0)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors flex-shrink-0",title:"Edit meeting",children:a.jsx(kN,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>{Bs(h),xi(!0)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-gray-100 rounded transition-colors flex-shrink-0",title:"Delete meeting",children:a.jsx(Ts,{className:"w-4 h-4"})})]})]})]}),a.jsx("p",{className:"text-base md:text-sm text-gray-600 mt-2 whitespace-pre-wrap bg-gray-50 p-3 md:p-4 rounded overflow-hidden",children:h.notes}),a.jsx("div",{className:"mt-3 md:mt-4 flex gap-2 flex-wrap",children:(h.attendees||[]).map(_=>{const E=e.find(S=>S.id===_)||sn.find(S=>S.id===_);return a.jsx("span",{className:"text-sm md:text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-medium whitespace-nowrap",children:(E==null?void 0:E.name)||"Unknown"},_)})})]})}),a.jsxs("div",{className:"border-t border-gray-100 p-3 md:p-4 bg-gray-50",children:[a.jsxs("button",{onClick:()=>{$(_=>{const E=new Set(_);return E.has(h.id)?E.delete(h.id):E.add(h.id),E})},className:"flex items-center gap-2 w-full hover:bg-gray-100 p-2 rounded transition-colors",children:[a.jsx("span",{className:`transform transition-transform ${H.has(h.id)?"rotate-90":""}`,children:a.jsx(Va,{className:"w-4 h-4 text-gray-600"})}),a.jsxs("h5",{className:"text-sm md:text-xs font-bold text-gray-700",children:["Comments (",(eo[h.id]||[]).length,")"]})]}),H.has(h.id)&&a.jsx("div",{className:"mt-2 md:mt-3",children:a.jsx("div",{className:"space-y-3 mb-3 max-h-60 overflow-y-auto",children:(eo[h.id]||[]).map(_=>{let E="Unknown User";if(_.userName&&_.userName.trim()&&_.userName!=="Unknown User")E=_.userName;else if(_.userId===u.id&&u.name)E=u.name;else if(_.userId){const A=e.find(re=>re.id===_.userId);if(A!=null&&A.name)E=A.name;else{const re=sn.find(Y=>Y.id===_.userId);re!=null&&re.name&&(E=re.name)}}const S=_.status==="done";return a.jsxs("div",{className:`p-3 ${S?"opacity-60":""}`,children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:`text-sm md:text-xs font-semibold text-gray-800 ${S?"line-through":""}`,children:E}),a.jsx("p",{className:`text-sm md:text-xs text-gray-700 mt-1 ${S?"line-through text-gray-500":""}`,children:_.text})]}),(u.id===_.userId||Ct)&&a.jsx("button",{onClick:()=>{const re={..._,status:S?"pending":"done"};pa(Y=>({...Y,[h.id]:(Y[h.id]||[]).map(X=>X.id===_.id?re:X)}))},className:`p-1 flex-shrink-0 rounded transition-colors ${S?"text-green-600 hover:text-green-700 bg-green-50":"text-gray-400 hover:text-green-600"}`,title:S?"Mark as pending":"Mark as done",children:a.jsx(Ol,{className:"w-4 h-4"})})]}),a.jsx("p",{className:`text-sm md:text-xs text-gray-500 mt-2 ${S?"line-through":""}`,children:Ox(_.timestamp)})]},_.id)})})}),a.jsxs("div",{className:"flex gap-1 mt-2 md:mt-3",children:[a.jsx("input",{type:"text",placeholder:"Add a comment...",value:Fi[h.id]||"",onChange:_=>Fs(E=>({...E,[h.id]:_.target.value})),onKeyPress:_=>{_.key==="Enter"&&!Wt[h.id]&&_s(h.id)},disabled:!!Wt[h.id],className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none"}),a.jsx("button",{onClick:()=>_s(h.id),className:"p-2 text-gray-500 hover:text-purple-600 transition-colors",title:"Post comment",disabled:!!Wt[h.id],children:Wt[h.id]?a.jsx(Pt,{size:"sm",className:"text-gray-700"}):a.jsx(ax,{className:"w-4 h-4"})})]})]})]},h.id))})]}),L==="plan"&&a.jsxs("div",{className:"space-y-6 h-full flex flex-col p-4 md:p-6",children:[a.jsx("div",{className:"flex bg-white rounded-lg border border-gray-200 p-1.5 w-fit shadow-sm",children:[{id:"list",label:"List View",icon:HS},{id:"kanban",label:"Priority Board",icon:BS},{id:"gantt",label:"Gantt Chart",icon:th}].map(h=>a.jsxs("button",{onClick:()=>ge(h.id),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all
                    ${le===h.id?"bg-gray-900 text-white shadow-sm":"text-gray-500 hover:text-gray-900"}`,children:[a.jsx(h.icon,{className:"w-4 h-4"}),h.label]},h.id))}),le==="kanban"&&a.jsx("div",{className:"flex-1 overflow-x-auto min-h-[500px]",children:a.jsx(iV,{tasks:ya,users:e,onUpdateTaskStatus:tm,onUpdateTaskPriority:nm,onEditTask:_i,onCompleteTask:jc})}),le==="gantt"&&Hi&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden flex-1 flex flex-col min-h-[600px]",children:[a.jsxs("div",{className:"p-4 md:p-5 bg-gray-50 flex justify-between items-center",children:[a.jsx("h3",{className:"font-bold text-base md:text-lg text-gray-800",children:"Timeline & Dependencies"}),a.jsxs("div",{className:"flex items-center gap-6 text-sm md:text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," Task"]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Done"]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-0.5 bg-gray-300"})," Dependency"]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-0.5 bg-red-400"})," Conflict"]})]})]}),a.jsx("div",{className:"flex-1 overflow-auto relative",children:(()=>{const h=[],_=new Date(Hi.minDate),E=new Date(Hi.maxDate);for(;_<=E;)h.push(new Date(_)),_.setDate(_.getDate()+1);const S=40,A=250,re=h.length*S,Y=A+re,X=[];let Se=null,Ge=0;return h.forEach((Ce,nt)=>{const ht=Ce.toLocaleDateString("en-IN",{month:"short",year:"2-digit"});ht!==Se&&(Se&&X.push({label:Se,startIdx:Ge,dayCount:nt-Ge}),Se=ht,Ge=nt)}),Se&&X.push({label:Se,startIdx:Ge,dayCount:h.length-Ge}),a.jsxs("div",{style:{minWidth:`${Y}px`},className:"p-6 relative",children:[a.jsx("div",{className:"absolute inset-0 pointer-events-none pt-[60px] pb-6 flex",style:{paddingLeft:`${A}px`,paddingRight:"24px"},children:h.map((Ce,nt)=>a.jsx("div",{style:{width:`${S}px`,flexShrink:0},className:"border-r border-gray-100 h-full"},nt))}),a.jsxs("div",{className:"sticky top-0 bg-white z-20",children:[a.jsxs("div",{className:"flex pb-1 mb-2",children:[a.jsx("div",{style:{width:`${A}px`,flexShrink:0},className:"font-semibold text-sm text-gray-700 pl-2",children:"Task Details"}),a.jsxs("div",{style:{width:`${re}px`},className:"relative",children:[a.jsx("div",{className:"flex w-full text-xs font-bold text-gray-600 mb-2 h-5 border-b border-gray-200",children:X.map((Ce,nt)=>a.jsx("div",{style:{width:`${Ce.dayCount*S}px`,flexShrink:0},className:"text-left px-2 bg-gray-50 border-r border-gray-200",children:Ce.label},nt))}),a.jsx("div",{className:"flex w-full",children:h.map((Ce,nt)=>a.jsxs("div",{style:{width:`${S}px`,flexShrink:0},className:`text-center text-xs py-1 ${Ce.getDay()===0||Ce.getDay()===6?"bg-red-50":""} ${Ce.getDate()===1?"border-l-2 border-gray-300":""}`,children:[a.jsx("div",{className:`font-semibold ${Ce.getDay()===0||Ce.getDay()===6?"text-red-400":"text-gray-600"}`,children:Ce.getDate()}),a.jsx("div",{className:"text-[10px] text-gray-400",children:Ce.toLocaleDateString("en-IN",{weekday:"short"}).substring(0,2)})]},nt))})]})]}),a.jsx("div",{className:"flex pb-2 border-b border-gray-100",children:a.jsx("div",{style:{width:`${A}px`},className:"pl-2"})})]}),a.jsxs("div",{className:"relative mt-2",children:[a.jsx("svg",{className:"absolute top-0 pointer-events-none z-0",style:{left:`${A}px`,width:`${re}px`},viewBox:`0 0 ${re} ${Gi.length*Bu}`,preserveAspectRatio:"none",children:Gi.flatMap(Ce=>(Ce.dependencies||[]).map(nt=>{const ht=Gi.find(Fr=>Fr.id===nt);if(!ht)return null;const mt=(ht.left+ht.width)*re/100,wt=ht.index*Bu+Bu/2,At=Ce.left*re/100,Le=Ce.index*Bu+Bu/2,Kn=mt>At,ss=`M ${mt} ${wt} C ${mt+20} ${wt}, ${At-20} ${Le}, ${At} ${Le}`;return a.jsxs("g",{children:[a.jsx("path",{d:ss,stroke:Kn?"#ef4444":"#9CA3AF",strokeWidth:Kn?"2":"1.5",fill:"none",className:Kn?"opacity-80":"opacity-30",strokeDasharray:Kn?"4 2":"none"}),a.jsx("circle",{cx:At,cy:Le,r:"3",fill:Kn?"#ef4444":"#9CA3AF"})]},`${ht.id}-${Ce.id}`)}))}),a.jsx("div",{className:"relative z-10 space-y-0",children:Gi.map((Ce,nt)=>{const ht=nt===0||Gi[nt-1].category!==Ce.category,mt=ra(Ce),wt=En(Ce.status);return a.jsxs(ii.Fragment,{children:[ht&&a.jsx("div",{className:"bg-gray-100/50 px-2 py-1 text-xs font-bold text-gray-500 uppercase tracking-wider sticky left-0 mb-1 mt-2",style:{width:`${Y}px`},children:Ce.category}),a.jsxs("div",{className:"flex items-center group hover:bg-gray-50/50 rounded min-h-[56px]",children:[a.jsxs("div",{style:{width:`${A}px`,flexShrink:0},className:"pr-4 pl-2 flex flex-col justify-center border-r border-gray-100",children:[a.jsxs("div",{onClick:()=>_i(Ce),className:"text-base font-medium text-gray-800 truncate cursor-pointer hover:text-blue-600 flex items-center gap-1",children:[Ce.title,ts(Ce)&&a.jsx(xh,{className:"w-3 h-3 text-red-400"}),wt&&a.jsx(Mo,{className:"w-3 h-3 text-red-600"})]}),a.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 mt-1",children:[a.jsx("span",{children:cn(Ce.assigneeId)}),a.jsxs("span",{className:"font-mono",children:[mt,"%"]})]})]}),a.jsx("div",{style:{width:`${re}px`},className:"relative h-6 rounded-md",children:a.jsxs("div",{className:`absolute h-full rounded shadow-sm flex items-center px-2 cursor-pointer
                                           ${Ce.status==="Done"?"bg-green-500 opacity-80":"bg-blue-500 opacity-80"}
                                           ${Ce.status==="Review"?"bg-purple-500 opacity-80":""}
                                           ${ts(Ce)?"bg-gray-400 opacity-50":""}
                                           ${wt?"bg-gray-800 opacity-70":""}
                                        hover:opacity-100 transition-opacity z-20
                                      `,style:{left:`${Ce.left}%`,width:`${Ce.width}%`},role:"button",tabIndex:0,title:"Click to edit task",onClick:()=>_i(Ce),children:[Ce.status===pe.OVERDUE&&a.jsx("div",{className:"absolute top-0 bottom-0 bg-red-500 opacity-80 rounded",style:{width:"100%"},"aria-label":"Overdue indicator"}),a.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-white/20",style:{width:`${mt}%`},"aria-label":"Progress indicator"}),a.jsx("span",{className:"relative text-[9px] text-white truncate font-medium w-full",children:Ce.width>10?Ce.title:""})]})})]})]},Ce.id)})})]})]})})()})]}),le==="list"&&a.jsx("div",{className:"space-y-8",children:Object.entries(ya.reduce((h,_)=>(h[_.category]=h[_.category]||[],h[_.category].push(_),h),{})).sort((h,_)=>Ks(h[0])-Ks(_[0])).map(([h,_])=>a.jsxs("div",{children:[a.jsxs("h3",{className:"text-base font-bold text-gray-500 uppercase tracking-wide mb-4 pl-1 flex items-center gap-1",children:[a.jsx($p,{className:"w-4 h-4"})," ",h]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_.map(E=>{const S=ts(E)&&E.status!==pe.DONE,A=En(E.status),re=ra(E),Y=u.id===E.assigneeId;return console.log(` Task "${E.title}": isMyTask=${Y}, blocked=${S}, frozen=${A}, status=${E.status}, assigneeId=${E.assigneeId}, userId=${u.id}`),a.jsxs("div",{className:`bg-white p-4 md:p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all ${S||A?"opacity-75 bg-gray-50":""}`,children:[a.jsxs("div",{className:"flex justify-between items-start mb-3",children:[a.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-medium uppercase
                                ${E.priority==="high"?"bg-red-100 text-red-600":E.priority==="medium"?"bg-yellow-100 text-yellow-600":"bg-green-100 text-green-600"}`,children:E.priority}),a.jsx("div",{className:"flex items-center gap-1",children:A?a.jsxs("span",{title:"Frozen by Admin",className:"flex items-center gap-1 text-xs text-red-600 font-bold bg-red-50 px-2 py-0.5 rounded border border-red-100",children:[a.jsx(Mo,{className:"w-3 h-3"})," ",E.status]}):a.jsxs(a.Fragment,{children:[S&&a.jsx("span",{title:"Blocked by dependency",children:a.jsx(xh,{className:"w-4 h-4 text-red-400"})}),a.jsx("button",{onClick:()=>_i(E),className:"text-xs text-gray-400 hover:text-gray-900 ml-2",children:"View"})]})})]}),a.jsxs("div",{className:"mt-3",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("span",{className:"text-sm md:text-xs text-gray-400 font-medium",children:"Progress"}),a.jsxs("span",{className:"text-sm md:text-xs text-gray-600 font-bold",children:[re,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5",children:a.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${E.status===pe.DONE?"bg-green-500":A?"bg-gray-400":"bg-blue-500"}`,style:{width:`${re}%`}})})]}),a.jsx("h4",{className:"font-bold text-lg text-gray-800 mb-1 cursor-pointer hover:text-blue-600",onClick:()=>_i(E),children:E.title}),a.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[ln(E.startDate)," - ",ln(E.dueDate)]}),a.jsx("div",{className:"flex gap-2 mb-3 flex-wrap",children:(()=>{var mt,wt,At,Le,Kn,ss,Fr,Nt,nn,an,Qn,An,Br,Yn,mr,Sa,fu,gu,ja;const X=((At=(wt=(mt=E.approvals)==null?void 0:mt.completion)==null?void 0:wt.client)==null?void 0:At.status)==="approved",Se=((ss=(Kn=(Le=E.approvals)==null?void 0:Le.completion)==null?void 0:Kn.admin)==null?void 0:ss.status)==="approved",Ge=((nn=(Nt=(Fr=E.approvals)==null?void 0:Fr.completion)==null?void 0:Nt.client)==null?void 0:nn.status)==="rejected",Ce=((An=(Qn=(an=E.approvals)==null?void 0:an.completion)==null?void 0:Qn.admin)==null?void 0:An.status)==="rejected",nt=((mr=(Yn=(Br=E.approvals)==null?void 0:Br.completion)==null?void 0:Yn.designer)==null?void 0:mr.status)==="rejected",ht=((fu=(Sa=E.approvals)==null?void 0:Sa.completion)==null?void 0:fu.client)||((ja=(gu=E.approvals)==null?void 0:gu.completion)==null?void 0:ja.admin);return a.jsxs(a.Fragment,{children:[X&&Se&&a.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Approved by Both"}),X&&!Se&&!Ce&&E.status===pe.REVIEW&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded",children:"Waiting for Admin Approval"}),Se&&!X&&!Ge&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded",children:E.status===pe.REVIEW?"Waiting for Client Approval":"Client Approval Pending"}),!X&&!Se&&!Ge&&!Ce&&E.status===pe.REVIEW&&ht&&a.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:E.status===pe.REVIEW?"Under Review":"Waiting for Review"}),Ge&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded",children:"Rejected by Client"}),Ce&&a.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded",children:"Rejected by Admin"}),nt&&a.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded",children:"Rejected by Designer"}),E.status===pe.OVERDUE&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded",children:"Overdue"})]})})()}),a.jsx("div",{className:"space-y-2 mb-4 max-h-[80px] overflow-y-auto pr-2",children:E.subtasks.map(X=>a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 transition-opacity",style:{opacity:S||A||!Ct&&!Y?.5:1},children:[a.jsx("button",{type:"button",onClick:()=>(Ct||Y)&&rm(E.id,X.id),disabled:S||A||!Ct&&!Y,className:`flex-shrink-0 w-4 h-4 rounded-full border flex items-center justify-center transition-all duration-200 ${X.isCompleted?"bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600":"border-gray-400 hover:border-green-400 hover:bg-green-50"} disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:border-gray-300`,children:X.isCompleted&&a.jsx(Ol,{className:"w-2.5 h-2.5 text-white"})}),a.jsx("span",{className:X.isCompleted?"line-through text-gray-400":"",children:X.title})]},X.id))}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{className:"text-sm md:text-xs text-gray-500",children:cn(E.assigneeId)})}),a.jsxs("div",{className:"flex items-center gap-2",children:[u.role===F.ADMIN&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:X=>{X.stopPropagation(),eg(E)},disabled:he===E.id,className:`p-1 rounded-full transition-all ${he===E.id?"text-blue-500 bg-blue-50 cursor-wait":"text-gray-400 hover:text-blue-600 hover:bg-blue-50"}`,title:he===E.id?"Sending email...":"Send Email Reminder",children:he===E.id?a.jsx("span",{className:"inline-block animate-spin w-4 h-4",children:""}):a.jsx(Op,{className:"w-4 h-4"})}),a.jsx("button",{onClick:X=>{X.stopPropagation(),Sc(E.id)},className:"text-gray-400 hover:text-blue-600 p-1 rounded-full hover:bg-blue-50 transition-colors",title:"Copy task link",children:a.jsx(Ru,{className:"w-4 h-4"})}),(()=>{const X=e.find(Se=>Se.id===E.assigneeId);return X&&X.phone?a.jsx("button",{onClick:Se=>{Se.stopPropagation();const Ge=`Hi ${X.name},

Task: "${E.title}"
Project: "${n.name}"
Due: ${ln(E.dueDate)}

Please update the status.`;em(X,Ge)},className:"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-50 transition-colors",title:`Chat on WhatsApp: ${X.phone}`,children:a.jsx(Ux,{className:"w-4 h-4"})}):null})()]}),(u.role===F.VENDOR||u.role===F.DESIGNER)&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:X=>{X.stopPropagation(),Sc(E.id)},className:"text-gray-400 hover:text-blue-600 p-1 rounded-full hover:bg-blue-50 transition-colors",title:"Copy task link",children:a.jsx(Ru,{className:"w-4 h-4"})}),(()=>{const X=e.find(Se=>Se.id===E.assigneeId);return X&&X.phone?a.jsx("button",{onClick:Se=>{Se.stopPropagation();const Ge=`Hi ${X.name},

Task: "${E.title}"
Project: "${n.name}"
Due: ${ln(E.dueDate)}

Please check the task details and update the status.`;em(X,Ge)},className:"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-50 transition-colors",title:`Share on WhatsApp: ${X.phone}`,children:a.jsx(Ux,{className:"w-4 h-4"})}):null})()]}),E.comments.length>0&&a.jsxs("button",{onClick:X=>{X.stopPropagation(),_i(E)},className:"text-gray-400 hover:text-gray-700 p-0.5 rounded-full hover:bg-gray-100 transition-colors flex items-center gap-0.5",title:`${E.comments.length} comment${E.comments.length!==1?"s":""}`,children:[a.jsx(tp,{className:"w-3 h-3"}),a.jsx("span",{className:"text-[10px] font-medium",children:E.comments.length})]})]})]})]},E.id)})})]},h))})]}),L==="documents"&&a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 p-4 md:p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl md:text-lg font-bold text-gray-800",children:"Project Documents"}),a.jsx("p",{className:"text-base md:text-sm text-gray-500",children:"Shared files, layouts, and contracts."})]}),!Ct&&a.jsxs("span",{className:"text-sm md:text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["Viewing as ",u.role]})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[u.role!==F.VENDOR&&a.jsxs("button",{onClick:()=>{at(!0),Oe([])},className:"border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center p-6 hover:bg-gray-50 hover:border-gray-400 transition-all text-gray-400 hover:text-gray-600 bg-white",children:[a.jsx(Uu,{className:"w-8 h-8 mb-2"}),a.jsx("span",{className:"text-base md:text-sm font-bold",children:"Upload File"})]}),(fn||[]).filter(h=>h.approvalStatus==="pending"?u.role===F.ADMIN||u.role===F.DESIGNER||h.uploadedBy===u.id:h.approvalStatus==="approved"?Array.isArray(h.sharedWith)&&h.sharedWith.includes(u.id)||u.role===F.ADMIN||h.uploadedBy===u.id:h.approvalStatus==="rejected"?u.role===F.ADMIN||u.role===F.DESIGNER||h.uploadedBy===u.id:u.role===F.ADMIN).sort((h,_)=>lo(_)-lo(h)).map(h=>{var _;return a.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-10 pointer-events-none group-hover:pointer-events-auto",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Comments",onClick:()=>I(h),children:a.jsx(tp,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"View",onClick:()=>window.open(h.url,"_blank"),children:a.jsx(ix,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Download",onClick:()=>Ni(h),children:a.jsx($b,{className:"w-4 h-4"})}),(h.uploadedBy===u.id||Ct)&&a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Delete",onClick:()=>m(h),children:a.jsx(Ts,{className:"w-4 h-4"})}),u.role===F.ADMIN&&a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Edit Share",onClick:E=>{E.stopPropagation(),Tc(h)},children:a.jsx(Fp,{className:"w-4 h-4"})})]}),u.role===F.ADMIN&&h.approvalStatus==="pending"&&a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve",onClick:()=>C(h),disabled:me===`approve-doc-${h.id}`,children:me===`approve-doc-${h.id}`?a.jsx(Pt,{size:"md",color:"currentColor"}):a.jsx(Ol,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject",onClick:()=>Z(h),disabled:me===`reject-doc-${h.id}`,children:me===`reject-doc-${h.id}`?a.jsx(Pt,{size:"md",color:"currentColor"}):a.jsx(_n,{className:"w-4 h-4"})})]}),u.role===F.CLIENT&&h.approvalStatus==="approved"&&h.clientApprovalStatus!=="approved"&&a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve as Client",onClick:()=>de(h),disabled:me===`client-approve-doc-${h.id}`,children:me===`client-approve-doc-${h.id}`?a.jsx(Pt,{size:"md",color:"currentColor"}):a.jsx(Ol,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject as Client",onClick:()=>De(h),disabled:me===`client-reject-doc-${h.id}`,children:me===`client-reject-doc-${h.id}`?a.jsx(Pt,{size:"md",color:"currentColor"}):a.jsx(_n,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center overflow-hidden relative group",children:h.type==="image"?a.jsx("img",{src:h.url||Lx,alt:h.name,className:"w-full h-full object-cover",onError:E=>{var S;E.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiI+PC9yZWN0PjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ij48L2NpcmNsZT48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNiAxMCA1IDIxIj48L3BvbHlsaW5lPjwvc3ZnPg==",E.currentTarget.className="w-12 h-12 opacity-50",(S=E.currentTarget.parentElement)==null||S.classList.add("flex","items-center","justify-center")}}):h.type==="pdf"?a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-50 to-red-100",children:[a.jsx(Pa,{className:"w-12 h-12 text-red-400 mb-2"}),a.jsx("span",{className:"text-sm font-bold text-red-600 uppercase",children:"PDF"})]}):a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100",children:[a.jsx(Pa,{className:"w-12 h-12 text-blue-400 mb-2"}),a.jsx("span",{className:"text-sm font-bold text-blue-600 uppercase",children:h.type})]})}),a.jsxs("div",{className:"p-3",children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsx("p",{className:"text-lg md:text-sm font-bold text-gray-800 flex-1 truncate",title:h.name,children:h.name}),a.jsx("span",{className:"text-sm md:text-xs text-gray-400 whitespace-nowrap",children:ln(h.uploadDate)})]}),a.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:(Array.isArray(h.sharedWith)?h.sharedWith:[]).map(E=>{const S=e.find(A=>A.id===E);return S!=null&&S.name?a.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-semibold",title:S.name,children:S.name.split(" ")[0]},E):null})}),a.jsxs("div",{className:"flex flex-col gap-1 mt-2",children:[a.jsx("div",{className:"flex-none w-auto",children:a.jsxs("span",{className:`inline-block text-xs font-bold px-2 py-0.5 rounded ${h.approvalStatus==="pending"?"bg-yellow-100 text-yellow-700":h.approvalStatus==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:["Admin: ",h.approvalStatus==="pending"?"Pending":h.approvalStatus==="approved"?"Approved":"Rejected"]})}),h.approvalStatus==="approved"&&h.clientApprovalStatus&&a.jsx("div",{className:"flex-none w-auto",children:a.jsxs("span",{className:`inline-block text-xs font-bold px-2 py-0.5 rounded ${h.clientApprovalStatus==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[h.clientApprovedBy&&((_=e.find(E=>E.id===h.clientApprovedBy))==null?void 0:_.name)||"Client",": ",h.clientApprovalStatus==="approved"?"Approved":"Rejected"]})})]}),h.comments&&h.comments.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-blue-600 font-medium",children:[h.comments.length," ",h.comments.length===1?"comment":"comments"]})]})]},h.id)})]})]}),L==="financials"&&cl&&a.jsxs("div",{className:"w-full mx-auto space-y-8 p-4 md:p-6",children:[a.jsx("h3",{className:"text-lg md:text-base font-bold text-gray-800",children:"Financial Management"}),a.jsxs("div",{className:"bg-gray-900 text-white p-4 md:p-8 rounded-xl shadow-lg flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"text-gray-400 text-sm md:text-xs font-bold uppercase mb-1",children:"Total Project Budget"}),Ct&&a.jsxs("button",{onClick:()=>{ga(!0),qi(""),vi("")},className:"text-xs bg-gray-800 hover:bg-gray-700 text-emerald-400 px-3 py-1 rounded border border-gray-700 transition-colors flex items-center gap-1",title:"Add to Project Budget",children:[a.jsx(Oi,{className:"w-3.5 h-3.5"})," Add Funds"]})]}),a.jsxs("h2",{className:"text-3xl md:text-2xl font-bold tracking-tight",children:["",((n.initialBudget||n.budget)+ns).toLocaleString()]}),ns>0&&a.jsxs("div",{className:"mt-3 space-y-1",children:[a.jsxs("p",{className:"text-sm md:text-xs text-gray-400",children:["Initial Budget: ",(n.initialBudget||n.budget).toLocaleString()]}),a.jsxs("p",{className:"text-sm md:text-xs text-emerald-400 font-medium",children:["Additional Budget: ",ns.toLocaleString()]})]})]}),a.jsxs("div",{className:"text-left md:text-right",children:[a.jsx("p",{className:"text-gray-400 text-sm md:text-xs font-bold uppercase mb-1",children:"Remaining Budget"}),a.jsxs("h2",{className:`text-2xl md:text-xl font-bold ${(n.initialBudget||n.budget)+ns-(Ei+qd)<0?"text-red-400":"text-emerald-400"}`,children:["",((n.initialBudget||n.budget)+ns-(Ei+qd)).toLocaleString()]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Budget - (Paid + Pending Expenses)"})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 md:px-6 md:py-5 border-b border-gray-200 bg-gray-50",children:a.jsx("h3",{className:"font-semibold text-base md:text-sm text-gray-800",children:"Financial Summary & Analysis"})}),a.jsx("div",{className:"p-4 md:p-6 space-y-6",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h4",{className:"text-base md:text-sm font-bold text-gray-700 flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),"Income Breakdown"]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[a.jsxs("div",{className:"p-4 md:p-6 bg-blue-50 rounded-lg border border-blue-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-blue-600 font-bold uppercase mb-1",children:"Estimated"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-blue-700",children:["",(n.initialBudget||n.budget).toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-purple-50 rounded-lg border border-purple-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-purple-600 font-bold uppercase mb-1",children:"Additional"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-purple-700",children:["",ns.toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-green-50 rounded-lg border border-green-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-green-600 font-bold uppercase mb-1",children:"Received"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-green-700",children:["",Ii.toLocaleString()]}),a.jsxs("p",{className:"text-sm md:text-xs text-green-600 mt-1",children:[Math.round(Ii/((n.initialBudget||n.budget)+ns)*100)||0,"% of budget"]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-red-50 rounded-lg border border-red-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-red-600 font-bold uppercase mb-1",children:"Expense"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-red-700",children:["",Ei.toLocaleString()]}),a.jsxs("p",{className:"text-sm md:text-xs text-red-600 mt-1",children:[Math.round(Ei/((n.initialBudget||n.budget)+ns)*100)||0,"% of budget"]})]}),a.jsxs("div",{className:`p-4 md:p-6 rounded-lg border ${Ii-Ei>=0?"bg-green-50 border-green-100":"bg-red-50 border-red-100"}`,children:[a.jsx("p",{className:`text-sm md:text-xs font-bold uppercase mb-1 ${Ii-Ei>=0?"text-green-600":"text-red-600"}`,children:"Profit/Loss"}),a.jsxs("p",{className:`text-xl md:text-lg font-bold ${Ii-Ei>=0?"text-green-700":"text-red-700"}`,children:[Ii-Ei>=0?"+":"","",(Ii-Ei).toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-orange-50 rounded-lg border border-orange-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-orange-600 font-bold uppercase mb-1",children:"Not Received"}),a.jsxs("p",{className:`text-xl md:text-lg font-bold ${(n.initialBudget||n.budget)+ns-Ii<0?"text-red-700":"text-orange-700"}`,children:["",((n.initialBudget||n.budget)+ns-Ii).toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("p",{className:"text-sm md:text-xs text-gray-600 font-bold uppercase mb-1",children:"Total"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-gray-700",children:["",((n.initialBudget||n.budget)+ns).toLocaleString()]})]})]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[300px]",children:[a.jsxs("div",{className:"px-4 py-3 md:px-5 md:py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[a.jsx("h3",{className:"font-semibold text-gray-800 text-lg md:text-base",children:"Transaction Ledger"}),a.jsxs("div",{className:"flex gap-2 relative",children:[a.jsxs("button",{onClick:()=>fs(!ol),className:`text-sm md:text-xs border px-3 py-1.5 rounded-lg hover:bg-white text-gray-700 flex items-center gap-1.5 font-medium transition-colors ${Qt!=="all"?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300"}`,children:[a.jsx(OS,{className:"w-3.5 h-3.5"}),a.jsx("span",{className:"capitalize hidden sm:inline",children:Qt==="all"?"Filter":Qt})]}),ol&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>fs(!1)}),a.jsx("div",{className:"absolute right-0 top-9 bg-white shadow-xl border border-gray-100 rounded-lg p-1 z-20 w-32 flex flex-col gap-0.5 animate-fade-in",children:["all","income","expense","pending","overdue"].map(h=>a.jsx("button",{onClick:()=>{$i(h),fs(!1)},className:`text-left text-xs px-2.5 py-1.5 rounded capitalize font-medium ${Qt===h?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50"}`,children:h},h))})]})]})]}),a.jsx("div",{className:"overflow-x-auto scrollbar-thin",children:a.jsxs("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-white text-gray-600 border-b border-gray-100 sticky top-0 z-10",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-left",children:"Date"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap",children:"Paid By"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-left",children:"Received By"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Type"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Mode"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Status"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Amount"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Approvals"}),a.jsx("th",{className:"px-2 py-2 font-semibold text-center w-8"})]})}),a.jsxs("tbody",{className:"divide-y divide-gray-50",children:[mo.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"text-center py-8 text-gray-400 text-sm",children:It.length===0?"No transactions recorded.":"No transactions match filters."})}),mo.map(h=>{var _,E;return a.jsxs("tr",{className:"hover:bg-gray-50 group transition-colors",children:[a.jsxs("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap text-sm md:text-xs text-left",children:[h.date,h.timestamp&&a.jsx("div",{className:"text-gray-400 text-xs mt-0.5",children:new Date(h.timestamp).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),a.jsx("td",{className:"px-4 py-2",style:{maxWidth:"150px"},children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.paidByOther?h.paidByOther.includes("(")?h.paidByOther.split("(")[0].trim():h.paidByOther:h.paidBy==="admin"?h.vendorName?h.vendorName:"-":h.type==="income"?h.paidTo?h.paidTo:"-":h.vendorName?h.vendorName:"-"}),h.type==="expense"&&a.jsx("span",{className:"text-gray-600 break-words text-sm md:text-xs",children:h.description}),a.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-xs",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium ${h.paidBy==="client"?"text-blue-700":h.paidBy==="vendor"?"text-purple-700":h.paidBy==="designer"?"text-orange-700":h.paidBy==="admin"?"text-red-700":h.paidBy==="other"?"text-gray-700":h.type==="income"?"text-green-700":"text-gray-700"}`,children:h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":h.paidBy==="other"?h.paidByOther&&h.paidByOther.includes("(")?h.paidByOther.split("(")[1].replace(")","").trim():"Other":h.type==="income"?"Client":h.type==="expense"?"Proj":"N/A"})]})]})}),a.jsx("td",{className:"px-2 py-2",style:{maxWidth:"150px"},children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.receivedByRole==="admin-received"?h.receivedByName?h.receivedByName:"-":h.receivedBy?h.receivedBy.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy:h.paidTo?h.paidTo:h.vendorName?h.vendorName:"-"}),a.jsxs("div",{className:"flex flex-col gap-1 text-sm md:text-xs",children:[h.type!=="expense"&&a.jsx("span",{className:"text-gray-600 break-words text-sm md:text-xs",children:h.description}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.receivedByRole==="admin-received"?"text-red-700":h.receivedByRole==="vendor-received"?"text-purple-700":h.receivedByRole==="designer-received"?"text-orange-700":h.receivedByRole==="client-received"?"text-blue-700":h.receivedByRole==="other-received"?"text-gray-700":h.receivedBy?(()=>{var re;const S=e.find(Y=>{var X;return Y.name===((X=h.receivedBy)!=null&&X.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy)}),A=(S==null?void 0:S.role)||((re=h.receivedBy)!=null&&re.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():"");return A===F.CLIENT||A==="Client"?"text-blue-700":A===F.VENDOR||A==="Vendor"?"text-purple-700":A===F.DESIGNER||A==="Designer"?"text-orange-700":A===F.ADMIN||A==="Admin"?"text-red-700":h.type==="income"?"text-green-700":"text-gray-700"})():h.type==="income"?"text-green-700":"text-gray-700"}`,children:h.receivedByRole==="admin-received"?"Admin":h.receivedByRole==="vendor-received"?"Vendor":h.receivedByRole==="designer-received"?"Designer":h.receivedByRole==="client-received"?"Client":h.receivedByRole==="other-received"?"Other":h.receivedBy&&h.receivedBy.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():h.type==="income"?((_=sn.find(S=>S.name===h.receivedBy))==null?void 0:_.role)||"Team Member":((E=sn.find(S=>S.name===h.receivedBy))==null?void 0:E.role)||"-"})]})]})]})}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:h.type==="income"?a.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-green-600 text-sm md:text-xs font-bold",children:[a.jsx(Hl,{className:"w-2.5 h-2.5 rotate-180"})," Received"]}):h.type==="expense"?a.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-red-600 text-sm md:text-xs font-bold",children:[a.jsx(Hl,{className:"w-2.5 h-2.5"})," Paid"]}):a.jsx("span",{className:"text-purple-600 text-sm md:text-xs font-bold",children:"Design"})}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center text-sm md:text-xs text-gray-600 capitalize",children:h.paymentMode?h.paymentMode.replace("_"," "):"-"}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:a.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-sm md:text-xs font-bold capitalize
                          ${h.status==="paid"?"bg-green-100 text-green-700":h.status==="overdue"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:h.status==="paid"?"Paid":h.status==="overdue"?"Overdue":"Pending"})}),a.jsxs("td",{className:`px-4 py-2 font-semibold whitespace-nowrap text-sm md:text-xs text-center ${h.type==="income"?"text-green-600":"text-gray-900"}`,children:["",h.amount.toLocaleString()]}),a.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:[(h.isAdditionalBudget||h.type==="income"&&h.category==="Additional Budget")&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),(h.clientApprovalForAdditionalBudget==="approved"||h.clientApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApprovalForAdditionalBudget==="pending"||!h.clientApprovalForAdditionalBudget&&!h.clientApproved)&&(u==null?void 0:u.role)===F.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>un(h.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve",disabled:me===`approve-budget-${h.id}-client-approved`,children:me===`approve-budget-${h.id}-client-approved`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>un(h.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject",disabled:me===`approve-budget-${h.id}-client-rejected`,children:me===`approve-budget-${h.id}-client-rejected`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApprovalForAdditionalBudget==="pending"||!h.clientApprovalForAdditionalBudget&&!h.clientApproved)&&(u==null?void 0:u.role)!==F.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),(h.adminApprovalForAdditionalBudget==="approved"||h.adminApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApprovalForAdditionalBudget==="pending"||!h.adminApprovalForAdditionalBudget&&!h.adminApproved)&&(u==null?void 0:u.role)===F.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>un(h.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve",disabled:me===`approve-budget-${h.id}-admin-approved`,children:me===`approve-budget-${h.id}-admin-approved`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>un(h.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject",disabled:me===`approve-budget-${h.id}-admin-rejected`,children:me===`approve-budget-${h.id}-admin-rejected`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApprovalForAdditionalBudget==="pending"||!h.adminApprovalForAdditionalBudget&&!h.adminApproved)&&(u==null?void 0:u.role)!==F.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),(h.isClientPayment||h.type==="income"&&h.category!=="Additional Budget")&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),(h.clientApprovalForPayment==="approved"||h.clientApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApprovalForPayment==="pending"||!h.clientApprovalForPayment&&!h.clientApproved)&&(u==null?void 0:u.role)===F.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Tn(h.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Confirm payment",disabled:me===`approve-payment-${h.id}-client-approved`,children:me===`approve-payment-${h.id}-client-approved`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Tn(h.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Dispute payment",disabled:me===`approve-payment-${h.id}-client-rejected`,children:me===`approve-payment-${h.id}-client-rejected`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApprovalForPayment==="pending"||!h.clientApprovalForPayment&&!h.clientApproved)&&(u==null?void 0:u.role)!==F.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),(h.adminApprovalForPayment==="approved"||h.adminApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApprovalForPayment==="pending"||!h.adminApprovalForPayment&&!h.adminApproved)&&(u==null?void 0:u.role)===F.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Tn(h.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve payment",disabled:me===`approve-payment-${h.id}-admin-approved`,children:me===`approve-payment-${h.id}-admin-approved`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Tn(h.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject payment",disabled:me===`approve-payment-${h.id}-admin-rejected`,children:me===`approve-payment-${h.id}-admin-rejected`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApprovalForPayment==="pending"||!h.adminApprovalForPayment&&!h.adminApproved)&&(u==null?void 0:u.role)!==F.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),h.type==="expense"&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),h.clientApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApproved===void 0&&(u==null?void 0:u.role)===F.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>$n(h.id,"client",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:me===`approve-expense-${h.id}-client-true`,children:me===`approve-expense-${h.id}-client-true`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>$n(h.id,"client",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:me===`approve-expense-${h.id}-client-false`,children:me===`approve-expense-${h.id}-client-false`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),h.clientApproved===void 0&&(u==null?void 0:u.role)!==F.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),h.adminApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApproved===void 0&&(u==null?void 0:u.role)===F.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>$n(h.id,"admin",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:me===`approve-expense-${h.id}-admin-true`,children:me===`approve-expense-${h.id}-admin-true`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>$n(h.id,"admin",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:me===`approve-expense-${h.id}-admin-false`,children:me===`approve-expense-${h.id}-admin-false`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),h.adminApproved===void 0&&(u==null?void 0:u.role)!==F.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),!h.isAdditionalBudget&&!h.isClientPayment&&h.type!=="expense"&&a.jsx("span",{className:"text-xs text-gray-300",children:"-"})]}),a.jsx("td",{className:"px-2 py-2 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[Ct&&a.jsx("button",{onClick:()=>dn(h.id),className:"text-gray-400 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-blue-50 rounded",title:"Edit Transaction",children:a.jsx(dj,{className:"w-3.5 h-3.5"})}),$t&&a.jsx("button",{onClick:()=>{Xr(h.id),ro(!0)},className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-50 rounded",title:"Delete Transaction",children:a.jsx(Ts,{className:"w-3.5 h-3.5"})})]})})]},h.id)})]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:a.jsx("h3",{className:"font-semibold text-gray-800 text-lg md:text-base",children:vn?"My Payment Records":"Vendor Billing Report"})}),It.filter(h=>{const _=e.filter(X=>X.role===F.VENDOR),E=new Set(_.map(X=>X.name)),S=X=>X?X.includes("(")?X.split("(")[0].trim():X.trim():"";if(vn)return h.vendorName===u.name||S(h.receivedByName)===u.name||S(h.paidByOther)===u.name||h.paidTo===u.name||h.receivedBy===u.name;const A=h.receivedByName&&E.has(S(h.receivedByName)),re=h.paidByOther&&E.has(S(h.paidByOther)),Y=h.receivedByRole==="vendor-received";return!!h.vendorName&&E.has(h.vendorName)||h.paidBy==="vendor"||A||re||Y}).length===0?a.jsx("div",{className:"px-6 py-10 text-center text-gray-400",children:vn?"No payment records for you yet.":"No vendor transactions recorded yet."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700 text-sm md:text-sm",children:"Date"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700 text-sm md:text-sm",children:"Paid By"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700 text-left text-sm md:text-sm",children:"Received By (Vendor)"}),a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700 text-sm md:text-sm",children:"Description"}),a.jsx("th",{className:"px-4 py-2 text-right font-bold text-gray-700 text-sm md:text-sm",children:"Amount"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Admin Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Client Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Status"})]})}),a.jsx("tbody",{children:It.filter(h=>{const _=e.filter(X=>X.role===F.VENDOR),E=new Set(_.map(X=>X.name)),S=X=>X?X.includes("(")?X.split("(")[0].trim():X.trim():"";if(vn)return h.vendorName===u.name||S(h.receivedByName)===u.name||S(h.paidByOther)===u.name||h.paidTo===u.name||h.receivedBy===u.name;const A=h.receivedByName&&E.has(S(h.receivedByName)),re=h.paidByOther&&E.has(S(h.paidByOther)),Y=h.receivedByRole==="vendor-received";return!!h.vendorName&&E.has(h.vendorName)||h.paidBy==="vendor"||A||re||Y}).sort((h,_)=>new Date(_.date).getTime()-new Date(h.date).getTime()).map((h,_)=>{var E;return a.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${_%2===0?"bg-white":"bg-gray-50/50"}`,children:[a.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap text-sm md:text-xs text-left",children:h.date}),a.jsx("td",{className:"px-4 py-2",children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.type==="income"?h.paidTo||h.paidByOther||"-":h.vendorName||"-"}),a.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-xs",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.paidBy==="client"?"text-blue-700":h.paidBy==="vendor"?"text-purple-700":h.paidBy==="designer"?"text-orange-700":h.paidBy==="admin"?"text-red-700":"text-gray-700"}`,children:h.type==="income"?(()=>{const S=e.find(A=>A.name===(h.paidTo||h.paidByOther));return(S==null?void 0:S.role)===F.CLIENT?"Client":(S==null?void 0:S.role)===F.VENDOR?"Vendor":(S==null?void 0:S.role)===F.DESIGNER?"Designer":(S==null?void 0:S.role)===F.ADMIN?"Admin":h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})():h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})]})]})}),a.jsx("td",{className:"px-2 py-2",style:{maxWidth:"150px"},children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.receivedBy?h.receivedBy.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy:"-"}),a.jsx("div",{className:"flex flex-col gap-1 text-sm md:text-xs",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.receivedBy?(()=>{var re;const S=e.find(Y=>{var X;return Y.name===((X=h.receivedBy)!=null&&X.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy)}),A=(S==null?void 0:S.role)||((re=h.receivedBy)!=null&&re.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():"");return A===F.CLIENT||A==="Client"?"text-blue-700":A===F.VENDOR||A==="Vendor"?"text-purple-700":A===F.DESIGNER||A==="Designer"?"text-orange-700":A===F.ADMIN||A==="Admin"?"text-red-700":"text-gray-700"})():"text-gray-700"}`,children:h.receivedBy&&h.receivedBy.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():((E=e.find(S=>S.name===h.receivedBy))==null?void 0:E.role)||"Vendor"})]})})]})}),a.jsx("td",{className:"px-4 py-3 text-left text-gray-700 text-sm md:text-xs",children:h.description}),a.jsxs("td",{className:"px-4 py-3 text-right text-gray-700 font-bold text-sm md:text-xs",children:["",h.amount.toLocaleString()]}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("div",{className:"flex justify-center",children:a.jsx("input",{type:"checkbox",checked:h.adminApproved===!0,disabled:!$t,title:h.adminApproved?"Click to revoke admin approval":"Admin approval checkbox","aria-label":"Approve or revoke as admin",onChange:S=>$n(h.id,"admin",S.target.checked),className:"w-4 h-4 rounded border-gray-300 cursor-pointer hover:border-gray-400 disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-gray-100"})})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("div",{className:"flex justify-center",children:a.jsx("input",{type:"checkbox",checked:h.clientApproved===!0,disabled:!oo,title:h.clientApproved?"Click to revoke client approval":"Client approval checkbox","aria-label":"Approve or revoke as client",onChange:S=>$n(h.id,"client",S.target.checked),className:"w-4 h-4 rounded border-gray-300 cursor-pointer hover:border-gray-400 disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-gray-100"})})}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:`inline-block px-2 py-1 rounded text-sm md:text-xs font-medium ${h.adminApproved&&h.clientApproved?"bg-green-100 text-green-700":h.adminApproved?"bg-blue-100 text-blue-700":h.clientApproved?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:h.adminApproved&&h.clientApproved?"Approved":h.adminApproved?"Admin OK":h.clientApproved?"Client OK":"Pending"})})]},h.id)})})]})}),n.type==="Designing"&&It.filter(h=>{const _=e.filter(A=>A.role===F.VENDOR),E=new Set(_.map(A=>A.name)),S=A=>A?A.includes("(")?A.split("(")[0].trim():A.trim():"";return!!h.vendorName&&E.has(h.vendorName)||h.paidBy==="vendor"||h.receivedByName&&E.has(S(h.receivedByName))||h.paidByOther&&E.has(S(h.paidByOther))||h.receivedByRole==="vendor-received"}).length>0&&a.jsx("div",{className:"px-6 py-4 bg-gray-100 border-t border-gray-200",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm md:text-xs font-semibold text-gray-700",children:"Total Vendor Transactions"}),(()=>{const _=It.filter(E=>{const S=e.filter(X=>X.role===F.VENDOR),A=new Set(S.map(X=>X.name)),re=X=>X?X.includes("(")?X.split("(")[0].trim():X.trim():"";return(!!E.vendorName&&A.has(E.vendorName)||E.paidBy==="vendor"||E.receivedByName&&A.has(re(E.receivedByName))||E.paidByOther&&A.has(re(E.paidByOther))||E.receivedByRole==="vendor-received")&&E.clientApproved===!0&&E.adminApproved===!0}).reduce((E,S)=>E+S.amount,0);return a.jsxs("span",{className:"font-semibold text-gray-900 text-lg md:text-sm",children:["",_.toLocaleString()]})})()]}),a.jsx("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200 bg-gray-100 rounded-md px-3 py-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-base md:text-xs font-semibold text-gray-700",children:"Designer Charges"}),$t&&!kt&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-base md:text-xs text-gray-700",children:["(",es,"%)"]}),a.jsx("button",{className:"ml-1 p-1 rounded hover:bg-gray-200",title:"Edit Designer Charges Percentage",onClick:()=>bs(!0),children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536M9 13h3l8-8a2.828 2.828 0 10-4-4l-8 8v3h3z"})})})]}),$t&&kt&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"number",min:"0",max:"100",value:es,onChange:h=>fa(parseFloat(h.target.value)||0),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:border-gray-500 bg-white","aria-label":"Designer Charges Percentage",title:"Enter designer charges percentage for vendor payments",placeholder:"0"}),a.jsx("span",{className:"text-sm md:text-xs text-gray-700",children:"%"}),a.jsx("button",{className:"ml-2 px-2 py-1 text-xs font-semibold rounded bg-gray-700 text-white hover:bg-gray-800 focus:outline-none border border-gray-700",onClick:()=>{ll(),bs(!1)},title:"Save Designer Charges Percentage",children:"Save"})]}),!$t&&a.jsxs("span",{className:"text-sm md:text-xs text-gray-700",children:["(",es,"%)"]})]})}),(()=>{const _=It.filter(A=>{const re=e.filter(Se=>Se.role===F.VENDOR),Y=new Set(re.map(Se=>Se.name)),X=Se=>Se?Se.includes("(")?Se.split("(")[0].trim():Se.trim():"";return!!A.vendorName&&Y.has(A.vendorName)||A.paidBy==="vendor"||A.receivedByName&&Y.has(X(A.receivedByName))||A.paidByOther&&Y.has(X(A.paidByOther))||A.receivedByRole==="vendor-received"}).reduce((A,re)=>A+re.amount,0),E=_*(es/100),S=_+E;return a.jsx("div",{className:"w-full mt-2 bg-gray-100 rounded px-3 py-2 text-sm md:text-xs",children:a.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4 sm:items-center sm:justify-between",children:[a.jsxs("span",{className:"block min-w-[140px] mb-1 sm:mb-0",children:["Total Vendor Amount: ",a.jsxs("span",{className:"font-semibold text-gray-900",children:["",_.toLocaleString()]})]}),a.jsxs("span",{className:"block min-w-[120px] mb-1 sm:mb-0",children:["Designer Charges: ",a.jsxs("span",{className:"font-semibold text-gray-700",children:[es,"%"]})]}),a.jsxs("span",{className:"block min-w-[150px] mb-1 sm:mb-0",children:["Calculated Charges: ",a.jsxs("span",{className:"font-semibold text-gray-700",children:["",E.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),a.jsxs("span",{className:"block min-w-[130px]",children:["Final Amount: ",a.jsxs("span",{className:"font-semibold text-green-700",children:["",S.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})})})()]})})]})]}),L==="timeline"&&!vn&&a.jsx("div",{className:"max-w-3xl mx-auto p-4 md:p-8",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-8 overflow-hidden",children:[a.jsx("h3",{className:"text-xl md:text-lg font-bold text-gray-800 mb-6",children:"Project Timeline"}),a.jsxs("div",{className:"relative border-l-2 border-gray-100 ml-3 space-y-8",children:[(!Mr||Mr.length===0)&&a.jsx("div",{className:"pl-6 text-gray-400 italic",children:"No timeline events yet. Add milestones to track project progress."}),Mr==null?void 0:Mr.sort((h,_)=>{const E=new Date(h.endDate||h.startDate).getTime();return new Date(_.endDate||_.startDate).getTime()-E}).map(h=>a.jsxs("div",{className:"relative pl-8",children:[a.jsx("span",{className:`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm
                        ${h.status==="completed"?"bg-green-500":h.status==="in-progress"?"bg-blue-500":"bg-gray-400"}`}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-bold text-gray-800 text-lg md:text-base",children:h.title||h.milestone}),a.jsx("p",{className:"text-gray-600 text-base md:text-sm mt-0.5",children:h.description}),a.jsx("div",{className:"flex items-center gap-2 mt-2",children:a.jsx("span",{className:`text-sm md:text-xs px-2.5 py-1.5 rounded-full font-medium
                                 ${h.status==="completed"?"bg-green-100 text-green-700":h.status==="in-progress"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:h.status})})]}),a.jsxs("div",{className:"text-sm md:text-xs text-gray-400 mt-2 sm:mt-0 font-mono whitespace-nowrap",children:[a.jsx("div",{children:ln(h.endDate||h.startDate)}),a.jsx("div",{className:"text-gray-300",children:new Date(h.endDate||h.startDate).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]})]})]},h.id))]})]})}),L==="team"&&a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 md:p-8",children:a.jsxs("div",{className:"bg-white p-4 md:p-8 rounded-xl border border-gray-200",children:[a.jsx("h3",{className:"font-bold text-lg md:text-base text-gray-800 mb-4",children:"Project Clients"}),a.jsx("div",{className:"space-y-2",children:(()=>{const h=Array.from(new Set([n.clientId,...n.clientIds||[]].filter(Boolean)));return h.length===0?a.jsx("p",{className:"text-gray-500 text-sm",children:"No clients assigned"}):h.map(_=>{const E=e.find(S=>S.id===_);return E?a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-50 pb-2",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{children:[a.jsx("p",{className:"text-base md:text-sm font-bold text-gray-900",children:E.name}),a.jsx("p",{className:"text-xs text-gray-500",children:"Client"})]})}),u.role===F.ADMIN&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:()=>tg(E),className:"text-gray-400 hover:text-green-600 p-2.5 rounded-full hover:bg-green-50 transition-colors",title:"Send Payment Reminder Email",children:a.jsx(yp,{className:"w-5 h-5"})}),a.jsx("button",{onClick:()=>{const S=`${window.location.origin}${window.location.pathname}?projectId=${n.id}`;navigator.clipboard.writeText(S).then(()=>{p("Success","Project link copied to clipboard","success",u==null?void 0:u.id,n.id,n.name)}).catch(()=>{p("Error","Failed to copy link","error",u==null?void 0:u.id,n.id,n.name)})},className:"text-gray-400 hover:text-blue-600 p-2.5 rounded-full hover:bg-blue-50 transition-colors",title:"Copy project link",children:a.jsx(Ru,{className:"w-5 h-5"})})]})]},_):null})})()}),a.jsx("div",{className:"flex items-center gap-4 border-b border-gray-50 pb-2",children:a.jsxs("div",{children:[a.jsx("p",{className:"text-base md:text-sm font-bold text-gray-900",children:cn(n.leadDesignerId)}),a.jsx("p",{className:"text-sm text-gray-500",children:"Lead Designer"})]})}),(()=>{const h=n.teamMembers?n.teamMembers.map(_=>e.find(E=>E.id===_)).filter(_=>_!==void 0&&_.role===F.DESIGNER):[];return h.length===0?null:a.jsxs(a.Fragment,{children:[a.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-2",children:"Designers"}),h.map(_=>a.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors border border-transparent hover:border-gray-100",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-bold text-gray-800 text-base md:text-sm",children:_.name}),a.jsx("p",{className:"text-sm text-gray-500",children:_.role})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>zi(_),className:"text-blue-500 hover:text-blue-700 text-sm font-medium px-2 py-1 hover:bg-blue-50 rounded transition-colors",title:"View designer details and projects",children:"View Details"}),Ct&&a.jsx("button",{onClick:()=>{const E={...n,teamMembers:(n.teamMembers||[]).filter(S=>S!==_.id)};t(E),p("Success",`${_.name} removed from team`,"success")},className:"text-red-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded transition-colors",title:"Remove Member",children:a.jsx(_n,{className:"w-4 h-4"})})]})]},_.id))]})})(),Wd.length>0&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"pt-4 space-y-6",children:Wd.map(h=>a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-3 border-b border-gray-100 pb-1 flex items-center gap-2",children:[a.jsx($p,{className:"w-4 h-4"})," ",h]}),a.jsx("div",{className:"grid grid-cols-1 gap-3",children:fl[h].map(_=>(It.filter(S=>{const A=S.adminApproved&&S.clientApproved,re=Y=>Y?Y.includes("(")?Y.split("(")[0].trim():Y.trim():"";return A&&(S.vendorName===_.name||re(S.receivedByName)===_.name||re(S.paidByOther)===_.name||S.paidTo===_.name||S.receivedBy===_.name)}).reduce((S,A)=>S+(A.amount||0),0),a.jsxs("div",{onClick:()=>{(!vn||_.id===u.id)&&so(_)},className:`flex items-center gap-3 p-3 rounded-lg transition-colors border border-transparent ${vn&&_.id!==u.id?"opacity-60 cursor-default":"hover:bg-gray-50 hover:border-gray-100 cursor-pointer group"}`,title:vn&&_.id!==u.id?"You can only view your own billing report":"Click to view billing report",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-bold text-gray-800 text-base md:text-sm",children:_.name}),a.jsx("p",{className:"text-sm text-gray-500",children:_.company||"Independent"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2.5 py-1.5 rounded-full font-medium",children:[n.tasks.filter(S=>S.assigneeId===_.id).length," Tasks"]}),$t&&a.jsx("button",{onClick:S=>{S.stopPropagation();const A=(n.hiddenVendors||[]).includes(_.id),re={...n,hiddenVendors:A?(n.hiddenVendors||[]).filter(X=>X!==_.id):[...n.hiddenVendors||[],_.id]};t(re);const Y=A?"shown":"hidden";p("Success",`${_.name} ${Y} from clients`,"success")},className:`p-1.5 rounded transition-colors ${(n.hiddenVendors||[]).includes(_.id)?"text-gray-400 hover:text-gray-600 hover:bg-gray-100":"text-blue-500 hover:text-blue-700 hover:bg-blue-50"}`,title:(n.hiddenVendors||[]).includes(_.id)?"Show to clients":"Hide from clients",children:(n.hiddenVendors||[]).includes(_.id)?a.jsx(jS,{className:"w-4 h-4"}):a.jsx(ix,{className:"w-4 h-4"})}),!vn||_.id===u.id?a.jsx(Va,{className:"w-4 h-4 text-gray-300 group-hover:text-gray-500"}):null]})]},_.id)))})]},h))})})]})})]}),L==="team"&&Vt&&a.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-lg border border-gray-200 mt-8 mb-8 p-4 md:p-6",children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:["Vendor Financials: ",a.jsx("span",{className:"text-purple-700",children:Vt.name})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700",children:"Date"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Description"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Amount"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Designer Charge"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Status"})]})}),a.jsx("tbody",{children:It.filter(h=>{const _=h.adminApproved&&h.clientApproved,E=S=>S?S.includes("(")?S.split("(")[0].trim():S.trim():"";return _&&(h.vendorName===Vt.name||E(h.receivedByName)===Vt.name||E(h.paidByOther)===Vt.name||h.paidTo===Vt.name||h.receivedBy===Vt.name)}).sort((h,_)=>new Date(_.date).getTime()-new Date(h.date).getTime()).map((h,_)=>{var A;const E=n.designerChargePercentage||0,S=Math.round((h.amount||0)*E/100);return a.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${_%2===0?"bg-white":"bg-gray-50/50"}`,children:[a.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap text-xs text-left",children:h.date}),a.jsx("td",{className:"px-4 py-3 text-gray-700",children:h.description||"-"}),a.jsxs("td",{className:"px-4 py-3 text-right text-gray-900 font-bold",children:["",(A=h.amount)==null?void 0:A.toLocaleString()]}),a.jsxs("td",{className:"px-4 py-3 text-right text-orange-700 font-bold",children:["",S.toLocaleString()," ",a.jsxs("span",{className:"text-xs text-gray-400",children:["(",E,"%)"]})]}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700",children:"Approved"})})]},h.id)})})]})})]}),Ls&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsx("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:a.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(CN,{className:"w-5 h-5"})," Add to Project"]})}),a.jsxs("div",{className:"p-4 md:p-6 space-y-4 flex-1 overflow-y-auto scrollbar-thin",children:[a.jsxs("div",{className:"flex gap-2 bg-gray-100 p-1 rounded-lg",children:[a.jsx("button",{onClick:()=>{Xa("client"),gs("")},className:`flex-1 py-2 rounded font-medium text-sm transition-colors ${xs==="client"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Add Client"}),a.jsx("button",{onClick:()=>{Xa("member"),gs("")},className:`flex-1 py-2 rounded font-medium text-sm transition-colors ${xs==="member"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Add Vendor"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-sm font-bold text-gray-500 uppercase",children:["Select ",xs==="client"?"Clients":"Vendors"]}),a.jsx("div",{className:"border rounded-lg p-3 space-y-2 max-h-48 overflow-y-auto mt-2 border-gray-300",children:xs==="client"?e.filter(h=>h.role===F.CLIENT&&h.id!==n.clientId&&!(n.clientIds||[]).includes(h.id)).length===0?a.jsx("p",{className:"text-gray-500 text-sm",children:"No clients available to add"}):e.filter(h=>h.role===F.CLIENT&&h.id!==n.clientId&&!(n.clientIds||[]).includes(h.id)).map(h=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",checked:Wn.includes(h.id),onChange:_=>{const E=Wn.split(",").filter(Boolean),S=_.target.checked?[...E,h.id]:E.filter(A=>A!==h.id);gs(S.join(","))},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:h.name})]},h.id)):e.filter(h=>h.role===F.VENDOR&&!(n.teamMembers||[]).includes(h.id)).length===0?a.jsx("p",{className:"text-gray-500 text-sm",children:"No vendors available to add"}):e.filter(h=>h.role===F.VENDOR&&!(n.teamMembers||[]).includes(h.id)).map(h=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",checked:Wn.includes(h.id),onChange:_=>{const E=Wn.split(",").filter(Boolean),S=_.target.checked?[...E,h.id]:E.filter(A=>A!==h.id);gs(S.join(","))},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:h.name})]},h.id))}),a.jsx("p",{className:"text-xs text-gray-400 mt-2",children:xs==="client"?"Select clients to add as additional contacts for this project.":"Select vendors to add to this project."})]}),a.jsxs("div",{className:"flex gap-3 pt-2",children:[a.jsx("button",{onClick:()=>{pi(!1),gs("")},className:"flex-1 py-2 text-gray-500 hover:bg-gray-100 rounded",children:"Cancel"}),a.jsxs("button",{onClick:co,className:"flex-1 py-2 bg-gray-900 text-white rounded font-bold hover:bg-gray-800",children:["Add ",xs==="client"?"Clients":"Vendors"]})]})]})]})}),document.body),se&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 flex-shrink-0",children:[a.jsxs("h3",{className:"text-2xl md:text-lg font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(yp,{className:"w-5 h-5"})," ",ze?"Edit Transaction":"Record Transaction"]}),a.jsx("button",{onClick:()=>{_e(!1),Vn(!1),Qe(null),In(""),Ve(""),et("")},className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close modal",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-thin space-y-3",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:["Amount ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx("span",{className:"absolute left-3 top-2 text-gray-400",children:""}),a.jsx("input",{type:"number",className:`${Dt(yr&&!J.amount)} pl-7`,placeholder:"0.00",title:"Enter transaction amount",value:J.amount||"",onChange:h=>Ye({...J,amount:parseFloat(h.target.value)})})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:["Description ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",className:`${Dt(yr&&!J.description)} mt-1`,placeholder:"e.g. Initial Deposit, Paint Supplies",title:"Enter transaction description",value:J.description||"",onChange:h=>Ye({...J,description:h.target.value})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Type"}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsx("button",{onClick:()=>Ye({...J,type:"income"}),className:`flex-1 py-2 text-base md:text-xs font-bold rounded ${J.type==="income"?"bg-green-100 text-green-700 ring-2 ring-green-500":"bg-gray-50 text-gray-500"}`,children:"Income"}),a.jsx("button",{onClick:()=>Ye({...J,type:"expense"}),className:`flex-1 py-2 text-base md:text-xs font-bold rounded ${J.type==="expense"?"bg-red-100 text-red-700 ring-2 ring-red-500":"bg-gray-50 text-gray-500"}`,children:"Expense"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Date"}),a.jsx("input",{type:"date",className:`${Dt(yr&&!J.date)} mt-1 text-base md:text-xs`,title:"Select transaction date",value:J.date||"",onChange:h=>Ye({...J,date:h.target.value})})]})]}),J.type==="expense"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>Ye({...J,paidBy:"client"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${J.paidBy==="client"?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"}`,children:"Client"}),a.jsx("button",{onClick:()=>Ye({...J,paidBy:"vendor"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${J.paidBy==="vendor"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>Ye({...J,paidBy:"designer"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${J.paidBy==="designer"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>Ye({...J,paidBy:"admin"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${J.paidBy==="admin"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>Ye({...J,paidBy:"other"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${J.paidBy==="other"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),J.paidBy==="client"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:J.vendorName||"",onChange:h=>Ye({...J,vendorName:h.target.value}),title:"Select a client from the list",children:[a.jsx("option",{value:"",children:"Select a client..."}),e.filter(h=>h.role===F.CLIENT).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),J.paidBy==="vendor"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:J.vendorName||"",onChange:h=>Ye({...J,vendorName:h.target.value}),title:"Select a vendor from the list",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),e.filter(h=>h.role===F.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),J.paidBy==="designer"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:J.vendorName||"",onChange:h=>Ye({...J,vendorName:h.target.value}),title:"Select a designer from the list",children:[a.jsx("option",{value:"",children:"Select a designer..."}),e.filter(h=>h.role===F.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),J.paidBy==="admin"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:J.vendorName||"",onChange:h=>Ye({...J,vendorName:h.target.value}),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===F.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),J.paidBy==="other"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By (Name & Role)"}),a.jsx("input",{type:"text",className:`${Dt(!1)} mt-1`,placeholder:"e.g. John Smith (Partner) or Supplier (Vendor)",title:"Enter who paid (name and role in parentheses)",value:J.paidByOther||"",onChange:h=>Ye({...J,paidByOther:h.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>et("client"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="client"?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"}`,children:"Client"}),a.jsx("button",{onClick:()=>et("vendor"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="vendor"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>et("designer"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="designer"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>et("admin"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="admin"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>et("other"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="other"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),ve==="client"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:xt||"",onChange:h=>Ve(h.target.value),title:"Select a client from the project",children:[a.jsx("option",{value:"",children:"Select a client..."}),sn.filter(h=>h.role===F.CLIENT).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="vendor"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:xt||"",onChange:h=>Ve(h.target.value),title:"Select a vendor from the project",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),sn.filter(h=>h.role===F.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="designer"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:xt||"",onChange:h=>Ve(h.target.value),title:"Select a designer from the project",children:[a.jsx("option",{value:"",children:"Select a designer..."}),sn.filter(h=>h.role===F.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="admin"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:xt||"",onChange:h=>Ve(h.target.value),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===F.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="other"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By (Name & Role)"}),a.jsx("input",{type:"text",className:`${Dt(!1)} mt-1`,placeholder:"e.g. John Smith (Contractor) or Supplier (Vendor)",title:"Enter who received (name and role in parentheses)",value:xt||"",onChange:h=>Ve(h.target.value)})]})]}),J.type==="income"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>et("client"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="client"?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"}`,children:"Client"}),a.jsx("button",{onClick:()=>et("vendor"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="vendor"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>et("designer"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="designer"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>et("admin"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="admin"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>et("other"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="other"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),ve==="client"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:rn||"",onChange:h=>In(h.target.value),title:"Select a client from the project",children:[a.jsx("option",{value:"",children:"Select a client..."}),sn.filter(h=>h.role===F.CLIENT).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="vendor"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:rn||"",onChange:h=>In(h.target.value),title:"Select a vendor from the project",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),sn.filter(h=>h.role===F.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="designer"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:rn||"",onChange:h=>In(h.target.value),title:"Select a designer from the project",children:[a.jsx("option",{value:"",children:"Select a designer..."}),sn.filter(h=>h.role===F.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="admin"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:rn||"",onChange:h=>In(h.target.value),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===F.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="other"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By (Name & Role)"}),a.jsx("input",{type:"text",className:`${Dt(!1)} mt-1`,placeholder:"e.g. John Smith (Partner) or Supplier (Vendor)",title:"Enter who paid (name and role in parentheses)",value:rn||"",onChange:h=>In(h.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>et(""),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve===""?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Project"}),a.jsx("button",{onClick:()=>et("vendor-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="vendor-received"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>et("designer-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="designer-received"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>et("admin-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="admin-received"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>et("other-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="other-received"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),ve==="vendor-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:xt||"",onChange:h=>Ve(h.target.value),title:"Select a vendor from the project",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),sn.filter(h=>h.role===F.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="designer-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:xt||"",onChange:h=>Ve(h.target.value),title:"Select a designer from the project",children:[a.jsx("option",{value:"",children:"Select a designer..."}),sn.filter(h=>h.role===F.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="admin-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${Dt(!1)} mt-1`,value:xt||"",onChange:h=>Ve(h.target.value),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===F.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="other-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By (Name & Role)"}),a.jsx("input",{type:"text",className:`${Dt(!1)} mt-1`,placeholder:"e.g. John Smith (Contractor) or Supplier (Vendor)",title:"Enter who received (name and role in parentheses)",value:xt||"",onChange:h=>Ve(h.target.value)})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Category"}),a.jsxs("select",{className:`${Dt(yr&&!J.category)} mt-1 text-base md:text-xs`,value:J.category||"",onChange:h=>{Ye({...J,category:h.target.value}),h.target.value!=="Others"&&it("")},"aria-label":"Transaction category",children:[a.jsx("option",{value:"",children:"Select..."}),J.type==="income"?a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"Advance",children:"Advance"}),a.jsx("option",{value:"Milestone 1",children:"Milestone 1"}),a.jsx("option",{value:"Milestone 2",children:"Milestone 2"}),a.jsx("option",{value:"Final Payment",children:"Final Payment"}),a.jsx("option",{value:"Additional Budget",children:"Additional Budget"}),a.jsx("option",{value:"Others",children:"Others (please specify)"})]}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"Materials",children:"Materials"}),a.jsx("option",{value:"Labor",children:"Labor"}),a.jsx("option",{value:"Permits/Fees",children:"Permits/Fees"}),a.jsx("option",{value:"Furniture",children:"Furniture"}),a.jsx("option",{value:"Misc",children:"Misc"})]})]})]}),J.type==="income"&&J.category==="Others"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Specify Category"}),a.jsx("input",{type:"text",className:`${Dt(yr&&!Lt)} mt-1 text-base md:text-xs`,placeholder:"Enter custom category",value:Lt,onChange:h=>it(h.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Mode"}),a.jsxs("select",{className:`${Dt(!1)} mt-1 text-base md:text-xs`,value:J.paymentMode||"",onChange:h=>Ye({...J,paymentMode:h.target.value}),"aria-label":"Payment mode",children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"cash",children:"Cash"}),a.jsx("option",{value:"upi",children:"UPI"}),a.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),a.jsx("option",{value:"cheque",children:"Cheque"}),a.jsx("option",{value:"credit_card",children:"Credit Card"}),a.jsx("option",{value:"other",children:"Other"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Status"}),a.jsxs("select",{className:`${Dt(!1)} mt-1 text-base md:text-xs`,value:J.status||"pending",onChange:h=>Ye({...J,status:h.target.value}),"aria-label":"Transaction status",children:[a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"paid",children:"Paid"}),a.jsx("option",{value:"overdue",children:"Overdue"})]})]})]}),J.type==="income"&&J.category==="Additional Budget"&&a.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[a.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Approvals Required"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==F.CLIENT?.5:1,pointerEvents:(u==null?void 0:u.role)!==F.CLIENT?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:J.clientApprovalForAdditionalBudget==="approved",onChange:h=>Ye({...J,clientApprovalForAdditionalBudget:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==F.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client approval for additional budget"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Client Approval",J.clientApprovalForAdditionalBudget==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),J.clientApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==F.ADMIN?.5:1,pointerEvents:(u==null?void 0:u.role)!==F.ADMIN?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:J.adminApprovalForAdditionalBudget==="approved",onChange:h=>Ye({...J,adminApprovalForAdditionalBudget:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==F.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval for additional budget"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval",J.adminApprovalForAdditionalBudget==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),J.adminApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),J.type==="income"&&J.category!=="Additional Budget"&&a.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[a.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Payment Approvals"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==F.CLIENT?.5:1,pointerEvents:(u==null?void 0:u.role)!==F.CLIENT?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:J.clientApprovalForPayment==="approved",onChange:h=>Ye({...J,clientApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==F.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client confirmation of payment"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Client Confirmation",J.clientApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),J.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==F.ADMIN?.5:1,pointerEvents:(u==null?void 0:u.role)!==F.ADMIN?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:J.adminApprovalForPayment==="approved",onChange:h=>Ye({...J,adminApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==F.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval of payment"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval",J.adminApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),J.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),J.type==="expense"&&a.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[a.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Payment Approvals"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==F.CLIENT?.5:1,pointerEvents:(u==null?void 0:u.role)!==F.CLIENT?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:J.clientApprovalForPayment==="approved",onChange:h=>Ye({...J,clientApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==F.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client approval of expense"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Client Approval",J.clientApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),J.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==F.ADMIN?.5:1,pointerEvents:(u==null?void 0:u.role)!==F.ADMIN?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:J.adminApprovalForPayment==="approved",onChange:h=>Ye({...J,adminApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==F.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval of expense"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval",J.adminApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),J.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),a.jsxs("div",{className:"pt-2 flex gap-3",children:[a.jsx("button",{onClick:()=>{_e(!1),Vn(!1),Qe(null),In(""),Ve(""),et(""),it("")},className:"flex-1 py-2 text-base md:text-xs text-gray-500 hover:bg-gray-100 rounded font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:Rr,title:"Close transaction modal",children:"Cancel"}),a.jsx("button",{onClick:Ht,disabled:Rr,className:"flex-1 py-2 text-base md:text-xs bg-gray-900 text-white rounded font-bold hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all",title:"Save transaction entry",children:Rr?"Saving...":ze?"Update Entry":"Add Entry"})]})]})]})}),document.body),pt&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsx("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:a.jsxs("h3",{className:"text-xl md:text-lg font-bold flex items-center gap-2 text-gray-900",children:[a.jsx(Uu,{className:"w-5 h-5 md:w-4 md:h-4"})," Upload Document"]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 scrollbar-thin space-y-4",children:[a.jsx("input",{type:"text",placeholder:"Document Name (e.g. FloorPlan.pdf) - optional when uploading files",className:`${Dt(mn&&!lt.name&&Re.length===0)} text-base md:text-sm`,value:lt.name,onChange:h=>on({...lt,name:h.target.value})}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Share With Project Team:"}),a.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:[F.CLIENT,F.VENDOR,F.DESIGNER].map(h=>{const _=sn.filter(E=>E.role===h);return _.length===0?null:a.jsxs("div",{children:[a.jsxs("p",{className:"text-base md:text-xs font-bold text-gray-600 uppercase mb-2",children:[h,"s"]}),a.jsx("div",{className:"space-y-1 ml-2",children:_.map(E=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-white p-1.5 rounded border border-transparent hover:border-gray-200",children:[a.jsx("input",{type:"checkbox",checked:lt.sharedWith.includes(E.id),onChange:S=>{S.target.checked?on({...lt,sharedWith:[...lt.sharedWith,E.id]}):on({...lt,sharedWith:lt.sharedWith.filter(A=>A!==E.id)})}}),a.jsx("span",{className:"text-base md:text-sm text-gray-800",children:E.name})]},E.id))})]},h)})})]}),He.length>0&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsx("label",{htmlFor:"attach-task-select",className:"text-base md:text-xs font-bold text-blue-600 uppercase mb-2 block",children:"Attach to Task (Optional):"}),a.jsxs("select",{id:"attach-task-select",title:"Select a task to attach documents to","aria-label":"Select a task to attach documents to",value:lt.attachToTaskId||"",onChange:h=>{on({...lt,attachToTaskId:h.target.value||void 0})},className:"w-full p-2 border border-blue-300 rounded bg-white text-base md:text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"-- Don't attach to any task --"}),He.map(h=>a.jsxs("option",{value:h.id,children:[h.title," (",h.status,")"]},h.id))]})]}),a.jsxs("div",{className:"bg-gray-50 p-4 md:p-6 rounded-lg border-2 border-dashed border-gray-300 text-base md:text-sm text-gray-500 hover:bg-gray-100 hover:border-gray-400 transition-colors cursor-pointer relative",onClick:()=>{var h;return(h=yn.current)==null?void 0:h.click()},children:[Re.length>0?a.jsxs("div",{className:"flex flex-col items-start gap-2",children:[a.jsxs("div",{className:"w-full flex items-center gap-2",children:[a.jsx(Cu,{className:"w-8 h-8 text-blue-500 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsxs("p",{className:"font-bold text-base md:text-sm text-gray-800",children:[Re.length," file(s) selected"]}),a.jsxs("p",{className:"text-sm md:text-xs text-gray-400",children:["Total size: ",(Re.reduce((h,_)=>h+_.size,0)/1024).toFixed(1)," KB"]})]})]}),a.jsx("div",{className:"w-full mt-2 max-h-32 overflow-y-auto border-t border-gray-200 pt-2",children:Re.map((h,_)=>a.jsxs("div",{className:"flex items-center justify-between text-sm md:text-xs text-gray-600 bg-white p-1.5 rounded mb-1",children:[a.jsx("span",{className:"truncate flex-1",children:h.name}),a.jsx("button",{type:"button",onClick:E=>{E.stopPropagation(),Oe(Re.filter((S,A)=>A!==_))},className:"ml-2 text-gray-400 hover:text-red-500 flex-shrink-0 text-lg md:text-base",title:"Remove file",children:""})]},_))})]}):a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(Uu,{className:"w-8 h-8 text-gray-300 mb-2"}),a.jsx("p",{className:"text-base md:text-sm",children:"Click to select files"}),a.jsx("p",{className:"text-sm md:text-xs text-gray-400 mt-1",children:"or drag and drop here (multiple files supported)"})]}),a.jsx("input",{type:"file",multiple:!0,ref:yn,onChange:h=>{const _=Array.from(h.target.files||[]);Oe(_)},className:"hidden",title:"Select files to upload"})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx("button",{onClick:()=>at(!1),className:"flex-1 py-2 md:py-1.5 text-base md:text-xs text-gray-500 hover:bg-gray-100 rounded",children:"Cancel"}),a.jsx("button",{onClick:Ac,className:"flex-1 py-2 md:py-1.5 text-base md:text-xs bg-gray-900 text-white rounded font-bold hover:bg-gray-800",disabled:Ln,children:Ln?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Uploading..."]}):"Upload"})]})]})]})}),document.body),Ms&&Vs&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:[a.jsx("h3",{className:"text-lg font-bold",children:"Edit Shared Users"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Modify who can access this document after approval."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-semibold",children:"Select Users"}),a.jsx("div",{className:"mt-2 space-y-2 max-h-56 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:sn.map(h=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-white p-1.5 rounded border border-transparent hover:border-gray-200",children:[a.jsx("input",{type:"checkbox",checked:ma.includes(h.id),onChange:_=>{_.target.checked?or(E=>Array.from(new Set([...E,h.id]))):or(E=>E.filter(S=>S!==h.id))}}),a.jsxs("span",{className:"text-sm text-gray-800",children:[h.name," (",h.role,")"]})]},h.id))})]})}),a.jsxs("div",{className:"p-4 md:p-6 border-t border-gray-100 flex gap-3",children:[a.jsx("button",{onClick:()=>{hi(!1),Jr(null),or([])},className:"flex-1 py-2 text-base text-gray-500 hover:bg-gray-100 rounded font-medium",children:"Cancel"}),a.jsx("button",{onClick:async()=>{try{await Fu(n.id,Vs.id,{sharedWith:ma}),p("Shared Users Updated",`Shared list updated for ${Vs.name}`,"success",void 0,n.id,n.name)}catch(h){console.error("Error updating sharedWith:",h),p("Update Failed","Could not update shared users","error")}finally{hi(!1),Jr(null),or([])}},className:"flex-1 py-2 bg-blue-600 text-white rounded font-bold hover:bg-blue-700",children:"Save"})]})]})}),document.body),ae&&j&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:j.id?"Edit Task Details":"Create New Task"}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 font-medium mt-0.5",children:[a.jsx(SN,{className:"w-3 h-3"}),a.jsx("span",{children:n.name})]})]})}),a.jsx("button",{onClick:()=>xe(!1),className:"text-gray-400 hover:text-gray-600",title:"Close task modal",children:a.jsx(_n,{})})]}),ts(j)&&a.jsxs("div",{className:"bg-red-50 border-b border-red-100 px-4 py-2 flex items-center gap-2 text-red-700 text-sm",children:[a.jsx(Ma,{className:"w-4 h-4"}),a.jsx("span",{className:"font-bold",children:"Dependency Locked:"}),a.jsxs("span",{children:["This task is blocked by pending dependencies: ",dr(j).map(h=>h.title).join(", "),"."]})]}),Et&&a.jsxs("div",{className:"bg-gray-800 text-white px-4 py-3 flex items-center justify-between shadow-md",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Mo,{className:"w-5 h-5 text-red-400"}),a.jsxs("span",{className:"font-bold uppercase tracking-wide",children:["Task Frozen: ",j.status]})]}),a.jsx("span",{className:"text-xs opacity-70",children:"Interaction disabled by Admin."})]}),a.jsxs("div",{className:"flex md:hidden border-b border-gray-200 bg-white flex-shrink-0",children:[a.jsx("button",{onClick:()=>V("details"),className:`flex-1 py-3 text-sm font-bold text-center ${K==="details"?"text-gray-900 border-b-2 border-gray-900":"text-gray-500"}`,children:"Details"}),a.jsx("button",{onClick:()=>V("activity"),className:`flex-1 py-3 text-sm font-bold text-center ${K==="activity"?"text-gray-900 border-b-2 border-gray-900":"text-gray-500"}`,children:"Activity"})]}),a.jsxs("div",{className:`flex-1 flex flex-col md:flex-row overflow-hidden ${Et?"pointer-events-none opacity-80 bg-gray-50":""}`,children:[a.jsx("div",{className:`w-full md:w-1/2 p-6 overflow-y-auto border-r border-gray-100 bg-white ${K==="activity"?"hidden md:block":"block"}`,children:a.jsxs("div",{className:"space-y-4",children:[$t&&a.jsxs("div",{className:"bg-gray-900 p-3 rounded-lg pointer-events-auto",children:[a.jsxs("p",{className:"text-xs font-bold text-gray-400 uppercase mb-2 flex items-center gap-1",children:[a.jsx(zx,{className:"w-3 h-3"})," Admin Actions"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>jc(j),className:"flex-1 bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",disabled:j.status===pe.DONE,children:[a.jsx(_d,{className:"w-3 h-3"})," Mark Done"]}),j.status===pe.ON_HOLD?a.jsxs("button",{onClick:()=>ie({...j,status:pp(j,pe.IN_PROGRESS)}),className:"flex-1 bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Lb,{className:"w-3 h-3"})," Resume"]}):a.jsxs("button",{onClick:()=>ie({...j,status:pe.ON_HOLD}),className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Bx,{className:"w-3 h-3"})," Hold"]}),j.status===pe.ABORTED?a.jsxs("button",{onClick:()=>ie({...j,status:pp(j,pe.IN_PROGRESS)}),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Fb,{className:"w-3 h-3"})," Restore"]}):a.jsxs("button",{onClick:()=>ie({...j,status:pe.ABORTED}),className:"flex-1 bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Mo,{className:"w-3 h-3"})," Abort"]})]})]}),j.id&&j.status!==pe.DONE&&!$t&&(u==null?void 0:u.id)===j.assigneeId&&!Et&&a.jsxs("div",{className:"bg-green-50 border border-green-100 p-3 rounded-lg mb-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[a.jsx(_d,{className:"w-5 h-5"}),a.jsx("span",{className:"font-bold text-sm",children:"Complete this task?"})]}),a.jsx("button",{onClick:()=>jc(j),className:"bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 px-4 rounded flex items-center gap-1 transition-colors",children:"Mark as Done"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Title ",a.jsx("span",{className:"text-red-500",children:"*"})]}),Ct?a.jsx("input",{type:"text",className:`${Dt(q&&!j.title,Et)} font-semibold mt-1`,placeholder:"Task title",value:j.title||"",onChange:h=>ie({...j,title:h.target.value}),disabled:Et}):a.jsx("p",{className:"font-bold text-gray-800 mt-1",children:j.title})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Category"}),Ct?a.jsx("select",{className:`${Dt(!1,Et)} mt-1`,value:j.category||"General",onChange:h=>ie({...j,category:h.target.value}),disabled:Et,"aria-label":"Task category",children:xf.map(h=>a.jsx("option",{value:h,children:h},h))}):a.jsx("span",{className:"block mt-1 text-sm bg-gray-100 w-fit px-2 py-1 rounded text-gray-800",children:j.category||"General"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Start Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),Ct?a.jsx("input",{type:"date",className:`${Dt(q&&!j.startDate,Et)} mt-1`,title:"Select start date",value:j.startDate||"",onChange:h=>ie({...j,startDate:h.target.value}),disabled:Et}):a.jsx("p",{className:"text-sm mt-1 text-gray-800",children:ln(j.startDate)})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Due Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),Ct?a.jsx("input",{type:"date",className:`${Dt(q&&!j.dueDate,Et)} mt-1`,title:"Select due date",value:j.dueDate||"",onChange:h=>ie({...j,dueDate:h.target.value}),disabled:Et}):a.jsx("p",{className:"text-sm mt-1 text-gray-800",children:ln(j.dueDate)})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(Ru,{className:"w-3 h-3 text-gray-400"}),a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Dependencies"})]}),Ct?a.jsx("div",{className:`mt-1 p-2 border rounded max-h-24 overflow-y-auto bg-white border-gray-200 ${Et?"opacity-50":""}`,children:He.filter(h=>h.id!==j.id).length>0?He.filter(h=>h.id!==j.id).map(h=>a.jsxs("label",{className:"flex items-center gap-2 mb-1 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[a.jsx("input",{type:"checkbox",checked:(j.dependencies||[]).includes(h.id),onChange:_=>Hs(h.id,_.target.checked),disabled:Et,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-sm text-gray-700 truncate",children:h.title}),a.jsxs("span",{className:"text-xs text-gray-400 ml-auto",children:["Ends: ",h.dueDate]})]},h.id)):a.jsx("p",{className:"text-xs text-gray-400 italic",children:"No other tasks available"})}):a.jsx("div",{className:"mt-1 text-sm text-gray-600",children:(j.dependencies||[]).length>0?He.filter(h=>(j.dependencies||[]).includes(h.id)).map(h=>a.jsxs("div",{className:"flex items-center gap-1 text-xs bg-gray-50 border border-gray-200 rounded px-2 py-1 mb-1",children:[a.jsx(Ru,{className:"w-3 h-3 text-gray-400"})," ",h.title,h.status!==pe.DONE&&a.jsx("span",{className:"text-red-500 font-bold ml-1",children:"(Pending)"})]},h.id)):a.jsx("span",{className:"text-gray-400 italic text-xs",children:"No dependencies"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Assignee & Priority"}),a.jsxs("div",{className:"flex gap-4 mt-1",children:[Ct?a.jsxs("select",{className:`${Dt(!1,Et)} flex-1`,value:j.assigneeId||"",onChange:h=>ie({...j,assigneeId:h.target.value}),disabled:Et,"aria-label":"Task assignee",children:[a.jsx("option",{value:"",children:"Unassigned"}),e.filter(h=>h.role===F.DESIGNER||h.role===F.VENDOR).map(h=>a.jsx("option",{value:h.id,children:h.name},h.id))]}):a.jsx("p",{className:"flex-1 text-sm bg-gray-50 p-2 rounded text-gray-800",children:cn(j.assigneeId||"")}),Ct?a.jsxs("select",{className:`w-32 p-2 border rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-900 ${Et?"bg-gray-100 text-gray-500":"bg-white text-gray-900"}`,value:j.priority||"medium",onChange:h=>ie({...j,priority:h.target.value}),disabled:Et,"aria-label":"Task priority",children:[a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]}):a.jsx("span",{className:"p-2 border rounded bg-gray-50 uppercase text-xs font-bold flex items-center text-gray-800",children:j.priority})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Current Status"}),a.jsxs("div",{className:`mt-1 w-full p-2 border rounded bg-gray-50 text-gray-700 font-bold flex justify-between items-center flex-wrap gap-2 ${Et?"border-red-300 bg-red-50":"border-gray-200"}`,children:[a.jsx("span",{children:j.status||pe.TODO}),j.status===pe.REVIEW&&a.jsxs("div",{className:"flex gap-1 flex-wrap",children:[((rs=(lm=(om=j.approvals)==null?void 0:om.completion)==null?void 0:lm.client)==null?void 0:rs.status)==="approved"&&((Gd=(Hd=(fo=j.approvals)==null?void 0:fo.completion)==null?void 0:Hd.admin)==null?void 0:Gd.status)==="approved"&&a.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded font-normal",children:"Approved by Both"}),((Rc=(Qd=(Kd=j.approvals)==null?void 0:Kd.completion)==null?void 0:Qd.client)==null?void 0:Rc.status)==="approved"&&!((wa=(dm=(cm=j.approvals)==null?void 0:cm.completion)==null?void 0:dm.admin)!=null&&wa.status)&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded font-normal",children:"Waiting for Admin Approval"}),((Pc=(go=(Dc=j.approvals)==null?void 0:Dc.completion)==null?void 0:go.admin)==null?void 0:Pc.status)==="approved"&&!((_a=(gl=(Yd=j.approvals)==null?void 0:Yd.completion)==null?void 0:gl.client)!=null&&_a.status)&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded font-normal",children:"Waiting for Client Approval"}),!((xl=(Jd=(Oc=j.approvals)==null?void 0:Oc.completion)==null?void 0:Jd.client)!=null&&xl.status)&&!((eu=(Zd=(Xd=j.approvals)==null?void 0:Xd.completion)==null?void 0:Zd.admin)!=null&&eu.status)&&a.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-normal",children:"Under Review"}),((ru=(nu=(tu=j.approvals)==null?void 0:tu.completion)==null?void 0:nu.client)==null?void 0:ru.status)==="rejected"&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded font-normal",children:"Rejected by Client"}),((Vc=(Mc=(Ti=j.approvals)==null?void 0:Ti.completion)==null?void 0:Mc.designer)==null?void 0:Vc.status)==="rejected"&&a.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded font-normal",children:"Rejected by Designer"})]}),a.jsx("span",{className:"text-xs font-normal text-gray-400 italic",children:Et?"Frozen by Admin":"Auto-updated via progress"})]})]}),a.jsxs("div",{className:`pt-4 border-t border-gray-100 flex flex-col ${j.subtasks&&j.subtasks.length>0?"h-64 max-h-[400px]":""}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase block",children:"Checklist"}),Ct&&!Et&&(!j.subtasks||j.subtasks.length===0)&&a.jsxs("button",{onClick:()=>{const h={id:Math.random().toString(),title:"New Item",isCompleted:!1};ie({...j,subtasks:[...j.subtasks||[],h]}),setTimeout(()=>{const _=document.getElementById("checklist-container");_&&(_.scrollTop=_.scrollHeight)},100)},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[a.jsx(Oi,{className:"w-3 h-3"})," Add"]})]}),a.jsxs("div",{className:`space-y-2 pr-2 custom-scrollbar ${j.subtasks&&j.subtasks.length>0?"flex-1 overflow-y-auto min-h-[200px] border border-gray-200 rounded-lg p-3":""}`,id:"checklist-container",children:[(um=j.subtasks)==null?void 0:um.map((h,_)=>a.jsxs("div",{className:"flex items-center gap-2 p-2 rounded transition-opacity",style:{opacity:!Ct&&u.id!==j.assigneeId||ts(j)||Et?.5:1},children:[a.jsx("button",{type:"button",onClick:()=>{const E=[...j.subtasks||[]];E[_].isCompleted=!E[_].isCompleted,ie({...j,subtasks:E})},disabled:!Ct&&u.id!==j.assigneeId||ts(j)||Et,title:"Toggle subtask completion","aria-label":"Toggle subtask completion",className:`flex-shrink-0 w-4 h-4 rounded-full border flex items-center justify-center transition-all duration-200 ${h.isCompleted?"bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600":"border-gray-400 hover:border-green-400 hover:bg-green-50"} disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:border-gray-300`,children:h.isCompleted&&a.jsx(Ol,{className:"w-3 h-3 text-white"})}),Ct?a.jsx("input",{type:"text",value:h.title,placeholder:"Subtask title",disabled:Et,onChange:E=>{const S=[...j.subtasks||[]];S[_].title=E.target.value,ie({...j,subtasks:S})},className:"flex-1 p-1 border-b border-transparent focus:border-gray-300 outline-none text-sm bg-white text-gray-900 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"}):a.jsx("span",{className:`flex-1 text-sm pointer-events-none ${h.isCompleted?"line-through text-gray-400":"text-gray-800"}`,children:h.title}),Ct&&!Et&&a.jsx("button",{onClick:()=>{var S;const E=(S=j.subtasks)==null?void 0:S.filter(A=>A.id!==h.id);ie({...j,subtasks:E})},className:"text-gray-300 hover:text-red-500",title:"Delete subtask","aria-label":"Delete subtask",children:a.jsx(_n,{className:"w-4 h-4"})})]},h.id)),(!j.subtasks||j.subtasks.length===0)&&a.jsx("p",{className:"text-xs text-gray-400 italic",children:"No checklist items"}),Ct&&!Et&&j.subtasks&&j.subtasks.length>0&&a.jsxs("button",{id:"add-checklist-btn",onClick:h=>{const _={id:Math.random().toString(),title:"New Item",isCompleted:!1};ie({...j,subtasks:[...j.subtasks||[],_]}),setTimeout(()=>{const E=document.getElementById("checklist-container");E&&(E.scrollTop=E.scrollHeight)},100)},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-2 pt-2",children:[a.jsx(Oi,{className:"w-3 h-3"})," Add Item"]})]})]})]})}),a.jsxs("div",{className:`w-full md:w-1/2 flex flex-col bg-gray-50/50 ${K==="details"?"hidden md:flex":"flex"}`,children:[j.approvals&&a.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(zx,{className:"w-4 h-4 text-gray-500"}),a.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase",children:"Approvals"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-100",children:[a.jsx("p",{className:"text-sm font-bold text-gray-500 mb-2",children:"1. Start Approval"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Client"}),((mm=(xo=(hm=j.approvals)==null?void 0:hm.start)==null?void 0:xo.client)==null?void 0:mm.status)==="pending"?oo&&!Et?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>Hn("start","approve"),disabled:Fe==="start-approve-client",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve start",children:Fe==="start-approve-client"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>Hn("start","reject"),disabled:Fe==="start-reject-client",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject start",children:Fe==="start-reject-client"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-sm font-bold px-1.5 py-0.5 rounded capitalize ${((en=(iu=(su=j.approvals)==null?void 0:su.start)==null?void 0:iu.client)==null?void 0:en.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(yo=(yl=(Lc=j.approvals)==null?void 0:Lc.start)==null?void 0:yl.client)==null?void 0:yo.status}),$t&&!Et&&!(((vo=($c=(au=j.approvals)==null?void 0:au.start)==null?void 0:$c.client)==null?void 0:vo.status)==="approved"&&((ou=(Na=(vl=j.approvals)==null?void 0:vl.start)==null?void 0:Na.admin)==null?void 0:ou.status)==="approved")&&a.jsx("button",{onClick:()=>Hn("start","revoke","client"),disabled:Fe==="start-revoke-client",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Admin"}),((lu=(fm=(pm=j.approvals)==null?void 0:pm.start)==null?void 0:fm.admin)==null?void 0:lu.status)==="pending"?$t&&!Et?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>Hn("start","approve"),disabled:Fe==="start-approve-admin",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve start",children:Fe==="start-approve-admin"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>Hn("start","reject"),disabled:Fe==="start-reject-admin",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject start",children:Fe==="start-reject-admin"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-sm font-bold px-1.5 py-0.5 rounded capitalize ${((Fc=(wl=(bl=j.approvals)==null?void 0:bl.start)==null?void 0:wl.admin)==null?void 0:Fc.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(zc=(Uc=(Bc=j.approvals)==null?void 0:Bc.start)==null?void 0:Uc.admin)==null?void 0:zc.status}),$t&&!Et&&!(((xm=(cu=(gm=j.approvals)==null?void 0:gm.start)==null?void 0:cu.client)==null?void 0:xm.status)==="approved"&&((Ai=(qc=(ym=j.approvals)==null?void 0:ym.start)==null?void 0:qc.admin)==null?void 0:Ai.status)==="approved")&&a.jsx("button",{onClick:()=>Hn("start","revoke","admin"),disabled:Fe==="start-revoke-admin",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]})]})]}),a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-100",children:[a.jsx("p",{className:"text-sm font-bold text-gray-500 mb-2",children:"2. End Approval"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Client"}),((Is=(Ia=(du=j.approvals)==null?void 0:du.completion)==null?void 0:Ia.client)==null?void 0:Is.status)==="pending"?oo&&!Et?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>Hn("completion","approve"),disabled:Fe==="completion-approve-client",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve completion",children:Fe==="completion-approve-client"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>Hn("completion","reject"),disabled:Fe==="completion-reject-client",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject completion",children:Fe==="completion-reject-client"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded capitalize ${((Wc=(Qs=(bo=j.approvals)==null?void 0:bo.completion)==null?void 0:Qs.client)==null?void 0:Wc.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(Ki=(bm=(vm=j.approvals)==null?void 0:vm.completion)==null?void 0:bm.client)==null?void 0:Ki.status}),$t&&!Et&&!(((_l=(Ea=(wo=j.approvals)==null?void 0:wo.completion)==null?void 0:Ea.client)==null?void 0:_l.status)==="approved"&&((Si=(Ta=(Hc=j.approvals)==null?void 0:Hc.completion)==null?void 0:Ta.admin)==null?void 0:Si.status)==="approved")&&a.jsx("button",{onClick:()=>Hn("completion","revoke","client"),disabled:Fe==="completion-revoke-client",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Admin"}),((ji=(Yt=(tn=j.approvals)==null?void 0:tn.completion)==null?void 0:Yt.admin)==null?void 0:ji.status)==="pending"?$t&&!Et?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>Hn("completion","approve"),disabled:Fe==="completion-approve-admin",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve completion",children:Fe==="completion-approve-admin"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>Hn("completion","reject"),disabled:Fe==="completion-reject-admin",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject completion",children:Fe==="completion-reject-admin"?a.jsx(Pt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded capitalize ${((Qi=(ur=(Gn=j.approvals)==null?void 0:Gn.completion)==null?void 0:ur.admin)==null?void 0:Qi.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(Nl=(hr=(Aa=j.approvals)==null?void 0:Aa.completion)==null?void 0:hr.admin)==null?void 0:Nl.status}),$t&&!Et&&!(((Il=(hu=(uu=j.approvals)==null?void 0:uu.completion)==null?void 0:hu.client)==null?void 0:Il.status)==="approved"&&((El=(Ys=(mu=j.approvals)==null?void 0:mu.completion)==null?void 0:Ys.admin)==null?void 0:El.status)==="approved")&&a.jsx("button",{onClick:()=>Hn("completion","revoke","admin"),disabled:Fe==="completion-revoke-admin",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]})]})]})]})]}),a.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:a.jsxs("button",{onClick:()=>{zt(null),mi(!0)},className:"w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors group",title:"View task documents",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Cu,{className:"w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-xs font-bold text-blue-900 uppercase",children:"Task Documents"}),j.documents&&po(j.documents)>0&&a.jsx("span",{className:"bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:po(j.documents)})]}),a.jsx(Va,{className:"w-4 h-4 text-blue-600 group-hover:translate-x-0.5 transition-transform"})]})}),a.jsxs("div",{className:"flex-1 flex flex-col p-4 overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(tp,{className:"w-4 h-4 text-gray-500"}),a.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase",children:"Comments"})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4 pr-1",children:[((Gc=j.comments)==null?void 0:Gc.length)===0&&a.jsx("p",{className:"text-center text-sm text-gray-400 py-4",children:"No comments yet. Start the discussion!"}),(pu=j.comments)==null?void 0:pu.map(h=>{const _=h.userId===u.id;return a.jsx("div",{className:`flex gap-2 ${_?"flex-row-reverse":""}`,children:a.jsxs("div",{className:`p-2 rounded-lg max-w-[85%] text-sm ${_?"bg-blue-100 text-blue-900":"bg-white border border-gray-200 text-gray-700"}`,children:[a.jsx("p",{className:"text-xs font-bold opacity-70 mb-1",children:cn(h.userId,h.userName)}),a.jsx("p",{children:h.text}),a.jsx("p",{className:"text-xs opacity-60 mt-1 text-right",children:Ox(h.timestamp)})]})},h.id)}),a.jsx("div",{ref:oe})]}),a.jsxs("div",{className:`relative ${Et?"opacity-50 pointer-events-none":""}`,children:[a.jsx("input",{type:"text",className:"w-full p-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm bg-white text-gray-900",placeholder:"Type a message...",value:fe,onChange:h=>P(h.target.value),onKeyDown:h=>h.key==="Enter"&&zd(),disabled:Et}),a.jsx("button",{onClick:zd,disabled:Et,className:"absolute right-2 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800",title:"Send comment",children:a.jsx(ax,{className:"w-4 h-4"})})]})]})]})]}),a.jsxs("div",{className:"p-4 border-t border-gray-100 flex justify-between items-center bg-white",children:[a.jsx("div",{children:$t&&j.id&&a.jsxs("button",{onClick:pl,className:"px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-2",title:"Delete this task permanently",children:[a.jsx(Mo,{className:"w-4 h-4"})," Delete Task"]})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>xe(!1),className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg",title:"Cancel",children:"Cancel"}),(!Et||$t)&&a.jsx("button",{onClick:Gs,disabled:Te,className:"px-6 py-2 text-sm font-bold bg-gray-900 text-white rounded-lg hover:bg-gray-800 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",title:"Save task",children:Te?a.jsxs(a.Fragment,{children:[a.jsx(Pt,{size:"sm",color:"currentColor"}),j.id?"Saving...":"Creating..."]}):a.jsx(a.Fragment,{children:j.id?"Save Changes":"Create Task"})})]})]})]})}),document.body),_t&&Be&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Pa,{className:"w-5 h-5 text-gray-400"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-gray-900",children:Be.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded ",ln(Be.uploadDate)]})]})]}),a.jsx("button",{onClick:()=>Tt(!1),className:"text-gray-400 hover:text-gray-600",title:"Close document modal",children:a.jsx(_n,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex-1 max-h-[45%] overflow-hidden bg-gray-50 flex items-center justify-center",children:Be.type==="image"?a.jsx("img",{src:Be.url||Lx,alt:Be.name,className:"max-h-full max-w-full object-contain"}):Be.type==="pdf"?a.jsxs("div",{className:"text-center space-y-4",children:[a.jsxs("div",{className:"w-24 h-32 mx-auto bg-gradient-to-br from-red-50 to-red-100 rounded-lg flex flex-col items-center justify-center border-2 border-red-200",children:[a.jsx(Pa,{className:"w-12 h-12 text-red-500 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-red-600 uppercase",children:"PDF"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-700 font-medium mb-2",children:Be.name}),a.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"PDF documents cannot be previewed in-browser"})]}),a.jsx("button",{onClick:()=>window.open(Be.url,"_blank"),className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800",children:"Open PDF in New Tab"})]}):a.jsxs("div",{className:"text-center space-y-4",children:[a.jsxs("div",{className:"w-24 h-32 mx-auto bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg flex flex-col items-center justify-center border-2 border-blue-200",children:[a.jsx(Pa,{className:"w-12 h-12 text-blue-500 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase",children:Be.type})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-700 font-medium mb-2",children:Be.name}),a.jsxs("p",{className:"text-gray-500 text-sm mb-4",children:[Be.type.toUpperCase()," files cannot be previewed in-browser"]})]}),a.jsx("button",{onClick:()=>window.open(Be.url,"_blank"),className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800",children:"Open in New Tab"})]})}),a.jsxs("div",{className:"border-t border-gray-100 flex flex-col flex-1 min-h-[45%] bg-white",children:[a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[a.jsxs("h4",{className:"text-xs font-bold text-gray-700 uppercase mb-3",children:["Comments (",((wm=Be.comments)==null?void 0:wm.length)||0,")"]}),Be.comments&&Be.comments.length===0?a.jsx("p",{className:"text-center text-xs text-gray-400 py-4",children:"No comments yet. Start discussing!"}):(ki=Be.comments)==null?void 0:ki.map(h=>a.jsx("div",{className:"flex gap-2",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-[10px] font-bold text-gray-700",children:cn(h.userId,h.userName)}),a.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:h.text}),a.jsx("p",{className:"text-[9px] text-gray-400 mt-1",children:Ox(h.timestamp)})]})},h.id))]}),a.jsxs("div",{className:"p-3 border-t border-gray-100 flex gap-2",children:[a.jsx("input",{type:"text",placeholder:"Add a comment...",value:jt,onChange:h=>Yr(h.target.value),onKeyDown:h=>h.key==="Enter"&&!ms&&ft(),disabled:ms,className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 disabled:opacity-50"}),a.jsx("button",{onClick:ft,disabled:!jt.trim()||ms,className:"px-3 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 disabled:opacity-50",title:"Send comment",children:ms?a.jsx(Pt,{size:"sm",className:"text-white"}):a.jsx(ax,{className:"w-4 h-4"})})]})]})]})}),document.body),to&&lr&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-start justify-center pt-20 p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Ma,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Task?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the task ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',lr.title,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This task will be removed from the project immediately. All associated data will be lost."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{Bi(!1),Ui(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:uo,className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm task deletion",children:[a.jsx(Mo,{className:"w-4 h-4"})," Delete Task"]})]})]})}),document.body),Zr&&br&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Ma,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Meeting?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the meeting ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',br.title,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This meeting and all associated comments will be removed from the project immediately."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{xi(!1),Bs(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:()=>{br&&(hl(br.id,br.title),xi(!1),Bs(null))},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm meeting deletion",children:[a.jsx(Mo,{className:"w-4 h-4"})," Delete Meeting"]})]})]})}),document.body),Bt&&Us&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Ma,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Document?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the document ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',Us.name,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:"Warning:"})," This document will be permanently removed from the project and any tasks it is attached to."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{vs(!1),yi(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:v,className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm document deletion",children:[a.jsx(Ts,{className:"w-4 h-4"})," Delete Document"]})]})]})}),document.body),Vt&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:Vt.name}),a.jsx("p",{className:"text-sm text-gray-500",children:"Billing Report"})]})}),a.jsx("button",{onClick:()=>so(null),className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Close vendor billing panel",children:a.jsx(_n,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:It.filter(h=>{const _=h.adminApproved&&h.clientApproved,E=S=>S?S.includes("(")?S.split("(")[0].trim():S.trim():"";return _&&(h.vendorName===Vt.name||E(h.receivedByName)===Vt.name||E(h.paidByOther)===Vt.name||h.paidTo===Vt.name||h.receivedBy===Vt.name)}).length===0?a.jsx("div",{className:"text-center py-10 text-gray-400 border-2 border-dashed border-gray-100 rounded-xl",children:"No approved billing records found for this vendor."}):a.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:a.jsxs("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-gray-50 border-b border-gray-200 text-gray-600 font-semibold",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3",children:"Date"}),a.jsx("th",{className:"px-4 py-3",children:"Paid By"}),a.jsx("th",{className:"px-4 py-3",children:"Received By"}),a.jsx("th",{className:"px-4 py-3",children:"Description"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"Amount"}),a.jsx("th",{className:"px-4 py-3 text-center",children:"Approvals"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100",children:It.filter(h=>{const _=h.adminApproved&&h.clientApproved,E=S=>S?S.includes("(")?S.split("(")[0].trim():S.trim():"";return _&&(h.vendorName===Vt.name||E(h.receivedByName)===Vt.name||E(h.paidByOther)===Vt.name||h.paidTo===Vt.name||h.receivedBy===Vt.name)}).sort((h,_)=>new Date(_.date).getTime()-new Date(h.date).getTime()).map(h=>{var _;return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap",children:h.date}),a.jsx("td",{className:"px-4 py-3",children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-xs",children:h.type==="income"?h.paidTo||h.paidByOther||"-":h.vendorName||"-"}),a.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.paidBy==="client"?"text-blue-700":h.paidBy==="vendor"?"text-purple-700":h.paidBy==="designer"?"text-orange-700":h.paidBy==="admin"?"text-red-700":"text-gray-700"}`,children:h.type==="income"?(()=>{const E=e.find(S=>S.name===(h.paidTo||h.paidByOther));return(E==null?void 0:E.role)===F.CLIENT?"Client":(E==null?void 0:E.role)===F.VENDOR?"Vendor":(E==null?void 0:E.role)===F.DESIGNER?"Designer":(E==null?void 0:E.role)===F.ADMIN?"Admin":h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})():h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})]})]})}),a.jsx("td",{className:"px-4 py-3",children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-xs",children:h.receivedBy?h.receivedBy.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy:"-"}),a.jsx("div",{className:"flex flex-col gap-1 text-xs",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-xs ${h.receivedBy?(()=>{var A;const E=e.find(re=>{var Y;return re.name===((Y=h.receivedBy)!=null&&Y.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy)}),S=(E==null?void 0:E.role)||((A=h.receivedBy)!=null&&A.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():"");return S===F.CLIENT||S==="Client"?"text-blue-700":S===F.VENDOR||S==="Vendor"?"text-purple-700":S===F.DESIGNER||S==="Designer"?"text-orange-700":S===F.ADMIN||S==="Admin"?"text-red-700":"text-gray-700"})():"text-gray-700"}`,children:h.receivedBy&&h.receivedBy.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():((_=e.find(E=>E.name===h.receivedBy))==null?void 0:_.role)||"Vendor"})]})})]})}),a.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:h.description}),a.jsxs("td",{className:"px-4 py-3 text-right font-bold text-gray-800",children:["",h.amount.toLocaleString()]}),a.jsxs("td",{className:"px-4 py-3 text-center",children:[(h.isClientPayment||h.type==="income")&&a.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),(h.clientApprovalForPayment==="approved"||h.clientApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApprovalForPayment==="pending"||h.clientApprovalForPayment===void 0||h.clientApprovalForPayment===null)&&!h.clientApproved&&(u==null?void 0:u.role)===F.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Tn(h.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Confirm payment",disabled:me===`approve-payment-${h.id}-client-approved`,children:me===`approve-payment-${h.id}-client-approved`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Tn(h.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Dispute payment",disabled:me===`approve-payment-${h.id}-client-rejected`,children:me===`approve-payment-${h.id}-client-rejected`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApprovalForPayment==="pending"||h.clientApprovalForPayment===void 0||h.clientApprovalForPayment===null)&&!h.clientApproved&&(u==null?void 0:u.role)!==F.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),(h.adminApprovalForPayment==="approved"||h.adminApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApprovalForPayment==="pending"||h.adminApprovalForPayment===void 0||h.adminApprovalForPayment===null)&&!h.adminApproved&&(u==null?void 0:u.role)===F.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Tn(h.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve payment",disabled:me===`approve-payment-${h.id}-admin-approved`,children:me===`approve-payment-${h.id}-admin-approved`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Tn(h.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject payment",disabled:me===`approve-payment-${h.id}-admin-rejected`,children:me===`approve-payment-${h.id}-admin-rejected`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApprovalForPayment==="pending"||h.adminApprovalForPayment===void 0||h.adminApprovalForPayment===null)&&!h.adminApproved&&(u==null?void 0:u.role)!==F.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),h.type==="expense"&&a.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),h.clientApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApproved===void 0||h.clientApproved===null)&&(u==null?void 0:u.role)===F.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>$n(h.id,"client",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:me===`approve-expense-${h.id}-client-true`,children:me===`approve-expense-${h.id}-client-true`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>$n(h.id,"client",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:me===`approve-expense-${h.id}-client-false`,children:me===`approve-expense-${h.id}-client-false`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApproved===void 0||h.clientApproved===null)&&(u==null?void 0:u.role)!==F.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),h.adminApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApproved===void 0||h.adminApproved===null)&&(u==null?void 0:u.role)===F.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>$n(h.id,"admin",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:me===`approve-expense-${h.id}-admin-true`,children:me===`approve-expense-${h.id}-admin-true`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>$n(h.id,"admin",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:me===`approve-expense-${h.id}-admin-false`,children:me===`approve-expense-${h.id}-admin-false`?a.jsx(Pt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApproved===void 0||h.adminApproved===null)&&(u==null?void 0:u.role)!==F.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),!h.isAdditionalBudget&&!h.isClientPayment&&h.type!=="expense"&&a.jsx("span",{className:"text-xs text-gray-300",children:"-"})]})]},h.id)})})]})})}),a.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50",children:(()=>{const h=It.filter(Y=>{const X=Y.adminApproved&&Y.clientApproved,Se=Ge=>Ge?Ge.includes("(")?Ge.split("(")[0].trim():Ge.trim():"";return X&&(Y.vendorName===Vt.name||Se(Y.receivedByName)===Vt.name||Se(Y.paidByOther)===Vt.name||Y.paidTo===Vt.name||Y.receivedBy===Vt.name)}),_=h.filter(Y=>(Se=>Se?Se.includes("(")?Se.split("(")[0].trim():Se.trim():"")(Y.receivedByName)===Vt.name||Y.receivedBy===Vt.name).reduce((Y,X)=>Y+X.amount,0),E=h.filter(Y=>{const X=Se=>Se?Se.includes("(")?Se.split("(")[0].trim():Se.trim():"";return Y.vendorName===Vt.name||X(Y.paidByOther)===Vt.name||Y.paidTo===Vt.name}).reduce((Y,X)=>Y+X.amount,0),S=_-E,A=S*(es/100),re=S+A;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Total Paid To Vendor (Received):"}),a.jsxs("span",{className:"font-medium text-gray-900",children:["",_.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Less: Paid By Vendor (Expenses):"}),a.jsxs("span",{className:"font-medium text-red-600",children:["- ",E.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[a.jsx("span",{className:"font-bold text-gray-800",children:"Net Amount:"}),a.jsxs("span",{className:"font-bold text-gray-900",children:["",S.toLocaleString()]})]}),n.type==="Designing"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200 border-dashed",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm font-bold text-gray-700",children:"Designer Charges"}),u.role===F.ADMIN?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("input",{type:"number",min:"0",max:"100",value:es,onChange:Y=>fa(parseFloat(Y.target.value)||0),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:border-blue-500","aria-label":"Designer Charges Percentage",title:"Enter designer charges percentage",placeholder:"0"}),a.jsx("span",{className:"text-sm text-gray-500",children:"%"})]}):a.jsxs("span",{className:"text-sm text-gray-500",children:["(",es,"%)"]})]}),a.jsxs("div",{className:"text-md font-semibold text-orange-700",children:["+ ",A.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-300",children:[a.jsx("div",{className:"text-base font-bold text-gray-800",children:"Final Payable"}),a.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["",re.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})]})})()})]})}),document.body),Pr&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:Pr.name}),a.jsx("p",{className:"text-sm text-gray-500",children:"Designer Details & Projects"})]})}),a.jsxs("div",{className:"flex items-center gap-2",children:[Ct&&a.jsx("button",{onClick:()=>{p("Info","Designer edit functionality coming soon","info")},className:"text-emerald-600 hover:text-emerald-700 text-sm font-medium px-3 py-1.5 hover:bg-emerald-50 rounded transition-colors",title:"Edit designer details",children:"Edit"}),a.jsx("button",{onClick:()=>zi(null),className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Close designer details",children:a.jsx(_n,{className:"w-5 h-5"})})]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[a.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 border border-gray-100",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Name"}),a.jsx("p",{className:"text-sm font-bold text-gray-900 mt-1",children:Pr.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Specialty"}),a.jsx("p",{className:"text-sm font-bold text-gray-900 mt-1",children:Pr.specialty||"General Design"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Email"}),a.jsx("p",{className:"text-sm text-gray-700 mt-1",children:Pr.email})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Phone"}),a.jsx("p",{className:"text-sm text-gray-700 mt-1",children:Pr.phone||"N/A"})]})]})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-bold text-gray-800 mb-4",children:"Assigned Projects"}),n.tasks.filter(h=>h.assigneeId===Pr.id).length===0?a.jsx("div",{className:"text-center py-8 text-gray-400 border-2 border-dashed border-gray-100 rounded-lg",children:"No tasks assigned to this designer in this project."}):a.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left font-bold text-gray-700 text-sm",children:"Project Name"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Work Progress"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Percentage"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Deadline"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Pending Tasks"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Completed Tasks"})]})}),a.jsx("tbody",{children:(()=>{const h=n.tasks.filter(A=>A.assigneeId===Pr.id),_=h.filter(A=>A.status===pe.DONE).length,E=h.filter(A=>{var Ge,Ce,nt,ht,mt,wt;const re=((nt=(Ce=(Ge=A==null?void 0:A.approvals)==null?void 0:Ge.completion)==null?void 0:Ce.admin)==null?void 0:nt.status)==="approved",Y=(wt=(mt=(ht=A==null?void 0:A.approvals)==null?void 0:ht.completion)==null?void 0:mt.client)==null?void 0:wt.status,X=!Y||Y==="pending";return A.status===pe.DONE&&re&&X?!1:A.status!==pe.DONE&&A.status!==pe.REVIEW}).length,S=h.length>0?Math.round(_/h.length*100):0;return a.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-left text-gray-900 font-medium text-xs",children:n.name}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 max-w-xs mx-auto",children:a.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:`${S}%`}})})}),a.jsxs("td",{className:"px-4 py-3 text-center font-semibold text-gray-900 text-xs",children:[S,"%"]}),a.jsx("td",{className:"px-4 py-3 text-center text-gray-600 text-xs whitespace-nowrap",children:ln(n.deadline)}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:"inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800",children:E})}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:"inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:_})})]})})()})]})})]})]}),a.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50",children:(()=>{const h=n.tasks.filter(S=>S.assigneeId===Pr.id),_=h.filter(S=>S.status===pe.DONE).length,E=h.length;return a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Total Project Tasks"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:E})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Completed"}),a.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:_})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Remaining"}),a.jsx("p",{className:"text-2xl font-bold text-orange-600 mt-1",children:E-_})]})]})})()})]})}),document.body),io&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-200 bg-gradient-to-r from-emerald-50 to-green-50 flex-shrink-0",children:[a.jsxs("h3",{className:"text-xl md:text-lg font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(Oi,{className:"w-5 h-5 md:w-4 md:h-4 text-emerald-600"})," Add Additional Budget"]}),a.jsx("p",{className:"text-base md:text-sm text-gray-600 mt-1",children:"Increase the project budget with client approval"})]}),a.jsxs("div",{className:"p-4 md:p-6 space-y-4 flex-1 overflow-y-auto scrollbar-thin",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-medium text-gray-700 mb-2",children:["Budget Amount ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-semibold text-lg md:text-base",children:""}),a.jsx("input",{type:"number",value:ws,onChange:h=>qi(h.target.value),placeholder:"Enter amount",className:"w-full pl-7 pr-4 py-3 md:py-2 text-base md:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none",min:"0"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-base md:text-sm font-medium text-gray-700 mb-2",children:"Reason/Description"}),a.jsx("textarea",{value:Or,onChange:h=>vi(h.target.value),placeholder:"Why is additional budget needed? (optional)",className:"w-full px-4 py-3 md:py-2 text-base md:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none resize-none",rows:3})]}),ws&&a.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 md:p-3",children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Current Budget:"}),a.jsxs("span",{className:"text-base md:text-sm font-semibold text-gray-900",children:["",n.budget.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Additional Amount:"}),a.jsxs("span",{className:"text-base md:text-sm font-semibold text-emerald-600",children:["+",parseFloat(ws||"0").toLocaleString()]})]}),a.jsxs("div",{className:"border-t border-emerald-200 pt-2 flex justify-between",children:[a.jsx("span",{className:"text-base md:text-sm font-medium text-gray-900",children:"New Total:"}),a.jsxs("span",{className:"text-base md:text-sm font-bold text-emerald-700",children:["",(n.budget+parseFloat(ws||"0")).toLocaleString()]})]})]})})]}),a.jsxs("div",{className:"p-4 md:p-6 border-t border-gray-200 bg-gray-50 flex gap-3 justify-end",children:[a.jsx("button",{onClick:()=>{ga(!1),qi(""),vi("")},className:"px-4 py-2 md:py-1.5 text-base md:text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsxs("button",{onClick:async()=>{if(!ws||isNaN(parseFloat(ws))){p("Validation","Please enter a valid budget amount","error",n.clientId,n.id,n.name);return}const h=parseFloat(ws);try{const _=e.find(Y=>Y.id===n.clientId),E=(_==null?void 0:_.name)||"Client",S=e.find(Y=>Y.role===F.ADMIN),A=(S==null?void 0:S.name)||"Admin",re=await Py(n.id,{date:new Date().toISOString().split("T")[0],timestamp:new Date().toISOString(),description:Or||`Additional Budget Increase: ${h.toLocaleString()}`,amount:h,type:"income",category:"Additional Budget",status:"pending",paidBy:"client",paidByOther:E,receivedBy:A,receivedByName:A,receivedByRole:"admin-received",isAdditionalBudget:!0,clientApprovalForAdditionalBudget:"pending",adminApprovalForAdditionalBudget:"pending"});ti(n.id,`Budget Increase Requested: ${h.toLocaleString()}`,`Budget increase of ${h.toLocaleString()} requested by ${u.name}. Reason: ${Or||"Not specified"}. Awaiting Client and Admin approval.`,"in-progress",new Date().toISOString(),new Date().toISOString()),nr("Budget",`Budget increase of ${h.toLocaleString()} requested by ${u.name}. Awaiting approvals. Reason: ${Or||"Not specified"}`),p("Request",`Budget increase of ${h.toLocaleString()} requested. Awaiting Client and Admin approval.`,"success",n.clientId,n.id,n.name),ga(!1),qi(""),vi("")}catch(_){console.error("Error creating additional budget record:",_),p("Error","Failed to create additional budget record","error",n.clientId,n.id,n.name)}},className:"px-4 py-2 md:py-1.5 text-base md:text-xs font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2",children:[a.jsx(Oi,{className:"w-4 h-4 md:w-3 md:h-3"})," Add Budget"]})]})]})}),document.body),a.jsx(aV,{isOpen:ys,onClose:()=>{fi(!1),Za(null)},onSubmit:wi,onUpdate:va,teamMembers:sn,isLoading:_c,editingMeeting:wc}),ps&&j&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-5xl h-[80vh] flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Cu,{className:"w-5 h-5 text-blue-600"}),a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Task Documents"}),j.documents&&po(j.documents)>0&&a.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:po(j.documents)})]}),a.jsx("button",{type:"button",onClick:()=>mi(!1),className:"text-gray-500 hover:text-gray-700 p-1 hover:bg-gray-100 rounded transition-colors",title:"Close modal","aria-label":"Close documents modal",children:a.jsx(_n,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:po(j.documents)>0?a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:im(j.documents).filter(h=>h.approvalStatus==="pending"?u.role===F.ADMIN||u.role===F.DESIGNER||h.uploadedBy===u.id:h.approvalStatus==="approved"?Array.isArray(h.sharedWith)&&h.sharedWith.includes(u.id)||u.role===F.ADMIN||h.uploadedBy===u.id:h.approvalStatus==="rejected"?u.role===F.ADMIN||u.role===F.DESIGNER||h.uploadedBy===u.id:u.role===F.ADMIN).map(h=>a.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-10",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Comments",onClick:()=>I(h),children:a.jsx(tp,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"View",onClick:()=>window.open(h.url,"_blank"),children:a.jsx(ix,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Download",onClick:()=>Ni(h),children:a.jsx($b,{className:"w-4 h-4"})}),(h.uploadedBy===u.id||Ct)&&a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Delete",onClick:()=>m(h),children:a.jsx(Ts,{className:"w-4 h-4"})})]}),u.role===F.ADMIN&&h.approvalStatus==="pending"&&a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve",onClick:()=>C(h),disabled:me===`approve-doc-${h.id}`,children:me===`approve-doc-${h.id}`?a.jsx(Pt,{size:"md",color:"currentColor"}):a.jsx(Ol,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject",onClick:()=>Z(h),disabled:me===`reject-doc-${h.id}`,children:me===`reject-doc-${h.id}`?a.jsx(Pt,{size:"md",color:"currentColor"}):a.jsx(_n,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center overflow-hidden relative group",children:h.type==="image"?a.jsx("img",{src:h.url||Lx,alt:h.name,className:"w-full h-full object-cover",onError:_=>{var E;_.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiI+PC9yZWN0PjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ij48L2NpcmNsZT48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNiAxMCA1IDIxIj48L3BvbHlsaW5lPjwvc3ZnPg==",_.currentTarget.className="w-12 h-12 opacity-50",(E=_.currentTarget.parentElement)==null||E.classList.add("flex","items-center","justify-center")}}):h.type==="pdf"?a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-50 to-red-100",children:[a.jsx(Pa,{className:"w-12 h-12 text-red-400 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-red-600 uppercase",children:"PDF"})]}):a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100",children:[a.jsx(Pa,{className:"w-12 h-12 text-blue-400 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase",children:h.type})]})}),a.jsxs("div",{className:"p-3",children:[a.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",title:h.name,children:h.name}),a.jsxs("div",{className:"flex justify-between items-center mt-2",children:[a.jsx("span",{className:"text-xs text-gray-400",children:ln(h.uploadDate)}),a.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${h.approvalStatus==="pending"?"bg-yellow-100 text-yellow-700":h.approvalStatus==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:h.approvalStatus==="pending"?"Approval Pending":h.approvalStatus==="approved"?"Approved":"Rejected"})]}),a.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:(Array.isArray(h.sharedWith)?h.sharedWith:[]).map(_=>{var S;const E=e.find(A=>A.id===_);return a.jsx("span",{className:"text-[8px] bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded",title:E==null?void 0:E.name,children:((S=E==null?void 0:E.name)==null?void 0:S.split(" ")[0])||"Unknown"},_)})}),h.comments&&h.comments.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-blue-600 font-medium",children:[h.comments.length," ",h.comments.length===1?"comment":"comments"]})]})]},h.id))}):a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx(Cu,{className:"w-16 h-16 text-gray-300 mb-3"}),a.jsx("p",{className:"text-gray-400 font-medium",children:"No documents attached to this task"}),a.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Upload documents and attach them to this task"})]})}),Ct&&!Et&&a.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-end",children:a.jsxs("button",{onClick:()=>{mi(!1),at(!0),on({...lt,attachToTaskId:j.id})},className:"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors font-semibold text-sm",title:"Add documents to task",children:[a.jsx(Oi,{className:"w-4 h-4"})," Add Documents"]})})]})}),document.body),no&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Ma,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Project?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the project ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',n.name,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This project and all associated data (tasks, documents, meetings, financials) will be permanently deleted."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>gi(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:tr,className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm project deletion",children:[a.jsx(Ts,{className:"w-4 h-4"})," Delete Project"]})]})]})}),document.body),Dr&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Ma,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Transaction?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"Are you sure you want to delete this transaction?"}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This financial record will be permanently removed from the project ledger."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{ro(!1),Xr(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:async()=>{if(vr)try{await N(vr),p("Transaction Deleted","The transaction was deleted successfully.","success"),ro(!1),Xr(null)}catch{p("Error","Failed to delete transaction.","error")}},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm transaction deletion",children:[a.jsx(Ts,{className:"w-4 h-4"})," Delete Transaction"]})]})]})}),document.body)]})},lV=async n=>{try{const e=bt(st,"users",n.id),t=n.role.toLowerCase()+"s",r=bt(st,t,n.id),i={name:n.name,email:n.email,role:n.role,phone:n.phone||""};n.company&&(i.company=n.company),n.specialty&&(i.specialty=n.specialty),n.tenantId&&(i.tenantId=n.tenantId),n.tenantIds&&(i.tenantIds=n.tenantIds),await Os(e,i,{merge:!0}),await Os(r,i,{merge:!0})}catch(e){throw console.error("Error updating user in Firebase:",e),new Error(e.message||"Failed to update user")}},iA=async(n,e,t)=>{const r=Xb().find(c=>c.name==="SecondaryApp")||By(qT,"SecondaryApp"),i=Xb().find(c=>c.name==="SecondaryApp")?V1(r):b1(r,{persistence:Zx}),l=FE(r);try{let c="";n.authMethod==="phone"?c=`phone_${(n.phone||"").replace(/\D/g,"")}`:c=(await NC(i,n.email,n.password)).user.uid;const u=(n.phone||"").replace(/\D/g,"");let p=n.tenantId;if(n.role===F.ADMIN&&!p)try{p=(await A5(hn(l,"tenants"),{name:n.company||`${n.name}'s Organization`,ownerId:c,createdAt:new Date().toISOString(),status:"active"})).id}catch(w){console.error("Error creating tenant document:",w),p=c}const g={id:c,name:n.name,email:n.email,role:n.role,phone:u||"",password:n.password,authMethod:n.authMethod||"email",tenantId:p||c};n.company&&(g.company=n.company),n.specialty&&(g.specialty=n.specialty),n.password&&(g.password=n.password),await Os(bt(l,"users",c),g);const b=n.role.toLowerCase()+"s";if(await Os(bt(l,b,c),g),n.authMethod==="phone")try{const w=`
          <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
              <h2 style="color: #fff; margin: 0; font-size: 24px;"> Welcome to Kydo Solutions!</h2>
            </div>
            
            <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
              <p style="color: #333; font-size: 16px;">Hi <strong>${n.name}</strong>,</p>
              
              <p style="color: #555; font-size: 14px;">Your account has been created on Kydo Solutions. You can now log in using your phone number with OTP (One-Time Password).</p>
              
              <div style="background-color: #f3f4f6; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #ef4444;">
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your Phone Number:</strong></p>
                <p style="margin: 5px 0 15px 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${n.phone}</p>
                
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>How to Login:</strong></p>
                <ol style="margin: 5px 0 0 0; color: #1f2937; font-size: 14px;">
                  <li>Go to the Kydo Solutions login page</li>
                  <li>Click the "Phone" tab</li>
                  <li>Enter your phone number: ${n.phone}</li>
                  <li>Click "Send OTP"</li>
                  <li>You'll receive an SMS with a 6-digit OTP</li>
                  <li>Enter the OTP and click "Verify OTP"</li>
                </ol>
              </div>
              
              <p style="color: #555; font-size: 14px;">
                <strong>Important:</strong> Keep your phone number safe. You'll need it to log in.
              </p>

              
              <div style="margin-top: 30px; text-align: center;">
                <a href="https://btw-erp.web.app" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 30px; border-radius: 6px; text-decoration: none; display: inline-block; font-weight: 600;">
                  Go to Kydo Solutions
                </a>
              </div>
              
              <p style="color: #9ca3af; font-size: 12px; margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
                If you have any questions, please contact the administrator.
              </p>
            </div>
          </div>
        `;await Qr({to:n.email,recipientName:n.name,subject:"Welcome to Kydo Solutions - Phone-Based Login Instructions",htmlContent:w})}catch(w){console.error(` Failed to send welcome email to ${n.email}:`,w.message)}else try{const w=`
          <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
              <h2 style="color: #fff; margin: 0; font-size: 24px;"> Welcome to Kydo Solutions!</h2>
            </div>
            
            <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
              <p style="color: #333; font-size: 16px;">Hi <strong>${n.name}</strong>,</p>
              
              <p style="color: #555; font-size: 14px;">Your account has been created on Kydo Solutions. Here are your login credentials:</p>
              
              <div style="background-color: #f3f4f6; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #ef4444;">
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your ID (Email):</strong></p>
                <p style="margin: 5px 0 15px 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${n.email}</p>
                
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your Password:</strong></p>
                <p style="margin: 5px 0 0 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${n.password}</p>
              </div>
              
              <p style="color: #555; font-size: 14px;">
                <strong>Keep these credentials safe!</strong> You can change your password after logging in for the first time.
              </p>
              
              <div style="margin-top: 30px; text-align: center;">
                <a href="https://btw-erp.web.app" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 30px; border-radius: 6px; text-decoration: none; display: inline-block; font-weight: 600;">
                  Go to Kydo Solutions
                </a>
              </div>
              
              <p style="color: #9ca3af; font-size: 12px; margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
                If you have any questions, please contact the administrator.
              </p>
            </div>
          </div>
        `;await Qr({to:n.email,recipientName:n.name,subject:"Welcome to Kydo Solutions - Your Account Credentials",htmlContent:w})}catch(w){console.error(` Failed to send welcome email to ${n.email}:`,w.message)}return c}catch(c){throw console.error("Error creating user in Firebase:",c),c.code==="auth/email-already-in-use"?new Error("This email is already registered."):c.code==="auth/weak-password"?new Error("Password is too weak. Use at least 6 characters."):c.code==="auth/invalid-email"?new Error("Invalid email address."):new Error(c.message||"Failed to create user")}finally{try{await dk(r)}catch(c){console.warn("Error deleting secondary app:",c)}}},gp=({users:n,roleFilter:e,onAddUser:t,projects:r=[],onSelectProject:i,onSelectTask:l})=>{var mi;const{user:c,adminCredentials:u}=ha(),{addNotification:p}=al(),{showLoading:g,hideLoading:b}=Xh(),[w,N]=W.useState(!1),[D,z]=W.useState(null),[L,O]=W.useState(!1),[le,ge]=W.useState(null),[ae,xe]=W.useState(!1),[j,ie]=W.useState(!1),[k,R]=W.useState(null),[M,q]=W.useState(null),[U,K]=W.useState(!1),[V,Fe]=W.useState("email"),[ue,Te]=W.useState({role:e==="All"?F.CLIENT:e}),[Ie,fe]=W.useState(null),[P,H]=W.useState(!1),[$,oe]=W.useState(!1),[we,he]=W.useState(null),[ke,me]=W.useState("email"),[$e,pt]=W.useState({}),[at,lt]=W.useState(null),[on,Re]=W.useState({}),Oe=r,[mn,pn]=W.useState(null),[yn,Be]=W.useState(!1),[zt,_t]=W.useState({});W.useEffect(()=>{if(r.length===0){_t({});return}const se=[];return r.forEach(_e=>{try{const ze=hn(st,"projects",_e.id,"finances"),Qe=ci(ze,J=>{const Ye=J.docs.map(Lt=>({...Lt.data(),id:Lt.id}));_t(Lt=>({...Lt,[_e.id]:Ye}))},J=>{console.error(`Error listening to financials for project ${_e.id}:`,J)});se.push(Qe)}catch(ze){console.error(`Failed to set up listener for project ${_e.id}`,ze)}}),()=>{se.forEach(_e=>_e())}},[r]),W.useEffect(()=>{},[r]),W.useEffect(()=>{},[zt]),W.useEffect(()=>{D&&(Be(!0),da(bt(st,"vendors",D.id)).then(se=>{se.exists()?pn(se.data()):pn(null)}).finally(()=>Be(!1)))},[D]);const Tt=ii.useMemo(()=>{let se=e==="All"?n.filter(_e=>_e.role!==F.ADMIN):n.filter(_e=>_e.role===e);if((c==null?void 0:c.role)===F.VENDOR&&e===F.ADMIN){const _e=c.tenantIds||[];se=se.filter(ze=>_e.length===0||_e.includes(ze.tenantId))}return se},[n,e,c]),jt=ii.useMemo(()=>{if(e!==F.VENDOR)return null;const se={};return Tt.forEach(_e=>{const ze=_e.specialty||"General";se[ze]||(se[ze]=[]),se[ze].push(_e)}),se},[Tt,e]),Yr=ii.useMemo(()=>jt?Object.keys(jt).sort((se,_e)=>{const ze=xf.indexOf(se),Qe=xf.indexOf(_e);return(ze===-1?999:ze)-(Qe===-1?999:Qe)}):[],[jt]),ms=se=>se.startsWith("+91")?"+91 "+se.slice(3):se,ui=se=>{fe(se);const _e=se.email&&se.email.endsWith("@kydo-phone-auth.local");Te({name:se.name,email:_e?"":se.email,role:se.role,phone:se.phone,company:se.company,specialty:se.specialty}),me(_e?"phone":"email"),N(!0)},Ms=()=>{if(!ue.name||!ue.role||!ue.phone)return H(!0),p("Missing Information","Please fill in all compulsory fields marked with *","error"),!1;if(Ie){if(!ue.email)return H(!0),p("Missing Information","Please fill in all compulsory fields marked with *","error"),!1}else{if(ke==="email"&&!ue.email)return H(!0),p("Missing Email","Email is required for email-based authentication","error"),!1;if(ke==="phone"&&!ue.phone)return H(!0),p("Missing Phone","Phone number is required for phone-based authentication","error"),!1}return(ue.phone||"").replace(/\D/g,"").length<4?(H(!0),p("Invalid Phone","Phone number must have at least 4 digits","error"),!1):!0},hi=async se=>{if(se.preventDefault(),!!Ms())try{if(g(`Creating ${ue.role}...`),Ie){const Lt={...Ie,...ue};await lV(Lt),p("Success","User profile updated successfully","success"),N(!1),fe(null),Te({role:e==="All"?F.CLIENT:e}),H(!1);return}let _e=ue.email;ke==="phone"&&(_e="");const Qe=(ue.phone||"").replace(/\D/g,"").slice(-6),J=await iA({id:"",name:ue.name,email:_e||"",role:ue.role,company:ue.company||void 0,specialty:ue.specialty||void 0,phone:ue.phone||void 0,password:Qe,authMethod:ke,tenantId:c==null?void 0:c.tenantId},c==null?void 0:c.email,u==null?void 0:u.password),Ye={id:J,name:ue.name,email:ke==="phone"?"":ue.email,role:ue.role,company:ue.company||void 0,specialty:ue.specialty||void 0,phone:ue.phone||void 0,password:Qe,authMethod:ke};if(p("Success",`${ue.role} ${ue.name} created successfully!`,"success"),ke==="phone"){const Lt={id:J,name:ue.name,email:"",role:ue.role,company:ue.company||void 0,specialty:ue.specialty||void 0,phone:ue.phone||void 0,password:Qe,authMethod:"phone"};lt(Lt)}N(!1),Te({role:e==="All"?F.CLIENT:e}),H(!1)}catch(_e){console.error("Failed to create user:",_e),p("Error",_e.message||"Failed to create user. Please try again.","error")}finally{b()}},Vs=se=>{z(se),O(!0)},Jr=se=>{he(se),oe(!0)},ma=async se=>{if(we)try{const _e={...se};let ze=!1;if(we.role===F.CLIENT){const Qe=se.clientIds||[];if(!Qe.includes(we.id)&&se.clientId!==we.id)_e.clientIds=[...Qe,we.id],ze=!0;else{p("Info","User is already a client on this project","info");return}}else{const Qe=se.teamMembers||[];if(!Qe.includes(we.id)&&se.leadDesignerId!==we.id)_e.teamMembers=[...Qe,we.id],ze=!0;else{p("Info","User is already in the team","info");return}}if(ze){const Qe={};we.role===F.CLIENT?Qe.clientIds=_e.clientIds:Qe.teamMembers=_e.teamMembers,await nv(se.id,Qe),p("Success",`Added ${we.name} to ${se.name}`,"success"),oe(!1),he(null)}}catch(_e){console.error("Error assigning user:",_e),p("Error","Failed to assign user","error")}},or=se=>`
    w-full px-3 py-2 border rounded-lg focus:outline-none transition-all
    bg-white text-gray-900 placeholder-gray-400
    ${P&&!se?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}
  `,ps=({user:se,hideRole:_e=!1,hideSpecialty:ze=!1,isVendor:Qe=!1})=>a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow h-full flex flex-col",children:[a.jsxs("div",{className:"p-6 flex-1",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[a.jsx(Ba,{avatar:se.avatar,name:se.name,size:"md",role:String(se.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-base md:text-sm font-bold text-gray-900",children:se.name}),se.company&&a.jsxs("p",{className:"text-xs md:text-xs font-medium text-gray-500 flex items-center gap-1",children:[a.jsx(AN,{className:"w-3 h-3"})," ",se.company]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[Qe&&a.jsx("button",{onClick:()=>{R(se),ie(!0)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Accounts",children:a.jsx(IS,{className:"w-5 h-5"})}),!_e&&a.jsx("span",{className:`px-2 py-1 rounded text-xs md:text-xs font-bold uppercase tracking-wide
                  ${se.role===F.CLIENT?"bg-blue-100 text-blue-700":se.role===F.VENDOR?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700"}`,children:se.role})]})]}),a.jsx("div",{className:"mt-2",children:!ze&&se.specialty&&a.jsx("p",{className:"text-xs md:text-xs text-gray-400 mt-1",children:se.specialty})}),a.jsxs("div",{className:"mt-4 space-y-2 border-t border-gray-100 pt-4",children:[se.email&&!se.email.endsWith("@kydo-phone-auth.local")&&a.jsxs("a",{href:`mailto:${se.email}`,className:"flex items-center gap-2 text-base md:text-sm text-gray-600 hover:text-blue-600 group transition-colors",children:[a.jsx(Vp,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"}),a.jsx("span",{className:"truncate",children:se.email})]}),se.phone&&a.jsxs("a",{href:`tel:${se.phone}`,className:"flex items-center gap-2 text-base md:text-sm text-gray-600 hover:text-blue-600 group transition-colors",children:[a.jsx(Lp,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"}),a.jsx("span",{className:"text-base md:text-sm",children:ms(se.phone)})]})]})]}),a.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-100 flex justify-between items-center mt-auto",children:[Qe?a.jsxs("button",{onClick:()=>Vs(se),className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:["View Details ",a.jsx(Va,{className:"w-3 h-3"})]}):se.role===F.DESIGNER?a.jsxs("button",{onClick:()=>{ge(se),xe(!0)},className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:["View Details ",a.jsx(Va,{className:"w-3 h-3"})]}):(c==null?void 0:c.role)===F.DESIGNER&&se.role===F.CLIENT?a.jsx("button",{className:"text-base md:text-sm font-medium text-gray-400 cursor-not-allowed",title:"Designers cannot edit client profiles",children:"View Profile"}):a.jsx("button",{onClick:()=>ui(se),className:"text-base md:text-sm font-medium text-gray-500 hover:text-gray-900",children:"View Profile"}),(c==null?void 0:c.role)===F.DESIGNER?a.jsx("button",{className:"text-base md:text-sm font-medium text-gray-400 cursor-not-allowed",title:"Designers cannot assign users to projects",disabled:!0,children:"Assign to Project"}):a.jsx("button",{onClick:()=>Jr(se),className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800",children:"Assign to Project"})]})]});return a.jsxs("div",{className:"animate-fade-in pb-12",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:e==="All"?"Directory":`${e}s`}),a.jsx("div",{className:"flex items-center gap-3",children:!((c==null?void 0:c.role)===F.DESIGNER&&e===F.CLIENT)&&a.jsxs("button",{onClick:()=>{Te({role:e==="All"?F.CLIENT:e,phone:"+91 "}),N(!0)},className:"bg-gray-900 text-white px-4 py-2.5 md:px-4 md:py-2 rounded-lg text-base md:text-sm font-medium hover:bg-gray-800 transition-colors flex items-center gap-2",children:[a.jsx(Oi,{className:"w-4 h-4 md:w-4 md:h-4"}),"Add ",e==="All"?"Person":e]})})]}),jt?a.jsx("div",{className:"space-y-8",children:Yr.length>0?Yr.map(se=>a.jsxs("div",{children:[a.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wide mb-4 flex items-center gap-2 border-b border-gray-200 pb-2",children:[a.jsx($p,{className:"w-4 h-4"})," ",se]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:jt[se].map(_e=>a.jsx("div",{children:a.jsx(ps,{user:_e,hideRole:!0,hideSpecialty:!0,isVendor:!0})},_e.id))})]},se)):a.jsx("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Fx,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No vendors yet"}),a.jsx("p",{className:"text-gray-500",children:'No vendors have been added yet. Click "Add Vendor" to create one.'})]})})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Tt.length>0?Tt.map(se=>a.jsx("div",{children:a.jsx(ps,{user:se,isVendor:e===F.VENDOR,hideRole:e===F.CLIENT||e===F.DESIGNER})},se.id)):a.jsx("div",{className:"col-span-full flex flex-col items-center justify-center py-20 px-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Fx,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a.jsxs("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:["No ",e==="All"?"team members":e.toLowerCase()+"s"," yet"]}),a.jsx("p",{className:"text-gray-500",children:e==="All"?"Team members will appear here once they are added.":`${e}s will appear here once they are added.`})]})})}),w&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center p-4 pt-24",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[75vh] overflow-hidden animate-fade-in flex flex-col",children:[a.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-100 bg-gray-50 flex-shrink-0",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:Ie?"Edit Profile":`Add New ${e==="All"?"Person":e}`}),a.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600",title:"Close add person dialog",children:a.jsx(_n,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:hi,className:"overflow-y-auto flex-1",children:[a.jsxs("div",{className:"p-5 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Full Name ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",className:or(ue.name),placeholder:"e.g. John Doe",value:ue.name||"",onChange:se=>Te({...ue,name:se.target.value})})]}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Role ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{title:"Select user role",className:`w-full px-3 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 text-sm ${P&&!ue.role?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,value:ue.role||"",onChange:se=>{const _e=se.target.value;Te({...ue,role:_e})},children:[a.jsx("option",{value:"",children:"Select Role"}),(c==null?void 0:c.role)!==F.DESIGNER&&a.jsx("option",{value:F.CLIENT,children:"Client"}),a.jsx("option",{value:F.DESIGNER,children:"Designer"}),a.jsx("option",{value:F.VENDOR,children:"Vendor"}),(c==null?void 0:c.role)===F.ADMIN&&a.jsx("option",{value:F.ADMIN,children:"Admin"})]})]})}),!Ie&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Authentication Method ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>me("email"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors font-medium text-sm ${ke==="email"?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,title:"User will log in with email and password",children:"Email"}),a.jsx("button",{type:"button",onClick:()=>{me("phone"),Te(se=>({...se,email:""}))},className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors font-medium text-sm ${ke==="phone"?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,title:"User will log in with phone number and OTP",children:"Phone"})]})]}),ke==="email"&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Email Id ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"email",className:or(ue.email),placeholder:"john@example.com",value:ue.email||"",onChange:se=>Te({...ue,email:se.target.value})})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:[ke==="phone"?"Phone Number (Login ID)":"Phone Number"," ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"tel",className:or(ue.phone),placeholder:"+91 98765 43210",value:ue.phone||"",onChange:se=>Te({...ue,phone:se.target.value})}),ke==="email"&&a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 6 digits will automatically become their initial password."})]}),ue.role===F.VENDOR&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:"Company Name"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent bg-white text-gray-900 text-sm",placeholder:"e.g. ABC Construction",value:ue.company||"",onChange:se=>Te({...ue,company:se.target.value})})]}),ue.role===F.VENDOR&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:"Specialty"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent bg-white text-gray-900 text-sm",placeholder:"e.g. Flooring",value:ue.specialty||"",onChange:se=>Te({...ue,specialty:se.target.value})})]})]}),a.jsx("div",{className:"p-5 border-t border-gray-100 bg-gray-50 flex-shrink-0 sticky bottom-0",children:a.jsx("button",{type:"submit",className:"w-full bg-gray-900 text-white font-bold py-2.5 rounded-lg hover:bg-gray-800 transition-colors text-sm",children:Ie?"Save Changes":"Create Account"})})]})]})}),L&&D&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(Ba,{avatar:D.avatar,name:D.name,size:"md",role:String(D.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl sm:text-lg font-bold text-gray-900",children:D.name}),a.jsxs("p",{className:"text-sm sm:text-xs text-gray-500",children:[D.specialty,"  ",D.company]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{O(!1),ui(D)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Vendor Profile",children:a.jsx(qx,{className:"w-6 h-6 sm:w-5 sm:h-5"})}),a.jsx("button",{onClick:()=>O(!1),className:"text-gray-400 hover:text-gray-600",title:"Close vendor detail panel",children:a.jsx(_n,{className:"w-6 h-6 sm:w-5 sm:h-5"})})]})]}),a.jsx("div",{className:"p-6 space-y-6",children:(()=>{const se=Oe.filter(_e=>{var ze;return(ze=_e.tasks)==null?void 0:ze.some(Qe=>Qe.assigneeId===(D==null?void 0:D.id))}).map(_e=>{var Lt;const ze=((Lt=_e.tasks)==null?void 0:Lt.filter(it=>it.assigneeId===(D==null?void 0:D.id)))||[],Qe=ze.reduce((it,xt)=>it+ra(xt),0),J=ze.length>0?Math.round(Qe/ze.length):0,Ye=ze.filter(it=>it.status===pe.DONE).length;return{project:_e,tasks:ze,totalTasks:ze.length,completedTasks:Ye,progressPercentage:J}});return a.jsxs("div",{children:[a.jsx("h4",{className:"text-base sm:text-sm font-bold text-gray-800 mb-4",children:"Project-wise Tasks & Progress"}),se.length===0?a.jsx("p",{className:"text-base sm:text-sm text-gray-500 text-center py-6",children:"No tasks assigned"}):a.jsx("div",{className:"space-y-6",children:se.map(({project:_e,tasks:ze,totalTasks:Qe,completedTasks:J,progressPercentage:Ye})=>{const Lt=$e[_e.id]!==!1,it=()=>{pt(ve=>({...ve,[_e.id]:!ve[_e.id]}))},xt=ze.length>0?ze.reduce((ve,et)=>et.dueDate?ve?new Date(et.dueDate)>new Date(ve)?et.dueDate:ve:et.dueDate:ve,null):null,Ve=xt?ln(xt):"N/A";return a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:it,className:"w-full bg-gray-50 p-4 border-b border-gray-200 hover:bg-gray-100 transition-colors flex justify-between items-start",children:[a.jsxs("div",{className:"flex justify-between items-start flex-1 gap-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-semibold text-gray-900 text-base sm:text-sm text-left cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(_e),children:_e.name}),a.jsxs("p",{className:"text-sm sm:text-xs text-gray-500 mt-1 text-left",children:["DueDate: ",Ve]})]}),a.jsxs("span",{className:"text-sm sm:text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-md font-medium whitespace-nowrap",children:[J,"/",Qe," Completed"]})]}),a.jsx(Va,{className:`w-5 h-5 text-gray-600 ml-4 transition-transform flex-shrink-0 ${Lt?"rotate-90":""}`})]}),a.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-sm sm:text-xs font-medium text-gray-600",children:"Work Completed"}),a.jsxs("span",{className:"text-base sm:text-sm font-bold text-gray-900",children:[Ye,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-300 rounded-full h-2",children:a.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${Ye}%`}})})]}),Lt&&a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsxs("colgroup",{children:[a.jsx("col",{style:{width:"30%"}}),a.jsx("col",{style:{width:"20%"}}),a.jsx("col",{style:{width:"30%"}}),a.jsx("col",{style:{width:"20%"}})]}),a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Task Title"}),a.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Status"}),a.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Progress"}),a.jsx("th",{className:"text-left px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Deadline"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:ze.map(ve=>{const et=ra(ve),rn=ve.dueDate?ln(ve.dueDate):"No deadline",In=ve.dependencies&&ve.dependencies.length>0&&ve.dependencies.some(Vn=>{var ut;const Rr=(ut=_e.tasks)==null?void 0:ut.find(Qt=>Qt.id===Vn);return Rr&&Rr.status!==pe.DONE}),yr=ve.status===pe.DONE?"bg-green-100 text-green-800":ve.status===pe.IN_PROGRESS?"bg-blue-100 text-blue-800":ve.status===pe.REVIEW?"bg-purple-100 text-purple-800":ve.status===pe.TODO?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return a.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[a.jsx("td",{className:"px-2 sm:px-4 py-3 text-base sm:text-sm text-gray-700",children:a.jsxs("div",{className:"flex items-center gap-2 min-w-0 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l==null?void 0:l(ve,_e),children:[a.jsx("span",{className:"truncate",children:ve.title}),In&&a.jsx(xh,{className:"w-3 h-3 text-red-400 flex-shrink-0","aria-label":"Task blocked - waiting for dependencies"})]})}),a.jsx("td",{className:"px-2 sm:px-4 py-3 text-center",children:a.jsx("span",{className:`px-2 py-1 rounded-md text-sm sm:text-xs font-medium whitespace-nowrap ${yr}`,children:ve.status===pe.DONE?"Completed":ve.status})}),a.jsx("td",{className:"px-2 sm:px-4 py-3 text-center",children:a.jsxs("div",{className:"flex items-center gap-0.5 justify-center",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-2",style:{width:"50px"},children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${et===100?"bg-green-500":"bg-blue-500"}`,style:{width:`${et}%`}})}),a.jsxs("span",{className:"text-sm sm:text-xs font-medium text-gray-700 min-w-[30px]",children:[et,"%"]})]})}),a.jsx("td",{className:"px-2 sm:px-4 py-3 text-base sm:text-sm text-gray-700 whitespace-nowrap",children:rn})]},ve.id)})})]})})]},_e.id)})})]})})()})]})}),document.body),$&&we&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md animate-fade-in max-h-[80vh] flex flex-col",children:[a.jsxs("div",{className:"p-5 border-b border-gray-100 bg-gray-50 flex justify-between items-center flex-shrink-0",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Assign to Project"}),a.jsxs("p",{className:"text-xs text-gray-500",children:["Add ",we.name," to a project team"]})]}),a.jsx("button",{onClick:()=>oe(!1),className:"text-gray-400 hover:text-gray-600",children:a.jsx(_n,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-2 overflow-y-auto flex-1",children:r.length===0?a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No projects available"}):a.jsx("div",{className:"space-y-1",children:Oe.map(se=>{const _e=se.clientId===we.id||se.leadDesignerId===we.id||(se.clientIds||[]).includes(we.id)||(se.teamMembers||[]).includes(we.id);return a.jsxs("button",{onClick:()=>!_e&&ma(se),disabled:_e,className:`w-full text-left p-3 rounded-lg flex items-center justify-between transition-colors ${_e?"bg-gray-50 opacity-60 cursor-not-allowed":"hover:bg-blue-50 hover:border-blue-100 border border-transparent"}`,children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-bold text-gray-800 text-sm cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(se),children:se.name}),a.jsx("p",{className:"text-xs text-gray-500",children:se.status})]}),_e?a.jsxs("span",{className:"text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded-full flex items-center gap-1",children:[a.jsx(_d,{className:"w-3 h-3"})," Added"]}):a.jsx(Oi,{className:"w-4 h-4 text-gray-400"})]},se.id)})})})]})}),document.body),ae&&le&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(Ba,{avatar:le.avatar,name:le.name,size:"md",role:String(le.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-2xl sm:text-xl font-bold text-gray-900",children:le.name}),a.jsx("p",{className:"text-base sm:text-sm text-gray-500",children:le.specialty||"Designer"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{xe(!1),ui(le)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Designer Profile",children:a.jsx(qx,{className:"w-6 h-6 sm:w-5 sm:h-5"})}),a.jsx("button",{onClick:()=>{xe(!1),ge(null)},className:"text-gray-400 hover:text-gray-600",title:"Close designer details",children:a.jsx(_n,{className:"w-6 h-6 sm:w-5 sm:h-5"})})]})]}),a.jsx("div",{className:"p-6 space-y-6",children:(()=>{const se=Oe.filter(_e=>{var ze;return(ze=_e.tasks)==null?void 0:ze.some(Qe=>Qe.assigneeId===le.id)}).map(_e=>({project:_e,tasks:_e.tasks.filter(ze=>ze.assigneeId===le.id),projectFinancials:zt[_e.id]||[]}));return se.length===0?a.jsx("p",{className:"text-lg sm:text-base text-gray-500 text-center py-6",children:"No tasks assigned"}):a.jsx("div",{className:"space-y-6",children:se.map(({project:_e,tasks:ze,projectFinancials:Qe})=>{const J=Qe.filter(it=>it.adminApproved&&it.clientApproved&&it.type==="income").reduce((it,xt)=>it+(xt.amount||0),0),Ye=on[_e.id]===!0,Lt=()=>{Re(it=>({...it,[_e.id]:!it[_e.id]}))};return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-3",children:[a.jsx("h4",{className:"text-lg sm:text-base font-bold text-gray-800 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(_e),children:_e.name}),a.jsxs("p",{className:"text-base sm:text-sm text-gray-500 mt-1",children:["Total Payment Received: ",a.jsxs("span",{className:"font-semibold text-gray-900",children:["",J.toLocaleString()]})]})]}),a.jsxs("button",{onClick:Lt,className:"w-full px-4 py-2.5 bg-gradient-to-r from-blue-50 to-blue-100 flex justify-between items-center transition-colors text-left border border-blue-200 rounded-t-lg",children:[a.jsxs("span",{className:"text-sm font-semibold text-blue-900",children:["Tasks (",ze.length,")"]}),a.jsx(Va,{className:`w-5 h-5 text-blue-600 transition-transform ${Ye?"rotate-90":""}`})]}),Ye&&a.jsx("div",{className:"overflow-x-auto border border-gray-200 border-t-0 rounded-b-lg",children:a.jsxs("table",{className:"w-full text-lg sm:text-base",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left font-bold text-gray-700 text-base sm:text-sm",children:"Task Name"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Progress"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Status"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Due Date"})]})}),a.jsx("tbody",{children:ze.map(it=>{const xt=ra(it),Ve=it.dueDate?new Date(it.dueDate).toLocaleDateString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",ve=it.status===pe.DONE?"bg-green-100 text-green-800":it.status===pe.IN_PROGRESS?"bg-blue-100 text-blue-800":it.status===pe.REVIEW?"bg-purple-100 text-purple-800":it.status===pe.OVERDUE?"bg-red-100 text-red-800":it.status===pe.TODO?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return a.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-left text-gray-900 font-medium text-base sm:text-sm cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l==null?void 0:l(it,_e),children:it.title}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("div",{className:"w-12 bg-gray-200 rounded-full h-1.5",children:a.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full",style:{width:`${xt}%`}})}),a.jsxs("span",{className:"text-base sm:text-sm font-semibold text-gray-700",children:[xt,"%"]})]})}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:`px-2 py-1 rounded text-base sm:text-sm font-medium whitespace-nowrap ${ve}`,children:it.status})}),a.jsx("td",{className:"px-4 py-3 text-center text-gray-600 text-base sm:text-sm",children:Ve})]},it.id)})})]})})]},_e.id)})})})()})]})}),document.body),U&&D&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Share Vendor Report"}),a.jsx("button",{onClick:()=>K(!1),className:"text-gray-400 hover:text-gray-600",title:"Close share report dialog",children:a.jsx(_n,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Share ",a.jsx("span",{className:"font-semibold",children:D.name}),"'s billing report with:"]}),a.jsx("div",{className:"space-y-3",children:Oe.filter(se=>se.tasks.some(_e=>_e.assigneeId===(D==null?void 0:D.id))).map(se=>{var _e;return a.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0,className:"w-4 h-4 rounded border-gray-300"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(se),children:se.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:[((_e=se.team)==null?void 0:_e.length)||0," team members"]})]})]},se.id)})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Share Method"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center p-3 border border-blue-200 bg-blue-50 rounded-lg cursor-pointer",children:[a.jsx("input",{type:"radio",name:"shareMethod",value:"email",checked:V==="email",onChange:se=>Fe(se.target.value),className:"w-4 h-4 border-gray-300"}),a.jsx("span",{className:"ml-3 text-sm font-medium text-gray-900",children:"Send via Email"})]}),a.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[a.jsx("input",{type:"radio",name:"shareMethod",value:"link",checked:V==="link",onChange:se=>Fe(se.target.value),className:"w-4 h-4 border-gray-300"}),a.jsx("span",{className:"ml-3 text-sm font-medium text-gray-900",children:"Create Shareable Link"})]})]})]})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end",children:[a.jsx("button",{onClick:()=>K(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),a.jsxs("button",{onClick:()=>{var se,_e;if(V==="link"&&D){const ze=`${window.location.origin}${window.location.pathname}?vendorId=${D.id}`;navigator.clipboard.writeText(ze).then(()=>{var Qe,J;p("Success","Vendor link copied to clipboard","success",(c==null?void 0:c.id)||"",((Qe=r[0])==null?void 0:Qe.id)||"",((J=r[0])==null?void 0:J.name)||"Project"),K(!1)}).catch(()=>{var Qe,J;p("Error","Failed to copy link","error",(c==null?void 0:c.id)||"",((Qe=r[0])==null?void 0:Qe.id)||"",((J=r[0])==null?void 0:J.name)||"Project")})}else p("Success",`Vendor report for ${D==null?void 0:D.name} shared with client`,"success",(c==null?void 0:c.id)||"",((se=r[0])==null?void 0:se.id)||"",((_e=r[0])==null?void 0:_e.name)||"Project"),K(!1)},title:"Share vendor billing report",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[a.jsx(xj,{className:"w-4 h-4"}),"Share Report"]})]})]})}),document.body),j&&k&&Mn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(Ba,{avatar:k.avatar,name:k.name,size:"md",role:String(k.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:k.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:[k.specialty,"  ",k.company]})]})]}),a.jsx("button",{onClick:()=>ie(!1),className:"text-gray-400 hover:text-gray-600",title:"Close accounts panel",children:a.jsx(_n,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-4",children:"Project & Billing Report"}),Oe.filter(se=>{var it,xt;const _e=(it=se.teamMembers)==null?void 0:it.includes((k==null?void 0:k.id)||""),ze=(xt=se.tasks)==null?void 0:xt.some(Ve=>Ve.assigneeId===(k==null?void 0:k.id)),Qe=zt[se.id]||[],J=(k==null?void 0:k.name)||"",Ye=Ve=>Ve?Ve.includes("(")?Ve.split("(")[0].trim():Ve.trim():"",Lt=Qe.some(Ve=>Ve.vendorId===(k==null?void 0:k.id)||Ve.vendorName===J||Ve.paidTo===J||Ve.receivedBy===J||Ye(Ve.receivedByName)===J||Ye(Ve.paidByOther)===J);return _e||ze||Lt}).length===0?a.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"No projects assigned"}):a.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:a.jsxs("table",{className:"w-full text-xs",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700",children:"Project"}),a.jsx("th",{className:"px-4 py-2 text-right font-bold text-gray-700",children:"Net Amount"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Tasks"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Admin Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Client Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Status"})]})}),a.jsx("tbody",{children:Oe.filter(se=>{var it,xt;const _e=(it=se.teamMembers)==null?void 0:it.includes((k==null?void 0:k.id)||""),ze=(xt=se.tasks)==null?void 0:xt.some(Ve=>Ve.assigneeId===(k==null?void 0:k.id)),Qe=zt[se.id]||[],J=Ve=>Ve?Ve.includes("(")?Ve.split("(")[0].trim():Ve.trim():"",Ye=(k==null?void 0:k.name)||"",Lt=Qe.some(Ve=>Ve.vendorId===(k==null?void 0:k.id)||Ve.vendorName===Ye||Ve.paidTo===Ye||Ve.receivedBy===Ye||J(Ve.receivedByName)===Ye||J(Ve.paidByOther)===Ye);return _e||ze||Lt}).map((se,_e)=>{const ze=zt[se.id]||[],Qe=ut=>ut?ut.includes("(")?ut.split("(")[0].trim():ut.trim():"",J=(k==null?void 0:k.name)||"",Ye=ze.filter(ut=>ut.vendorId===(k==null?void 0:k.id)||ut.vendorName===J||ut.paidTo===J||ut.receivedBy===J||Qe(ut.receivedByName)===J||Qe(ut.paidByOther)===J),Lt=Ye.filter(ut=>ut.adminApproved&&ut.clientApproved),it=Lt.filter(ut=>Qe(ut.receivedByName)===J||ut.receivedBy===J).reduce((ut,Qt)=>ut+Qt.amount,0),xt=Lt.filter(ut=>ut.vendorName===J||Qe(ut.paidByOther)===J||ut.paidTo===J).reduce((ut,Qt)=>ut+Qt.amount,0),Ve=it-xt;let ve=0;k!=null&&k.projectMetrics&&k.projectMetrics[se.id]?ve=k.projectMetrics[se.id].taskCount:ve=se.tasks.filter(Qt=>Qt.assigneeId===(k==null?void 0:k.id)).length;const et=Ye.length>0,rn=et&&Ye.every(ut=>ut.adminApproved),In=et&&Ye.some(ut=>ut.adminApproved),yr=et&&Ye.every(ut=>ut.clientApproved),Vn=et&&Ye.some(ut=>ut.clientApproved),Rr=(ut,Qt)=>ut?a.jsx("div",{className:"flex justify-center text-green-500 font-bold text-lg",children:""}):Qt?a.jsx("span",{className:"text-orange-500 font-medium text-xs",children:"Partial"}):a.jsx("span",{className:"text-gray-400 text-xs",children:"-"});return a.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${_e%2===0?"bg-white":"bg-gray-50/50"}`,children:[a.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(se),children:se.name}),a.jsxs("td",{className:"px-4 py-3 text-left text-gray-700",children:["",(Ve/1e3).toFixed(1),"k"]}),a.jsx("td",{className:"px-4 py-3 text-center text-gray-700 font-medium",children:ve}),a.jsx("td",{className:"px-4 py-3 text-center",children:Rr(rn,In)}),a.jsx("td",{className:"px-4 py-3 text-center",children:Rr(yr,Vn)}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-medium ${rn&&yr?"bg-green-100 text-green-700":rn?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:rn&&yr?"Approved":rn?"Admin OK":"Pending"})})]},se.id)})})]})})]})]})}),document.body),at&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-8 text-center",style:{position:"relative",zIndex:1e4},children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx(_d,{className:"w-8 h-8 text-green-600"})}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:" User Created Successfully!"}),a.jsxs("p",{className:"text-gray-700 mb-6 text-base font-medium",children:[a.jsx("strong",{children:at.name})," has been created with phone authentication.",a.jsx("br",{}),a.jsxs("span",{className:"text-sm text-gray-600",children:["Phone: ",at.phone]})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-left mb-6 border-l-4 border-blue-500",children:[a.jsx("p",{className:"text-xs text-blue-600 font-bold uppercase mb-2",children:" Welcome Message"}),a.jsxs("p",{className:"text-sm text-gray-800 italic",children:['"Hi ',at.name,", welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ",at.phone,'."']})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("a",{href:`https://wa.me/+${(mi=at.phone)==null?void 0:mi.replace(/\D/g,"")}?text=${encodeURIComponent(`Hi ${at.name}, welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ${at.phone}.`)}`,target:"_blank",rel:"noopener noreferrer",className:"w-full bg-[#25D366] hover:bg-[#128C7E] text-white font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-md",children:[a.jsx(Ux,{className:"w-5 h-5"})," Send Welcome on WhatsApp"]}),a.jsxs("button",{onClick:()=>{const se=`Hi ${at.name}, welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ${at.phone}.`;navigator.clipboard.writeText(se),p("Copied","Message copied to clipboard!","success")},className:"w-full bg-blue-100 border border-blue-300 hover:bg-blue-200 text-blue-700 font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:[a.jsx(_S,{className:"w-5 h-5"})," Copy Message"]}),a.jsx("button",{onClick:()=>{lt(null),p("Done","Remember to send the message!","info")},className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 rounded-lg transition-colors",children:"Done"})]})]})})})]})},aA=({message:n})=>{const{loading:e,message:t}=Xh();return e?a.jsxs("div",{className:"loader-overlay",role:"status","aria-live":"polite",children:[a.jsx("div",{className:"loader-circle"}),a.jsx("div",{className:"loader-message",children:n||t||"Loading..."})]}):null};let Oo=null;const cV=async(n,e)=>{try{console.log(" Initializing phone authentication...");let t=document.getElementById(e);if(t||(console.log(` Container ${e} not found, creating it`),t=document.createElement("div"),t.id=e,t.style.display="none",document.body.appendChild(t)),Oo){try{Oo.clear()}catch(l){console.warn("Failed to clear existing verifier:",l)}Oo=null}const r=n.trim();console.log(" Sending OTP to:",r),Oo=new KC(Od,e,{size:"invisible",callback:()=>{console.log(" Invisible reCAPTCHA callback")}}),console.log(" Calling signInWithPhoneNumber...");const i=await JC(Od,r,Oo);return console.log(" OTP sent successfully!"),i}catch(t){if(console.error("Phone authentication error:",t),console.error("Error code:",t.code),console.error("Error message:",t.message),Oo){try{Oo.clear()}catch(r){console.warn("Failed to clear verifier:",r)}Oo=null}throw t.code==="auth/invalid-app-credential"?new Error("Firebase app credential error. This usually means: 1) Phone authentication not properly enabled in Firebase Console, 2) API key restrictions, or 3) Enforcement mode not set correctly. Please verify Phone auth is enabled and set to AUDIT mode."):t.code==="auth/invalid-phone-number"?new Error("Invalid phone number format. Please use format like +911234567890"):t.message&&t.message.includes("400")?new Error("SMS delivery failed (400). Possible reasons: 1) Daily SMS quota exceeded (50/day free), 2) Too many requests from this number, 3) Billing issue."):t.code==="auth/quota-exceeded"?new Error("SMS quota exceeded. Daily limit reached."):t}},dV=async(n,e)=>{try{return(await n.confirm(e)).user}catch(t){throw console.error("Phone OTP verification error:",t),t}},uV={"auth/invalid-phone-number":"The phone number entered is invalid. Please check and try again.","auth/missing-phone-number":"Please enter your phone number.","auth/too-many-requests":"Too many attempts. Please try again later or contact support.","auth/quota-exceeded":"SMS quota exceeded. Please try again later.","auth/user-disabled":"This account has been disabled. Contact support for help.","auth/network-request-failed":"Network error. Please check your connection and try again.","auth/code-expired":"The verification code has expired. Please request a new one.","auth/invalid-verification-code":"The code you entered is incorrect. Please try again.","auth/session-expired":"Session expired. Please request a new verification code."};function _N(n){return uV[n]||"An unexpected error occurred. Please try again."}const hV=()=>{const{user:n,adminCredentials:e}=ha(),{addNotification:t}=al(),{showLoading:r,hideLoading:i}=Xh(),[l,c]=W.useState(""),[u,p]=W.useState(""),[g,b]=W.useState(""),[w,N]=W.useState(""),[D,z]=W.useState("email"),[L,O]=W.useState(!1),le=async ge=>{if(ge.preventDefault(),!l)return t("Validation Error","Please enter a name","error");if(!w)return t("Validation Error","Please enter a business name","error");if(!g)return t("Validation Error","Please enter a phone number","error");if(D==="email"&&!u)return t("Validation Error","Please enter an email","error");O(!0),r("Creating admin...");try{const xe=(g||"").replace(/\D/g,"").slice(-6)||"admin123",j={id:"",name:l,email:D==="email"?u:"",role:F.ADMIN,company:w||void 0,phone:g||void 0,password:xe,authMethod:D};n&&n.tenantId&&(j.tenantId=n.tenantId);const ie=await iA(j,n==null?void 0:n.email,e==null?void 0:e.password);t("Success",`Admin account created. Password: last 6 digits of ${g}`,"success"),c(""),p(""),b(""),N("")}catch(ae){console.error("Error creating admin:",ae),t("Error",ae.message||"Failed to create admin","error")}finally{O(!1),i()}};return a.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col font-sans",children:[a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),a.jsx("div",{className:"flex-1 flex items-center justify-center p-4 mt-[env(safe-area-inset-top,24px)]",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden max-w-5xl w-full flex flex-col md:flex-row min-h-[600px]",children:[a.jsxs("div",{className:"md:w-5/12 bg-gray-900 p-8 md:p-12 text-white flex flex-col justify-between relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2"}),a.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-white opacity-5 rounded-full translate-x-1/3 translate-y-1/3"}),a.jsxs("div",{className:"relative z-10",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[a.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-10 h-10 rounded-lg"}),a.jsx("span",{className:"text-2xl font-bold tracking-tight",children:"Kydo Solutions"})]}),a.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6 leading-tight",children:"Manage your business with confidence."}),a.jsx("p",{className:"text-gray-400 text-lg mb-8",children:"Create your admin account to access powerful tools for project management, financial tracking, and team collaboration."})]}),a.jsxs("div",{className:"space-y-4 relative z-10",children:[a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[a.jsx(vj,{className:"w-8 h-8 text-gray-300"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Enterprise Security"}),a.jsx("p",{className:"text-sm text-gray-400",children:"High-Level encryption for your data"})]})]}),a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[a.jsx(Lj,{className:"w-8 h-8 text-gray-300"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Quick Setup"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Get started in less than 2 minutes"})]})]})]})]}),a.jsx("div",{className:"md:w-7/12 p-8 md:p-12 bg-white overflow-y-auto",children:a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Create Admin Account"}),a.jsx("p",{className:"text-gray-500",children:"Enter your details to set up your workspace."})]}),a.jsxs("form",{onSubmit:le,className:"space-y-5",children:[a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"fullName",className:"text-sm font-medium text-gray-700",children:"Full Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(CN,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"fullName",placeholder:"e.g. Rajesh Kumar",value:l,onChange:ge=>c(ge.target.value),className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"businessName",className:"text-sm font-medium text-gray-700",children:"Business Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(AN,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"businessName",placeholder:"e.g. Kydo Interiors",value:w,onChange:ge=>N(ge.target.value),className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"phone",className:"text-sm font-medium text-gray-700",children:"Phone Number"}),a.jsxs("div",{className:"relative",children:[a.jsx(Lp,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"phone",type:"tel",placeholder:"+91 9876543210",value:g,onChange:ge=>b(ge.target.value),title:"Include country code, e.g. +91 for India",className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]}),a.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[a.jsx(xp,{className:"w-3 h-3 text-green-500"}),"Last 6 digits will be your password"]})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"adminEmail",className:"text-sm font-medium text-gray-700",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Vp,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"adminEmail",placeholder:"admin@example.com",value:u,onChange:ge=>p(ge.target.value),type:"email",className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),a.jsxs("div",{className:"pt-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Preferred Login Method"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{type:"button",onClick:()=>z("email"),className:`py-2.5 px-4 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 border ${D==="email"?"bg-gray-900 border-gray-900 text-white ring-1 ring-gray-900":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:[a.jsx(Vp,{className:"w-4 h-4"}),"Email Login"]}),a.jsxs("button",{type:"button",onClick:()=>z("phone"),className:`py-2.5 px-4 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 border ${D==="phone"?"bg-gray-900 border-gray-900 text-white ring-1 ring-gray-900":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:[a.jsx(Lp,{className:"w-4 h-4"}),"Phone Login"]})]})]}),a.jsx("div",{className:"flex justify-center pt-2",children:a.jsx("button",{type:"submit",disabled:L,className:"px-10 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold py-2.5 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-600/20",children:L?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):a.jsxs(a.Fragment,{children:["Create Admin Account",a.jsx(Hl,{className:"w-4 h-4"})]})})}),a.jsx("div",{className:"text-center mt-6",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",a.jsx("a",{href:"/",className:"font-semibold text-blue-600 hover:text-blue-700 hover:underline transition-colors",children:"Sign In"})]})})]})]})})]})})]})},mV=({users:n=[]})=>{const{login:e,setAdminCredentials:t}=ha(),{addNotification:r}=al(),{showLoading:i,hideLoading:l}=Xh(),[c,u]=W.useState(""),[p,g]=W.useState(""),[b,w]=W.useState("+91 "),[N,D]=W.useState(""),[z,L]=W.useState(""),[O,le]=W.useState(!1),[ge,ae]=W.useState(!1),[xe,j]=W.useState("email"),[ie,k]=W.useState(!1),[R,M]=W.useState(null),[q,U]=W.useState(!0);if((typeof window<"u"?new URLSearchParams(window.location.search).get("open"):null)==="admins")return a.jsx(hV,{});const V=async Te=>{if(Te.preventDefault(),ae(!0),L(""),!c||!p){r("Validation Error","Please fill in all required fields.","error");return}le(!0),i("Signing in...");try{const Ie=await IC(Od,c,p);t({email:c,password:p}),sessionStorage.setItem("adminEmail",c),sessionStorage.setItem("adminPassword",p);let fe=null;try{fe=await Cy(Ie.user.uid)}catch(P){console.warn("Could not fetch user profile:",P)}if(!fe){const P="Account not found. Please contact your administrator to set up your account.";L(P),r("Account Not Found",P,"error"),await A1(Od),le(!1),l();return}if(q){const P=r6();s6(P),r("Device Remembered","This device will be remembered for 30 days","success")}e(fe),L("")}catch(Ie){console.error("Firebase login error:",Ie);let fe="Invalid credentials.";Ie.code==="auth/user-not-found"?fe="Email not found.":Ie.code==="auth/wrong-password"?fe="Incorrect password.":Ie.code==="auth/invalid-email"&&(fe="Invalid email format."),L(fe),r("Login Failed",fe,"error")}finally{le(!1),l()}},Fe=async Te=>{if(Te.preventDefault(),ae(!0),L(""),!b){r("Validation Error","Please enter your phone number.","error");return}le(!0),i("Sending OTP...");try{let Ie=b.replace(/[\s\-()]/g,"");Ie.startsWith("+")||(Ie=`+91${Ie}`),l();const fe=await cV(Ie,"recaptcha-container");M(fe),k(!0),r("Success","OTP sent to your phone number.","success"),L("")}catch(Ie){console.error("Phone OTP error:",Ie);let fe=_N(Ie.code);Ie.code==="auth/too-many-requests"&&(fe+=" You have reached the maximum number of attempts. Please wait a few minutes before trying again."),L(fe),r("Error",fe,"error")}finally{le(!1),l()}},ue=async Te=>{if(Te.preventDefault(),ae(!0),L(""),!N){r("Validation Error","Please enter the OTP.","error");return}le(!0),i("Verifying OTP...");try{const Ie=await dV(R,N);let fe=null;try{fe=await Cy(Ie.uid),!fe&&Ie.phoneNumber&&(fe=await HT(Ie.uid,Ie.phoneNumber))}catch(P){console.warn("Could not fetch user profile:",P)}if(!fe){L("User profile not found. Please contact your administrator to set up your account."),r("Profile Not Found","Your profile has not been created yet. Please contact the administrator.","error"),k(!1),D("");return}e(fe),L("")}catch(Ie){console.error("OTP verification error:",Ie);let fe=_N(Ie.code);L(fe),r("Verification Failed",fe,"error")}finally{le(!1),l()}};return a.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),a.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 mt-[env(safe-area-inset-top,24px)]",children:[O&&a.jsx(aA,{message:"Signing in..."}),a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full overflow-hidden flex flex-col md:flex-row",children:[a.jsxs("div",{className:"md:w-1/2 bg-gray-900 p-12 text-white flex flex-col justify-between relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2"}),a.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-white opacity-5 rounded-full translate-x-1/3 translate-y-1/3"}),a.jsxs("div",{className:"relative z-10",children:[a.jsx("img",{src:"/kydoicon.png",alt:"Kydo Solutions Logo",className:"h-12 w-12 mb-6 rounded-lg"}),a.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Kydo Solutions"}),a.jsx("p",{className:"text-gray-400 text-lg leading-relaxed",children:"Manage your interior design projects, clients, and vendors in one seamless platform."})]}),a.jsx("div",{className:"mt-12 relative z-10",children:a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[a.jsx(xh,{className:"w-8 h-8 text-gray-300"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Secure Access"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Role-Based Access Control"})]})]})})]}),a.jsxs("div",{className:"md:w-1/2 p-12 bg-white flex flex-col justify-center",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Sign In"}),a.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[a.jsxs("button",{type:"button",onClick:()=>{j("email"),k(!1),L(""),ae(!1),w("+91 "),D("")},className:`pb-3 px-4 font-medium border-b-2 transition-colors flex items-center gap-2 ${xe==="email"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[a.jsx(Vp,{className:"w-4 h-4"}),"Email"]}),a.jsxs("button",{type:"button",onClick:()=>{j("phone"),k(!1),L(""),ae(!1),u(""),g("")},className:`pb-3 px-4 font-medium border-b-2 transition-colors flex items-center gap-2 ${xe==="phone"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[a.jsx(Lp,{className:"w-4 h-4"}),"Phone"]})]})]}),xe==="email"&&a.jsxs("form",{onSubmit:V,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"email",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 ${ge&&!c?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"Enter your email",value:c,onChange:Te=>u(Te.target.value),disabled:O})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"password",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 ${ge&&!p?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"Enter password",value:p,onChange:Te=>g(Te.target.value),disabled:O})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:q,onChange:Te=>U(Te.target.checked),disabled:O,className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Remember this device for 30 days"})]}),z&&a.jsx("p",{className:"text-sm text-red-500 font-medium",children:z}),a.jsxs("button",{type:"submit",disabled:O,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[O?"Signing in...":"Login"," ",!O&&a.jsx(Hl,{className:"w-4 h-4"})]}),a.jsx("div",{className:"mt-3 text-center",children:a.jsx("a",{href:"?open=admins",className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Create Admin account"})})]}),xe==="phone"&&a.jsx(a.Fragment,{children:ie?a.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Enter OTP ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["OTP sent to ",b]}),a.jsx("input",{type:"text",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 text-center tracking-widest ${ge&&!N?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"000000",value:N,onChange:Te=>D(Te.target.value.replace(/\D/g,"").slice(0,6)),disabled:O,maxLength:6})]}),z&&a.jsx("p",{className:"text-sm text-red-500 font-medium",children:z}),a.jsxs("button",{type:"submit",disabled:O,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[O?"Verifying...":"Verify OTP"," ",!O&&a.jsx(Hl,{className:"w-4 h-4"})]}),a.jsx("button",{type:"button",onClick:()=>{k(!1),D(""),L("")},className:"w-full text-blue-600 hover:text-blue-700 font-medium py-2",children:"Send OTP Again"})]}):a.jsxs("form",{onSubmit:Fe,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"tel",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 ${ge&&!b?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"+91 9876543210",value:b,onChange:Te=>w(Te.target.value),disabled:O}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Include country code (e.g., +91 for India)"})]}),a.jsx("div",{id:"recaptcha-container"}),z&&a.jsx("p",{className:"text-sm text-red-500 font-medium",children:z}),a.jsxs("button",{type:"submit",disabled:O,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[O?"Sending OTP...":"Send OTP"," ",!O&&a.jsx(Hl,{className:"w-4 h-4"})]})]})})]})]})]})]})},pV=({isOpen:n,onClose:e,projects:t,onSelectProject:r})=>{const{notifications:i,markAsRead:l,markAllAsRead:c,clearNotifications:u}=al(),p=g=>{if(l(g.id),g.projectId&&r){const b=t.find(w=>w.id===g.projectId);b&&(r==null||r(b),e())}};return n?a.jsxs("div",{className:"fixed sm:absolute right-1/2 sm:right-0 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 top-12 w-[calc(100%-2rem)] sm:w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-100 z-50 overflow-hidden animate-fade-in",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[a.jsx("h3",{className:"font-semibold text-gray-800",children:"Notifications"}),a.jsx("div",{className:"flex gap-2",children:i.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:c,className:"text-xs text-blue-600 hover:text-blue-800 font-medium px-2 py-1 rounded hover:bg-blue-50",title:"Mark all as read",children:"Mark all read"}),a.jsx("button",{onClick:u,className:"text-gray-400 hover:text-red-600 p-1 rounded hover:bg-red-50",title:"Clear all",children:a.jsx(Ts,{className:"w-4 h-4"})})]})})]}),a.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:i.length===0?a.jsxs("div",{className:"p-8 text-center text-gray-400 flex flex-col items-center",children:[a.jsx(Op,{className:"w-8 h-8 mb-2 opacity-20"}),a.jsx("p",{className:"text-sm",children:"No new notifications"})]}):a.jsx("div",{className:"divide-y divide-gray-50",children:i.map(g=>a.jsx("div",{onClick:()=>p(g),className:`p-4 hover:bg-gray-50 transition-colors relative group cursor-pointer ${g.read?"opacity-60":"bg-blue-50/30"}`,children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:`mt-1 w-2 h-2 rounded-full flex-shrink-0 ${g.type==="error"?"bg-red-500":g.type==="warning"?"bg-yellow-500":g.type==="success"?"bg-green-500":"bg-blue-500"}`}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:`text-sm font-medium ${g.read?"text-gray-700":"text-gray-900"}`,children:g.title}),a.jsx("p",{className:"text-xs text-gray-500 mt-0.5 leading-relaxed",children:g.message}),a.jsx("p",{className:"text-[10px] text-gray-400 mt-2",children:new Date(g.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),!g.read&&a.jsx("button",{onClick:b=>{b.stopPropagation(),l(g.id)},className:"absolute top-4 right-4 text-blue-400 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(Ol,{className:"w-4 h-4"})})]})},g.id))})})]}):null},fV=({users:n,onClose:e,onSave:t,initialProject:r})=>{const{addNotification:i}=al(),{user:l}=ha(),{createNewProject:c,updateExistingProject:u}=sA(),[p,g]=W.useState(!1),b=!!r,w=new Date().toISOString().split("T")[0],[N,D]=W.useState(r?{name:r.name,tenantId:r.tenantId,status:r.status,type:r.type,category:r.category,description:r.description,budget:r.budget,startDate:r.startDate,deadline:r.deadline,clientId:r.clientId,clientIds:r.clientIds||[r.clientId],leadDesignerId:r.leadDesignerId}:{name:"",tenantId:(l==null?void 0:l.tenantId)||(l==null?void 0:l.id)||"",status:jn.DISCOVERY,type:$l.DESIGNING,category:Vo.COMMERCIAL,description:"",budget:void 0,startDate:w,deadline:w,clientId:"",clientIds:[],leadDesignerId:""}),[z,L]=W.useState(!1),[O,le]=W.useState(null),[ge,ae]=W.useState([]),xe=W.useRef(null),j=W.useRef(null),ie=()=>{if(N.clientIds&&N.clientIds.length>0?N.clientIds:N.clientId&&N.clientId,!N.name||!N.leadDesignerId||!N.startDate||!N.deadline||!N.budget)return L(!0),i("Validation Error","Please complete all required fields marked in red.","error"),!1;if(!/^\d{4}-\d{2}-\d{2}$/.test(N.startDate||""))return i("Invalid Date","Start date must be in YYYY-MM-DD format.","error"),!1;if(!/^\d{4}-\d{2}-\d{2}$/.test(N.deadline||""))return i("Invalid Date","Deadline must be in YYYY-MM-DD format.","error"),!1;const ue=new Date(N.startDate),Te=new Date(N.deadline);return isNaN(ue.getTime())?(i("Invalid Date","Start date is not a valid date.","error"),!1):isNaN(Te.getTime())?(i("Invalid Date","Deadline is not a valid date.","error"),!1):Te<ue?(i("Invalid Date Range","Deadline must be on or after the start date.","error"),!1):!0},k=async ue=>{if(ue.preventDefault(),!!ie()){g(!0);try{if(b&&r){const Te=N.clientIds&&N.clientIds.length>0?N.clientIds:N.clientId?[N.clientId]:[],Ie={name:N.name,clientId:Te[0]||"",clientIds:Te,tenantId:r.tenantId||(l==null?void 0:l.tenantId)||(l==null?void 0:l.id)||"",leadDesignerId:N.leadDesignerId,status:N.status||jn.DISCOVERY,type:N.type,category:N.category,startDate:N.startDate,deadline:N.deadline,budget:Number(N.budget),description:N.description||""};if(Ie.updatedBy=(l==null?void 0:l.id)||"",Ie.updatedAt=new Date().toISOString(),O)try{const P=Date.now(),H=O.name.replace(/\s+/g,"_"),$=Zu(eh,`thumbnails/${r.id}/${P}_${H}`);await Ju($,O),Ie.thumbnail=await Xu($)}catch(P){console.error("Cover image upload failed:",P),i("Warning","Project updated but cover image upload failed.","warning")}if(ge.length>0){const P=[];for(let H=0;H<ge.length;H++){const $=ge[H];try{const oe=Date.now(),we=$.file.name.replace(/\s+/g,"_"),he=Zu(eh,`documents/${r.id}/${oe}_${we}`);await Ju(he,$.file);const ke=await Xu(he);let me="other";$.file.type.startsWith("image/")?me="image":$.file.type==="application/pdf"&&(me="pdf");const $e={id:`doc_${oe}_${H}`,name:$.name||$.file.name,type:me,url:ke,uploadedBy:(l==null?void 0:l.id)||"system",uploadDate:new Date().toISOString(),sharedWith:[F.ADMIN,F.DESIGNER,F.CLIENT],approvalStatus:"pending"};P.push($e),await Dy(r.id,$e)}catch(oe){console.error(`Document upload failed for ${$.name}:`,oe),i("Warning",`Failed to upload document: ${$.name}`,"warning")}}Ie.documents=[...r.documents||[],...P]}await u(r.id,Ie);const fe={...r,...Ie};t(fe),e(),i("Success",`Project "${N.name}" has been updated successfully.`,"success")}else{const Te=N.clientIds&&N.clientIds.length>0?N.clientIds:N.clientId?[N.clientId]:[],Ie={name:N.name,clientId:Te[0]||"",clientIds:Te,tenantId:(l==null?void 0:l.tenantId)||(l==null?void 0:l.id)||"",leadDesignerId:N.leadDesignerId,status:N.status||jn.DISCOVERY,type:N.type,category:N.category,startDate:N.startDate,deadline:N.deadline,budget:Number(N.budget),initialBudget:Number(N.budget),thumbnail:"",description:N.description||"",tasks:[],financials:[],meetings:[],documents:[],activityLog:[{id:`log_${Date.now()}`,userId:(l==null?void 0:l.id)||"system",action:"Project Created",details:"Project initialized via Admin Dashboard",timestamp:new Date().toISOString(),type:"creation"}],createdBy:(l==null?void 0:l.id)||"",createdAt:new Date().toISOString()},fe=await c(Ie);let P;if(O)try{const we=Date.now(),he=O.name.replace(/\s+/g,"_"),ke=Zu(eh,`thumbnails/${fe}/${we}_${he}`);await Ju(ke,O),P=await Xu(ke)}catch(we){console.error("Cover image upload failed:",we),i("Warning","Project created but cover image upload failed. You can add it later.","warning")}const H=[];for(let we=0;we<ge.length;we++){const he=ge[we];try{const ke=Date.now(),me=he.file.name.replace(/\s+/g,"_"),$e=Zu(eh,`documents/${fe}/${ke}_${me}`);await Ju($e,he.file);const pt=await Xu($e);let at="other";he.file.type.startsWith("image/")?at="image":he.file.type==="application/pdf"&&(at="pdf");const lt={id:`doc_${ke}_${we}`,name:he.name||he.file.name,type:at,url:pt,uploadedBy:(l==null?void 0:l.id)||"system",uploadDate:new Date().toISOString(),sharedWith:[F.ADMIN,F.DESIGNER,F.CLIENT],approvalStatus:"pending"};H.push(lt),await Dy(fe,lt)}catch(ke){console.error(`Document upload failed for ${he.name}:`,ke),i("Warning",`Failed to upload document: ${he.name}`,"warning")}}const $={};P&&($.thumbnail=P),H.length>0&&($.documents=H),Object.keys($).length>0&&await u(fe,$);const oe={...Ie,id:fe,thumbnail:P,documents:H};t(oe),e(),i("Success",`Project "${N.name}" has been created with ${H.length} document(s).`,"success")}}catch(Te){console.error("Project operation failed:",Te),i("Error",`Failed to ${b?"update":"create"} project: ${Te.message}`,"error")}finally{g(!1)}}},R=n.filter(ue=>ue.role===F.CLIENT),M=n.filter(ue=>ue.role===F.DESIGNER),[q,U]=W.useState(!1),K=W.useRef(null);W.useEffect(()=>{const ue=Te=>{K.current&&!K.current.contains(Te.target)&&U(!1)};return document.addEventListener("mousedown",ue),()=>document.removeEventListener("mousedown",ue)},[]);const V=(ue,Te)=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(Te)&&Te!=="")return;const Ie={...N,[ue]:Te};ue==="startDate"&&Ie.deadline&&new Date(Te)>new Date(Ie.deadline)&&(Ie.deadline=Te),D(Ie)},Fe=ue=>`
    w-full px-4 py-2 border rounded-lg focus:outline-none transition-all
    bg-white text-gray-900 placeholder-gray-400 text-base md:text-sm
    ${z&&!ue?"border-red-500 ring-1 ring-red-500":"border-gray-200 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}
  `;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-100 bg-white sticky top-0 z-10",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:b?"Edit Project":"Create New Project"}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close modal",children:a.jsx(_n,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:k,className:"p-8 space-y-6 bg-white",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Project Name ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",className:Fe(N.name),placeholder:"e.g. House Renovation",value:N.name,onChange:ue=>D({...N,name:ue.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Description"}),a.jsx("textarea",{className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none h-24 resize-none bg-white text-gray-900 placeholder-gray-400",placeholder:"Briefly describe the scope of work...",value:N.description,onChange:ue=>D({...N,description:ue.target.value})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Clients"}),a.jsxs("div",{className:"relative",ref:K,children:[a.jsx("button",{type:"button",onClick:()=>U(ue=>!ue),className:"w-full text-left px-3 py-2 border rounded-lg bg-white border-gray-300",title:"Select clients",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-gray-700 truncate",children:N.clientIds&&N.clientIds.length>0?`${N.clientIds.length} client${N.clientIds.length!==1?"s":""} selected`:"Select clients..."}),a.jsx("div",{className:"text-gray-400",children:q?"":""})]})}),q&&a.jsx("div",{className:"absolute z-30 left-0 right-0 mt-2 bg-white border border-gray-200 rounded-md shadow-md max-h-48 overflow-y-auto",children:R.length===0?a.jsx("p",{className:"text-gray-500 text-sm p-3",children:"No clients available"}):R.map(ue=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",checked:(N.clientIds||[]).includes(ue.id),onChange:Te=>{const Ie=N.clientIds||[],fe=Te.target.checked?[...Ie,ue.id]:Ie.filter(P=>P!==ue.id);D({...N,clientIds:fe,clientId:fe[0]||""})},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:ue.name})]},ue.id))})]}),N.clientIds&&N.clientIds.length>0&&a.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[N.clientIds.length," client",N.clientIds.length!==1?"s":""," selected"]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Lead Designer ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{className:Fe(N.leadDesignerId),value:N.leadDesignerId,onChange:ue=>D({...N,leadDesignerId:ue.target.value}),title:"Select the lead designer for the project",children:[a.jsx("option",{value:"",children:"Select Designer..."}),M.map(ue=>a.jsx("option",{value:ue.id,children:ue.name},ue.id))]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Project Type ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{className:Fe(N.type),value:N.type||"",onChange:ue=>D({...N,type:ue.target.value}),title:"Select the project type (Designing or Turnkey)",children:[a.jsx("option",{value:"",children:"Select Type..."}),a.jsx("option",{value:$l.DESIGNING,children:$l.DESIGNING}),a.jsx("option",{value:$l.TURNKEY,children:$l.TURNKEY})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Category ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{className:Fe(N.category),value:N.category||"",onChange:ue=>D({...N,category:ue.target.value}),title:"Select the project category (Commercial or Residential)",children:[a.jsx("option",{value:"",children:"Select Category..."}),a.jsx("option",{value:Vo.COMMERCIAL,children:Vo.COMMERCIAL}),a.jsx("option",{value:Vo.RESIDENTIAL,children:Vo.RESIDENTIAL})]})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[a.jsx(Mp,{className:"w-3 h-3 text-gray-400"})," Start Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"date",className:Fe(N.startDate),value:N.startDate||"",onChange:ue=>V("startDate",ue.target.value),title:"Select the project start date"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[a.jsx(Mp,{className:"w-3 h-3 text-gray-400"})," Deadline ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"date",className:Fe(N.deadline),value:N.deadline||"",onChange:ue=>V("deadline",ue.target.value),title:"Select the project deadline date"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[a.jsx(yp,{className:"w-3 h-3 text-gray-400"})," Budget ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",className:Fe(N.budget),placeholder:"0.00",value:N.budget||"",onChange:ue=>D({...N,budget:Number(ue.target.value)}),title:"Enter the total project budget"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Cover Image (Optional)"}),a.jsxs("div",{className:"flex gap-2 items-start",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-2 text-center cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{var ue;return(ue=xe.current)==null?void 0:ue.click()},children:[O?a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.jsx(Bb,{className:"w-3 h-3 text-blue-500"}),a.jsx("span",{className:"text-base md:text-sm text-gray-700 truncate",children:O.name})]}):a.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[a.jsx(Bb,{className:"w-4 h-4 text-gray-300"}),a.jsx("p",{className:"text-base md:text-sm text-gray-500",children:"Upload image"})]}),a.jsx("input",{ref:xe,type:"file",accept:"image/*",onChange:ue=>{var Ie;const Te=(Ie=ue.target.files)==null?void 0:Ie[0];Te&&le(Te)},className:"hidden",title:"Upload cover image"})]})}),O&&a.jsx("div",{className:"w-16 h-16 rounded-lg border border-gray-200 overflow-hidden bg-gray-50 flex-shrink-0",children:a.jsx("img",{src:URL.createObjectURL(O),alt:"Cover preview",className:"w-full h-full object-cover"})})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Attached Documents (Optional)"}),ge.length>0&&a.jsxs("span",{className:"text-base md:text-sm text-gray-500",children:[ge.length," file(s)"]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("button",{type:"button",onClick:()=>{var ue;return(ue=j.current)==null?void 0:ue.click()},className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-2 text-center cursor-pointer hover:bg-gray-50 transition-colors flex items-center justify-center gap-1",children:[a.jsx(Uu,{className:"w-3 h-3 text-gray-500"}),a.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Add documents"})]}),a.jsx("input",{ref:j,type:"file",multiple:!0,onChange:ue=>{const Te=ue.target.files;if(Te){const Ie=Array.from(Te).map(fe=>({file:fe,name:fe.name}));ae([...ge,...Ie])}},className:"hidden",title:"Upload documents"}),ge.length>0&&a.jsx("div",{className:"space-y-0.5 max-h-24 overflow-y-auto bg-gray-50 p-1 rounded border border-gray-200",children:ge.map((ue,Te)=>a.jsxs("div",{className:"flex items-center justify-between bg-white p-1 rounded border border-gray-200 text-base md:text-sm",children:[a.jsx("span",{className:"text-gray-700 truncate flex-1",children:ue.name}),a.jsx("button",{type:"button",onClick:()=>ae(ge.filter((Ie,fe)=>fe!==Te)),className:"text-red-500 hover:text-red-700 transition-colors ml-1",title:"Remove document",children:a.jsx(Ts,{className:"w-2.5 h-2.5"})})]},Te))})]})]}),a.jsxs("div",{className:"pt-2 border-t border-gray-100 flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:e,disabled:p,className:"px-4 py-1.5 rounded-lg text-base md:text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors disabled:opacity-50",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:p,className:"px-6 py-1.5 rounded-lg text-base md:text-sm font-bold text-white bg-gray-900 hover:bg-gray-800 shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:p?a.jsxs(a.Fragment,{children:[a.jsx(QS,{className:"w-3 h-3 animate-spin"}),b?"Updating...":"Saving..."]}):b?"Update Project":"Launch Project"})]})]})]})})},gV=()=>{const[n,e]=W.useState([]),[t,r]=W.useState("");W.useEffect(()=>{i()},[]);const i=()=>{const u=i6(),p=a6();e(u),r(p)},l=u=>{o6(u),e(n.filter(p=>p.id!==u))},c=u=>{const p=new Date(u),b=new Date().getTime()-p.getTime(),w=Math.floor(b/(1e3*60*60*24));if(w===0){const N=Math.floor(b/36e5);if(N===0){const D=Math.floor(b/6e4);return`${D} minute${D>1?"s":""} ago`}return`${N} hour${N>1?"s":""} ago`}return w===1?"Yesterday":w<7?`${w} days ago`:p.toLocaleDateString("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[a.jsx(ox,{className:"w-5 h-5"}),"Remembered Devices (",n.length,")"]}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Manage devices that have been remembered for automatic login"})]}),n.length===0?a.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[a.jsx(ox,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-600",children:"No remembered devices"}),a.jsx("p",{className:"text-sm text-gray-500",children:'Next time you log in, check "Remember this device"'})]}):a.jsx("div",{className:"space-y-3",children:n.map(u=>{const p=u.id===t;return a.jsxs("div",{className:`border rounded-lg p-4 flex items-center justify-between ${p?"bg-blue-50 border-blue-200":"bg-white border-gray-200 hover:border-gray-300"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[a.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${p?"bg-blue-100":"bg-gray-100"}`,children:a.jsx(ox,{className:`w-5 h-5 ${p?"text-blue-600":"text-gray-600"}`})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"font-semibold text-gray-900",children:u.name}),p&&a.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs font-semibold px-2 py-1 rounded",children:"This Device"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[a.jsx(th,{className:"w-3 h-3"}),a.jsxs("span",{children:["Last login: ",c(u.lastLogin)]})]}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Added: ",c(u.createdAt)]})]})]}),a.jsx("button",{onClick:()=>l(u.id),className:"ml-4 p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:`Forget this device${p?" (will require login next time)":""}`,children:a.jsx(Ts,{className:"w-4 h-4"})})]},u.id)})}),a.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 text-sm text-amber-900",children:[a.jsxs("p",{className:"font-semibold mb-1",children:[a.jsx(jN,{className:"w-4 h-4 inline-block mr-2"})," About Device Memory"]}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[a.jsx("li",{children:"Devices are remembered for 30 days of inactivity"}),a.jsx("li",{children:"Each login extends the 30-day period"}),a.jsx("li",{children:"Forgetting a device requires manual login next time"}),a.jsx("li",{children:"Device fingerprints are stored locally in your browser"})]})]})]})},xV=()=>{const{extendSession:n}=ha(),[e,t]=W.useState(!1),[r,i]=W.useState("");return W.useEffect(()=>{const l=()=>{m6()&&(t(!0),i(h6()))};l();const c=setInterval(l,6e4);return()=>clearInterval(c)},[]),e?a.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in",children:a.jsx("div",{className:"bg-amber-50 border border-amber-300 rounded-lg shadow-lg p-4 max-w-sm",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx(Ma,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-amber-900 mb-1",children:"Session Expiring Soon"}),a.jsxs("p",{className:"text-sm text-amber-800 mb-3 flex items-center gap-1",children:[a.jsx(th,{className:"w-3 h-3"}),r]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>{n(),t(!1)},className:"flex-1 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium py-2 rounded transition-colors",children:"Extend Session"}),a.jsx("button",{onClick:()=>t(!1),className:"px-3 py-2 text-amber-700 hover:bg-amber-100 rounded transition-colors",title:"Dismiss warning",children:a.jsx(_n,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-xs text-amber-700 mt-2",children:"After expiry, you'll need to log in again."})]})]})})}):null},yV=({projects:n,onSelect:e,user:t,setEditingProject:r,setIsNewProjectModalOpen:i,onDeleteProject:l,realTimeTasks:c})=>{const[u,p]=W.useState({}),g=N=>N===$l.DESIGNING?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700",b=n.reduce((N,D)=>{const z=D.category;return N[z]||(N[z]=[]),N[z].push(D),N},{}),w=Object.keys(b).sort((N,D)=>N===Vo.COMMERCIAL?-1:D===Vo.COMMERCIAL?1:0);return a.jsx("div",{className:"space-y-8 animate-fade-in",children:w.map(N=>a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx($p,{className:"w-5 h-5 text-gray-600"}),a.jsx("h2",{className:"text-lg font-bold text-gray-800",children:N}),a.jsxs("span",{className:"text-xs font-bold bg-gray-100 text-gray-600 px-2 py-1 rounded-full mobile-increase",children:[b[N].length," projects"]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b[N].map(D=>a.jsxs("div",{onClick:()=>e(D),className:"group bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-300",children:[a.jsxs("div",{className:"h-40 overflow-hidden relative bg-gray-100",children:[u[D.id]&&a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-100 via-gray-50 to-gray-100 animate-pulse"}),a.jsx("img",{src:D.thumbnail,alt:D.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onLoad:()=>p(z=>({...z,[D.id]:!1})),onLoadStart:()=>p(z=>({...z,[D.id]:!0}))}),a.jsx("div",{className:"absolute top-3 right-3 flex gap-2 items-center",children:a.jsx("div",{className:`backdrop-blur-md px-3 py-1 rounded text-sm font-bold md:px-2 md:text-xs md:font-bold shadow-sm border border-white/20 ${g(D.type)}`,children:D.type})}),D.activityLog&&D.activityLog.length>0&&new Date().getTime()-new Date(D.activityLog[0].timestamp).getTime()<864e5&&a.jsx("div",{className:"absolute bottom-3 right-3 w-3 h-3 bg-blue-500 rounded-full border-2 border-white animate-pulse",title:"New Activity"})]}),a.jsxs("div",{className:"p-5",children:[a.jsx("h3",{className:"font-bold text-gray-900 text-lg mb-1 mobile-increase",children:D.name}),a.jsx("p",{className:"text-base text-gray-600 md:text-sm md:text-gray-500 mb-4 line-clamp-2 mobile-increase",children:D.description}),a.jsxs("div",{className:"mt-2",children:[a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"text-gray-500 text-[10px]",children:"Progress"}),a.jsxs("span",{className:"text-gray-900 font-bold text-[10px]",children:[gh(c.get(D.id)||D.tasks),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5",children:a.jsx("div",{style:{width:`${gh(c.get(D.id)||D.tasks)}%`},className:"bg-gray-900 h-1.5 rounded-full transition-all duration-1000"})})]}),a.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-4 mt-3",children:[a.jsx("div",{className:"flex items-center gap-2",children:(t==null?void 0:t.role)===F.ADMIN&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:z=>{z.stopPropagation(),r(D),i(!0)},className:"p-2 rounded text-xs font-bold shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors",title:"Edit project",children:a.jsx(qx,{className:"w-4 h-4 text-gray-900"})}),a.jsx("button",{onClick:z=>{z.stopPropagation(),window.confirm(`Are you sure you want to delete project "${D.name}"? This action cannot be undone.`)&&l(D)},className:"p-2 rounded text-xs font-bold shadow-sm border border-gray-200 hover:bg-red-50 transition-colors",title:"Delete project",children:a.jsx(Ts,{className:"w-4 h-4 text-red-600"})})]})}),a.jsxs("span",{className:"text-sm font-medium text-gray-600 md:text-xs md:text-gray-400 mobile-increase",children:["Due ",ln(D.deadline)]})]})]})]},D.id))})]},N))})};function vV(){const[n,e]=W.useState([]),[t,r]=W.useState([]);return a.jsx(f6,{children:a.jsx(g6,{projects:n,children:a.jsx(x6,{children:a.jsx(bV,{projects:n,setProjects:e,users:t,setUsers:r})})})})}function bV({projects:n,setProjects:e,users:t,setUsers:r}){const{user:i,logout:l,loading:c}=ha(),{unreadCount:u,addNotification:p}=al(),[g,b]=W.useState(()=>i&&i.role===F.CLIENT?"projects":"dashboard"),[w,N]=W.useState(null),[D,z]=W.useState(null),[L,O]=W.useState(!1),[le,ge]=W.useState(void 0),[ae,xe]=W.useState(null),[j,ie]=W.useState(!1),[k,R]=W.useState(!1),[M,q]=W.useState(!1),[U,K]=W.useState(!1),[V,Fe]=W.useState(null),[ue,Te]=W.useState(!0),[Ie,fe]=W.useState(new Map),[P,H]=W.useState(!1);W.useEffect(()=>{i&&((async()=>{if(Yo.isNativePlatform())await Px(i.id);else if("Notification"in window){const Oe=Notification.permission;Oe==="default"?H(!0):Oe==="granted"&&await Px(i.id)}})(),F6(Oe=>{p({title:Oe.title,message:Oe.message||Oe.body,type:"info"})}).catch(Oe=>console.log("failed: ",Oe)))},[i]);const $=async()=>{i&&await Px(i.id)&&(H(!1),!Yo.isNativePlatform()&&Notification.permission==="granted"?new Notification("Notifications Enabled! ",{body:"You will now receive push notifications for project updates",icon:"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png"}):Yo.isNativePlatform()&&p({title:"Notifications Enabled! ",message:"You will now receive push notifications for project updates",type:"success"}))};if(W.useEffect(()=>{try{if(typeof window<"u"){const Be=new URLSearchParams(window.location.search),zt=Be.get("projectId")||Be.get("project")||void 0,_t=Be.get("taskId")||Be.get("task")||void 0,Tt=Be.get("meetingId")||void 0,jt=Be.get("tab")||void 0,Yr=Be.get("open")||void 0;(zt||_t||Tt||jt||Yr)&&xe({projectId:zt,taskId:_t,meetingId:Tt,tab:jt,open:Yr})}}catch{}if(!i)return;Te(!1);let Re;Re=YM(Be=>{e(Be||[]),i.role!==F.VENDOR&&hN(i.tenantId).catch(zt=>{console.error("Failed to sync vendor metrics:",zt)})},i.tenantId);const Oe=JM(Be=>{r(Be||[])},i.tenantId),mn=XM(Be=>{r(zt=>{const _t=new Set(Be.map(jt=>jt.id));return[...zt.filter(jt=>!_t.has(jt.id)),...Be]})},i.tenantId),pn=ZM(Be=>{r(zt=>{const _t=new Set(Be.map(jt=>jt.id));return[...zt.filter(jt=>!_t.has(jt.id)),...Be]})},i.tenantId),yn=e6(Be=>{r(zt=>{const _t=new Set(Be.map(jt=>jt.id));return[...zt.filter(jt=>!_t.has(jt.id)),...Be]})},i.tenantId);return()=>{Re(),Oe(),mn(),pn(),yn()}},[i,e,r]),W.useEffect(()=>{if(!ae)return;const{projectId:Re,taskId:Oe,meetingId:mn,tab:pn}=ae;if(!Re)return;const yn=n.find(Be=>Be.id===Re);if(yn){if(N(yn),ge(pn||void 0),Oe){const zt=(Ie.get(Re)||yn.tasks||[]).find(_t=>_t.id===Oe)||null;zt&&(z(zt),O(!0))}mn&&!Oe&&ge("meetings"),xe(null);try{window.history.replaceState({},document.title,window.location.pathname)}catch{}}},[n,Ie,ae]),W.useEffect(()=>{if(n.length===0)return;const Re=[];return n.forEach(Oe=>{const mn=iv(Oe.id,pn=>{fe(yn=>new Map(yn).set(Oe.id,pn))});Re.push(mn)}),()=>{Re.forEach(Oe=>Oe())}},[n]),W.useEffect(()=>{if(i){try{(ae||{}).open==="admins"?b("admins"):b(i.role===F.CLIENT?"projects":"dashboard")}catch{b(i.role===F.CLIENT?"projects":"dashboard")}N(null)}},[i]),W.useEffect(()=>{if(w){const Re=n.find(Oe=>Oe.id===w.id);Re&&JSON.stringify(Re)!==JSON.stringify(w)&&N(Re)}},[n,w]),!i)return a.jsx(mV,{users:t});const oe=i.role===F.ADMIN||i.role===F.DESIGNER,we=i.role===F.ADMIN,he=i.role===F.ADMIN||i.role===F.DESIGNER,ke=i.role===F.ADMIN||i.role===F.VENDOR,me=Re=>{e(pn=>pn.map(yn=>yn.id===Re.id?Re:yn)),N(Re);const{id:Oe,...mn}=Re;nv(Re.id,mn).catch(pn=>{console.error("Failed to save project update to Firebase:",pn)}),hN(i.tenantId).catch(pn=>{console.error("Failed to sync vendor metrics:",pn)})},$e=Re=>{r(Oe=>[...Oe,Re])},pt=Re=>{},at=async Re=>{try{await WT(Re.id),p("Success",`Project "${Re.name}" deleted successfully`,"success")}catch(Oe){console.error("Error deleting project:",Oe),p("Error",`Failed to delete project: ${Oe.message}`,"error")}},lt=n.filter(Re=>i.role===F.ADMIN?!0:i.role===F.DESIGNER?Re.leadDesignerId===i.id||(Re.teamMembers||[]).includes(i.id):i.role===F.CLIENT?Re.clientId===i.id||(Re.clientIds||[]).includes(i.id):i.role===F.VENDOR?(Ie.get(Re.id)||[]).some(mn=>mn.assigneeId===i.id)||(Re.vendorIds||[]).includes(i.id)||(Re.teamMembers||[]).includes(i.id):!1),on=({view:Re,icon:Oe,label:mn})=>a.jsxs("button",{onClick:()=>{b(Re),N(null),z(null),O(!1),ie(!1)},className:`w-full flex items-center gap-1 px-4 py-3 rounded-lg transition-colors mb-1 ${k?"justify-center":""}
        ${g===Re&&!w?"bg-gray-900 text-white shadow-lg":"text-gray-500 hover:bg-gray-100 hover:text-gray-900"}`,title:k?mn:"",children:[a.jsx(Oe,{className:"w-5 h-5 flex-shrink-0"}),!k&&a.jsx("span",{className:"font-medium",children:mn})]});return a.jsxs("div",{className:"flex h-screen bg-gray-50 overflow-hidden",children:[a.jsx(aA,{}),a.jsx(xV,{}),a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),j&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-20 md:hidden",onClick:()=>ie(!1)}),a.jsx("aside",{className:`
        fixed inset-y-0 left-0 z-30 bg-white transform transition-all duration-300 ease-in-out md:relative md:translate-x-0 md:border-r md:border-gray-200
        ${j?"translate-x-0":"-translate-x-full"} md:translate-x-0
        ${k?"md:w-20":"md:w-64 w-64"}
      `,children:a.jsxs("div",{className:"h-full flex flex-col relative",children:[a.jsxs("div",{className:"p-6 flex items-center justify-between pt-[calc(0.5rem+env(safe-area-inset-top))]",children:[!k&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-12 h-12 rounded-lg"}),a.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Kydo Solutions"})]}),k&&a.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-12 h-12 rounded-lg"}),a.jsx("button",{className:"md:hidden",onClick:()=>ie(!1),title:"Close sidebar",children:a.jsx(_n,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("button",{onClick:()=>R(!k),className:"hidden md:flex absolute -right-3 top-6 w-7 h-7 bg-white text-gray-900 rounded-full items-center justify-center hover:bg-gray-100 transition-colors shadow-md border border-gray-200 z-40",title:k?"Expand sidebar":"Collapse sidebar","aria-label":"Toggle sidebar",children:a.jsxs("span",{className:"relative w-4 h-4 block",children:[a.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out
                  ${k?"-translate-x-1/2":"rotate-45 -translate-x-1/2 -translate-y-1/2"}
                `,style:{transform:k?"translate(-50%, -5px) rotate(0deg)":"translate(-50%, -50%) rotate(45deg)"}}),a.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out
                  ${k?"-translate-x-1/2 translate-y-1/2":"-rotate-45 -translate-x-1/2 -translate-y-1/2"}
                `,style:{transform:k?"translate(-50%, 5px) rotate(0deg)":"translate(-50%, -50%) rotate(-45deg)"}}),a.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out
                  ${k?"-translate-x-1/2 -translate-y-1/2":"opacity-0"}
                `,style:{opacity:k?1:0,transform:k?"translate(-50%, 0) scaleX(1)":"translate(-50%, -50%) scaleX(0)"}})]})}),a.jsxs("div",{className:"px-4 flex-1 overflow-y-auto",children:[a.jsxs("div",{className:"mb-6",children:[!k&&a.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Main"}),i.role!==F.CLIENT&&a.jsx(on,{view:"dashboard",icon:zS,label:"Dashboard"}),a.jsx(on,{view:"projects",icon:SN,label:"Projects"})]}),(oe||we||he||ke)&&a.jsxs("div",{className:"mb-6",children:[!k&&a.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"People"}),oe&&a.jsx(on,{view:"clients",icon:Uj,label:"Clients"}),we&&a.jsx(on,{view:"designers",icon:Fp,label:"Team"}),he&&a.jsx(on,{view:"vendors",icon:_j,label:"Vendors"}),ke&&a.jsx(on,{view:"admins",icon:zx,label:"Admins"})]}),a.jsxs("div",{className:"mb-6",children:[!k&&a.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Account"}),a.jsx(on,{view:"settings",icon:fj,label:"Settings"})]})]}),a.jsx("div",{className:"p-4 border-t border-gray-200",children:a.jsxs("button",{onClick:async()=>{try{await l()}catch(Re){console.error("Logout failed:",Re)}},className:"w-full flex items-center gap-3 px-4 py-3 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:k?"Sign Out":"",children:[a.jsx(XS,{className:"w-5 h-5 flex-shrink-0"}),!k&&a.jsx("span",{className:"font-medium",children:"Sign Out"})]})})]})}),a.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden relative",children:[a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full flex-shrink-0"}),P&&a.jsxs("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-3 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Op,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),a.jsx("p",{className:"text-sm text-blue-900",children:"Enable push notifications to stay updated on project activities"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:$,className:"bg-blue-600 text-white px-4 py-1.5 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:"Enable"}),a.jsx("button",{onClick:()=>H(!1),className:"text-blue-600 px-2 py-1.5 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors",children:a.jsx(_n,{className:"w-4 h-4"})})]})]}),a.jsxs("header",{className:"h-14 sm:h-20 bg-white border-b border-gray-200 flex items-center justify-between px-3 sm:px-6 relative z-20",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsx("button",{onClick:()=>ie(!0),className:"md:hidden p-2 text-gray-500 hover:bg-gray-100 rounded-lg",title:"Toggle sidebar menu",children:a.jsx(tj,{className:"w-6 h-6"})})}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>q(!M),className:"relative p-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",title:"Toggle notifications",children:[a.jsx(Op,{className:"w-5 h-5"}),u>0&&a.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white animate-pulse"})]}),a.jsx(pV,{isOpen:M,onClose:()=>q(!1),projects:n,onSelectProject:(Re,Oe)=>{N(Re),z(null),O(!1),ge(Oe==null?void 0:Oe.initialTab)}})]}),a.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-gray-200",children:[a.jsxs("div",{className:"text-right hidden sm:block",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.name}),a.jsx("p",{className:"text-xs text-gray-500 capitalize",children:i.role})]}),a.jsx(Ba,{avatar:i.avatar,name:i.name,size:"sm",role:String(i.role).toLowerCase()})]})]})]}),a.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 relative z-0",onClick:()=>M&&q(!1),children:a.jsxs("div",{className:"px-4 sm:px-6 py-2 sm:py-4 pb-12 sm:pb-16 h-full flex flex-col",children:[ue&&a.jsx("div",{className:"flex items-center justify-center h-full",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-gray-200 border-t-gray-900 animate-spin mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 font-medium",children:"Loading data from Firebase..."})]})}),!ue&&a.jsx(a.Fragment,{children:w?a.jsx(oV,{project:w,users:t,onUpdateProject:me,onBack:()=>{N(null),z(null),O(!1),ge(void 0)},initialTask:D||void 0,initialTab:le,onCloseTask:()=>{L&&(N(null),z(null),O(!1))}}):a.jsxs(a.Fragment,{children:[g==="dashboard"&&a.jsx(tV,{projects:n,users:t,onSelectProject:(Re,Oe)=>{N(Re),z(null),O(!1),ge(Oe==null?void 0:Oe.initialTab)},onSelectTask:(Re,Oe)=>{N(Oe),z(Re),O(!0)}}),g==="projects"&&a.jsxs("div",{className:"space-y-6 pb-12",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Projects"}),i.role===F.ADMIN&&a.jsxs("button",{onClick:()=>K(!0),className:"bg-gray-900 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-800 transition-colors shadow-sm flex items-center gap-2",children:[a.jsx(ij,{className:"w-4 h-4"})," New Project"]})]}),lt.length>0?a.jsx(yV,{projects:lt,onSelect:Re=>{N(Re),z(null),O(!1),ge(void 0)},user:i,setEditingProject:Fe,setIsNewProjectModalOpen:K,onDeleteProject:at,realTimeTasks:Ie}):a.jsx("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed border-gray-300",children:a.jsx("p",{className:"text-gray-500",children:"No projects found for your account."})})]}),g==="clients"&&a.jsx(gp,{users:t,roleFilter:F.CLIENT,onAddUser:$e,projects:n,onSelectProject:Re=>{N(Re),z(null),O(!1),ge(void 0)},onSelectTask:(Re,Oe)=>{N(Oe),z(Re),O(!0)}}),g==="vendors"&&a.jsx(gp,{users:t,roleFilter:F.VENDOR,onAddUser:$e,projects:n,onSelectProject:Re=>{N(Re),z(null),O(!1),ge(void 0)},onSelectTask:(Re,Oe)=>{N(Oe),z(Re),O(!0)}}),g==="designers"&&a.jsx(gp,{users:t,roleFilter:F.DESIGNER,onAddUser:$e,projects:n,onSelectProject:Re=>{N(Re),z(null),O(!1),ge(void 0)},onSelectTask:(Re,Oe)=>{N(Oe),z(Re),O(!0)}}),g==="admins"&&a.jsx(gp,{users:t,roleFilter:F.ADMIN,onAddUser:$e,projects:n,onSelectProject:Re=>{N(Re),z(null),O(!1),ge(void 0)},onSelectTask:(Re,Oe)=>{N(Oe),z(Re),O(!0)}}),g==="settings"&&a.jsxs("div",{className:"max-w-3xl mx-auto space-y-8 pb-12",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Settings"}),a.jsx("p",{className:"text-gray-600",children:"Manage your account security and preferences"})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Account Information"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Name"}),a.jsx("p",{className:"text-gray-900 font-medium",children:i.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Email"}),a.jsx("p",{className:"text-gray-900 font-medium",children:i.email})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Role"}),a.jsx("p",{className:"text-gray-900 font-medium capitalize",children:i.role})]}),i.phone&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Phone"}),a.jsx("p",{className:"text-gray-900 font-medium",children:i.phone})]})]})})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:a.jsx(gV,{})})]})]})})]})})]}),U&&a.jsx(fV,{users:t,onClose:()=>{K(!1),Fe(null)},onSave:pt,initialProject:V})]})}var Oy;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(Oy||(Oy={}));var NN;(function(n){n.None="NONE",n.Slide="SLIDE",n.Fade="FADE"})(NN||(NN={}));const $x=Zh("StatusBar");async function wV(){try{if(!(window.cordova||window.capacitor)){console.log("StatusBar not available on web platform");return}await $x.setStyle({style:Oy.Dark}),await $x.setBackgroundColor({color:"#111827"}),await $x.setOverlaysWebView({overlay:!0}),console.log("StatusBar initialized: light style, dark blue background, overlay mode")}catch(n){console.error("Error initializing StatusBar:",n)}}wV();const oA=document.getElementById("root");if(!oA)throw new Error("Could not find root element to mount to");const _V=QA.createRoot(oA);_V.render(a.jsx(ii.StrictMode,{children:a.jsx(vV,{})}));
