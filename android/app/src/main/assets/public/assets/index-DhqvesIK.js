const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-yXAMf3Jx.js","assets/recharts-EVrsijMk.js","assets/firebase-CoIuEebr.js"])))=>i.map(i=>d[i]);
import{r as e,a as t,g as s,b as a,R as r,c as n}from"./recharts-EVrsijMk.js";import{r as i,_ as l,C as o,a as d,E as c,o as m,F as p,L as x,g,i as u,b as h,v as b,c as y,d as f,e as v,f as j,h as N,j as w,k,l as I,m as S,n as C,q as D,w as A,p as E,s as $,t as T,u as P,x as M,y as O,z as B,A as R,B as L,D as F,G as z,H as V,I as U,J as W,K as _,M as G,N as H,O as q,P as K,Q as Y,R as J,S as Z,T as X}from"./firebase-CoIuEebr.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Q={},ee=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");a=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in Q)return;Q[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};var te,se,ae,re={exports:{}},ne={},ie=(se||(se=1,re.exports=function(){if(te)return ne;te=1;var t=e(),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,a){var l,o={},d=null,c=null;for(l in void 0!==a&&(d=""+a),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)r.call(t,l)&&!i.hasOwnProperty(l)&&(o[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps)void 0===o[l]&&(o[l]=t[l]);return{$$typeof:s,type:e,key:d,ref:c,props:o,_owner:n.current}}return ne.Fragment=a,ne.jsx=l,ne.jsxs=l,ne}()),re.exports),le={};const oe=s(function(){if(ae)return le;ae=1;var e=t();return le.createRoot=e.createRoot,le.hydrateRoot=e.hydrateRoot,le}()),de=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},ce=(...e)=>e.filter((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),me=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var pe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const xe=a.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:n="",children:i,iconNode:l,...o},d)=>a.createElement("svg",{ref:d,...pe,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:ce("lucide",n),...!i&&!me(o)&&{"aria-hidden":"true"},...o},[...l.map(([e,t])=>a.createElement(e,t)),...Array.isArray(i)?i:[i]])),ge=(e,t)=>{const s=a.forwardRef(({className:s,...r},n)=>{return a.createElement(xe,{ref:n,iconNode:t,className:ce(`lucide-${i=de(e),i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...r});var i});return s.displayName=de(e),s},ue=ge("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),he=ge("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),be=ge("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),ye=ge("ban",[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),fe=ge("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),ve=ge("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),je=ge("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]]),Ne=ge("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),we=ge("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ke=ge("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ie=ge("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Se=ge("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ce=ge("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),De=ge("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Ae=ge("circle-pause",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]),Ee=ge("circle-play",[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),$e=ge("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Te=ge("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Pe=ge("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Me=ge("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Oe=ge("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),Be=ge("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Re=ge("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Le=ge("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Fe=ge("file",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]]),ze=ge("folder-kanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]),Ve=ge("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),Ue=ge("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),We=ge("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),_e=ge("indian-rupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]),Ge=ge("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),He=ge("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),qe=ge("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Ke=ge("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),Ye=ge("list-checks",[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]]),Je=ge("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),Ze=ge("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),Xe=ge("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Qe=ge("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),et=ge("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),tt=ge("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),st=ge("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),at=ge("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),rt=ge("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]),nt=ge("panels-top-left",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]),it=ge("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),lt=ge("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),ot=ge("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),dt=ge("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ct=ge("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),mt=ge("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),pt=ge("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),xt=ge("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),gt=ge("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ut=ge("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),ht=ge("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),bt=ge("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),yt=ge("shopping-bag",[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]]),ft=ge("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),vt=ge("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),jt=ge("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Nt=ge("thumbs-down",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]),wt=ge("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),kt=ge("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),It=ge("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),St=ge("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Ct=ge("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Dt=ge("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),At=ge("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Et=ge("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),$t=ge("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var Tt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Pt=r.createContext&&r.createContext(Tt),Mt=function(){return Mt=Object.assign||function(e){for(var t,s=1,a=arguments.length;s<a;s++)for(var r in t=arguments[s])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Mt.apply(this,arguments)};function Ot(e){return e&&e.map(function(e,t){return r.createElement(e.tag,Mt({key:t},e.attr),Ot(e.child))})}function Bt(e){return function(t){return r.createElement(Rt,Mt({attr:Mt({},e.attr)},t),Ot(e.child))}}function Rt(e){var t=function(t){var s,a=e.attr,n=e.size,i=e.title,l=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(s[a[r]]=e[a[r]])}return s}(e,["attr","size","title"]),o=n||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),r.createElement("svg",Mt({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,l,{className:s,style:Mt(Mt({color:e.color||t.color},t.style),e.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==Pt?r.createElement(Pt.Consumer,null,function(e){return t(e)}):t(Tt)}function Lt(e){return Bt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z"}},{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z"}}]})(e)}var Ft=(e=>(e.ADMIN="Admin",e.DESIGNER="Designer",e.VENDOR="Vendor",e.CLIENT="Client",e))(Ft||{}),zt=(e=>(e.DISCOVERY="Discovery",e.PLANNING="Planning",e.EXECUTION="Execution",e.COMPLETED="Completed",e.ON_HOLD="On Hold",e))(zt||{}),Vt=(e=>(e.DESIGNING="Designing",e.TURNKEY="Turnkey",e))(Vt||{}),Ut=(e=>(e.COMMERCIAL="Commercial",e.RESIDENTIAL="Residential",e))(Ut||{}),Wt=(e=>(e.TODO="To Do",e.IN_PROGRESS="In Progress",e.REVIEW="Review",e.DONE="Done",e.OVERDUE="Overdue",e.ABORTED="Aborted",e.ON_HOLD="On Hold",e))(Wt||{});const _t="@firebase/installations",Gt="0.6.19",Ht=`w:${Gt}`,qt="FIS_v2",Kt=new c("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Yt(e){return e instanceof p&&e.code.includes("request-failed")}function Jt({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Zt(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Xt(e,t){const s=(await t.json()).error;return Kt.create("request-failed",{requestName:e,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function Qt({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function es(e){const t=await e();return t.status>=500&&t.status<600?e():t}function ts(e){return new Promise(t=>{setTimeout(t,e)})}const ss=/^[cdef][\w-]{21}$/;function as(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return ss.test(t)?t:""}catch{return""}}function rs(e){return`${e.appName}!${e.appId}`}const ns=new Map;function is(e,t){const s=rs(e);ls(s,t),function(e,t){const s=(!os&&"BroadcastChannel"in self&&(os=new BroadcastChannel("[Firebase] FID Change"),os.onmessage=e=>{ls(e.data.key,e.data.fid)}),os);s&&s.postMessage({key:e,fid:t}),0===ns.size&&os&&(os.close(),os=null)}(s,t)}function ls(e,t){const s=ns.get(e);if(s)for(const a of s)a(t)}let os=null;const ds="firebase-installations-store";let cs=null;function ms(){return cs||(cs=m("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(ds)}})),cs}async function ps(e,t){const s=rs(e),a=(await ms()).transaction(ds,"readwrite"),r=a.objectStore(ds),n=await r.get(s);return await r.put(t,s),await a.done,n&&n.fid===t.fid||is(e,t.fid),t}async function xs(e){const t=rs(e),s=(await ms()).transaction(ds,"readwrite");await s.objectStore(ds).delete(t),await s.done}async function gs(e,t){const s=rs(e),a=(await ms()).transaction(ds,"readwrite"),r=a.objectStore(ds),n=await r.get(s),i=t(n);return void 0===i?await r.delete(s):await r.put(i,s),await a.done,!i||n&&n.fid===i.fid||is(e,i.fid),i}async function us(e){let t;const s=await gs(e.appConfig,s=>{const a=function(e){return ys(e||{fid:as(),registrationStatus:0})}(s),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Kt.create("app-offline"))};const s={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},a=async function(e,t){try{const s=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:s}){const a=Jt(e),r=Qt(e),n=t.getImmediate({optional:!0});if(n){const e=await n.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const i={fid:s,authVersion:qt,appId:e.appId,sdkVersion:Ht},l={method:"POST",headers:r,body:JSON.stringify(i)},o=await es(()=>fetch(a,l));if(o.ok){const e=await o.json();return{fid:e.fid||s,registrationStatus:2,refreshToken:e.refreshToken,authToken:Zt(e.authToken)}}throw await Xt("Create Installation",o)}(e,t);return ps(e.appConfig,s)}catch(s){throw Yt(s)&&409===s.customData.serverCode?await xs(e.appConfig):await ps(e.appConfig,{fid:t.fid,registrationStatus:0}),s}}(e,s);return{installationEntry:s,registrationPromise:a}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:hs(e)}:{installationEntry:t}}(e,a);return t=r.registrationPromise,r.installationEntry});return""===s.fid?{installationEntry:await t}:{installationEntry:s,registrationPromise:t}}async function hs(e){let t=await bs(e.appConfig);for(;1===t.registrationStatus;)await ts(100),t=await bs(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:s}=await us(e);return s||t}return t}function bs(e){return gs(e,e=>{if(!e)throw Kt.create("installation-not-found");return ys(e)})}function ys(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function fs({appConfig:e,heartbeatServiceProvider:t},s){const a=function(e,{fid:t}){return`${Jt(e)}/${t}/authTokens:generate`}(e,s),r=function(e,{refreshToken:t}){const s=Qt(e);return s.append("Authorization",function(e){return`${qt} ${e}`}(t)),s}(e,s),n=t.getImmediate({optional:!0});if(n){const e=await n.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const i={installation:{sdkVersion:Ht,appId:e.appId}},l={method:"POST",headers:r,body:JSON.stringify(i)},o=await es(()=>fetch(a,l));if(o.ok)return Zt(await o.json());throw await Xt("Generate Auth Token",o)}async function vs(e,t=!1){let s;const a=await gs(e.appConfig,a=>{if(!Ns(a))throw Kt.create("not-registered");const r=a.authToken;if(!t&&(2===(n=r).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(n)))return a;var n;if(1===r.requestStatus)return s=async function(e,t){let s=await js(e.appConfig);for(;1===s.authToken.requestStatus;)await ts(100),s=await js(e.appConfig);const a=s.authToken;return 0===a.requestStatus?vs(e,t):a}(e,t),a;{if(!navigator.onLine)throw Kt.create("app-offline");const t=function(e){return{...e,authToken:{requestStatus:1,requestTime:Date.now()}}}(a);return s=async function(e,t){try{const s=await fs(e,t),a={...t,authToken:s};return await ps(e.appConfig,a),s}catch(s){if(!Yt(s)||401!==s.customData.serverCode&&404!==s.customData.serverCode){const s={...t,authToken:{requestStatus:0}};await ps(e.appConfig,s)}else await xs(e.appConfig);throw s}}(e,t),t}});return s?await s:a.authToken}function js(e){return gs(e,e=>{if(!Ns(e))throw Kt.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?{...e,authToken:{requestStatus:0}}:e;var t})}function Ns(e){return void 0!==e&&2===e.registrationStatus}function ws(e){return Kt.create("missing-app-config-values",{valueName:e})}const ks="installations";l(new o(ks,e=>{const t=e.getProvider("app").getImmediate(),s=function(e){if(!e||!e.options)throw ws("App Configuration");if(!e.name)throw ws("App Name");const t=["projectId","apiKey","appId"];for(const s of t)if(!e.options[s])throw ws(s);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:s,heartbeatServiceProvider:d(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),l(new o("installations-internal",e=>{const t=e.getProvider("app").getImmediate(),s=d(t,ks).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:s,registrationPromise:a}=await us(t);return a?a.catch(console.error):vs(t).catch(console.error),s.fid}(s),getToken:e=>async function(e,t=!1){const s=e;return await async function(e){const{registrationPromise:t}=await us(e);t&&await t}(s),(await vs(s,t)).token}(s,e)}},"PRIVATE")),i(_t,Gt),i(_t,Gt,"esm2020");const Is="analytics",Ss="https://www.googletagmanager.com/gtag/js",Cs=new x("@firebase/analytics"),Ds=new c("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function As(e){if(!e.startsWith(Ss)){const t=Ds.create("invalid-gtag-resource",{gtagURL:e});return Cs.warn(t.message),""}return e}function Es(e){return Promise.all(e.map(e=>e.catch(e=>e)))}const $s=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Ts(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Ps(e,t=$s,s){const{appId:a,apiKey:r,measurementId:n}=e.options;if(!a)throw Ds.create("no-app-id");if(!r){if(n)return{measurementId:n,appId:a};throw Ds.create("no-api-key")}const i=t.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new Os;return setTimeout(async()=>{l.abort()},6e4),Ms({appId:a,apiKey:r,measurementId:n},i,l,t)}async function Ms(e,{throttleEndTimeMillis:t,backoffCount:s},a,r=$s){const{appId:n,measurementId:i}=e;try{await function(e,t){return new Promise((s,a)=>{const r=Math.max(t-Date.now(),0),n=setTimeout(s,r);e.addEventListener(()=>{clearTimeout(n),a(Ds.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(a,t)}catch(l){if(i)return Cs.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${i} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:n,measurementId:i};throw l}try{const t=await async function(e){const{appId:t,apiKey:s}=e,a={method:"GET",headers:Ts(s)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",t),n=await fetch(r,a);if(200!==n.status&&304!==n.status){let e="";try{const t=await n.json();t.error?.message&&(e=t.error.message)}catch(i){}throw Ds.create("config-fetch-failed",{httpStatus:n.status,responseMessage:e})}return n.json()}(e);return r.deleteThrottleMetadata(n),t}catch(l){const t=l;if(!function(e){if(!(e instanceof p&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(t)){if(r.deleteThrottleMetadata(n),i)return Cs.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${i} provided in the "measurementId" field in the local Firebase config. [${t?.message}]`),{appId:n,measurementId:i};throw l}const o=503===Number(t?.customData?.httpStatus)?y(s,r.intervalMillis,30):y(s,r.intervalMillis),d={throttleEndTimeMillis:Date.now()+o,backoffCount:s+1};return r.setThrottleMetadata(n,d),Cs.debug(`Calling attemptFetch again in ${o} millis`),Ms(e,d,a,r)}}class Os{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Bs(e,t,s,a,r,n,i){const l=Ps(e);l.then(t=>{s[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Cs.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>Cs.error(e)),t.push(l);const o=async function(){if(!h())return Cs.warn(Ds.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await b()}catch(e){return Cs.warn(Ds.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}return!0}().then(e=>e?a.getId():void 0),[d,c]=await Promise.all([l,o]);(function(e){const t=window.document.getElementsByTagName("script");for(const s of Object.values(t))if(s.src&&s.src.includes(Ss)&&s.src.includes(e))return s;return null})(n)||function(e,t){const s=function(e,t){let s;return window.trustedTypes&&(s=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),s}(0,{createScriptURL:As}),a=document.createElement("script"),r=`${Ss}?l=${e}&id=${t}`;a.src=s?s?.createScriptURL(r):r,a.async=!0,document.head.appendChild(a)}(n,d.measurementId),r("js",new Date);const m=i?.config??{};return m.origin="firebase",m.update=!0,null!=c&&(m.firebase_id=c),r("config",d.measurementId,m),d.measurementId}class Rs{constructor(e){this.app=e}_delete(){return delete Ls[this.app.options.appId],Promise.resolve()}}let Ls={},Fs=[];const zs={};let Vs,Us,Ws="dataLayer",_s=!1;function Gs(e,t,s){!function(){const e=[];if(u()&&e.push("This is a browser extension environment."),j()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),s=Ds.create("invalid-analytics-context",{errorInfo:t});Cs.warn(s.message)}}();const a=e.options.appId;if(!a)throw Ds.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Ds.create("no-api-key");Cs.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ls[a])throw Ds.create("already-exists",{id:a});if(!_s){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Ws);const{wrappedGtag:e,gtagCore:t}=function(e,t,s,a,r){let n=function(...e){window[a].push(arguments)};return window[r]&&"function"==typeof window[r]&&(n=window[r]),window[r]=function(e,t,s,a){return async function(r,...n){try{if("event"===r){const[a,r]=n;await async function(e,t,s,a,r){try{let n=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const a=await Es(s);for(const s of e){const e=a.find(e=>e.measurementId===s),r=e&&t[e.appId];if(!r){n=[];break}n.push(r)}}0===n.length&&(n=Object.values(t)),await Promise.all(n),e("event",a,r||{})}catch(n){Cs.error(n)}}(e,t,s,a,r)}else if("config"===r){const[r,i]=n;await async function(e,t,s,a,r,n){const i=a[r];try{if(i)await t[i];else{const e=(await Es(s)).find(e=>e.measurementId===r);e&&await t[e.appId]}}catch(l){Cs.error(l)}e("config",r,n)}(e,t,s,a,r,i)}else if("consent"===r){const[t,s]=n;e("consent",t,s)}else if("get"===r){const[t,s,a]=n;e("get",t,s,a)}else if("set"===r){const[t]=n;e("set",t)}else e(r,...n)}catch(i){Cs.error(i)}}}(n,e,t,s),{gtagCore:n,wrappedGtag:window[r]}}(Ls,Fs,zs,Ws,"gtag");Us=e,Vs=t,_s=!0}return Ls[a]=Bs(e,Fs,zs,t,Vs,Ws,s),new Rs(e)}const Hs="@firebase/analytics",qs="0.10.19";l(new o(Is,(e,{options:t})=>Gs(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),l(new o("analytics-internal",function(e){try{const t=e.getProvider(Is).getImmediate();return{logEvent:(e,s,a)=>function(e,t,s,a){e=g(e),async function(e,t,s,a,r){if(r&&r.global)e("event",s,a);else{const r=await t;e("event",s,{...a,send_to:r})}}(Us,Ls[e.app.options.appId],t,s,a).catch(e=>Cs.error(e))}(t,e,s,a),setUserProperties:(e,s)=>function(e,t,s){e=g(e),async function(e,t,s,a){if(a&&a.global){const t={};for(const e of Object.keys(s))t[`user_properties.${e}`]=s[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:s})}(Us,Ls[e.app.options.appId],t,s).catch(e=>Cs.error(e))}(t,e,s)}}catch(t){throw Ds.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),i(Hs,qs),i(Hs,qs,"esm2020");const Ks="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Ys="google.c.a.c_id";var Js,Zs,Xs;function Qs(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ea(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),s=atob(t),a=new Uint8Array(s.length);for(let r=0;r<s.length;++r)a[r]=s.charCodeAt(r);return a}(Zs=Js||(Js={}))[Zs.DATA_MESSAGE=1]="DATA_MESSAGE",Zs[Zs.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(Xs||(Xs={}));const ta="fcm_token_details_db",sa="fcm_token_object_Store",aa="firebase-messaging-store";let ra=null;function na(){return ra||(ra=m("firebase-messaging-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(aa)}})),ra}async function ia(e,t){const s=la(e),a=(await na()).transaction(aa,"readwrite");return await a.objectStore(aa).put(t,s),await a.done,t}function la({appConfig:e}){return e.appId}const oa=new c("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function da({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}async function ca({appConfig:e,installations:t}){const s=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${s}`})}function ma({p256dh:e,auth:t,endpoint:s,vapidKey:a}){const r={web:{endpoint:s,auth:t,p256dh:e}};return a!==Ks&&(r.web.applicationPubKey=a),r}async function pa(e){const t=await async function(e,t){const s=await e.pushManager.getSubscription();return s||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ea(t)})}(e.swRegistration,e.vapidKey),s={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Qs(t.getKey("auth")),p256dh:Qs(t.getKey("p256dh"))},a=await async function(e){const t=la(e),s=await na(),a=await s.transaction(aa).objectStore(aa).get(t);if(a)return a;{const t=await async function(e){if("databases"in indexedDB&&!(await indexedDB.databases()).map(e=>e.name).includes(ta))return null;let t=null;return(await m(ta,5,{upgrade:async(s,a,r,n)=>{if(a<2)return;if(!s.objectStoreNames.contains(sa))return;const i=n.objectStore(sa),l=await i.index("fcmSenderId").get(e);if(await i.clear(),l)if(2===a){const e=l;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:e.createTime??Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:Qs(e.vapidKey)}}}else if(3===a){const e=l;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Qs(e.auth),p256dh:Qs(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Qs(e.vapidKey)}}}else if(4===a){const e=l;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Qs(e.auth),p256dh:Qs(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Qs(e.vapidKey)}}}}})).close(),await N(ta),await N("fcm_vapid_details_db"),await N("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(t)?t:null}(e.appConfig.senderId);if(t)return await ia(e,t),t}}(e.firebaseDependencies);if(a){if(function(e,t){const s=t.vapidKey===e.vapidKey,a=t.endpoint===e.endpoint,r=t.auth===e.auth,n=t.p256dh===e.p256dh;return s&&a&&r&&n}(a.subscriptionOptions,s))return Date.now()>=a.createTime+6048e5?async function(e,t){try{const s=await async function(e,t){const s=await ca(e),a=ma(t.subscriptionOptions),r={method:"PATCH",headers:s,body:JSON.stringify(a)};let n;try{const s=await fetch(`${da(e.appConfig)}/${t.token}`,r);n=await s.json()}catch(i){throw oa.create("token-update-failed",{errorInfo:i?.toString()})}if(n.error){const e=n.error.message;throw oa.create("token-update-failed",{errorInfo:e})}if(!n.token)throw oa.create("token-update-no-token");return n.token}(e.firebaseDependencies,t),a={...t,token:s,createTime:Date.now()};return await ia(e.firebaseDependencies,a),s}catch(s){throw s}}(e,{token:a.token,createTime:Date.now(),subscriptionOptions:s}):a.token;try{await async function(e,t){const s={method:"DELETE",headers:await ca(e)};try{const a=await fetch(`${da(e.appConfig)}/${t}`,s),r=await a.json();if(r.error){const e=r.error.message;throw oa.create("token-unsubscribe-failed",{errorInfo:e})}}catch(a){throw oa.create("token-unsubscribe-failed",{errorInfo:a?.toString()})}}(e.firebaseDependencies,a.token)}catch(r){}return xa(e.firebaseDependencies,s)}return xa(e.firebaseDependencies,s)}async function xa(e,t){const s=await async function(e,t){const s=await ca(e),a=ma(t),r={method:"POST",headers:s,body:JSON.stringify(a)};let n;try{const t=await fetch(da(e.appConfig),r);n=await t.json()}catch(i){throw oa.create("token-subscribe-failed",{errorInfo:i?.toString()})}if(n.error){const e=n.error.message;throw oa.create("token-subscribe-failed",{errorInfo:e})}if(!n.token)throw oa.create("token-subscribe-no-token");return n.token}(e,t),a={token:s,createTime:Date.now(),subscriptionOptions:t};return await ia(e,a),a.token}function ga(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const s=t.notification.title;s&&(e.notification.title=s);const a=t.notification.body;a&&(e.notification.body=a);const r=t.notification.image;r&&(e.notification.image=r);const n=t.notification.icon;n&&(e.notification.icon=n)}(t,e),function(e,t){t.data&&(e.data=t.data)}(t,e),function(e,t){if(!t.fcmOptions&&!t.notification?.click_action)return;e.fcmOptions={};const s=t.fcmOptions?.link??t.notification?.click_action;s&&(e.fcmOptions.link=s);const a=t.fcmOptions?.analytics_label;a&&(e.fcmOptions.analyticsLabel=a)}(t,e),t}function ua(e){return oa.create("missing-app-config-values",{valueName:e})}class ha{constructor(e,t,s){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const a=function(e){if(!e||!e.options)throw ua("App Configuration Object");if(!e.name)throw ua("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:s}=e;for(const a of t)if(!s[a])throw ua(a);return{appName:e.name,projectId:s.projectId,apiKey:s.apiKey,appId:s.appId,senderId:s.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:a,installations:t,analyticsProvider:s}}_delete(){return Promise.resolve()}}async function ba(e,t){if(!navigator)throw oa.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw oa.create("permission-blocked");return await async function(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=Ks)}(e,t?.vapidKey),await async function(e,t){if(t||e.swRegistration||await async function(e){try{e.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),e.swRegistration.update().catch(()=>{}),await async function(e){return new Promise((t,s)=>{const a=setTimeout(()=>s(new Error("Service worker not registered after 10000 ms")),1e4),r=e.installing||e.waiting;e.active?(clearTimeout(a),t()):r?r.onstatechange=e=>{"activated"===e.target?.state&&(r.onstatechange=null,clearTimeout(a),t())}:(clearTimeout(a),s(new Error("No incoming service worker found.")))})}(e.swRegistration)}catch(t){throw oa.create("failed-service-worker-registration",{browserErrorMessage:t?.message})}}(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw oa.create("invalid-sw-registration");e.swRegistration=t}}(e,t?.serviceWorkerRegistration),pa(e)}async function ya(e,t){const s=t.data;if(!s.isFirebaseMessaging)return;e.onMessageHandler&&s.messageType===Xs.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(ga(s)):e.onMessageHandler.next(ga(s)));const a=s.data;var r;"object"==typeof(r=a)&&r&&Ys in r&&"1"===a["google.c.a.e"]&&await async function(e,t,s){const a=function(e){switch(e){case Xs.NOTIFICATION_CLICKED:return"notification_open";case Xs.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(a,{message_id:s[Ys],message_name:s["google.c.a.c_l"],message_time:s["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}(e,s.messageType,a)}const fa="@firebase/messaging",va="0.12.23";l(new o("messaging",e=>{const t=new ha(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>ya(t,e)),t},"PUBLIC")),l(new o("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>ba(t,e)}},"PRIVATE")),i(fa,va),i(fa,va,"esm2020");const ja={apiKey:"AIzaSyBm3qcPWMOt_AmyFmtW-0DfFYBnM-qjhCs",authDomain:"btw-erp.firebaseapp.com",projectId:"btw-erp",storageBucket:"btw-erp.firebasestorage.app",messagingSenderId:"700838936930",appId:"1:700838936930:web:00474b6818f67f872aec3b",measurementId:"G-HDRN5MET3X"},Na=w(ja),wa=k(Na),ka=I(Na),Ia=S(Na);let Sa;!function(e=f()){e=g(e);const t=d(e,Is);t.isInitialized()?t.getImmediate():function(e,t={}){const s=d(e,Is);if(s.isInitialized()){const e=s.getImmediate();if(v(t,s.getOptions()))return e;throw Ds.create("already-initialized")}s.initialize({options:t})}(e)}(Na);try{Sa=function(e=f()){return async function(){try{await b()}catch(e){return!1}return"undefined"!=typeof window&&h()&&j()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}().then(e=>{if(!e)throw oa.create("unsupported-browser")},e=>{throw oa.create("indexed-db-unsupported")}),d(g(e),"messaging").getImmediate()}(Na)}catch(Cn){Sa=null}const Ca=Sa;async function Da(e){try{let t=D(C(ka,"projects"));e&&(t=D(C(ka,"projects"),A("tenantId","==",e)));const s=(await M(t)).docs.map(e=>({...e.data(),id:e.id})),a={};for(const e of s){const t=new Set;e.tasks?.forEach(e=>{e.assigneeId&&t.add(e.assigneeId)});for(const s of t){a[s]||(a[s]={});const t=(e.tasks||[]).filter(e=>e.assigneeId===s).length,r=(e.financials||[]).filter(e=>e.adminApproved&&e.clientApproved&&e.vendorId===s),n=r.filter(e=>e.receivedByName&&e.receivedByName.includes(s)).reduce((e,t)=>e+t.amount,0)-r.filter(e=>e.vendorId===s).reduce((e,t)=>e+t.amount,0);a[s][e.id]={projectName:e.name,taskCount:t,netAmount:n}}}for(const[e,r]of Object.entries(a))try{await P(T(ka,"users",e),{projectMetrics:r})}catch(Cn){Cn.code}}catch(Cn){}}const Aa=C(ka,"projects"),Ea=e=>Array.isArray(e)?e.map(e=>Ea(e)).filter(e=>void 0!==e):null!==e&&"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,t])=>[e,Ea(t)]).filter(([e,t])=>void 0!==t)):e,$a=async(e,t)=>{try{const s=Ea(t);await P(T(ka,"projects",e),s)}catch(Cn){throw Cn}},Ta=async e=>{try{await B(T(ka,"projects",e))}catch(Cn){throw Cn}},Pa=C(ka,"users"),Ma=async e=>{try{const s=await $(T(ka,"users",e));if(s.exists()){const a={...s.data(),id:s.id};if(!a.tenantId){a.tenantId=e;try{await P(T(ka,"users",e),{tenantId:e})}catch(t){}}return a}const a=await $(T(ka,"clients",e));if(a.exists()){const s={...a.data(),id:a.id};if(!s.tenantId){s.tenantId=e;try{await P(T(ka,"clients",e),{tenantId:e})}catch(t){}}return s}return null}catch(Cn){throw Cn.code,Cn}},Oa=async(e,t)=>{try{const s=T(ka,"users",e),a=await $(s);if(a.exists())return a.data();const r=C(ka,"vendors"),n=t.replace(/\D/g,""),i=D(r,A("phone","==",n)),l=await M(i);if(!l.empty){const t=l.docs[0].data(),s=l.docs[0].id;let a=t;if(a.tenantId||(a.tenantId=e),s!==e){const r={...t,id:e,tenantId:e};a=r,await O(T(ka,"users",e),r),await O(T(ka,"vendors",e),r),await B(T(ka,"users",s)),await B(T(ka,"vendors",s))}return a}return null}catch(Cn){return null}},Ba=async e=>{try{const t=await $(T(ka,"tenants",e));return t.exists()?{id:t.id,...t.data()}:null}catch(Cn){return null}},Ra=()=>{const e=window.navigator,t=window.screen,s=[e.userAgent,e.language,t.width+"x"+t.height,t.colorDepth,(new Date).getTimezoneOffset(),e.hardwareConcurrency||"unknown",e.deviceMemory||"unknown"].join("|");let a=0;for(let r=0;r<s.length;r++)a=(a<<5)-a+s.charCodeAt(r),a&=a;return Math.abs(a).toString(36)},La=()=>{const e=navigator.userAgent.toLowerCase();return/tablet|ipad|playbook|silk|(android(?!.*mobi|phone|windows phone))/.test(e)?"tablet":/mobile|phone|windows phone|iphone|android|blackberry|opera mini/.test(e)?"mobile":"desktop"},Fa=()=>{const e=navigator.userAgent;return e.includes("Firefox")?"Firefox":e.includes("Chrome")&&!e.includes("Chromium")?"Chrome":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edge")||e.includes("Edg")?"Edge":e.includes("Opera")?"Opera":"Unknown Browser"},za=()=>{const e=navigator.userAgent.toLowerCase();return e.includes("win")?"Windows":e.includes("mac")?"macOS":e.includes("linux")?"Linux":e.includes("android")?"Android":e.includes("iphone")||e.includes("ipad")?"iOS":"Unknown OS"},Va="erp_session",Ua="erp_session_expiry",Wa=e=>{try{const t=new Date,s=new Date(t.getTime()+864e5),a={user:e,loginTime:t.toISOString(),expiresAt:s.toISOString(),isAutoRestored:!1};localStorage.setItem(Va,JSON.stringify(a)),localStorage.setItem(Ua,s.toISOString())}catch(Cn){}},_a=()=>{try{const e=localStorage.getItem(Va);if(!e)return null;const t=JSON.parse(e),s=new Date(t.expiresAt);return new Date>s?(Ga(),null):t}catch(Cn){return null}},Ga=()=>{try{localStorage.removeItem(Va),localStorage.removeItem(Ua)}catch(Cn){}},Ha=a.createContext(void 0),qa=({children:e})=>{const[t,s]=a.useState(null),[r,n]=a.useState(null),[i,l]=a.useState(!0),[o,d]=a.useState(null),[c,m]=a.useState(null),[p,x]=a.useState([]);return a.useEffect(()=>R(wa,async e=>{try{if(e){let t=null;try{t=await Ma(e.uid),!t&&e.phoneNumber&&(t=await Oa(e.uid,e.phoneNumber))}catch(Cn){}if(!t){if(e.phoneNumber)return n(null),s(null),void l(!1);t={id:e.uid,name:e.email?.split("@")[0]||"Admin",email:e.email||"",role:"Admin",phone:"",tenantId:e.uid}}n(e),s(t),Wa(t)}else{const e=_a();if(e)return s(e.user),void l(!1);n(null),s(null)}}catch(Cn){n(null),s(null)}finally{l(!1)}}),[]),a.useEffect(()=>{if(!t||"Admin"!==t.role)return x([]),void m(null);(async()=>{try{const e=await(async e=>{try{const t=D(C(ka,"tenants"),A("adminUid","==",e)),s=await M(t),a=D(C(ka,"tenants"),A("adminIds","array-contains",e)),r=await M(a),n=new Map;return s.docs.forEach(e=>{n.set(e.id,{id:e.id,name:e.data().name||"Unnamed Firm"})}),r.docs.forEach(e=>{n.set(e.id,{id:e.id,name:e.data().name||"Unnamed Firm"})}),Array.from(n.values())}catch(Cn){return[]}})(t.id);if(!e||0===e.length){if(t.tenantId){const e=await Ba(t.tenantId),s=e?.name||t.tenantId,a={id:t.tenantId,name:s};x([a]),m(a)}return}x(e);const s=(e=>{try{return localStorage.getItem(`selectedTenant_${e}`)}catch(Cn){return null}})(t.id),a=e.find(e=>e.id===s)||e[0]||null;a&&m(a)}catch(Cn){if(t.tenantId)try{const e=await Ba(t.tenantId),s=e?.name||t.tenantId,a={id:t.tenantId,name:s};x([a]),m(a)}catch(e){const s={id:t.tenantId,name:t.tenantId};x([s]),m(s)}}})()},[t]),ie.jsx(Ha.Provider,{value:{user:t,firebaseUser:r,login:e=>{s(e),Wa(e);try{const{generateDeviceFingerprint:e}=require("../utils/deviceUtils");(e=>{try{const t=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");t[e]&&(t[e].lastLogin=(new Date).toISOString(),localStorage.setItem("rememberedDevices",JSON.stringify(t)))}catch(Cn){}})(e())}catch(Cn){}},logout:async()=>{try{s(null),n(null),Ga();try{await L(ka)}catch(Cn){}await new Promise(e=>setTimeout(e,100)),await F(wa),window.location.href="/"}catch(Cn){throw Cn}},loading:i,adminCredentials:o,setAdminCredentials:d,extendSession:()=>{t&&(e=>{Wa(e)})(t)},currentTenant:c,availableTenants:p,switchTenant:async e=>{try{const s=p.find(t=>t.id===e);if(!s)throw new Error("Tenant not found");m(s),t&&((e,t)=>{try{localStorage.setItem(`selectedTenant_${e}`,t)}catch(Cn){}})(t.id,e)}catch(Cn){throw Cn}}},children:e})},Ka=()=>{const e=a.useContext(Ha);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Ya=(e,t)=>{try{if(t.setCurrentView(e.view),e.projectId&&"project-detail"===e.view){const s=t.projects.find(t=>t.id===e.projectId);if(s&&(t.setSelectedProject(s),e.targetTab&&t.setInitialProjectTab(e.targetTab),e.taskId&&t.tasks)){const s=(t.tasks.get(e.projectId)||[]).find(t=>t.id===e.taskId);s&&t.setSelectedTask(s)}}}catch(Cn){}},Ja=a.createContext(void 0),Za=({children:e,projects:t=[]})=>{const{user:s}=Ka(),[r,n]=a.useState([]),[i,l]=a.useState([]),[o,d]=a.useState(null),c=(e,s)=>{const a=t.find(e=>e.id===s);if(!a)return!1;const r=a.clientId===e,n=a.leadDesignerId===e,i=a.teamMembers?.includes(e)||!1;return r||n||i},m=r.filter(e=>!!s&&(e.recipientId?e.recipientId===s.id:!!e.projectId&&c(s.id,e.projectId))),p=m.filter(e=>!e.read).length;return ie.jsxs(Ja.Provider,{value:{notifications:m,unreadCount:p,addNotification:(e,t,a="info",r,i,o,d)=>{let c;c="object"==typeof e?e:{title:e,message:t,type:a,recipientId:r,projectId:i,projectName:o,targetTab:d};const m={id:Math.random().toString(36).substr(2,9),title:c.title,message:c.message,type:c.type||"info",recipientId:c.recipientId,projectId:c.projectId,projectName:c.projectName,timestamp:new Date,read:!1,targetTab:c.targetTab,taskId:c.taskId,meetingId:c.meetingId,deepLinkPath:c.deepLinkPath};n(e=>[m,...e]),m.recipientId?m.recipientId===s?.id&&(l(e=>[...e,m]),setTimeout(()=>{l(e=>e.filter(e=>e.id!==m.id))},5e3)):m.projectId&&m.projectName&&s&&(l(e=>[...e,m]),setTimeout(()=>{l(e=>e.filter(e=>e.id!==m.id))},5e3))},markAsRead:e=>{n(t=>t.map(t=>t.id===e?{...t,read:!0}:t))},markAllAsRead:()=>{n(e=>e.map(e=>s?e.recipientId&&e.recipientId!==s.id||!e.recipientId&&e.projectId&&!c(s.id,e.projectId)||!e.recipientId&&!e.projectId?e:{...e,read:!0}:e))},clearNotifications:()=>{n(e=>s?e.filter(e=>!(!e.recipientId||e.recipientId===s.id)||!(e.recipientId||!e.projectId||c(s.id,e.projectId))||!e.recipientId&&!e.projectId):e)},setDeepLinkHandler:d,handleNotificationDeepLink:e=>{if(!o)return;if(e.deepLinkPath){const t=(e=>{if(!e)return null;const t=e.split("?")[0].replace(/^\/+/,""),s=new URLSearchParams(e.split("?")[1]||""),a=t.split("/").filter(Boolean);if("project"===a[0]&&a[1]){const e=a[1],t=s.get("tab")||void 0;return"task"===a[2]&&a[3]?{view:"project-detail",projectId:e,taskId:a[3],targetTab:t}:"meeting"===a[2]&&a[3]?{view:"project-detail",projectId:e,meetingId:a[3],targetTab:"meetings"}:{view:"project-detail",projectId:e,targetTab:t}}return"projects"===a[0]?{view:"projects"}:"dashboard"===a[0]?{view:"dashboard"}:"designers"===a[0]?{view:"designers"}:"clients"===a[0]?{view:"clients"}:"vendors"===a[0]?{view:"vendors"}:"admins"===a[0]?{view:"admins"}:null})(e.deepLinkPath);if(t)return void o(t)}const t={view:e.projectId?"project-detail":"dashboard",projectId:e.projectId,taskId:e.taskId,meetingId:e.meetingId,targetTab:e.targetTab};o(t)}},children:[e,ie.jsx("div",{className:"fixed bottom-6 right-6 z-[100] flex flex-col gap-2 pointer-events-none",children:i.map(e=>ie.jsxs("div",{className:"bg-white rounded-lg shadow-xl border-l-4 p-4 w-80 pointer-events-auto transform transition-all animate-fade-in flex items-start gap-3",style:{borderColor:"error"===e.type?"#ef4444":"warning"===e.type?"#f59e0b":"success"===e.type?"#22c55e":"#3b82f6"},children:[ie.jsxs("div",{className:"mt-0.5",children:["success"===e.type&&ie.jsx(Ce,{className:"w-5 h-5 text-green-500"}),"error"===e.type&&ie.jsx(Se,{className:"w-5 h-5 text-red-500"}),"warning"===e.type&&ie.jsx(It,{className:"w-5 h-5 text-yellow-500"}),"info"===e.type&&ie.jsx(Ge,{className:"w-5 h-5 text-blue-500"})]}),ie.jsxs("div",{className:"flex-1",children:[ie.jsx("h4",{className:"font-bold text-gray-800 text-sm",children:e.title}),ie.jsx("p",{className:"text-xs text-gray-600 mt-1",children:e.message})]}),ie.jsx("button",{onClick:()=>{return t=e.id,void l(e=>e.filter(e=>e.id!==t));var t},className:"text-gray-400 hover:text-gray-600",children:ie.jsx(Et,{className:"w-4 h-4"})})]},e.id))})]})},Xa=()=>{const e=a.useContext(Ja);if(!e)throw new Error("useNotifications must be used within a NotificationProvider");return e},Qa=a.createContext({loading:!1,showLoading:()=>{},hideLoading:()=>{},message:null}),er=({children:e})=>{const[t,s]=a.useState(!1),[r,n]=a.useState(null);return ie.jsx(Qa.Provider,{value:{loading:t,showLoading:e=>{e&&n(e),s(!0);try{document.body.style.overflow="hidden"}catch(t){}},hideLoading:()=>{s(!1),n(null);try{document.body.style.overflow=""}catch(e){}},message:r},children:e})},tr=()=>a.useContext(Qa),sr=async(e,t,s,a="completed",r,n)=>{try{const i=(new Date).toISOString();let l=r||i,o=n||i;if(l&&!/^\d{4}-\d{2}-\d{2}/.test(l))l=i;else if(l){const e=new Date(l);isNaN(e.getTime())&&(l=i)}if(o&&!/^\d{4}-\d{2}-\d{2}/.test(o))o=i;else if(o){const e=new Date(o);isNaN(e.getTime())&&(o=i)}new Date(o)<new Date(l)&&(o=l);const d={projectId:e,title:t,description:s,status:a,type:"milestone",startDate:l,endDate:o,createdAt:(new Date).toISOString()};return await or(e,d)}catch(Cn){throw Cn}},ar=async(e,t,s)=>{try{const r=Object.fromEntries(Object.entries({...s}).filter(([e,t])=>void 0!==t));if(await P(T(ka,"projects",e,"tasks",t),{...r,updatedAt:new Date}),s.assigneeId){const t=T(ka,"projects",e);try{const e=await $(T(ka,"users",s.assigneeId));(e.exists()&&"Vendor"===e.data().role||(await $(T(ka,"vendors",s.assigneeId))).exists())&&await P(t,{vendorIds:z(s.assigneeId)})}catch(a){}}}catch(Cn){throw Cn}},rr=(e,t)=>E(C(ka,"projects",e,"tasks"),e=>{const s=e.docs.map(e=>({...e.data(),id:e.id}));t(s)},e=>{e.code}),nr=async(e,t)=>{try{const s=C(ka,"projects",e,"documents"),a=T(s),r=Object.fromEntries(Object.entries({...t}).filter(([e,t])=>void 0!==t));return await O(a,{...r,createdAt:new Date,updatedAt:new Date}),a.id}catch(Cn){throw Cn}},ir=async(e,t,s)=>{try{const a=Object.fromEntries(Object.entries({...s}).filter(([e,t])=>void 0!==t));await P(T(ka,"projects",e,"documents",t),{...a,updatedAt:new Date})}catch(Cn){throw Cn}},lr=(e,t)=>{const s=new Map,a=[],r=E(C(ka,"projects",e,"documents"),e=>{e.docs.forEach(e=>{const t=e.id,a=e.data();s.set(t,{...a,id:t,comments:a.comments||[]})}),s.forEach((t,a)=>{e.docs.find(e=>e.id===a)||s.delete(a)}),t(Array.from(s.values()))},e=>{e.code});return a.push(r),()=>{a.forEach(e=>e())}},or=async(e,t)=>{try{const s=C(ka,"projects",e,"timelines"),a=T(s),r=Object.fromEntries(Object.entries({...t}).filter(([e,t])=>void 0!==t));return await O(a,{...r,createdAt:new Date,updatedAt:new Date}),a.id}catch(Cn){throw Cn}};var dr,cr;(cr=dr||(dr={})).Unimplemented="UNIMPLEMENTED",cr.Unavailable="UNAVAILABLE";class mr extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const pr=(e=>e.Capacitor=(e=>{const t=e.CapacitorCustomPlatform||null,s=e.Capacitor||{},a=s.Plugins=s.Plugins||{},r=()=>null!==t?t.name:(e=>{var t,s;return(null==e?void 0:e.androidBridge)?"android":(null===(s=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===s?void 0:s.bridge)?"ios":"web"})(e),n=e=>{var t;return null===(t=s.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},i=new Map;return s.convertFileSrc||(s.convertFileSrc=e=>e),s.getPlatform=r,s.handleError=t=>e.console.error(t),s.isNativePlatform=()=>"web"!==r(),s.isPluginAvailable=e=>{const t=i.get(e);return!!(null==t?void 0:t.platforms.has(r()))||!!n(e)},s.registerPlugin=(e,l={})=>{const o=i.get(e);if(o)return o.proxy;const d=r(),c=n(e);let m;const p=a=>{let r;const n=(...n)=>{const i=(async()=>(!m&&d in l?m=m="function"==typeof l[d]?await l[d]():l[d]:null!==t&&!m&&"web"in l&&(m=m="function"==typeof l.web?await l.web():l.web),m))().then(t=>{const i=((t,a)=>{var r,n;if(!c){if(t)return null===(n=t[a])||void 0===n?void 0:n.bind(t);throw new mr(`"${e}" plugin is not implemented on ${d}`,dr.Unimplemented)}{const n=null==c?void 0:c.methods.find(e=>a===e.name);if(n)return"promise"===n.rtype?t=>s.nativePromise(e,a.toString(),t):(t,r)=>s.nativeCallback(e,a.toString(),t,r);if(t)return null===(r=t[a])||void 0===r?void 0:r.bind(t)}})(t,a);if(i){const e=i(...n);return r=null==e?void 0:e.remove,e}throw new mr(`"${e}.${a}()" is not implemented on ${d}`,dr.Unimplemented)});return"addListener"===a&&(i.remove=async()=>r()),i};return n.toString=()=>`${a.toString()}() { [capacitor code] }`,Object.defineProperty(n,"name",{value:a,writable:!1,configurable:!1}),n},x=p("addListener"),g=p("removeListener"),u=(e,t)=>{const s=x({eventName:e},t),a=async()=>{const a=await s;g({eventName:e,callbackId:a},t)},r=new Promise(e=>s.then(()=>e({remove:a})));return r.remove=async()=>{await a()},r},h=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return c?u:x;case"removeListener":return g;default:return p(t)}}});return a[e]=h,i.set(e,{name:e,proxy:h,platforms:new Set([...Object.keys(l),...c?[d]:[]])}),h},s.Exception=mr,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),xr=pr.registerPlugin;class gr{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const a=this.windowListeners[e];return a&&!a.registered&&this.addWindowListener(a),s&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const a=this.listeners[e];if(a)a.forEach(e=>e(t));else if(s){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new pr.Exception(e,dr.Unimplemented)}unavailable(e="not available"){return new pr.Exception(e,dr.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const a=s.indexOf(t);this.listeners[e].splice(a,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const ur=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),hr=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class br extends gr{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[s,a]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=hr(s).trim(),a=hr(a).trim(),t[s]=a}),t}async setCookie(e){try{const t=ur(e.key),s=ur(e.value),a=`; expires=${(e.expires||"").replace("expires=","")}`,r=(e.path||"/").replace("path=",""),n=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${a}; path=${r}; ${n};`}catch(Cn){return Promise.reject(Cn)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(Cn){return Promise.reject(Cn)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(Cn){return Promise.reject(Cn)}}async clearAllCookies(){try{await this.clearCookies()}catch(Cn){return Promise.reject(Cn)}}}xr("CapacitorCookies",{web:()=>new br});class yr extends gr{async request(e){const t=((e,t={})=>{const s=Object.assign({method:e.method||"GET",headers:e.headers},t),a=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((s,a,r)=>(s[a]=e[t[r]],s),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[s,a]of Object.entries(e.data||{}))t.set(s,a);s.body=t.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,s)=>{t.append(s,e)});else for(const s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(a.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s})(e,e.webFetchExtra),s=((e,t=!0)=>e?Object.entries(e).reduce((e,s)=>{const[a,r]=s;let n,i;return Array.isArray(r)?(i="",r.forEach(e=>{n=t?encodeURIComponent(e):e,i+=`${a}=${n}&`}),i.slice(0,-1)):(n=t?encodeURIComponent(r):r,i=`${a}=${n}`),`${e}&${i}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),a=s?`${e.url}?${s}`:e.url,r=await fetch(a,t),n=r.headers.get("content-type")||"";let i,l,{responseType:o="text"}=r.ok?e:{};switch(n.includes("application/json")&&(o="json"),o){case"arraybuffer":case"blob":l=await r.blob(),i=await(async e=>new Promise((t,s)=>{const a=new FileReader;a.onload=()=>{const e=a.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},a.onerror=e=>s(e),a.readAsDataURL(e)}))(l);break;case"json":i=await r.json();break;default:i=await r.text()}const d={};return r.headers.forEach((e,t)=>{d[t]=e}),{data:i,headers:d,status:r.status,url:r.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}var fr,vr,jr,Nr;xr("CapacitorHttp",{web:()=>new yr}),(vr=fr||(fr={})).Dark="DARK",vr.Light="LIGHT",vr.Default="DEFAULT",(Nr=jr||(jr={})).StatusBar="StatusBar",Nr.NavigationBar="NavigationBar";class wr extends gr{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}xr("SystemBars",{web:()=>new wr});const kr=xr("PushNotifications",{}),Ir=async e=>{if(pr.isNativePlatform())try{let t=await kr.checkPermissions();return"prompt"===t.receive&&(t=await kr.requestPermissions()),"granted"!==t.receive?null:(await kr.register(),new Promise(t=>{kr.addListener("registration",async({value:s})=>{if(s&&e){const t=T(ka,"users",e);(await $(t)).exists()&&await P(t,{fcmTokens:z(s)})}t(s)}),kr.addListener("registrationError",e=>{t(null)})}))}catch(Cn){return null}if(!Ca)return null;try{if("granted"===await Notification.requestPermission()){const t=await async function(){return ba(g(Ca),{vapidKey:"BC8fFC7blIHMaLia44KI9ALElvAUqVUTn_x_GL7Ce17SVafTMdVNyMIRSnxPu6UjbkSrisqkYJb2_XZvzTCKjq0"})}();if(t&&e){const s=T(ka,"users",e);(await $(s)).exists()&&await P(s,{fcmTokens:z(t)})}return t}return null}catch(Cn){return null}},Sr=async(e,t,s,a)=>{try{const r={recipientId:e,title:t,body:s,deepLinkPath:a?.deepLinkPath||"/",projectId:a?.projectId,taskId:a?.taskId,meetingId:a?.meetingId,targetTab:a?.targetTab,icon:a?.icon||"/icons/icon-192x192.png"};await fetch("https://sendpushnotification-jl3d2uhdra-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(Cn){}},Cr=({avatar:e,name:t,size:s="md",role:a})=>{const r=(e=>e.split(" ").slice(0,2).map(e=>e.charAt(0).toUpperCase()).join(""))(t),n=((e,t)=>{if("client"===t)return{bg:"bg-blue-100",text:"text-blue-700",border:"border-blue-200"};if("vendor"===t)return{bg:"bg-amber-100",text:"text-amber-700",border:"border-amber-200"};if("designer"===t||"team"===t)return{bg:"bg-indigo-100",text:"text-indigo-700",border:"border-indigo-200"};if("admin"===t)return{bg:"bg-gray-800",text:"text-white",border:"border-gray-700"};const s=[{bg:"bg-red-500",text:"text-white"},{bg:"bg-blue-500",text:"text-white"},{bg:"bg-green-500",text:"text-white"},{bg:"bg-purple-500",text:"text-white"},{bg:"bg-pink-500",text:"text-white"},{bg:"bg-yellow-500",text:"text-white"},{bg:"bg-indigo-500",text:"text-white"},{bg:"bg-teal-500",text:"text-white"},{bg:"bg-orange-500",text:"text-white"},{bg:"bg-cyan-500",text:"text-white"}];return s[e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%s.length]})(r,a),i=n.border?n.border:"border-gray-200";return ie.jsx("div",{className:`${{sm:"w-8 h-8 text-xs",md:"w-12 h-12 text-sm",lg:"w-16 h-16 text-lg"}[s]} ${n.bg} rounded-full flex items-center justify-center ${n.text} font-bold border-2 ${i}`,children:r})},Dr=e=>{if(void 0!==e.progress&&null!==e.progress)return Math.min(Math.max(e.progress,0),100);if(e.subtasks&&e.subtasks.length>0){const t=e.subtasks.filter(e=>e.isCompleted).length;return Math.round(t/e.subtasks.length*100)}return e.status===Wt.DONE||e.status===Wt.REVIEW?100:e.status===Wt.IN_PROGRESS?50:0},Ar=e=>{if(!e||0===e.length)return 0;const t=e.reduce((e,t)=>e+Dr(t),0);return Math.round(t/e.length)},Er=(e,t=Wt.TODO)=>{if(t===Wt.ABORTED||t===Wt.ON_HOLD)return t;const s=e.subtasks||[];if(0===s.length)return t;const a=s.filter(e=>e.isCompleted).length;if(0===a)return Wt.TODO;if(a===s.length){const t="approved"===e.approvals?.start?.client?.status,s="approved"===e.approvals?.start?.admin?.status,a="approved"===e.approvals?.completion?.client?.status,r="approved"===e.approvals?.completion?.admin?.status;return t&&s&&a&&r?Wt.DONE:Wt.REVIEW}return Wt.IN_PROGRESS},$r=e=>{try{const t=new Date(e);if(isNaN(t.getTime()))return e;const s=(new Date).getTime()-t.getTime(),a=Math.floor(s/1e3),r=Math.floor(a/60),n=Math.floor(r/60),i=Math.floor(n/24),l=Math.floor(i/7),o=Math.floor(i/30);return a<60?"Just now":r<60?`${r} minute${r>1?"s":""} ago`:n<24?`${n} hour${n>1?"s":""} ago`:i<7?`${i} day${i>1?"s":""} ago`:l<4?`${l} week${l>1?"s":""} ago`:`${o} month${o>1?"s":""} ago`}catch{return e}},Tr=e=>{if(!e)return"";try{let t;if(e.includes("-"))t=new Date(e);else if(e.includes("/")){const s=e.split("/");if(3!==s.length)return e;{const a=parseInt(s[0]),r=parseInt(s[1]),n=parseInt(s[2]);if(a>12)return e;t=new Date(n,r-1,a)}}else t=new Date(e);if(isNaN(t.getTime()))return e;const s=String(t.getDate()).padStart(2,"0");return`${s}/${String(t.getMonth()+1).padStart(2,"0")}/${t.getFullYear()}`}catch{return e}},Pr=e=>{if(!e)return"";try{if((e=e.trim()).includes("-")&&!e.includes("/"))return e;const[t,s,a]=e.split("/");if(!t||!s||!a)return e;const r=parseInt(t),n=parseInt(s),i=parseInt(a);return r<1||r>31||n<1||n>12?e:`${i}-${String(n).padStart(2,"0")}-${String(r).padStart(2,"0")}`}catch{return e}},Mr=async(e,t)=>{try{const s=C(ka,"projects",e,"finances"),a=T(s),r=Object.fromEntries(Object.entries({...t}).filter(([e,t])=>void 0!==t));return await O(a,{...r,createdAt:new Date,updatedAt:new Date}),a.id}catch(Cn){throw Cn}},Or=async(e,t,s)=>{try{const a=Object.fromEntries(Object.entries({...s}).filter(([e,t])=>void 0!==t));await P(T(ka,"projects",e,"finances",t),{...a,updatedAt:new Date})}catch(Cn){throw Cn}},Br=(e,t)=>E(C(ka,"projects",e,"finances"),e=>{const s=e.docs.map(e=>({...e.data(),id:e.id}));t(s)},e=>{e.code}),Rr=()=>"undefined"!=typeof window?window.location.origin:"https://btw-erp.web.app",Lr=async e=>{if(!e.to||!e.subject||!e.htmlContent)return{success:!1,error:"Missing required email fields"};try{const t={to:e.to,recipientName:e.recipientName||e.to.split("@")[0],subject:e.subject,htmlContent:e.htmlContent},s=await fetch("https://sendemail-jl3d2uhdra-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return s.ok?{success:!0,messageId:(await s.json()).messageId}:{success:!1,error:(await s.json()).error||"Failed to send email"}}catch(Cn){return{success:!1,error:Cn instanceof Error?Cn.message:"Unknown error"}}},Fr=async(e,t,s,a,r)=>{const n=`\n    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">\n      <div style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">\n        <h2 style="color: #fff; margin: 0; font-size: 24px;"> Task Reminder</h2>\n      </div>\n      \n      <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">\n        <p style="color: #333; font-size: 16px;">Hi <strong>${t}</strong>,</p>\n        \n        <p style="color: #555; font-size: 14px;">This is a friendly reminder about the following task:</p>\n        \n        <div style="background-color: #eff6ff; border-left: 4px solid #2563eb; padding: 15px; margin: 20px 0; border-radius: 4px;">\n          <p style="margin: 8px 0; color: #333;"><strong>Task:</strong> ${s}</p>\n          <p style="margin: 8px 0; color: #333;"><strong>Project:</strong> ${a}</p>\n          <p style="margin: 8px 0; color: #d97706;"><strong>Due Date:</strong> ${Tr(r)}</p>\n        </div>\n        \n        <p style="color: #555; font-size: 14px;">Please update the task status at your earliest convenience.</p>\n        \n        <p style="margin-top: 30px; color: #999; font-size: 12px; border-top: 1px solid #e5e7eb; padding-top: 20px;">\n          Regards,<br>\n          <strong>ID ERP System</strong>\n        </p>\n      </div>\n    </div>\n  `;return Lr({to:e,recipientName:t,subject:`Reminder: ${s}`,htmlContent:n})},zr=async(e,t,s,a=new Set)=>{const r=new Date,n=new Date(r.getTime()+864e5),i=new Date(r.getTime()+9e7);for(const l of e){const e=new Date(l.dueDate),r=`${l.id}-24h-reminder`;if(e>n&&e<i&&!a.has(r)){const e=t.find(e=>e.id===l.assigneeId);if(e?.email)try{(await Fr(e.email,e.name,l.title,s,l.dueDate)).success&&(a.add(r),await Sr(e.id,"Task Due Reminder",`Task "${l.title}" is due tomorrow in project ${s}`))}catch(Cn){}}}},Vr=async(e,t,s,a,r)=>{if(!t.email)return;const n=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: #dcfce7; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: #16a34a; margin: 0;"> Task Approved</h2>\n      </div>\n      \n      <p>Hi <strong>${t.name}</strong>,</p>\n      \n      <p>The task <strong>"${e}"</strong> in project <strong>${s}</strong> has been approved.</p>\n      \n      <div style="background-color: #f0fdf4; border-left: 4px solid #16a34a; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Task:</strong> ${e}</p>\n        <p style="margin: 5px 0;"><strong>Project:</strong> ${s}</p>\n        <p style="margin: 5px 0;"><strong>Approval Stage:</strong> ${r}</p>\n        <p style="margin: 5px 0;"><strong>Approved by:</strong> ${a}</p>\n      </div>\n      \n      <p>Great work! The task has been successfully approved and is moving forward.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;try{(await Lr({to:t.email,recipientName:t.name,subject:`Task Approved: ${e}`,htmlContent:n})).success&&await Sr(t.id,"Task Approved",`Task "${e}" in project ${s} has been approved by ${a}`)}catch(Cn){}},Ur=async(e,t,s,a,r="created")=>{if(!t||0===t.length)return;const n=`${Rr()}?projectId=${a}&meetingId=${e.id}&tab=meetings`,i="created"===r?"New Meeting Scheduled":"Meeting Updated",l="created"===r?"#0284c7":"#f59e0b",o=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: ${"created"===r?"#dbeafe":"#fef3c7"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: ${l}; margin: 0;"> ${i}</h2>\n      </div>\n      \n      <p>Hi <strong>Team</strong>,</p>\n      \n      <p>${"created"===r?"A new meeting has been scheduled":"A meeting has been updated"} for project <strong>${s}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid ${l}; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Meeting Title:</strong> ${e.title}</p>\n        <p style="margin: 5px 0;"><strong>Type:</strong> ${e.type}</p>\n        <p style="margin: 5px 0;"><strong>Date:</strong> ${Tr(e.date)}</p>\n        <p style="margin: 5px 0;"><strong>Project:</strong> ${s}</p>\n        ${e.notes?`<p style="margin: 5px 0;"><strong>Notes:</strong> ${e.notes}</p>`:""}\n      </div>\n      \n      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; margin: 20px 0;">\n        <p style="margin: 5px 0; font-weight: bold;">Attendees:</p>\n        <ul style="margin: 10px 0; padding-left: 20px;">\n          ${t.map(e=>`<li>${e.name}${e.email?` (${e.email})`:""}</li>`).join("")}\n        </ul>\n      </div>\n      \n      <div style="margin: 20px 0;">\n        <a href="${n}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          View Meeting Details\n        </a>\n      </div>\n      \n      <p>Click the button above to view the full meeting details and any additional information in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;for(const d of t)if(d.email)try{(await Lr({to:d.email,recipientName:d.name,subject:`${i}: ${e.title} - ${s}`,htmlContent:o})).success&&await Sr(d.id,i,`${"created"===r?"New meeting scheduled":"Meeting updated"}: ${e.title} in project ${s}`,n)}catch(Cn){}},Wr=async(e,t,s,a,r="created")=>{if(!t.email)return;const n=`${Rr()}?projectId=${a}&taskId=${e.id}&tab=plan`,i="created"===r?"New Task Assigned":"Task Updated",l="created"===r?"#0284c7":"#f59e0b",o=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: ${"created"===r?"#dbeafe":"#fef3c7"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: ${l}; margin: 0;"> ${i}</h2>\n      </div>\n      \n      <p>Hi <strong>${t.name}</strong>,</p>\n      \n      <p>${"created"===r?"You have been assigned a new task":"A task you are assigned to has been updated"} in project <strong>${s}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid ${l}; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Task:</strong> ${e.title}</p>\n        <p style="margin: 5px 0;"><strong>Category:</strong> ${e.category}</p>\n        <p style="margin: 5px 0;"><strong>Priority:</strong> <span style="color: ${"high"===e.priority?"#dc2626":"medium"===e.priority?"#f59e0b":"#059669"}; font-weight: bold;">${e.priority.toUpperCase()}</span></p>\n        <p style="margin: 5px 0;"><strong>Start Date:</strong> ${Tr(e.startDate)}</p>\n        <p style="margin: 5px 0;"><strong>Due Date:</strong> ${Tr(e.dueDate)}</p>\n        ${e.description?`<p style="margin: 5px 0;"><strong>Description:</strong> ${e.description}</p>`:""}\n      </div>\n      \n      <div style="margin: 20px 0;">\n        <a href="${n}" style="display: inline-block; background-color: ${l}; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          View Task Details\n        </a>\n      </div>\n      \n      <p>Click the button above to view the full task details and start working on it in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;try{(await Lr({to:t.email,recipientName:t.name,subject:`${i}: ${e.title} - ${s}`,htmlContent:o})).success&&await Sr(t.id,i,`${"created"===r?"New task assigned":"Task updated"}: ${e.title} in project ${s}`,n)}catch(Cn){}},_r=async(e,t,s,a,r,n="approved")=>{if(!s||0===s.length)return;const i=`${Rr()}?projectId=${r}&tab=documents&docId=${e.id}`,l="approved"===n,o=l?"Approved":"Rejected",d=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: ${l?"#dcfce7":"#fee2e2"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: ${l?"#16a34a":"#dc2626"}; margin: 0;">${l?"":""} Document ${o} by Admin</h2>\n      </div>\n      \n      <p>Hi Team,</p>\n      \n      <p>Document <strong>"${e.name}"</strong> has been <strong>${n}</strong> by admin <strong>${t}</strong> in project <strong>${a}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Document:</strong> ${e.name}</p>\n        <p style="margin: 5px 0;"><strong>Type:</strong> ${e.type||"Not specified"}</p>\n        <p style="margin: 5px 0;"><strong>Admin:</strong> ${t}</p>\n        <p style="margin: 5px 0;"><strong>Status:</strong> ${o}</p>\n      </div>\n      \n      <div style="margin: 20px 0;">\n        <a href="${i}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          View All Documents\n        </a>\n      </div>\n      \n      <p>Click the button above to view all documents and their approval status in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;for(const c of s)if(c.email)try{(await Lr({to:c.email,recipientName:c.name,subject:`Document ${o} by Admin: ${e.name} - ${a}`,htmlContent:d})).success&&await Sr(c.id,`Document ${o} by Admin`,`Document "${e.name}" in project ${a} has been ${n} by ${t}`,i)}catch(Cn){}},Gr=async(e,t,s,a,r,n="approved")=>{if(!s||0===s.length)return;const i=`${Rr()}?projectId=${r}&tab=documents`,l="approved"===n,o=l?"Approved":"Rejected",d=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: ${l?"#dcfce7":"#fee2e2"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: ${l?"#16a34a":"#dc2626"}; margin: 0;">${l?"":""} Document ${o} by Client</h2>\n      </div>\n      \n      <p>Hi Team,</p>\n      \n      <p>Document <strong>"${e.name}"</strong> has been <strong>${n}</strong> by client <strong>${t}</strong> in project <strong>${a}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Document:</strong> ${e.name}</p>\n        <p style="margin: 5px 0;"><strong>Type:</strong> ${e.type||"Not specified"}</p>\n        <p style="margin: 5px 0;"><strong>Client:</strong> ${t}</p>\n        <p style="margin: 5px 0;"><strong>Status:</strong> ${o}</p>\n      </div>\n      \n      <div style="margin: 20px 0;">\n        <a href="${i}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          View All Documents\n        </a>\n      </div>\n      \n      <p>Click the button above to view all documents and their approval status in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;for(const c of s)if(c.email)try{(await Lr({to:c.email,recipientName:c.name,subject:`Document ${o} by Client: ${e.name} - ${a}`,htmlContent:d})).success&&await Sr(c.id,`Document ${o} by Client`,`Document "${e.name}" in project ${a} has been ${n} by ${t}`,i)}catch(Cn){}},Hr=async(e,t,s,a,r,n="approved",i="admin",l="expense")=>{if(!s||0===s.length)return;const o=`${Rr()}?projectId=${r}&tab=financials`,d="approved"===n;let c="Financial Record";"additional-budget"===l?c="Additional Budget":"expense"===l?c="Expense":"payment"===l&&(c="Payment");const m=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: ${d?"#dcfce7":"#fee2e2"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: ${d?"#16a34a":"#dc2626"}; margin: 0;">${d?"":""} ${c} ${"approved"===n?"Approved":"Rejected"}</h2>\n      </div>\n      \n      <p>Hi Team,</p>\n      \n      <p>A ${c.toLowerCase()} has been <strong>${n}</strong> by <strong>${t}</strong> (${i}) in project <strong>${a}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Type:</strong> ${c}</p>\n        <p style="margin: 5px 0;"><strong>Description:</strong> ${e.description}</p>\n        <p style="margin: 5px 0;"><strong>Amount:</strong> ${e.amount.toLocaleString()}</p>\n        <p style="margin: 5px 0;"><strong>Status:</strong> ${e.status}</p>\n        <p style="margin: 5px 0;"><strong>Approved By:</strong> ${t}</p>\n        <p style="margin: 5px 0;"><strong>Approval Status:</strong> ${"approved"===n?"Approved ":"Rejected "}</p>\n      </div>\n\n      ${"additional-budget"===l?`\n        <div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 4px;">\n          <p style="margin: 5px 0; font-weight: bold;"> Additional Budget</p>\n          <p style="margin: 5px 0;">This is a request to increase the project budget by ${e.amount.toLocaleString()}. Approval from both Client and Admin is required.</p>\n        </div>\n      `:""}\n      \n      <div style="margin: 20px 0;">\n        <a href="${o}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          View Financial Records\n        </a>\n      </div>\n      \n      <p>Click the button above to view all financial records and their approval status in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;for(const p of s)if(p.email)try{(await Lr({to:p.email,recipientName:p.name,subject:`${c} ${"approved"===n?"Approved":"Rejected"}: ${e.description} - ${a}`,htmlContent:m})).success&&await Sr(p.id,`${c} ${"approved"===n?"Approved":"Rejected"}`,`${c} "${e.description}" in project ${a} has been ${n} by ${t}`,o)}catch(Cn){}},qr=({currentField:e,currentOrder:t,fields:s,onSort:a})=>ie.jsxs("div",{className:"flex items-center gap-1 bg-white/50 rounded-lg px-2 py-1 border border-gray-100",children:[ie.jsx("select",{value:e,onChange:e=>a(e.target.value,t),className:"text-[10px] font-bold bg-transparent border-none focus:ring-0 cursor-pointer text-gray-500 hover:text-gray-700 p-0","aria-label":"Sort field",title:"Sort field",children:s.map(e=>ie.jsx("option",{value:e.value,children:e.label},e.value))}),ie.jsx("button",{onClick:()=>a(e,"asc"===t?"desc":"asc"),className:"p-0.5 hover:bg-gray-200 rounded transition-colors text-gray-400 hover:text-gray-600",title:"Sort "+("asc"===t?"Descending":"Ascending"),children:"asc"===t?ie.jsx(be,{className:"w-3 h-3"}):ie.jsx(ue,{className:"w-3 h-3"})})]}),Kr=({projects:e,users:t,onSelectProject:s,onSelectTask:r})=>{const{user:n}=Ka(),[i,l]=a.useState(new Map),[o,d]=a.useState(new Map),[c,m]=a.useState(new Map),[p,x]=a.useState({}),[g,u]=a.useState({}),[h,b]=a.useState(new Set),[y,f]=a.useState({field:"activity",order:"desc"}),[v,j]=a.useState({field:"activity",order:"desc"}),[N,w]=a.useState({field:"activity",order:"desc"});if(!n)return null;a.useEffect(()=>{if(0===e.length)return;const t=[];return e.forEach(e=>{const s=rr(e.id,t=>{l(s=>new Map(s).set(e.id,t))});t.push(s);const a=lr(e.id,t=>{d(s=>new Map(s).set(e.id,t))});t.push(a);const r=Br(e.id,t=>{m(s=>new Map(s).set(e.id,t))});t.push(r)}),()=>{t.forEach(e=>e())}},[e]),a.useEffect(()=>{const s=async()=>{for(const s of e){const e=i.get(s.id)||s.tasks||[];await zr(e,t,s.name,h)}},a=new Date,r=new Date;r.setDate(r.getDate()+1),r.setHours(8,0,0,0);const n=r.getTime()-a.getTime(),l=setTimeout(()=>{s();const e=setInterval(s,864e5);return()=>clearInterval(e)},Math.max(0,n));return()=>clearTimeout(l)},[e,i,t,h]);const k=t=>i.get(t)||e.find(e=>e.id===t)?.tasks||[],I=e=>e?"string"==typeof e?new Date(e).getTime():e.toDate&&"function"==typeof e.toDate?e.toDate().getTime():e instanceof Date?e.getTime():new Date(e).getTime()||0:0,S=e=>{const t=(k(e.id)||[]).reduce((e,t)=>{const s=I(t.comments?.slice?.(-1)?.[0]?.timestamp),a=I(t.completedAt||t.modifiedAt||t.lastModified||t.createdAt||t.timestamp),r=Math.max(s||0,a||0);return Math.max(e,r||0)},0),s=I(e.documents?.slice?.(-1)?.[0]?.uploadDate),a=I(e.updatedAt||e.modifiedAt||e.lastModified||e.activityLog?.slice?.(-1)?.[0]?.timestamp||e.createdAt||s);return Math.max(a||0,t||0)},C=(e,t)=>{const s=I(e.comments?.slice?.(-1)?.[0]?.timestamp),a=I(e.completedAt||e.modifiedAt||e.createdAt||e.timestamp),r=t?S(t):0;return Math.max(s||0,a||0,r||0)},D=e=>{try{const t="approved"===e?.approvals?.completion?.admin?.status,s=e.status===Wt.DONE,a=e.status===Wt.REVIEW;return t&&(s||a)}catch(t){return!1}},A=t=>{const s=[],a=k(t.id),r=(i=t.id,o.get(i)||e.find(e=>e.id===i)?.documents||[]);var i;const l=(t=>c.get(t)||e.find(e=>e.id===t)?.financials||[])(t.id);return a.forEach(e=>{n.role===Ft.ADMIN?("pending"===e.approvals.start.admin.status&&s.push({label:`Start: ${e.title}`,type:"task",projectName:t.name,projectId:t.id,task:e}),"pending"===e.approvals.completion.admin.status&&s.push({label:`End: ${e.title}`,type:"task",projectName:t.name,projectId:t.id,task:e})):n.role===Ft.CLIENT?("pending"===e.approvals.start.client.status&&s.push({label:`Start: ${e.title}`,type:"task",projectName:t.name,projectId:t.id,task:e}),"pending"===e.approvals.completion.client.status&&s.push({label:`End: ${e.title}`,type:"task",projectName:t.name,projectId:t.id,task:e})):n.role===Ft.DESIGNER&&("pending"===e.approvals.start.designer?.status&&s.push({label:`Start: ${e.title}`,type:"task",projectName:t.name,projectId:t.id,task:e}),"pending"===e.approvals.completion.designer?.status&&s.push({label:`End: ${e.title}`,type:"task",projectName:t.name,projectId:t.id,task:e}))}),r.forEach(e=>{n.role===Ft.ADMIN?"pending"===e.approvalStatus&&s.push({label:`Doc: ${e.name}`,type:"doc",projectName:t.name,projectId:t.id}):n.role!==Ft.CLIENT||"approved"!==e.approvalStatus||"pending"!==e.clientApprovalStatus&&e.clientApprovalStatus||(Array.isArray(e.sharedWith)&&e.sharedWith.includes(n.id)||t.clientId===n.id||(t.clientIds||[]).includes(n.id))&&s.push({label:`Doc: ${e.name}`,type:"doc",projectName:t.name,projectId:t.id})}),l.forEach(e=>{n.role===Ft.ADMIN?(e.isAdditionalBudget&&"pending"===e.adminApprovalForAdditionalBudget&&s.push({label:`Budget: ${e.description}`,type:"fin",projectName:t.name,projectId:t.id}),e.isClientPayment&&"pending"===e.adminApprovalForPayment&&s.push({label:`Payment: ${e.description}`,type:"fin",projectName:t.name,projectId:t.id})):n.role===Ft.CLIENT&&(e.isAdditionalBudget&&"pending"===e.clientApprovalForAdditionalBudget&&s.push({label:`Budget: ${e.description}`,type:"fin",projectName:t.name,projectId:t.id}),e.isClientPayment&&"pending"===e.clientApprovalForPayment&&s.push({label:`Payment: ${e.description}`,type:"fin",projectName:t.name,projectId:t.id}))}),s};let E=e,$=[];if(n.role===Ft.CLIENT)E=e.filter(e=>[e.clientId,...e.clientIds||[]].filter(Boolean).includes(n.id));else if(n.role===Ft.DESIGNER){const t=new Set(e.filter(e=>e.leadDesignerId===n.id||(e.teamMembers||[]).includes(n.id)||(e.clientIds||[]).includes(n.id)).map(e=>e.id));E=e.filter(e=>t.has(e.id)),$=e.flatMap(e=>k(e.id).map(t=>({task:t,project:e}))).filter(e=>e.task.assigneeId===n.id)}else if(n.role===Ft.VENDOR){$=e.flatMap(e=>k(e.id).map(t=>({task:t,project:e}))).filter(e=>e.task.assigneeId===n.id);const t=new Set($.map(e=>e.project.id));E=e.filter(e=>t.has(e.id)||(e.vendorIds||[]).includes(n.id)||(e.teamMembers||[]).includes(n.id))}const T=({title:e,value:t,icon:s,color:a,onClick:r})=>ie.jsxs("div",{onClick:r,className:"bg-white p-5 md:p-6 rounded-xl border border-gray-100 flex items-center justify-between hover:shadow-sm transition-shadow "+(r?"cursor-pointer hover:border-gray-300":""),children:[ie.jsxs("div",{children:[ie.jsx("p",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wide mb-1",children:e}),ie.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:t})]}),ie.jsx("div",{className:`p-3 rounded-lg ${a} bg-opacity-10`,children:ie.jsx(s,{className:`w-6 h-6 ${a.replace("bg-","text-")}`})})]});return ie.jsxs("div",{className:"space-y-2 animate-fade-in max-w-7xl pb-12",children:[ie.jsxs("div",{className:"flex justify-between items-center mb-1 mt-4",children:[ie.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:(n.role,Ft.ADMIN,"Dashboard")}),ie.jsx("div",{className:"flex items-center gap-3",children:ie.jsx("span",{className:"text-sm text-gray-500 font-medium px-4 py-1.5 bg-white rounded-full border border-gray-200",children:(new Date).toLocaleDateString("en-IN",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})})]}),ie.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:n.role===Ft.VENDOR?ie.jsx(T,{title:"My Tasks",value:$.length,icon:Je,color:"bg-blue-500",onClick:()=>{const e=document.querySelector('[data-section="vendor-tasks"]');e?.scrollIntoView({behavior:"smooth"})}}):n.role===Ft.CLIENT?ie.jsx(T,{title:"Completed Tasks",value:E.flatMap(e=>k(e.id)).filter(e=>e.status===Wt.DONE).length,icon:De,color:"bg-green-500",onClick:()=>{const e=document.querySelector('[data-section="project-overview"]');e?.scrollIntoView({behavior:"smooth"})}}):null}),(n.role===Ft.ADMIN||n.role===Ft.DESIGNER||n.role===Ft.CLIENT)&&ie.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[ie.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-[600px]",children:[ie.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[ie.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[ie.jsx(ve,{className:"w-4 h-4 text-blue-500"}),"Active Projects"]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(qr,{currentField:y.field,currentOrder:y.order,onSort:(e,t)=>f({field:e,order:t}),fields:[{value:"activity",label:"Recent"},{value:"name",label:"Name"},{value:"progress",label:"Progress"}]}),ie.jsx("span",{className:"text-sm font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full",children:E.length})]})]}),ie.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:0===E.length?ie.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No active projects"}):[...E].sort((e,t)=>{let s=0;return"activity"===y.field?s=S(e)-S(t):"name"===y.field?s=e.name.localeCompare(t.name):"progress"===y.field&&(s=Ar(k(e.id))-Ar(k(t.id))),"desc"===y.order?-s:s}).map(e=>{const a=Ar(k(e.id)),n=k(e.id).filter(e=>e.status!==Wt.DONE&&!D(e)),i=g[e.id];return ie.jsxs("div",{className:"rounded-lg border border-gray-50 hover:border-blue-200 hover:bg-blue-50/30 transition-all",children:[ie.jsxs("div",{onClick:()=>s?.(e),className:"p-3 cursor-pointer group",children:[ie.jsxs("div",{className:"flex justify-between items-start gap-2",children:[ie.jsxs("div",{className:"flex-1 min-w-0",children:[ie.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-blue-600",children:e.name}),ie.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:e.clientIds?.map(e=>t.find(t=>t.id===e)?.name).filter(Boolean).join(", ")||t.find(t=>t.id===e.clientId)?.name||"No Client"})]}),ie.jsx(Ie,{className:"w-4 h-4 text-gray-300 group-hover:text-blue-400"})]}),ie.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[ie.jsx("div",{className:"flex-1 bg-gray-100 rounded-full h-1",children:ie.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${a}%`}})}),ie.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[a,"%"]})]})]}),n.length>0&&ie.jsxs("div",{className:"border-t border-gray-50",children:[ie.jsxs("button",{onClick:t=>{t.stopPropagation(),u(t=>({...t,[e.id]:!t[e.id]}))},className:"w-full px-3 py-2 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[ie.jsxs("span",{className:"text-xs font-semibold text-gray-600 flex items-center gap-1",children:[ie.jsx(Je,{className:"w-3 h-3"}),"Pending Tasks (",n.length,")"]}),ie.jsx(ke,{className:"w-3 h-3 text-gray-400 transition-transform "+(i?"rotate-180":"")})]}),i&&ie.jsxs("div",{className:"px-3 py-2 space-y-1 bg-gray-50/50",children:[n.slice(0,5).map(t=>ie.jsxs("div",{className:"w-full flex items-center justify-between px-2 py-1.5 rounded text-xs hover:bg-white transition-colors group/task",children:[ie.jsxs("button",{onClick:()=>r?.(t,e),className:"flex-1 text-left flex items-start gap-2 min-w-0",children:[ie.jsx("div",{className:"w-2 h-2 rounded-full mt-0.5 flex-shrink-0 "+(t.status===Wt.DONE?"bg-green-500":t.status===Wt.IN_PROGRESS?"bg-blue-500":"bg-gray-300")}),ie.jsxs("div",{className:"min-w-0 flex-1",children:[ie.jsx("p",{className:"text-gray-700 truncate font-medium",children:t.title}),t.dueDate&&ie.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:Tr(t.dueDate)})]})]}),t.status!==Wt.DONE&&ie.jsx("button",{onClick:s=>{s.stopPropagation(),(async(e,t)=>{const s=e.subtasks?.map(e=>({...e,isCompleted:!0}))||[];let a=e.status;a=e.status===Wt.REVIEW?Wt.DONE:Wt.REVIEW;try{await ar(t.id,e.id,{subtasks:s,status:a})}catch(Cn){}})(t,e)},className:"ml-2 p-1 text-gray-300 hover:text-green-500 opacity-0 group-hover/task:opacity-100 transition-all",title:"Mark as Done",children:ie.jsx(De,{className:"w-4 h-4"})})]},t.id)),n.length>5&&ie.jsxs("p",{className:"text-xs text-gray-400 text-center py-1",children:["+",n.length-5," more tasks"]})]})]})]},e.id)})})]}),ie.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-auto max-h-[500px] lg:h-[600px] lg:max-h-none",children:[ie.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[ie.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[ie.jsx(Je,{className:"w-4 h-4 text-amber-500"}),"Tasks"]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(qr,{currentField:v.field,currentOrder:v.order,onSort:(e,t)=>j({field:e,order:t}),fields:[{value:"activity",label:"Recent"},{value:"dueDate",label:"Due Date"},{value:"title",label:"Title"}]}),ie.jsx("span",{className:"text-sm font-bold text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:n.role===Ft.DESIGNER?$.filter(e=>e.task.status!==Wt.DONE&&!D(e.task)).length:E.reduce((e,t)=>e+k(t.id).filter(e=>e.status!==Wt.DONE&&!D(e)).length,0)})]})]}),ie.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:(n.role===Ft.DESIGNER?0===$.filter(e=>e.task.status!==Wt.DONE&&!D(e.task)).length:E.every(e=>0===k(e.id).filter(e=>e.status!==Wt.DONE&&!D(e)).length))?ie.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"All tasks completed! "}):(n.role===Ft.DESIGNER?$.filter(e=>e.task.status!==Wt.DONE&&!D(e.task)).map(({task:e,project:t})=>({...e,projectName:t.name,project:t})):E.flatMap(e=>k(e.id).filter(e=>e.status!==Wt.DONE&&!D(e)).map(t=>({...t,projectName:e.name,project:e})))).sort((e,t)=>{let s=0;return"activity"===v.field?s=C(e,e.project)-C(t,t.project):"dueDate"===v.field?s=new Date(e.dueDate).getTime()-new Date(t.dueDate).getTime():"title"===v.field&&(s=e.title.localeCompare(t.title)),"desc"===v.order?-s:s}).map(e=>{const s=t.find(t=>t.id===e.assigneeId);return ie.jsx("div",{className:"p-3 rounded-lg border border-gray-50 hover:border-amber-200 hover:bg-amber-50/30 transition-all cursor-pointer group relative",children:ie.jsxs("div",{onClick:()=>r?.(e,e.project),children:[ie.jsxs("div",{className:"flex justify-between items-start gap-2",children:[ie.jsxs("div",{className:"flex-1 min-w-0",children:[ie.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-amber-600",children:e.title}),ie.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[ie.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.projectName}),ie.jsx("span",{className:"text-xs text-gray-300",children:""}),ie.jsx("p",{className:"text-xs text-blue-500 font-medium truncate",children:s?.name||"Unassigned"})]})]}),ie.jsx("span",{className:"text-xs font-bold px-1.5 py-0.5 rounded shrink-0 "+(e.status===Wt.IN_PROGRESS?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"),children:e.status})]}),ie.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[ie.jsxs("span",{className:"text-xs text-gray-400 font-medium",children:["Due: ",Tr(e.dueDate)]}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-400"}),ie.jsxs("span",{className:"text-xs font-bold text-gray-500",children:[Dr(e),"%"]})]})]})]})},e.id)})})]}),ie.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-auto max-h-[500px] lg:h-[600px] lg:max-h-none",children:[ie.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[ie.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[ie.jsx(De,{className:"w-4 h-4 text-rose-500"}),"Pending Approvals"]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(qr,{currentField:"activity",currentOrder:y.order,onSort:(e,t)=>f(e=>({...e,order:t})),fields:[{value:"activity",label:"Recent"}]}),ie.jsx("span",{className:"text-sm font-bold text-rose-600 bg-rose-50 px-2 py-0.5 rounded-full",children:E.reduce((e,t)=>e+A(t).length,0)})]})]}),ie.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:E.every(e=>0===A(e).length)?ie.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No pending approvals"}):E.flatMap(e=>A(e).map(t=>({...t,project:e}))).sort((e,t)=>{const s=S(e.project)-S(t.project);return"desc"===y.order?-s:s}).map((e,t)=>ie.jsx("div",{onClick:()=>{"task"===e.type&&e.task?r?.(e.task,e.project):s?.(e.project,{initialTab:"documents"})},className:"p-3 rounded-lg border border-gray-50 hover:border-rose-200 hover:bg-rose-50/30 transition-all cursor-pointer group",children:ie.jsxs("div",{className:"flex items-start gap-3",children:[ie.jsx("div",{className:"shrink-0 mt-0.5 "+("task"===e.type?"text-blue-500":"doc"===e.type?"text-purple-500":"text-amber-500"),children:"task"===e.type?ie.jsx(Je,{className:"w-4 h-4"}):"doc"===e.type?ie.jsx(Le,{className:"w-4 h-4"}):ie.jsx(Me,{className:"w-4 h-4"})}),ie.jsxs("div",{className:"flex-1 min-w-0",children:[ie.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-rose-600",children:e.label}),ie.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:e.projectName})]}),ie.jsx(Se,{className:"w-4 h-4 text-rose-400 shrink-0"})]})},t))})]})]}),n.role===Ft.VENDOR&&ie.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:ie.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-100 lg:col-span-3","data-section":"vendor-tasks",children:[ie.jsxs("div",{className:"flex justify-between items-center mb-4",children:[ie.jsxs("h3",{className:"text-sm font-bold text-gray-800",children:["Your Active Tasks",ie.jsx("span",{className:"ml-2 text-sm text-gray-400 font-normal",children:"Real-time synced"})]}),ie.jsx(qr,{currentField:N.field,currentOrder:N.order,onSort:(e,t)=>w({field:e,order:t}),fields:[{value:"activity",label:"Recent"},{value:"dueDate",label:"Due Date"},{value:"title",label:"Title"}]})]}),ie.jsx("div",{className:"overflow-x-auto",children:ie.jsxs("table",{className:"w-full text-sm text-left",children:[ie.jsx("thead",{className:"bg-gray-50 text-gray-500 text-sm font-semibold",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-3 rounded-l-lg",children:"Task"}),ie.jsx("th",{className:"px-4 py-3",children:"Project"}),ie.jsx("th",{className:"px-4 py-3",children:"Due"}),ie.jsx("th",{className:"px-4 py-3 rounded-r-lg",children:"Status"})]})}),ie.jsxs("tbody",{className:"divide-y divide-gray-50",children:[$.filter(e=>e.task.status!==Wt.DONE).sort((e,t)=>{let s=0;return"activity"===N.field?s=C(e.task,e.project)-C(t.task,t.project):"dueDate"===N.field?s=new Date(e.task.dueDate).getTime()-new Date(t.task.dueDate).getTime():"title"===N.field&&(s=e.task.title.localeCompare(t.task.title)),"desc"===N.order?-s:s}).map(({task:e,project:t})=>ie.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer group",children:[ie.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",onClick:()=>r?.(e,t),children:e.title}),ie.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",onClick:()=>r?.(e,t),children:t.name}),ie.jsx("td",{className:"px-4 py-3 text-gray-500 text-sm",onClick:()=>r?.(e,t),children:Tr(e.dueDate)}),ie.jsx("td",{className:"px-4 py-3 flex items-center justify-between",children:ie.jsx("span",{className:"px-2.5 py-1 rounded-md text-sm font-semibold uppercase transition-colors\n                          "+(e.status===Wt.IN_PROGRESS?"bg-blue-100 text-blue-700":e.status===Wt.TODO?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"),onClick:()=>r?.(e,t),children:e.status})})]},e.id)),0===$.filter(e=>e.task.status!==Wt.DONE).length&&ie.jsx("tr",{children:ie.jsx("td",{colSpan:4,className:"text-center py-8 text-gray-400 text-sm",children:"All caught up! "})})]})]})})]})})]})},Yr=["General","Design and Planning","Execution"],Jr=()=>{const[e,t]=a.useState({loading:!1,error:null,success:!1});return{...e,createNewProject:async e=>{t({loading:!0,error:null,success:!1});try{const s=await(async e=>{try{const t=T(Aa),s=Ea(e);return await O(t,s),t.id}catch(Cn){throw Cn}})(e);return t({loading:!1,error:null,success:!0}),s}catch(Cn){throw t({loading:!1,error:Cn.message,success:!1}),Cn}},updateExistingProject:async(e,s)=>{t({loading:!0,error:null,success:!1});try{await $a(e,s),t({loading:!1,error:null,success:!0})}catch(Cn){throw t({loading:!1,error:Cn.message,success:!1}),Cn}},deleteExistingProject:async e=>{t({loading:!0,error:null,success:!1});try{await Ta(e),t({loading:!1,error:null,success:!0})}catch(Cn){throw t({loading:!1,error:Cn.message,success:!1}),Cn}}}},Zr=async(e,t)=>{try{if(!e||0===e.size)throw new Error(`Invalid file: ${e.name}. File size is 0 bytes.`);const s=V(Ia,t),a={contentType:e.type||"application/octet-stream",cacheControl:"public, max-age=31536000"},r=await U(s,e,a);if(!r||!r.ref)throw new Error("Upload snapshot is invalid");const n=await W(r.ref);if(!n)throw new Error("Failed to get download URL after upload");return n}catch(Cn){throw Error,Cn}},Xr=[{id:Wt.TODO,label:"Scheduled Tasks",color:"border-t-4 border-gray-400"},{id:Wt.IN_PROGRESS,label:"In Process",color:"border-t-4 border-blue-500"},{id:Wt.REVIEW,label:"In Review",color:"border-t-4 border-purple-500"},{id:Wt.ON_HOLD,label:"On Hold",color:"border-t-4 border-yellow-500"},{id:Wt.DONE,label:"Completed",color:"border-t-4 border-green-500"}],Qr=({tasks:e,users:t,onUpdateTaskStatus:s,onUpdateTaskPriority:r,onEditTask:n,onCompleteTask:i})=>{const{user:l}=Ka(),{addNotification:o}=Xa(),[d,c]=a.useState(null),m=e=>e===Wt.ABORTED||e===Wt.ON_HOLD,p=e=>{e.preventDefault()},x=e=>{const s=t.find(t=>t.id===e);return s?ie.jsx(Cr,{avatar:s.avatar,name:s.name,size:"sm",role:String(s.role).toLowerCase()}):ie.jsx(Cr,{avatar:"",name:"Unassigned",size:"sm"})},g=t=>t.status!==Wt.DONE&&(!(!t.dependencies||0===t.dependencies.length)&&e.filter(e=>t.dependencies?.includes(e.id)).some(e=>e.status!==Wt.DONE)),u=e=>{switch(e){case Wt.TODO:return"bg-gray-100 text-gray-600";case Wt.IN_PROGRESS:return"bg-blue-100 text-blue-600";case Wt.REVIEW:return"bg-purple-100 text-purple-600";case Wt.DONE:return"bg-green-100 text-green-600";case Wt.OVERDUE:return"bg-red-100 text-red-600";case Wt.ABORTED:return"bg-black text-white";case Wt.ON_HOLD:return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100"}};return ie.jsx("div",{className:"flex h-full overflow-x-auto gap-4 p-3 pb-6 items-start",children:Xr.map(t=>{let a;a=t.id===Wt.IN_PROGRESS?e.filter(e=>e.status===Wt.IN_PROGRESS||e.status===Wt.OVERDUE||e.status===Wt.ABORTED):e.filter(e=>e.status===t.id);const r=a.sort((e,t)=>e.dependencies?.includes(t.id)?1:t.dependencies?.includes(e.id)?-1:new Date(e.dueDate).getTime()-new Date(t.dueDate).getTime());return ie.jsxs("div",{className:`flex-shrink-0 w-80 bg-gray-50 rounded-lg p-4 flex flex-col h-full max-h-[calc(100vh-250px)] border border-gray-200 ${t.color}`,onDragOver:p,onDrop:e=>((e,t)=>{e.preventDefault(),d&&s&&(s(d,t),c(null))})(e,t.id),children:[ie.jsx("div",{className:"flex justify-between items-center mb-3 px-1",children:ie.jsxs("h3",{className:"font-bold text-gray-900 text-sm flex items-center gap-2",children:[t.label,ie.jsx("span",{className:"bg-white border border-gray-200 text-gray-600 text-xs px-2.5 py-0.5 rounded-full",children:r.length})]})}),ie.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-1",children:[r.map(t=>{const a=g(t)&&t.status!==Wt.DONE,r=m(t.status),d=Dr(t),p=l?.id===t.assigneeId;return ie.jsxs("div",{draggable:!a&&!r&&l?.role!==Ft.CLIENT,onDragStart:s=>!a&&!r&&l?.role!==Ft.CLIENT&&((t,s)=>{const a=e.find(e=>e.id===s);a&&m(a.status)?t.preventDefault():(c(s),t.dataTransfer.effectAllowed="move")})(s,t.id),onClick:()=>n(t),className:`bg-white p-3 md:p-4 rounded-lg shadow-sm border cursor-grab active:cursor-grabbing hover:shadow-md transition-all group relative\n                       ${a?"border-red-200 bg-red-50/50 cursor-not-allowed opacity-75":"border-gray-200"}\n                       ${r?"border-gray-300 bg-gray-100 opacity-80 cursor-not-allowed":""}\n                       ${t.status===Wt.DONE?"opacity-70 bg-gray-50":""}\n                    `,children:[r&&ie.jsx("div",{className:"absolute top-1 right-1 text-gray-500",title:`Frozen: ${t.status}`,children:t.status===Wt.ABORTED?ie.jsx(ye,{className:"w-3 h-3"}):ie.jsx(Ae,{className:"w-3 h-3"})}),ie.jsxs("div",{className:"flex justify-between items-center gap-1 mb-2",children:[ie.jsxs("div",{className:"flex items-center gap-0.5",children:[a&&ie.jsx("span",{title:"Locked by dependencies",className:"flex items-center",children:ie.jsx(Xe,{className:"w-3 h-3 text-red-400 flex-shrink-0"})}),ie.jsx("span",{className:"text-xs font-medium text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded border border-gray-200 flex-shrink-0",children:t.category})]}),ie.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-bold uppercase flex-shrink-0 ${u(t.status)}`,children:t.status})]}),ie.jsxs("div",{className:"flex justify-between items-start gap-0.5 mb-2",children:[ie.jsx("h4",{className:"font-bold text-sm group-hover:text-blue-600 transition-colors line-clamp-2 "+(a||r?"text-gray-500":"text-gray-900"),children:t.title}),(p||l?.role===Ft.ADMIN)&&!a&&!r&&t.status!==Wt.DONE&&l?.role!==Ft.CLIENT&&ie.jsxs("div",{className:"flex items-center",children:[ie.jsx("button",{onClick:e=>{e.stopPropagation(),i(t)},className:"text-gray-300 hover:text-green-500 transition-colors p-0.5 flex-shrink-0 mr-1",title:"Mark as Done",children:ie.jsx(Ce,{className:"w-4 h-4 text-green-500"})}),ie.jsx("button",{onClick:e=>((e,t)=>{if(e.stopPropagation(),m(t.status))return;if(g(t)&&t.status!==Wt.DONE)return void o("Locked","Cannot update task. Dependencies not met.","error");let a=t.status;t.status===Wt.TODO?a=Wt.IN_PROGRESS:t.status===Wt.IN_PROGRESS?a=Wt.REVIEW:t.status===Wt.REVIEW&&(a=Wt.DONE),s(t.id,a)})(e,t),className:"text-gray-300 hover:text-blue-500 transition-colors p-0.5 flex-shrink-0",title:"Advance Status",children:ie.jsx(he,{className:"w-4 h-4"})})]})]}),ie.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs",children:[ie.jsx("span",{className:"text-gray-400 font-medium",children:"Progress"}),ie.jsxs("span",{className:"text-gray-600 font-bold",children:[d,"%"]})]}),ie.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5 mb-3",children:ie.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500 "+(t.status===Wt.DONE?"bg-green-500":r?"bg-gray-400":"bg-blue-500"),style:{width:`${d}%`}})}),ie.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-50",children:[ie.jsx("div",{className:"flex items-center gap-1",children:x(t.assigneeId)}),ie.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[ie.jsx(Ne,{className:"w-3 h-3"}),ie.jsx("span",{children:Tr(t.dueDate)})]})]})]},t.id)}),0===r.length&&ie.jsx("div",{className:"h-16 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-sm text-gray-400 italic bg-white",children:"Drop items here"})]})]},t.id)})})},en=({isOpen:e,onClose:t,onSubmit:s,onUpdate:r,teamMembers:i,isLoading:l=!1,editingMeeting:o=null})=>{const[d,c]=a.useState({date:(new Date).toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),[m,p]=a.useState(!1),[x,g]=a.useState(!1);a.useEffect(()=>{c(o?{date:o.date,title:o.title,type:o.type,attendees:o.attendees,notes:o.notes}:{date:(new Date).toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),p(!1)},[o,e]);const u=e=>{c(t=>({...t,attendees:t.attendees.includes(e)?t.attendees.filter(t=>t!==e):[...t.attendees,e]}))};return e?n.createPortal(ie.jsxs(ie.Fragment,{children:[ie.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[999]",onClick:t}),ie.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[9999] p-2 md:p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-[95vh] md:max-h-[90vh] overflow-y-auto animate-fade-in",onClick:e=>e.stopPropagation(),children:[ie.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 flex justify-between items-center flex-shrink-0",children:[ie.jsx("h2",{className:"text-2xl md:text-xl font-bold text-gray-800",children:o?"Edit Meeting":"Add Meeting"}),ie.jsx("button",{onClick:t,title:"Close modal",className:"p-1 hover:bg-gray-100 rounded-md transition-colors flex-shrink-0",children:ie.jsx(Et,{className:"w-5 h-5 md:w-4 md:h-4 text-gray-500"})})]}),ie.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d.date&&d.title&&d.type||(p(!0),0))try{g(!0),o&&r?await r({...o,...d}):await s(d),o||c({date:(new Date).toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),p(!1),t()}catch(Cn){}finally{g(!1)}},className:"p-3 md:p-4 space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("label",{htmlFor:"meeting-date",className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Date ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{id:"meeting-date",type:"date",title:"Select meeting date",value:d.date||"",onChange:e=>c(t=>({...t,date:e.target.value})),className:"w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800\n                  "+(m&&!d.date?"border-red-500":"border-gray-200")}),m&&!d.date&&ie.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting date is required"})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Title ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"text",placeholder:"e.g., Client Kickoff, Site Visit Review",value:d.title,onChange:e=>c(t=>({...t,title:e.target.value})),className:"w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800\n                  "+(m&&!d.title?"border-red-500":"border-gray-200")}),m&&!d.title&&ie.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting title is required"})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Type ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"text",placeholder:"e.g., Discovery, Progress Review, Site Visit, Vendor Meet, Design Presentation",value:d.type,onChange:e=>c(t=>({...t,type:e.target.value})),className:"w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800\n                  "+(m&&!d.type?"border-red-500":"border-gray-200")}),m&&!d.type&&ie.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting type is required"})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-2",children:[ie.jsx(Dt,{className:"w-4 h-4 inline mr-1"}),"Add Attendees"]}),0===i.length?ie.jsx("p",{className:"text-base md:text-base text-gray-500 bg-gray-50 p-2 rounded-md",children:"No team members available. Add members to the project first."}):ie.jsx("div",{className:"grid grid-cols-2 gap-1.5 max-h-[200px] overflow-y-auto border border-gray-200 rounded-md p-2 bg-gray-50",children:i.map(e=>ie.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-md transition-colors text-left cursor-pointer bg-white border border-gray-200 hover:border-gray-300",children:[ie.jsx("input",{type:"checkbox",checked:d.attendees.includes(e.id),onChange:()=>u(e.id),title:`Add ${e.name} to meeting`,className:"w-4 h-4 rounded cursor-pointer"}),ie.jsx(Cr,{name:e.name,avatar:e.avatar,size:"sm",role:String(e.role).toLowerCase()}),ie.jsxs("div",{className:"min-w-0 flex-1",children:[ie.jsx("div",{className:"text-base md:text-sm font-medium text-gray-800 truncate",children:e.name}),ie.jsx("div",{className:"text-base md:text-sm text-gray-500 truncate",children:e.role})]})]},e.id))}),d.attendees.length>0&&ie.jsxs("div",{className:"mt-3",children:[ie.jsxs("p",{className:"text-base md:text-sm font-semibold text-gray-700 mb-2",children:["Selected Attendees (",d.attendees.length,"):"]}),ie.jsx("div",{className:"bg-white border border-gray-200 rounded-md p-2 space-y-1.5",children:d.attendees.map(e=>{const t=i.find(t=>t.id===e);return t?ie.jsxs("div",{className:"flex items-center justify-between bg-gray-50 px-2 py-1.5 rounded border border-gray-100",children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(Cr,{name:t.name,avatar:t.avatar,size:"sm",role:String(t.role).toLowerCase()}),ie.jsxs("div",{children:[ie.jsx("div",{className:"text-base md:text-sm font-medium text-gray-800",children:t.name}),ie.jsx("div",{className:"text-base md:text-sm text-gray-500",children:t.role})]})]}),ie.jsx("button",{type:"button",onClick:()=>u(t.id),className:"text-red-500 hover:text-red-700 p-0.5",title:`Remove ${t.name} from meeting`,children:ie.jsx(Et,{className:"w-2.5 h-2.5"})})]},e):null})})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:"Notes"}),ie.jsx("textarea",{placeholder:"Add any notes, decisions, or action items from the meeting",value:d.notes,onChange:e=>c(t=>({...t,notes:e.target.value})),rows:3,className:"w-full px-2 py-1.5 text-base md:text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:border-gray-800 resize-none"})]}),ie.jsxs("div",{className:"flex gap-2 justify-end pt-3 border-t border-gray-200",children:[ie.jsx("button",{type:"button",onClick:t,disabled:x||l,className:"px-3 py-1.5 border border-gray-300 rounded-md text-gray-700 font-medium text-base md:text-xs hover:bg-gray-50 transition-colors disabled:opacity-50 focus:outline-none focus:ring-1 focus:ring-gray-800",children:"Cancel"}),ie.jsxs("button",{type:"submit",disabled:x||l,className:"px-3 py-1.5 bg-gray-800 text-white rounded-md font-medium text-base md:text-xs hover:bg-gray-900 transition-colors disabled:opacity-50 flex items-center gap-1.5 focus:outline-none focus:ring-1 focus:ring-gray-800",children:[o?ie.jsx(it,{className:"w-4 h-4 md:w-3 md:h-3"}):ie.jsx(dt,{className:"w-4 h-4 md:w-3 md:h-3"}),x||l?"Saving...":o?"Update Meeting":"Add Meeting"]})]})]})]})})]}),document.body):null},tn=({size:e="md",color:t="currentColor",className:s=""})=>ie.jsx("div",{className:`spinner ${{sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[e]} ${s}`,style:{display:"inline-block",width:"sm"===e?"12px":"lg"===e?"20px":"16px",height:"sm"===e?"12px":"lg"===e?"20px":"16px",border:"2px solid",borderColor:`${t}40`,borderTopColor:t,borderRightColor:t,borderRadius:"50%",animation:"spin 0.6s linear infinite"}}),sn='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"%3E%3Ccircle cx="12" cy="12" r="12" fill="%23e5e7eb"/%3E%3C/svg%3E',an=({project:e,users:t,onUpdateProject:s,onBack:i,initialTab:l,initialTask:o,onCloseTask:d})=>{const{user:c}=Ka(),{addNotification:m}=Xa(),{updateExistingProject:p,deleteExistingProject:x}=Jr(),{updateExistingRecord:g,deleteExistingRecord:u}=(e=>{const[t,s]=a.useState({loading:!1,error:null,success:!1});return{...t,createNewRecord:async t=>{s({loading:!0,error:null,success:!1});try{const a=await Mr(e,t);return s({loading:!1,error:null,success:!0}),a}catch(Cn){throw s({loading:!1,error:Cn.message,success:!1}),Cn}},updateExistingRecord:async(t,a)=>{s({loading:!0,error:null,success:!1});try{await Or(e,t,a),s({loading:!1,error:null,success:!0})}catch(Cn){throw s({loading:!1,error:Cn.message,success:!1}),Cn}},deleteExistingRecord:async t=>{s({loading:!0,error:null,success:!1});try{await(async(e,t)=>{try{await B(T(ka,"projects",e,"finances",t))}catch(Cn){throw Cn}})(e,t),s({loading:!1,error:null,success:!0})}catch(Cn){throw s({loading:!1,error:Cn.message,success:!1}),Cn}}}})(e.id),{showLoading:h,hideLoading:b}=tr(),[y,f]=a.useState(()=>{const e=localStorage.getItem("lastProjectTab");return l||e||"meetings"});a.useEffect(()=>{localStorage.setItem("lastProjectTab",y)},[y]);const[v,j]=a.useState("list"),[N,w]=a.useState(!!o),[k,I]=a.useState(o||null),[S,D]=a.useState(!0),A=a.useRef(N);a.useEffect(()=>{A.current&&!N&&d&&d(),A.current=N},[N,d]);const[M,R]=a.useState(!1),[L,F]=a.useState("details"),[V,U]=a.useState(null),[W,_]=a.useState(!1),[G,H]=a.useState(""),[q,K]=a.useState(new Set),Y=a.useRef(null),J=a.useRef(null),[Z,X]=a.useState(null),[Q,ee]=a.useState(new Set),te=e=>Q.has(e),se=e=>{ee(t=>new Set([...t,e]))},ae=e=>{ee(t=>{const s=new Set(t);return s.delete(e),s})},[re,ne]=a.useState(!1),[le,oe]=a.useState({name:"",type:"other",sharedWith:[]}),[de,ce]=a.useState([]),[me,pe]=a.useState(!1),xe=a.useRef(null),[ge,ue]=a.useState(null),[be,ve]=a.useState(!1),[je,ke]=a.useState(""),[De,Te]=a.useState(!1),[Pe,Me]=a.useState(!1),[We,Ge]=a.useState(null),[qe,Je]=a.useState([]),[Ze,Qe]=a.useState(!1),[et,tt]=a.useState(!1),[rt,ot]=a.useState(null),[ct,mt]=a.useState({date:(new Date).toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0}),[pt,gt]=a.useState(""),[ut,ht]=a.useState(""),[yt,ft]=a.useState(""),[vt,It]=a.useState(""),[$t,Tt]=a.useState(!1),[Pt,Mt]=a.useState(!1),[Ot,Bt]=a.useState("all"),[Rt,Lt]=a.useState(!1),[Vt,Ut]=a.useState(!1),[_t,Gt]=a.useState(""),[Ht,qt]=a.useState("member"),[Kt,Yt]=a.useState(!1),[Jt,Zt]=a.useState(null),[Xt,Qt]=a.useState(!1),[es,ts]=a.useState({}),[ss,as]=a.useState({}),[rs,ns]=a.useState({}),[is,ls]=a.useState(!1),[os,ds]=a.useState(null),[cs,ms]=a.useState(!1),[ps,xs]=a.useState(!1),[gs,us]=a.useState(null),[hs,bs]=a.useState(!1),[ys,fs]=a.useState(null),[vs,js]=a.useState(!1),[Ns,ws]=a.useState(null),[ks,Is]=a.useState(!1),[Ss,Cs]=a.useState(null),[Ds,As]=a.useState(null),[Es,$s]=a.useState(e.designerChargePercentage??0),[Ts,Ps]=a.useState(!1);a.useEffect(()=>{$s(e.designerChargePercentage??0)},[e.designerChargePercentage]);const[Ms,Os]=a.useState(!1),[Bs,Rs]=a.useState(""),[Ls,Fs]=a.useState(""),[zs,Vs]=a.useState([]),[Us,Ws]=a.useState([]),[_s,Gs]=a.useState([]),[Hs,qs]=a.useState([]),[Ks,Ys]=a.useState([]),Js=Ks,Zs=Hs,Xs=a.useMemo(()=>c?.role===Ft.VENDOR?Zs.filter(e=>e.assigneeId===c.id):Zs,[Zs,c?.id,c?.role]);if(a.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("taskId");if(e&&Zs.length>0){const t=Zs.find(t=>t.id===e);t&&(I(t),w(!0),window.history.replaceState({},document.title,window.location.pathname))}},[Zs]),a.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("meetingId");if(e&&zs.length>0){const t=zs.find(t=>t.id===e);t&&(f("meetings"),Zt(t),Yt(!0),window.history.replaceState({},document.title,window.location.pathname))}},[zs]),a.useEffect(()=>{e&&(Zs.length>0||Js.length>0)&&(async()=>{const t=(new Date).toISOString().split("T")[0],s=Zs.filter(e=>e.dueDate<t&&e.status!==Wt.DONE&&e.status!==Wt.OVERDUE&&e.status!==Wt.ABORTED&&e.status!==Wt.ON_HOLD&&e.status!==Wt.REVIEW);if(s.length>0)for(const r of s)await ar(e.id,r.id,{status:Wt.OVERDUE});const a=Js.filter(e=>"pending"===e.status&&e.date<t);if(a.length>0)for(const e of a)await g(e.id,{...e,status:"overdue"})})()},[Zs,Js,e.id]),a.useEffect(()=>{Y.current&&Y.current.scrollIntoView({behavior:"smooth"})},[k?.comments]),a.useEffect(()=>{const t=(s=e.id,a=t=>{Vs(t),t.forEach(t=>{var s,a,r;s=e.id,a=t.id,r=e=>{ts(s=>({...s,[t.id]:e}))},E(C(ka,"projects",s,"meetings",a,"comments"),e=>{const t=e.docs.map(e=>({...e.data(),id:e.id}));r(t)})})},E(C(ka,"projects",s,"meetings"),e=>{const t=e.docs.map(e=>({...e.data(),id:e.id}));a(t)},e=>{e.code}));var s,a;return()=>t()},[e.id]),a.useEffect(()=>{const t=lr(e.id,e=>{Ws(e)});return()=>t()},[e.id]),a.useEffect(()=>{const t=(e=>{try{const t=C(ka,"projects",e,"timelines");return E(t,e=>{(e=>{Gs(e)})(e.docs.map(e=>({...e.data(),id:e.id})))},e=>{e.code})}catch(Cn){throw Cn}})(e.id);return()=>t()},[e.id]),a.useEffect(()=>{if(be&&ge){const e=Us.find(e=>e.id===ge.id);e&&ue(e)}},[Us,be,ge?.id]),a.useEffect(()=>{const t=rr(e.id,e=>{qs(e)});return()=>t()},[e.id]),a.useEffect(()=>{if(N&&k&&k.id){const e=Hs.find(e=>e.id===k.id);e&&I(e)}},[Hs,N,k?.id]),a.useEffect(()=>{const t=Br(e.id,e=>{Ys(e)});return()=>t()},[e.id]),a.useEffect(()=>{(Js.length>0||e.financials.length>0)&&(async()=>{try{const t=Js.filter(e=>"income"===e.type&&"Additional Budget"===e.category).reduce((e,t)=>e+t.amount,0),a=(e.initialBudget||e.budget)+t;await P(T(ka,"projects",e.id),{budget:a}),s({...e,budget:a})}catch(Cn){}})()},[Js,e.id]),a.useEffect(()=>{l&&f(l)},[l]),a.useEffect(()=>{if(J.current){const e=J.current.querySelector(`[data-tab-id="${y}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}},[y]),a.useEffect(()=>{c?.role!==Ft.VENDOR||"discovery"!==y&&"timeline"!==y&&"financials"!==y||f("plan")},[c?.role,y]),!c)return null;const Qs=c.role===Ft.CLIENT,ea=c.role===Ft.VENDOR,ta=c.role===Ft.ADMIN,sa=c.role===Ft.DESIGNER&&e.leadDesignerId===c.id,aa=ta,ra=!ea,[na,ia]=a.useState(null),[la,oa]=a.useState(null),da=(s,a)=>{if(!s)return"Unknown User";if(s===c.id)return c.name||"You";if(a&&a.trim())return a;const r=t.find(e=>e.id===s);if(r?.name)return r.name;if(s===e.leadDesignerId){const e=t.find(e=>e.id===s);if(e?.name)return e.name}if(s===e.clientId){const e=t.find(e=>e.id===s);if(e?.name)return e.name}return"Unknown User"},ca=a.useMemo(()=>{const s=new Set;return e.clientId&&s.add(e.clientId),e.clientIds&&e.clientIds.forEach(e=>s.add(e)),e.leadDesignerId&&s.add(e.leadDesignerId),e.vendorIds&&e.vendorIds.forEach(e=>s.add(e)),e.hiddenVendors&&e.hiddenVendors.forEach(e=>s.add(e)),t.filter(e=>e.role===Ft.ADMIN).forEach(e=>s.add(e.id)),e.tasks.forEach(e=>{e.assigneeId&&s.add(e.assigneeId)}),e.teamMembers&&e.teamMembers.forEach(e=>s.add(e)),t.filter(e=>s.has(e.id))},[e,t]),ma=async s=>{const a=ss[s];if(a&&a.trim()){if(!rs[s])try{ns(e=>({...e,[s]:!0}));let r=c.name||"Unknown User";const n=t.find(e=>e.id===c.id);n?.name&&(r=n.name);const i={userId:c.id,userName:r,text:a,timestamp:(new Date).toISOString()};await(async(e,t,s)=>{try{const a=C(ka,"projects",e,"meetings",t,"comments"),r=T(a),n=Object.fromEntries(Object.entries({...s}).filter(([e,t])=>void 0!==t));return await O(r,{...n,createdAt:new Date}),r.id}catch(Cn){throw Cn}})(e.id,s,i);const l=zs.find(e=>e.id===s);if(l){const s=[],a=t.filter(e=>e.role===Ft.ADMIN&&e.tenantId===c.tenantId&&e.id!==c.id);if(s.push(...a),l.attendees&&l.attendees.length>0){const e=t.filter(e=>l.attendees.includes(e.id)&&e.id!==c.id);s.push(...e)}const n=s.filter((e,t,s)=>s.findIndex(t=>t.id===e.id)===t);n.length>0&&await(async(e,t,s,a,r)=>{const n=`/projects?projectId=${e.id}`;for(const i of r)if(i.email)try{const r=`\n        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n          <h2 style="color: #1f2937;">New Comment on Meeting</h2>\n          <p>Hi ${i.name},</p>\n          <p><strong>${s}</strong> commented on a meeting in project <strong>${a}</strong>:</p>\n          \n          <div style="background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">\n            <p style="margin: 0; color: #4b5563;"><strong>Meeting:</strong> ${e.title}</p>\n            <p style="margin: 10px 0 0 0; color: #6b7280;">"${t.text}"</p>\n          </div>\n          \n          <p style="margin-top: 20px;">\n            <a href="${n}" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">View Meeting</a>\n          </p>\n        </div>\n      `;(await Lr({to:i.email,recipientName:i.name,subject:`New Comment on Meeting: ${e.title} - ${a}`,htmlContent:r})).success&&await Sr(i.id,`New Comment on Meeting - ${a}`,`${s} commented on "${e.title}": ${t.text.substring(0,100)}${t.text.length>100?"...":""}`,n)}catch(Cn){}})(l,{...i,id:"temp"},r,e.name,n)}as(e=>({...e,[s]:""})),m("Success","Comment added successfully","success")}catch(Cn){m("Error","Failed to add comment","error")}finally{ns(e=>({...e,[s]:!1}))}}else m("Validation Error","Please enter a comment","error")},pa=()=>{ms(!0)},xa=(s,a,r,n)=>{const i=[...t.filter(e=>e.role===Ft.ADMIN),t.find(t=>t.id===e.leadDesignerId),...Array.from(new Set([e.clientId,...e.clientIds||[]].filter(Boolean))).map(e=>t.find(t=>t.id===e)).filter(e=>!!e)];e.teamMembers&&e.teamMembers.forEach(e=>{const s=t.find(t=>t.id===e);s&&s.role!==Ft.VENDOR&&i.push(s)}),Array.from(new Set(i.filter(e=>!!e&&e.id!==r&&e.role!==Ft.VENDOR))).forEach(t=>{m(s,a,"info",t.id,e.id,e.name,n)})},ga=(t,s,a,r="info",n)=>{t&&t!==c.id&&m(s,a,r,t,e.id,e.name,n)},ua=(e,t,s="info")=>({id:Math.random().toString(36).substr(2,9),userId:c.id,action:e,details:t,timestamp:(new Date).toISOString(),type:s}),ha=e=>e===Wt.ABORTED||e===Wt.ON_HOLD,ba=e=>!!ha(e.status)||!(!e.dependencies||0===e.dependencies.length)&&Zs.filter(t=>e.dependencies?.includes(t.id)).some(e=>e.status!==Wt.DONE),ya=e=>e.dependencies?Zs.filter(t=>e.dependencies?.includes(t.id)&&t.status!==Wt.DONE):[],fa=e=>{return(t=e.approvalDate||e.clientApprovedDate||e.uploadDate||e.approvalDate||e.rejectionDate||e.uploadDate)?"string"==typeof t?new Date(t).getTime():t.toDate&&"function"==typeof t.toDate?t.toDate().getTime():t instanceof Date?t.getTime():new Date(t).getTime()||0:0;var t},va=(e,t=!1)=>`\n    w-full p-2 border rounded-lg transition-all focus:outline-none placeholder-gray-400\n    ${t?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-white text-gray-900"}\n    ${e?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}\n  `,ja=e=>{c.role!==Ft.VENDOR||e.assigneeId===c.id?(I({...e,approvals:e.approvals||{start:{client:{status:"pending"},admin:{status:"pending"}},completion:{client:{status:"pending"},admin:{status:"pending"}}}}),w(!0),R(!1)):m("Access Restricted","You can only view details of tasks assigned to you.","warning")},[Na,wa]=a.useState(!1),Ia=e=>{const t=document.createElement("a");t.href=e.url,t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),m("Download Started",`Downloading ${e.name}...`,"success")},Sa=e=>{ws(e),js(!0)},Ca=e=>{const t=Us.find(t=>t.id===e.id)||e;ue(t),ve(!0)},Da=async s=>{if(!te(`approve-doc-${s.id}`)){se(`approve-doc-${s.id}`);try{await ir(e.id,s.id,{approvalStatus:"approved",approvedBy:c.id,approvalDate:(new Date).toISOString()}),await new Promise(e=>setTimeout(e,500));const a=new Set;e.leadDesignerId&&a.add(e.leadDesignerId),s.uploadedBy&&a.add(s.uploadedBy),(s.sharedWith||[]).forEach(e=>a.add(e)),e.clientId&&s.sharedWith?.includes(e.clientId)&&a.add(e.clientId),t.filter(e=>e.role===Ft.ADMIN&&e.tenantId===c.tenantId).forEach(e=>a.add(e.id));const r=t.filter(e=>a.has(e.id));r.length>0&&await _r(s,c.name||"Unknown User",r,e.name,e.id,"approved"),m("Success",`Document "${s.name}" approved`,"success")}catch(Cn){m("Error","Failed to approve document","error")}finally{ae(`approve-doc-${s.id}`)}}},Aa=async s=>{if(!te(`reject-doc-${s.id}`)){se(`reject-doc-${s.id}`);try{await ir(e.id,s.id,{approvalStatus:"rejected",rejectedBy:c.id,rejectionDate:(new Date).toISOString()}),await new Promise(e=>setTimeout(e,500));const a=new Set;t.filter(e=>e.role===Ft.ADMIN).forEach(e=>a.add(e.id)),e.leadDesignerId&&a.add(e.leadDesignerId),s.uploadedBy&&a.add(s.uploadedBy),(s.sharedWith||[]).forEach(e=>{e!==c.id&&a.add(e)});const r=t.filter(e=>a.has(e.id));r.length>0&&await _r(s,c.name||"Unknown User",r,e.name,e.id,"rejected"),m("Success",`Document "${s.name}" rejected`,"success")}catch(Cn){m("Error","Failed to reject document","error")}finally{ae(`reject-doc-${s.id}`)}}},Ea=async()=>{if(je.trim()&&ge&&!De)try{Te(!0);const a={userId:c.id,userName:c.name||"Unknown User",text:je,timestamp:(new Date).toISOString()};await(async(e,t,s)=>{try{const a=T(ka,"projects",e,"documents",t),r=Object.fromEntries(Object.entries({...s}).filter(([e,t])=>void 0!==t)),n=Math.random().toString(36).substr(2,9),i={id:n,userId:r.userId||"",text:r.text||"",timestamp:r.timestamp||(new Date).toISOString(),...r};return await P(a,{comments:z(i)}),n}catch(Cn){throw Cn}})(e.id,ge.id,a);const r={...a,id:Math.random().toString(36).substr(2,9)},n=t.filter(t=>t.id===e.leadDesignerId||t.role===Ft.ADMIN&&t.tenantId===c.tenantId||t.id===e.clientId||!!ge.sharedWith?.includes(t.id));n.length>0&&await(async(e,t,s,a,r,n)=>{if(!a||0===a.length)return;const i=`${Rr()}?projectId=${n}&tab=documents&docId=${e.id}`,l=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: #0284c7; margin: 0;"> New Comment on Document</h2>\n      </div>\n      \n      <p>Hi Team,</p>\n      \n      <p><strong>${s}</strong> added a comment to document <strong>"${e.name}"</strong> in project <strong>${r}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Document:</strong> ${e.name}</p>\n        <p style="margin: 5px 0;"><strong>Type:</strong> ${e.type||"Not specified"}</p>\n        <p style="margin: 5px 0;"><strong>Commenter:</strong> ${s}</p>\n        <p style="margin: 5px 0;"><strong>Admin Approval:</strong> ${e.approvalStatus||"Pending"}</p>\n      </div>\n      \n      <div style="background-color: #fff8f0; border-left: 4px solid #ea580c; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0 10px 0; font-weight: bold;">Comment:</p>\n        <p style="margin: 0; white-space: pre-wrap; color: #333;">${t.text}</p>\n      </div>\n      \n      <div style="margin: 20px 0;">\n        <a href="${i}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          View Document & Comments\n        </a>\n      </div>\n      \n      <p>Click the button above to view the full document and all comments in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;for(const o of a)if(o.id!==t.userId&&o.email)try{(await Lr({to:o.email,recipientName:o.name,subject:`New Comment on Document: ${e.name} - ${r}`,htmlContent:l})).success&&await Sr(o.id,"New Comment on Document",`${s} commented on document "${e.name}" in project ${r}: ${t.text.substring(0,50)}${t.text.length>50?"...":""}`,i)}catch(Cn){}})(ge,r,c.name||"Unknown User",n,e.name,e.id),ke("");const i=(new Date).toISOString();await sr(e.id,`Document Comment: ${ge.name}`,`${c.name} commented: "${je.substring(0,100)}..."`,"completed",i,i);const l=ua("Document Comment",`Added comment to "${ge.name}"`);s({...e,activityLog:[l,...e.activityLog||[]]}),m("Success",`Comment added to "${ge.name}"`,"success")}catch(Cn){m("Error","Unable to add comment. Please try again.","error")}finally{Te(!1)}},$a=e=>{if(e){const s=Js.find(t=>t.id===e);if(s)if(mt(s),ot(e),"Others"===s.category?gt(s.description||""):gt(""),"income"===s.type){if(s.paidByRole)ft(s.paidByRole),It(s.paidTo||"");else if(s.paidByOther)ft("other"),It(s.paidByOther||"");else if(s.paidTo){const e=t.find(e=>e.name===s.paidTo);e?e.role===Ft.CLIENT?ft("client"):e.role===Ft.VENDOR?ft("vendor"):e.role===Ft.DESIGNER?ft("designer"):e.role===Ft.ADMIN&&ft("admin"):ft("other"),It(s.paidTo||"")}if(s.receivedByRole)ft(s.receivedByRole),ht(s.receivedBy||s.receivedByName||"");else if(s.receivedBy){const e=t.find(e=>e.name===s.receivedBy);e?e.role===Ft.VENDOR?ft("vendor-received"):e.role===Ft.DESIGNER?ft("designer-received"):e.role===Ft.ADMIN&&ft("admin-received"):ft("other-received"),ht(s.receivedBy||"")}}else if("expense"===s.type)if(s.paidByOther&&mt({...s,paidBy:"other"}),s.receivedByRole)ft(s.receivedByRole),ht(s.receivedByName||s.receivedBy||"");else if(s.receivedBy){const e=t.find(e=>e.name===s.receivedBy);e?e.role===Ft.CLIENT?ft("client"):e.role===Ft.VENDOR?ft("vendor"):e.role===Ft.DESIGNER?ft("designer"):e.role===Ft.ADMIN&&ft("admin"):ft("other"),ht(s.receivedBy||"")}}else mt({date:(new Date).toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0,paymentMode:void 0}),ot(null),It(""),ht(""),ft(""),gt("");tt(!0),Tt(!1)},Ta=async(a,r,n)=>{if(!te(`approve-budget-${a}-${r}-${n}`)){se(`approve-budget-${a}-${r}-${n}`);try{const i="client"===r?"clientApprovalForAdditionalBudget":"adminApprovalForAdditionalBudget",l=Ks.some(e=>e.id===a);l&&await Or(e.id,a,{[i]:n});const o=Js.find(e=>e.id===a);if(o){const d={...o,[i]:n},m="approved"===n?"Approved":"Rejected",p="client"===r?"Client":"Admin",x="client"===r?"approved"===n:"approved"===d.clientApprovalForAdditionalBudget,g="admin"===r?"approved"===n:"approved"===d.adminApprovalForAdditionalBudget,u=x&&g;if(u&&"paid"!==o.status){const t=e.budget+o.amount;let r={...e,budget:t,initialBudget:e.initialBudget||e.budget};s(r),l&&await Or(e.id,a,{status:"paid"})}await sr(e.id,u?`Additional Budget Approved: ${o.amount.toLocaleString()}`:`Additional Budget ${m}`,u?`Budget increased by ${o.amount.toLocaleString()}. Both Client and Admin have approved. New Total: ${(e.budget+o.amount).toLocaleString()}`:`${p} ${"approved"===n?"approved":"rejected"} additional budget of ${o.amount.toLocaleString()}`,u?"completed":"in-progress",(new Date).toISOString(),(new Date).toISOString());const h=t.filter(t=>t.id===e.leadDesignerId||t.id===e.clientId||t.role===Ft.ADMIN&&t.tenantId===c.tenantId);h.length>0&&await Hr(o,c.name||"Unknown User",h,e.name,e.id,n,r,"additional-budget")}m("Success",`Additional budget ${"approved"===n?"approved":"rejected"} by ${"client"===r?"Client":"Admin"}`,"success",void 0,e.id,e.name)}catch(Cn){m("Error","Unable to process approval. Please try again.","error",void 0,e.id,e.name)}finally{ae(`approve-budget-${a}-${r}-${n}`)}}},Pa=async(s,a,r)=>{if(!te(`approve-payment-${s}-${a}-${r}`)){se(`approve-payment-${s}-${a}-${r}`);try{const n="client"===a?"clientApprovalForPayment":"adminApprovalForPayment";Ks.some(e=>e.id===s)&&await Or(e.id,s,{[n]:r});const i=Js.find(e=>e.id===s);if(i){const s="approved"===r?"Confirmed":"Disputed",n="client"===a?"Client":"Admin",l=(new Date).toISOString();await sr(e.id,`Payment ${s}`,`${n} ${"approved"===r?"confirmed":"disputed"} payment of ${i.amount.toLocaleString()} for ${i.description}`,"approved"===r?"completed":"in-progress",l,l);const o=t.filter(t=>t.id===e.leadDesignerId||t.id===e.clientId||t.role===Ft.ADMIN&&t.tenantId===c.tenantId);o.length>0&&await Hr(i,c.name||"Unknown User",o,e.name,e.id,r,a,"payment")}m("Success",`Payment ${"approved"===r?"confirmed":"disputed"} by ${"client"===a?"Client":"Admin"}`,"success",void 0,e.id,e.name)}catch(Cn){m("Error","Unable to process approval. Please try again.","error",void 0,e.id,e.name)}finally{ae(`approve-payment-${s}-${a}-${r}`)}}},Ma=a.useCallback(async(s,a,r)=>{if(te(`approve-expense-${s}-${a}-${r}`))return;se(`approve-expense-${s}-${a}-${r}`);const n="client"===a?"clientApproved":"adminApproved";try{Ks.some(e=>e.id===s)&&await Or(e.id,s,{[n]:r});const i=Js.find(e=>e.id===s);if(i){const s=t.filter(t=>t.id===e.leadDesignerId||t.id===e.clientId||t.role===Ft.ADMIN&&t.tenantId===c.tenantId);s.length>0&&await Hr(i,c.name||"Unknown User",s,e.name,e.id,r?"approved":"rejected",a,"expense")}m("Success",`Expense ${r?"approved":"rejected"} by ${"client"===a?"client":"admin"}`,"success",void 0,e.id,e.name)}catch(Cn){m("Error","Unable to process approval. Please try again.","error",void 0,e.id,e.name)}finally{ae(`approve-expense-${s}-${a}-${r}`)}},[e.id,m,Ks,Js,e.leadDesignerId,e.clientId,t,c.name]),Oa=(e,t)=>{if(!e.phone||!e.phone.trim())return void m("Error",`WhatsApp number not found for ${e.name}`,"error");const s=e.phone.replace(/\D/g,"");if(s.length<10)return void m("Error",`Invalid WhatsApp number for ${e.name}`,"error");const a=`https://wa.me/${s}?text=${encodeURIComponent(t)}`;window.open(a,"_blank")},Ba=t=>{const s=`${window.location.origin}${window.location.pathname}?taskId=${t}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(s).then(()=>{m("Success","Task link copied to clipboard!","success",c?.id,e.id,e.name)}).catch(()=>{Ra(s)}):Ra(s)},Ra=t=>{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select();try{document.execCommand("copy"),m("Success","Task link copied to clipboard!","success",c?.id,e.id,e.name)}catch(a){m("Error","Failed to copy task link","error",c?.id,e.id,e.name)}document.body.removeChild(s)},La=async t=>{if(ha(t.status))return void m("Action Blocked","Task is frozen.","error");const s=t.subtasks?.map(e=>({...e,isCompleted:!0}))||[];let a=t.status;a=t.status===Wt.REVIEW?Wt.DONE:Wt.REVIEW;try{await ar(e.id,t.id,{subtasks:s,status:a}),m("Success",`Task marked as ${a}`,"success")}catch(Cn){m("Error","Failed to complete task","error")}},Fa=async()=>{if(!G.trim()||!k)return;if(ha(k.status))return void m("Frozen","Cannot comment on frozen tasks.","error");const s={id:Math.random().toString(36).substr(2,9),userId:c.id,userName:c.name||"Unknown User",text:G,timestamp:(new Date).toISOString()},a=[...k.comments||[],s];if(I({...k,comments:a}),H(""),k.id)try{await ar(e.id,k.id,{comments:a});const r=t.filter(t=>t.id===k.assigneeId||t.id===e.leadDesignerId||t.role===Ft.ADMIN&&t.tenantId===c.tenantId||t.id===e.clientId);r.length>0&&await(async(e,t,s,a,r,n)=>{if(!a||0===a.length)return;const i=`${Rr()}?projectId=${n}&taskId=${e.id}&tab=plan`,l=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: #0284c7; margin: 0;"> New Comment on Task</h2>\n      </div>\n      \n      <p>Hi Team,</p>\n      \n      <p><strong>${s}</strong> added a comment to task <strong>"${e.title}"</strong> in project <strong>${r}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Task:</strong> ${e.title}</p>\n        <p style="margin: 5px 0;"><strong>Category:</strong> ${e.category}</p>\n        <p style="margin: 5px 0;"><strong>Status:</strong> ${e.status}</p>\n        <p style="margin: 5px 0;"><strong>Commenter:</strong> ${s}</p>\n      </div>\n      \n      <div style="background-color: #fff8f0; border-left: 4px solid #ea580c; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0 10px 0; font-weight: bold;">Comment:</p>\n        <p style="margin: 0; white-space: pre-wrap; color: #333;">${t.text}</p>\n      </div>\n      \n      <div style="margin: 20px 0;">\n        <a href="${i}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          View Task & Comments\n        </a>\n      </div>\n      \n      <p>Click the button above to view the full task and all comments in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;for(const o of a)if(o.id!==t.userId&&o.email)try{(await Lr({to:o.email,recipientName:o.name,subject:`New Comment on Task: ${e.title} - ${r}`,htmlContent:l})).success&&await Sr(o.id,`New Comment on Task - ${r}`,`${s} commented on "${e.title}": ${t.text.substring(0,80)}${t.text.length>80?"...":""}`,i)}catch(Cn){}})(k,s,c.name||"Unknown User",r,e.name,e.id)}catch(Cn){}},za=async(t,a,r)=>{if(!k||!k.approvals)return;if(ha(k.status))return;const n=`${t}-${a}-${r||(Qs?"client":"admin")}`;if(!V){U(n);try{if("revoke"===a){if(!ta)return void m("Access Denied","Only admins can revoke approvals","error");if(!r)return;const s="approved"===k.approvals?.[t]?.client?.status,a="approved"===k.approvals?.[t]?.admin?.status;if(s&&a)return void m("Locked","Cannot revoke approvals once both parties have approved.","error");const n={...k.approvals,[t]:{...k.approvals[t],[r]:{status:"pending",updatedBy:c.id,timestamp:(new Date).toISOString()}}};if(I({...k,approvals:n}),k.id)try{await ar(e.id,k.id,{approvals:n});const s=(new Date).toISOString();await sr(e.id,`Approval Revoked: ${k.title}`,`${t} approval revoked for ${r} by ${c.name}`,"in-progress",s,s),m("Approval Revoked",`${r} approval for ${t} stage revoked.`,"info")}catch(Cn){m("Error","Failed to revoke approval","error")}return}const n=c.role===Ft.CLIENT?"client":c.role===Ft.ADMIN?"admin":null;if(!n)return;const i="approve"===a?"approved":"rejected";let l={...k.approvals,[t]:{...k.approvals[t],[n]:{status:i,updatedBy:c.id,timestamp:(new Date).toISOString()}}},o=k.status;if("reject"===a)o="start"===t?Wt.TODO:Wt.IN_PROGRESS,m("Task Rejected","Status has been reset. Please review comments.","warning"),k.assigneeId&&ga(k.assigneeId,"Work Rejected",`${c.name} rejected ${t} approval for "${k.title}".`,"warning","plan");else{const s="approved"===l.start?.client?.status,a="approved"===l.start?.admin?.status,r="approved"===l.completion?.client?.status,i="approved"===l.completion?.admin?.status;if(s&&a&&r&&i){if(o=Wt.DONE,m("Task Approved","Task fully approved and marked as DONE.","success"),k.assigneeId){ga(k.assigneeId,"Work Approved",`Great job! "${k.title}" is officially approved and done in "${e.name}".`,"success","plan");const t=ca.find(e=>e.id===k.assigneeId);t&&t.email&&k.title&&await Vr(k.title,t,e.name,c.name,"completion")}}else if("completion"===t){if(m("Approved",`Task completion approved by ${n}. Waiting for others.`,"success"),k.assigneeId){const t=ca.find(e=>e.id===k.assigneeId);t&&t.email&&k.title&&await Vr(k.title,t,e.name,c.name,"completion")}}else if(m("Approved",`Task ${t} approved.`,"success"),k.assigneeId){const s=ca.find(e=>e.id===k.assigneeId);s&&s.email&&k.title&&await Vr(k.title,s,e.name,c.name,t)}}if(I({...k,approvals:l,status:o}),k.id)try{await ar(e.id,k.id,{approvals:l,status:o});const r=Zs.map(e=>e.id===k.id?{...e,approvals:l,status:o}:e);s({...e,tasks:r});const n=(new Date).toISOString();await sr(e.id,`Approval: ${k.title}`,`${t} approval ${a}ed by ${c.name}`,"completed",n,n)}catch(Cn){m("Error","Failed to save approval status","error")}await new Promise(e=>setTimeout(e,500))}finally{U(null)}}},{received:Va,paidOut:Ua,pendingExpenses:Wa,totalAdditionalBudget:_a}={received:Js.filter(e=>"income"===e.type&&"paid"===e.status).reduce((e,t)=>e+t.amount,0),pendingIncome:Js.filter(e=>"income"===e.type&&("pending"===e.status||"overdue"===e.status)).reduce((e,t)=>e+t.amount,0),paidOut:Js.filter(e=>"expense"===e.type&&"paid"===e.status).reduce((e,t)=>e+t.amount,0),pendingExpenses:Js.filter(e=>"expense"===e.type&&("pending"===e.status||"overdue"===e.status)).reduce((e,t)=>e+t.amount,0),additionalBudgetReceived:Js.filter(e=>"income"===e.type&&"Additional Budget"===e.category&&"paid"===e.status).reduce((e,t)=>e+t.amount,0),totalAdditionalBudget:Js.filter(e=>"income"===e.type&&"Additional Budget"===e.category).reduce((e,t)=>e+t.amount,0)},Ga=a.useMemo(()=>Js.filter(e=>"all"===Ot||("income"===Ot?"income"===e.type:"expense"===Ot?"expense"===e.type:"pending"===Ot?"pending"===e.status:"overdue"!==Ot||"overdue"===e.status)).sort((e,t)=>{const s=e.timestamp?new Date(e.timestamp).getTime():new Date(e.date).getTime();return(t.timestamp?new Date(t.timestamp).getTime():new Date(t.date).getTime())-s}),[Js,Ot]),Ha=e=>{const t=Yr.indexOf(e);return-1===t?999:t},qa=a.useMemo(()=>{if(0===Zs.length)return null;const t=Zs.flatMap(e=>[new Date(e.startDate).getTime(),new Date(e.dueDate).getTime()]);t.push(new Date(e.startDate).getTime()),t.push(new Date(e.deadline).getTime());const s=Math.min(...t),a=Math.max(...t),r=a-s,n=864e5;return{minDate:s,maxDate:a,totalDays:Math.ceil(r/n)+5,dayMs:n}},[e,Zs]),Ya=a.useMemo(()=>{if(!qa)return[];const e=Xs.reduce((e,t)=>(e[t.category]=e[t.category]||[],e[t.category].push(t),e),{}),t=[];return Object.keys(e).sort((e,t)=>Ha(e)-Ha(t)).forEach(s=>{const a=e[s].sort((e,t)=>new Date(e.startDate).getTime()-new Date(t.startDate).getTime());t.push(...a)}),t.map((e,t)=>{const s=new Date(e.startDate).getTime(),a=new Date(e.dueDate).getTime(),r=qa.maxDate-qa.minDate,n=(s-qa.minDate)/r*100,i=(a-s)/r*100;return{...e,left:n,width:Math.max(i,.5),index:t}})},[Xs,qa]),Ja=a.useMemo(()=>{const e=new Set(Zs.map(e=>e.assigneeId));return t.filter(t=>t.role===Ft.VENDOR&&e.has(t.id))},[Zs,t]),Za=a.useMemo(()=>{const s=new Map;return Ja.forEach(e=>s.set(e.id,e)),e.teamMembers&&e.teamMembers.forEach(e=>{const a=t.find(t=>t.id===e);a&&a.role===Ft.VENDOR&&s.set(a.id,a)}),Array.from(s.values())},[Ja,e.teamMembers,t]),Qa=a.useMemo(()=>{if(ta||sa)return Za;const t=e.hiddenVendors||[];return Za.filter(e=>!t.includes(e.id))},[Za,e.hiddenVendors,ta,sa]),er=a.useMemo(()=>{const e={};return Qa.forEach(t=>{const s=t.specialty||"General";e[s]||(e[s]=[]),e[s].push(t)}),e},[Qa]),or=a.useMemo(()=>Object.keys(er).sort((e,t)=>Ha(e)-Ha(t)),[er]);a.useEffect(()=>{if(k&&k.id){const e=Zs.find(e=>e.id===k.id);e&&JSON.stringify(e.documents)!==JSON.stringify(k.documents)&&I(t=>t&&t.id===k.id?{...t,documents:e.documents}:t)}},[Zs,k?.id]);const dr=e=>e&&0!==e.length?e.filter(e=>Us.some(t=>t.id===e)).length:0,cr=!!k&&ha(k.status);return ie.jsxs("div",{className:"h-full flex flex-col animate-fade-in relative",children:[ie.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-2 flex flex-col md:flex-row items-start md:items-center justify-between sticky top-0 z-10 shadow-sm gap-3 md:gap-0",children:[!S&&ie.jsxs("div",{className:"w-full space-y-3",children:[ie.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 animate-pulse"}),ie.jsx("div",{className:"h-4 bg-gray-100 rounded w-1/2 animate-pulse"})]}),S&&ie.jsxs(ie.Fragment,{children:[ie.jsxs("div",{className:"flex items-start gap-3 md:gap-4 w-full md:w-auto flex-1",children:[ie.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-800 transition-colors flex-shrink-0 mt-1",title:"Go back to project list",children:ie.jsx(Ie,{className:"w-5 h-5 rotate-180"})}),ie.jsxs("div",{className:"flex-1 min-w-0",children:[ie.jsxs("div",{className:"flex items-start justify-between gap-2",children:[ie.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 truncate",children:e.name}),ta&&ie.jsx("button",{onClick:pa,className:"md:hidden flex items-center gap-2 px-2 py-1.5 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-xs font-medium whitespace-nowrap flex-shrink-0",title:"Delete Project",children:ie.jsx(kt,{className:"w-5 h-5"})})]}),ie.jsx("div",{className:"flex flex-wrap items-center gap-3 md:gap-4 text-sm md:text-xs text-gray-500 mt-4 md:mt-3",children:ta&&ie.jsxs("button",{onClick:async()=>{if(e.status===zt.ON_HOLD){const s=Zs.some(e=>"Execution"===e.category&&(e.status===Wt.IN_PROGRESS||e.status===Wt.DONE))?zt.EXECUTION:zt.PLANNING;if(window.confirm(`Resume project to ${s}?`))try{await p(e.id,{status:s}),m("Project Resumed",`Project resumed to ${s}`,"success")}catch(t){m("Error","Failed to resume project","error")}}else if(window.confirm("Are you sure you want to put this project ON HOLD?"))try{await p(e.id,{status:zt.ON_HOLD}),m("Project On Hold","Project status set to On Hold","warning")}catch(t){m("Error","Failed to update status","error")}},className:"text-sm md:text-xs font-bold flex items-center gap-1 px-2 py-0.5 rounded-md border transition-colors whitespace-nowrap "+(e.status===zt.ON_HOLD?"text-green-600 bg-green-50 border-green-100 hover:bg-green-100":"text-orange-600 bg-orange-50 border-orange-100 hover:bg-orange-100"),title:e.status===zt.ON_HOLD?"Resume Project":"Put Project On Hold",children:[e.status===zt.ON_HOLD?ie.jsx(Ee,{className:"w-3 h-3"}):ie.jsx(Ae,{className:"w-3 h-3"}),e.status===zt.ON_HOLD?"Resume":"Hold"]})}),ie.jsxs("div",{className:"flex flex-wrap items-center gap-3 md:gap-4 text-base md:text-sm text-gray-600 mt-3 md:mt-3",children:[ie.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[ie.jsx($e,{className:"w-4 h-4 flex-shrink-0"})," Due: ",Tr(e.deadline)]}),!ea&&ie.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[ie.jsx(At,{className:"w-4 h-4 flex-shrink-0"})," Budget: ",e.budget.toLocaleString()]})]})]})]}),ie.jsxs("div",{className:"flex gap-2 md:gap-3 w-full md:w-auto flex-shrink-0",children:[ta&&ie.jsxs("button",{onClick:pa,className:"hidden md:flex items-center gap-2 px-3 md:px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm md:text-xs font-medium whitespace-nowrap",title:"Delete Project",children:[ie.jsx(kt,{className:"w-5 h-5 flex-shrink-0"}),ie.jsx("span",{className:"hidden md:inline",children:"Delete"})]}),aa&&"timeline"!==y&&ie.jsxs(ie.Fragment,{children:[ie.jsxs("button",{onClick:()=>{if("plan"===y){const e=(new Date).toISOString().split("T")[0];I({startDate:e,dueDate:e}),w(!0),R(!1)}"documents"===y&&(ne(!0),ce([])),"financials"===y&&$a(),"team"===y&&(Ut(!0),Gt("")),"discovery"===y&&Yt(!0)},className:"hidden md:flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm md:text-xs font-medium whitespace-nowrap flex-1 md:flex-none justify-center md:justify-start",children:[ie.jsx(dt,{className:"w-4 h-4 flex-shrink-0"}),ie.jsx("span",{children:"plan"===y?"Add Task":"documents"===y?"Add Document":"financials"===y?"Add Transaction":"team"===y?"Add Member":"discovery"===y?"Add Meeting":"Add Item"})]}),ie.jsx("button",{onClick:()=>{if("plan"===y){const e=(new Date).toISOString().split("T")[0];I({startDate:e,dueDate:e}),w(!0),R(!1)}"documents"===y&&(ne(!0),ce([])),"financials"===y&&$a(),"team"===y&&(Ut(!0),Gt("")),"discovery"===y&&Yt(!0)},className:"md:hidden fixed bottom-6 right-6 z-40 w-14 h-14 bg-gray-900 text-white rounded-full shadow-xl flex items-center justify-center hover:bg-gray-800 transition-transform active:scale-95","aria-label":"Add Item",children:ie.jsx(dt,{className:"w-6 h-6"})})]}),!aa&&"documents"===y&&ie.jsxs("button",{onClick:()=>{ne(!0),ce([])},className:"flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm md:text-xs font-medium whitespace-nowrap flex-1 md:flex-none justify-center md:justify-start",children:[ie.jsx(St,{className:"w-4 h-4 flex-shrink-0"}),ie.jsx("span",{className:"hidden md:inline",children:"Upload"})]})]})]})]}),ie.jsx("div",{ref:J,className:"bg-gray-50 overflow-x-auto md:overflow-hidden [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded [&:hover::-webkit-scrollbar-thumb]:bg-gray-400 hover:[scrollbar-color:rgb(107_114_128)_transparent]",style:{scrollbarWidth:"thin",scrollbarColor:"transparent transparent"},children:ie.jsx("div",{className:"flex gap-1 md:gap-6 px-4 md:px-6 min-w-max md:min-w-0 md:w-full md:justify-center",children:[{id:"discovery",label:"Meetings",icon:Le,hidden:ea},{id:"plan",label:"WIP",icon:nt},{id:"documents",label:"Documents",icon:Fe},{id:"financials",label:"Financials",icon:_e,hidden:!ra},{id:"timeline",label:"Timeline",icon:Ue,hidden:ea},{id:"team",label:"Team",icon:Dt}].map(e=>e.hidden?null:ie.jsx("button",{"data-tab-id":e.id,onClick:()=>f(e.id),className:"flex items-center gap-1 md:gap-1 pt-1 pb-0.5 md:pt-2 md:pb-1 px-3 md:px-5 text-base md:text-sm font-medium transition-all whitespace-nowrap flex-shrink-0 md:flex-shrink "+(y===e.id?"text-gray-900":"text-gray-500 hover:text-gray-700"),children:ie.jsxs("span",{className:"inline-flex items-center gap-1 pb-1 "+(y===e.id?"border-b-2 border-gray-900":""),children:[ie.jsx(e.icon,{className:"w-4 h-4 md:w-4 md:h-4 flex-shrink-0"}),e.label]})},e.id))})}),ie.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 border-t border-gray-200",children:["discovery"===y&&!ea&&ie.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-6",children:[ie.jsxs("div",{className:"mb-6",children:[ie.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-800 mb-2",children:"Meetings"}),ie.jsxs("div",{className:"flex items-center gap-3 text-base md:text-sm text-gray-600",children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(Ne,{className:"w-5 h-5 md:w-4 md:h-4 flex-shrink-0"}),ie.jsxs("span",{className:"font-medium",children:[zs.length," Meeting",1!==zs.length?"s":""," Held"]})]}),zs.length>0&&ie.jsxs(ie.Fragment,{children:[ie.jsx("span",{className:"text-gray-400",children:""}),ie.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[ie.jsx($e,{className:"w-3.5 h-3.5 flex-shrink-0"}),ie.jsxs("span",{className:"whitespace-nowrap",children:["Latest: ",Tr(zs[0]?.date||"")]})]})]})]})]}),ie.jsx("div",{className:"space-y-3 md:space-y-4",children:0===zs.length?ie.jsx("div",{className:"text-center py-8 md:py-10 border-2 border-dashed border-gray-100 rounded-lg",children:ie.jsx("p",{className:"text-base md:text-sm text-gray-400",children:"No meetings recorded yet."})}):zs.map(e=>ie.jsxs("div",{className:"border border-gray-100 rounded-lg hover:shadow-md transition-shadow bg-white overflow-hidden",children:[ie.jsx("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 p-3 md:p-5",children:ie.jsxs("div",{className:"flex-1 min-w-0",children:[ie.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2",children:[ie.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[ie.jsx("h4",{className:"font-bold text-lg md:text-base text-gray-800 break-words",children:e.title}),ie.jsx("span",{className:"bg-gray-100 text-gray-600 text-sm md:text-xs px-2 py-1 rounded whitespace-nowrap",children:Tr(e.date)})]}),ie.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[ie.jsx("span",{className:"bg-purple-100 text-purple-700 text-sm md:text-xs px-2 py-0.5 rounded-full whitespace-nowrap",children:e.type}),aa&&ie.jsxs(ie.Fragment,{children:[ie.jsx("button",{onClick:()=>{Zt(e),Yt(!0)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors flex-shrink-0",title:"Edit meeting",children:ie.jsx(it,{className:"w-4 h-4"})}),ie.jsx("button",{onClick:()=>{fs(e),bs(!0)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-gray-100 rounded transition-colors flex-shrink-0",title:"Delete meeting",children:ie.jsx(kt,{className:"w-4 h-4"})})]})]})]}),ie.jsx("p",{className:"text-base md:text-sm text-gray-600 mt-2 whitespace-pre-wrap bg-gray-50 p-3 md:p-4 rounded overflow-hidden",children:e.notes}),ie.jsx("div",{className:"mt-3 md:mt-4 flex gap-2 flex-wrap",children:(e.attendees||[]).map(e=>{const s=t.find(t=>t.id===e)||ca.find(t=>t.id===e);return ie.jsx("span",{className:"text-sm md:text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-medium whitespace-nowrap",children:s?.name||"Unknown"},e)})})]})}),ie.jsxs("div",{className:"border-t border-gray-100 p-3 md:p-4 bg-gray-50",children:[ie.jsxs("button",{onClick:()=>{K(t=>{const s=new Set(t);return s.has(e.id)?s.delete(e.id):s.add(e.id),s})},className:"flex items-center gap-2 w-full hover:bg-gray-100 p-2 rounded transition-colors",children:[ie.jsx("span",{className:"transform transition-transform "+(q.has(e.id)?"rotate-90":""),children:ie.jsx(Ie,{className:"w-4 h-4 text-gray-600"})}),ie.jsxs("h5",{className:"text-sm md:text-xs font-bold text-gray-700",children:["Comments (",(es[e.id]||[]).length,")"]})]}),q.has(e.id)&&ie.jsx("div",{className:"mt-2 md:mt-3",children:ie.jsx("div",{className:"space-y-3 mb-3 max-h-60 overflow-y-auto",children:(es[e.id]||[]).map(s=>{let a="Unknown User";if(s.userName&&s.userName.trim()&&"Unknown User"!==s.userName)a=s.userName;else if(s.userId===c.id&&c.name)a=c.name;else if(s.userId){const e=t.find(e=>e.id===s.userId);if(e?.name)a=e.name;else{const e=ca.find(e=>e.id===s.userId);e?.name&&(a=e.name)}}const r="done"===s.status;return ie.jsxs("div",{className:"p-3 "+(r?"opacity-60":""),children:[ie.jsxs("div",{className:"flex justify-between items-start gap-2",children:[ie.jsxs("div",{className:"flex-1",children:[ie.jsx("p",{className:"text-sm md:text-xs font-semibold text-gray-800 "+(r?"line-through":""),children:a}),ie.jsx("p",{className:"text-sm md:text-xs text-gray-700 mt-1 "+(r?"line-through text-gray-500":""),children:s.text})]}),(c.id===s.userId||aa)&&ie.jsx("button",{onClick:()=>{const t=r?"pending":"done",a={...s,status:t};ts(t=>({...t,[e.id]:(t[e.id]||[]).map(e=>e.id===s.id?a:e)}))},className:"p-1 flex-shrink-0 rounded transition-colors "+(r?"text-green-600 hover:text-green-700 bg-green-50":"text-gray-400 hover:text-green-600"),title:r?"Mark as pending":"Mark as done",children:ie.jsx(we,{className:"w-4 h-4"})})]}),ie.jsx("p",{className:"text-sm md:text-xs text-gray-500 mt-2 "+(r?"line-through":""),children:$r(s.timestamp)})]},s.id)})})}),ie.jsxs("div",{className:"flex gap-1 mt-2 md:mt-3",children:[ie.jsx("input",{type:"text",placeholder:"Add a comment...",value:ss[e.id]||"",onChange:t=>as(s=>({...s,[e.id]:t.target.value})),onKeyPress:t=>{"Enter"!==t.key||rs[e.id]||ma(e.id)},disabled:!!rs[e.id],className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none"}),ie.jsx("button",{onClick:()=>ma(e.id),className:"p-2 text-gray-500 hover:text-purple-600 transition-colors",title:"Post comment",disabled:!!rs[e.id],children:rs[e.id]?ie.jsx(tn,{size:"sm",className:"text-gray-700"}):ie.jsx(xt,{className:"w-4 h-4"})})]})]})]},e.id))})]}),"plan"===y&&ie.jsxs("div",{className:"space-y-6 h-full flex flex-col p-4 md:p-6",children:[ie.jsx("div",{className:"flex bg-white rounded-lg border border-gray-200 p-1.5 w-fit shadow-sm",children:[{id:"list",label:"List View",icon:Ye},{id:"kanban",label:"Priority Board",icon:He},{id:"gantt",label:"Gantt Chart",icon:$e}].map(e=>ie.jsxs("button",{onClick:()=>j(e.id),className:"flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all\n                    "+(v===e.id?"bg-gray-900 text-white shadow-sm":"text-gray-500 hover:text-gray-900"),children:[ie.jsx(e.icon,{className:"w-4 h-4"}),e.label]},e.id))}),"kanban"===v&&ie.jsx("div",{className:"flex-1 overflow-x-auto min-h-[500px]",children:ie.jsx(Qr,{tasks:Xs,users:t,onUpdateTaskStatus:async(a,r)=>{const n=Zs.find(e=>e.id===a);if(!n)return;if(ha(n.status))return void m("Action Blocked","Task is frozen (Aborted or On Hold).","error");if(r!==Wt.TODO&&!ha(r)){const e=ya(n);if(e.length>0){const t=e.map(e=>e.title).join(", ");return void m("Action Blocked",`Waiting for dependencies: ${t}`,"error")}}const i=Zs.map(e=>e.id===a?{...e,status:r}:e),l=ua("Status Changed",`Task "${n.title}" moved from ${n.status} to ${r}`);try{const s={...n,status:r},i=Dr(s);let l="in-progress";r===Wt.DONE?l="completed":r===Wt.TODO&&(l="planned");const o=n.assigneeId?da(n.assigneeId):"Unassigned",d=`Status: ${n.status}  ${r} | Progress: ${i}% | Priority: ${n.priority} | Assigned to: ${o} | Changed by: ${c.name}`,x=(new Date).toISOString();if(await sr(e.id,`Task Status: ${n.title}`,d,l,x,x),await ar(e.id,a,{status:r}),r===Wt.REVIEW||r===Wt.DONE&&n.status!==Wt.DONE){const s=t.filter(e=>e.role===Ft.CLIENT||e.role===Ft.ADMIN);s.length>0&&await(async(e,t,s,a)=>{if(!t||0===t.length)return;const r=`${Rr()}?projectId=${a}&taskId=${e.id}&tab=plan`,n=`\n    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">\n      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">\n        <h2 style="color: #0284c7; margin: 0;"> Task Completion Approval Pending</h2>\n      </div>\n      \n      <p>Hi Team,</p>\n      \n      <p>A task has been completed and requires final approval in project <strong>${s}</strong>.</p>\n      \n      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">\n        <p style="margin: 5px 0;"><strong>Task:</strong> ${e.title}</p>\n        <p style="margin: 5px 0;"><strong>Category:</strong> ${e.category}</p>\n        <p style="margin: 5px 0;"><strong>Status:</strong> 100% Complete - Awaiting Final Approval</p>\n        <p style="margin: 5px 0;"><strong>Due Date:</strong> ${Tr(e.dueDate)}</p>\n      </div>\n      \n      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; margin: 20px 0;">\n        <p style="margin: 5px 0; font-weight: bold;">Approval Required From:</p>\n        <ul style="margin: 10px 0; padding-left: 20px;">\n          <li>Client</li>\n          <li>Admin</li>\n        </ul>\n      </div>\n      \n      <div style="margin: 20px 0;">\n        <a href="${r}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">\n          Review & Approve Completion\n        </a>\n      </div>\n      \n      <p>Click the button above to review the completed task and provide your final approval in the system.</p>\n      \n      <p style="margin-top: 30px; color: #666; font-size: 14px;">\n        Regards,<br>\n        <strong>ID ERP System</strong>\n      </p>\n    </div>\n  `;for(const i of t)if(i.email)try{(await Lr({to:i.email,recipientName:i.name,subject:`Task Completion Approval: ${e.title} - ${s}`,htmlContent:n})).success&&await Sr(i.id,"Task Completion Approval Pending",`Task "${e.title}" in project ${s} requires completion approval`,r)}catch(Cn){}})(n,s,e.name,e.id)}let g=e.status;r===Wt.IN_PROGRESS&&("Design and Planning"===n.category&&e.status===zt.DISCOVERY?g=zt.PLANNING:"Execution"!==n.category||e.status!==zt.DISCOVERY&&e.status!==zt.PLANNING||(g=zt.EXECUTION),g!==e.status&&(await p(e.id,{status:g}),m("Phase Updated",`Project automatically moved to ${g}`,"success")))}catch(Cn){m("Error","Failed to update task status. Please try again.","error")}r===Wt.DONE&&c.role===Ft.VENDOR?xa("Task Completed",`"${n.title}" marked as DONE by ${c.name} in "${e.name}"`,c.id,"plan"):r===Wt.REVIEW&&c.role===Ft.VENDOR?xa("Review Request",`"${n.title}" submitted for review by ${c.name} in "${e.name}"`,c.id,"plan"):r!==n.status&&xa("Status Update",`"${n.title}" moved to ${r} in "${e.name}"`,c.id,"plan");let o=e.status;r===Wt.IN_PROGRESS&&("Design and Planning"===n.category&&e.status===zt.DISCOVERY?o=zt.PLANNING:"Execution"!==n.category||e.status!==zt.DISCOVERY&&e.status!==zt.PLANNING||(o=zt.EXECUTION)),s({...e,status:o,tasks:i,activityLog:[l,...e.activityLog||[]]})},onUpdateTaskPriority:async(t,a)=>{const r=Zs.find(e=>e.id===t);if(r&&ha(r.status))return;const n=Zs.map(e=>e.id===t?{...e,priority:a}:e);try{await ar(e.id,t,{priority:a}),s({...e,tasks:n})}catch(Cn){m("Error","Failed to update task priority.","error")}},onEditTask:ja,onCompleteTask:La})}),"gantt"===v&&qa&&ie.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden flex-1 flex flex-col min-h-[600px]",children:[ie.jsxs("div",{className:"p-4 md:p-5 bg-gray-50 flex justify-between items-center",children:[ie.jsx("h3",{className:"font-bold text-base md:text-lg text-gray-800",children:"Timeline & Dependencies"}),ie.jsxs("div",{className:"flex items-center gap-6 text-sm md:text-xs text-gray-500",children:[ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," Task"]}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Done"]}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"w-3 h-0.5 bg-gray-300"})," Dependency"]}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"w-3 h-0.5 bg-red-400"})," Conflict"]})]})]}),ie.jsx("div",{className:"flex-1 overflow-auto relative",children:(()=>{const e=[],t=new Date(qa.minDate),s=new Date(qa.maxDate);for(;t<=s;)e.push(new Date(t)),t.setDate(t.getDate()+1);const a=40*e.length,n=250+a,i=[];let l=null,o=0;return e.forEach((e,t)=>{const s=e.toLocaleDateString("en-IN",{month:"short",year:"2-digit"});s!==l&&(l&&i.push({label:l,startIdx:o,dayCount:t-o}),l=s,o=t)}),l&&i.push({label:l,startIdx:o,dayCount:e.length-o}),ie.jsxs("div",{style:{minWidth:`${n}px`},className:"p-6 relative",children:[ie.jsx("div",{className:"absolute inset-0 pointer-events-none pt-[60px] pb-6 flex",style:{paddingLeft:"250px",paddingRight:"24px"},children:e.map((e,t)=>ie.jsx("div",{style:{width:"40px",flexShrink:0},className:"border-r border-gray-100 h-full"},t))}),ie.jsxs("div",{className:"sticky top-0 bg-white z-20",children:[ie.jsxs("div",{className:"flex pb-1 mb-2",children:[ie.jsx("div",{style:{width:"250px",flexShrink:0},className:"font-semibold text-sm text-gray-700 pl-2",children:"Task Details"}),ie.jsxs("div",{style:{width:`${a}px`},className:"relative",children:[ie.jsx("div",{className:"flex w-full text-xs font-bold text-gray-600 mb-2 h-5 border-b border-gray-200",children:i.map((e,t)=>ie.jsx("div",{style:{width:40*e.dayCount+"px",flexShrink:0},className:"text-left px-2 bg-gray-50 border-r border-gray-200",children:e.label},t))}),ie.jsx("div",{className:"flex w-full",children:e.map((e,t)=>ie.jsxs("div",{style:{width:"40px",flexShrink:0},className:`text-center text-xs py-1 ${0===e.getDay()||6===e.getDay()?"bg-red-50":""} ${1===e.getDate()?"border-l-2 border-gray-300":""}`,children:[ie.jsx("div",{className:"font-semibold "+(0===e.getDay()||6===e.getDay()?"text-red-400":"text-gray-600"),children:e.getDate()}),ie.jsx("div",{className:"text-[10px] text-gray-400",children:e.toLocaleDateString("en-IN",{weekday:"short"}).substring(0,2)})]},t))})]})]}),ie.jsx("div",{className:"flex pb-2 border-b border-gray-100",children:ie.jsx("div",{style:{width:"250px"},className:"pl-2"})})]}),ie.jsxs("div",{className:"relative mt-2",children:[ie.jsx("svg",{className:"absolute top-0 pointer-events-none z-0",style:{left:"250px",width:`${a}px`},viewBox:`0 0 ${a} ${48*Ya.length}`,preserveAspectRatio:"none",children:Ya.flatMap(e=>(e.dependencies||[]).map(t=>{const s=Ya.find(e=>e.id===t);if(!s)return null;const r=(s.left+s.width)*a/100,n=48*s.index+24,i=e.left*a/100,l=48*e.index+24,o=r>i,d=`M ${r} ${n} C ${r+20} ${n}, ${i-20} ${l}, ${i} ${l}`;return ie.jsxs("g",{children:[ie.jsx("path",{d:d,stroke:o?"#ef4444":"#9CA3AF",strokeWidth:o?"2":"1.5",fill:"none",className:o?"opacity-80":"opacity-30",strokeDasharray:o?"4 2":"none"}),ie.jsx("circle",{cx:i,cy:l,r:"3",fill:o?"#ef4444":"#9CA3AF"})]},`${s.id}-${e.id}`)}))}),ie.jsx("div",{className:"relative z-10 space-y-0",children:Ya.map((e,t)=>{const s=0===t||Ya[t-1].category!==e.category,i=Dr(e),l=ha(e.status);return ie.jsxs(r.Fragment,{children:[s&&ie.jsx("div",{className:"bg-gray-100/50 px-2 py-1 text-xs font-bold text-gray-500 uppercase tracking-wider sticky left-0 mb-1 mt-2",style:{width:`${n}px`},children:e.category}),ie.jsxs("div",{className:"flex items-center group hover:bg-gray-50/50 rounded min-h-[56px]",children:[ie.jsxs("div",{style:{width:"250px",flexShrink:0},className:"pr-4 pl-2 flex flex-col justify-center border-r border-gray-100",children:[ie.jsxs("div",{onClick:()=>ja(e),className:"text-base font-medium text-gray-800 truncate cursor-pointer hover:text-blue-600 flex items-center gap-1",children:[e.title,ba(e)&&ie.jsx(Xe,{className:"w-3 h-3 text-red-400"}),l&&ie.jsx(ye,{className:"w-3 h-3 text-red-600"})]}),ie.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 mt-1",children:[ie.jsx("span",{children:da(e.assigneeId)}),ie.jsxs("span",{className:"font-mono",children:[i,"%"]})]})]}),ie.jsx("div",{style:{width:`${a}px`},className:"relative h-6 rounded-md",children:ie.jsxs("div",{className:`absolute h-full rounded shadow-sm flex items-center px-2 cursor-pointer\n                                           ${"Done"===e.status?"bg-green-500 opacity-80":"bg-blue-500 opacity-80"}\n                                           ${"Review"===e.status?"bg-purple-500 opacity-80":""}\n                                           ${ba(e)?"bg-gray-400 opacity-50":""}\n                                           ${l?"bg-gray-800 opacity-70":""}\n                                        hover:opacity-100 transition-opacity z-20\n                                      `,style:{left:`${e.left}%`,width:`${e.width}%`},role:"button",tabIndex:0,title:"Click to edit task",onClick:()=>ja(e),children:[e.status===Wt.OVERDUE&&ie.jsx("div",{className:"absolute top-0 bottom-0 bg-red-500 opacity-80 rounded",style:{width:"100%"},"aria-label":"Overdue indicator"}),ie.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-white/20",style:{width:`${i}%`},"aria-label":"Progress indicator"}),ie.jsx("span",{className:"relative text-[9px] text-white truncate font-medium w-full",children:e.width>10?e.title:""})]})})]})]},e.id)})})]})]})})()})]}),"list"===v&&ie.jsx("div",{className:"space-y-8",children:Object.entries(Xs.reduce((e,t)=>(e[t.category]=e[t.category]||[],e[t.category].push(t),e),{})).sort((e,t)=>Ha(e[0])-Ha(t[0])).map(([a,r])=>ie.jsxs("div",{children:[ie.jsxs("h3",{className:"text-base font-bold text-gray-500 uppercase tracking-wide mb-4 pl-1 flex items-center gap-1",children:[ie.jsx(jt,{className:"w-4 h-4"})," ",a]}),ie.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(a=>{const r=ba(a)&&a.status!==Wt.DONE,n=ha(a.status),i=Dr(a),l=c.id===a.assigneeId;return ie.jsxs("div",{className:"bg-white p-4 md:p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all "+(r||n?"opacity-75 bg-gray-50":""),children:[ie.jsxs("div",{className:"flex justify-between items-start mb-3",children:[ie.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium uppercase\n                                "+("high"===a.priority?"bg-red-100 text-red-600":"medium"===a.priority?"bg-yellow-100 text-yellow-600":"bg-green-100 text-green-600"),children:a.priority}),ie.jsx("div",{className:"flex items-center gap-1",children:n?ie.jsxs("span",{title:"Frozen by Admin",className:"flex items-center gap-1 text-xs text-red-600 font-bold bg-red-50 px-2 py-0.5 rounded border border-red-100",children:[ie.jsx(ye,{className:"w-3 h-3"})," ",a.status]}):ie.jsxs(ie.Fragment,{children:[r&&ie.jsx("span",{title:"Blocked by dependency",children:ie.jsx(Xe,{className:"w-4 h-4 text-red-400"})}),ie.jsx("button",{onClick:()=>ja(a),className:"text-xs text-gray-400 hover:text-gray-900 ml-2",children:"View"})]})})]}),ie.jsxs("div",{className:"mt-3",children:[ie.jsxs("div",{className:"flex justify-between items-center mb-1",children:[ie.jsx("span",{className:"text-sm md:text-xs text-gray-400 font-medium",children:"Progress"}),ie.jsxs("span",{className:"text-sm md:text-xs text-gray-600 font-bold",children:[i,"%"]})]}),ie.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5",children:ie.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500 "+(a.status===Wt.DONE?"bg-green-500":n?"bg-gray-400":"bg-blue-500"),style:{width:`${i}%`}})})]}),ie.jsx("h4",{className:"font-bold text-lg text-gray-800 mb-1 cursor-pointer hover:text-blue-600",onClick:()=>ja(a),children:a.title}),ie.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[Tr(a.startDate)," - ",Tr(a.dueDate)]}),ie.jsx("div",{className:"flex gap-2 mb-3 flex-wrap",children:(()=>{const e="approved"===a.approvals?.completion?.client?.status,t="approved"===a.approvals?.completion?.admin?.status,s="rejected"===a.approvals?.completion?.client?.status,r="rejected"===a.approvals?.completion?.admin?.status,n="rejected"===a.approvals?.completion?.designer?.status,i=a.approvals?.completion?.client||a.approvals?.completion?.admin;return ie.jsxs(ie.Fragment,{children:[e&&t&&ie.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Approved by Both"}),e&&!t&&!r&&a.status===Wt.REVIEW&&ie.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded",children:"Waiting for Admin Approval"}),t&&!e&&!s&&ie.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded",children:a.status===Wt.REVIEW?"Waiting for Client Approval":"Client Approval Pending"}),!e&&!t&&!s&&!r&&a.status===Wt.REVIEW&&i&&ie.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:a.status===Wt.REVIEW?"Under Review":"Waiting for Review"}),s&&ie.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded",children:"Rejected by Client"}),r&&ie.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded",children:"Rejected by Admin"}),n&&ie.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded",children:"Rejected by Designer"}),a.status===Wt.OVERDUE&&ie.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded",children:"Overdue"})]})})()}),ie.jsx("div",{className:"space-y-2 mb-4 max-h-[80px] overflow-y-auto pr-2",children:a.subtasks.map(t=>ie.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 transition-opacity",style:{opacity:r||n||!aa&&!l?.5:1},children:[ie.jsx("button",{type:"button",onClick:()=>(aa||l)&&(async(t,a)=>{const r=Zs.find(e=>e.id===t);if(!r)return;if(ha(r.status))return void m("Frozen","Task is frozen. Cannot update checklist.","error");if(ba(r))return void m("Locked","Cannot check off items. This task is blocked by pending dependencies.","warning");const n=r.subtasks.map(e=>e.id===a?{...e,isCompleted:!e.isCompleted}:e),i={...r,subtasks:n},l=Er(i,r.status),o=Zs.map(e=>e.id===t?{...e,subtasks:n,status:l}:e);try{await ar(e.id,t,{subtasks:n,status:l}),l!==r.status&&l===Wt.REVIEW&&c.role===Ft.VENDOR&&xa("Review Ready",`All items checked for "${r.title}" by ${c.name} in "${e.name}"`,c.id,"plan"),s({...e,tasks:o})}catch(Cn){m("Error","Failed to update checklist.","error")}})(a.id,t.id),disabled:r||n||!aa&&!l,className:`flex-shrink-0 w-4 h-4 rounded-full border flex items-center justify-center transition-all duration-200 ${t.isCompleted?"bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600":"border-gray-400 hover:border-green-400 hover:bg-green-50"} disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:border-gray-300`,children:t.isCompleted&&ie.jsx(we,{className:"w-2.5 h-2.5 text-white"})}),ie.jsx("span",{className:t.isCompleted?"line-through text-gray-400":"",children:t.title})]},t.id))}),ie.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[ie.jsx("div",{className:"flex items-center gap-2",children:ie.jsx("span",{className:"text-sm md:text-xs text-gray-500",children:da(a.assigneeId)})}),ie.jsxs("div",{className:"flex items-center gap-2",children:[c.role===Ft.ADMIN&&ie.jsxs(ie.Fragment,{children:[ie.jsx("button",{onClick:s=>{s.stopPropagation(),(async s=>{const a=t.find(e=>e.id===s.assigneeId);if(a)if(a.email&&a.email.trim()){X(s.id),h("Sending reminder...");try{const t=await Fr(a.email,a.name,s.title,e.name,s.dueDate);t.success?m("Success",`Email reminder sent to ${a.name}`,"success"):m("Error",t.error||"Failed to send email","error")}catch(Cn){m("Error","Failed to send email reminder","error")}finally{X(null),b()}}else m("Error",`Email not found for ${a.name}`,"error");else m("Error","Assignee not found","error")})(a)},disabled:Z===a.id,className:"p-1 rounded-full transition-all "+(Z===a.id?"text-blue-500 bg-blue-50 cursor-wait":"text-gray-400 hover:text-blue-600 hover:bg-blue-50"),title:Z===a.id?"Sending email...":"Send Email Reminder",children:Z===a.id?ie.jsx("span",{className:"inline-block animate-spin w-4 h-4",children:""}):ie.jsx(fe,{className:"w-4 h-4"})}),ie.jsx("button",{onClick:e=>{e.stopPropagation(),Ba(a.id)},className:"text-gray-400 hover:text-blue-600 p-1 rounded-full hover:bg-blue-50 transition-colors",title:"Copy task link",children:ie.jsx(Ke,{className:"w-4 h-4"})}),(()=>{const s=t.find(e=>e.id===a.assigneeId);return s&&s.phone?ie.jsx("button",{onClick:t=>{t.stopPropagation();const r=`Hi ${s.name},\n\nTask: "${a.title}"\nProject: "${e.name}"\nDue: ${Tr(a.dueDate)}\n\nPlease update the status.`;Oa(s,r)},className:"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-50 transition-colors",title:`Chat on WhatsApp: ${s.phone}`,children:ie.jsx(st,{className:"w-4 h-4"})}):null})()]}),(c.role===Ft.VENDOR||c.role===Ft.DESIGNER)&&ie.jsxs(ie.Fragment,{children:[ie.jsx("button",{onClick:e=>{e.stopPropagation(),Ba(a.id)},className:"text-gray-400 hover:text-blue-600 p-1 rounded-full hover:bg-blue-50 transition-colors",title:"Copy task link",children:ie.jsx(Ke,{className:"w-4 h-4"})}),(()=>{const s=t.find(e=>e.id===a.assigneeId);return s&&s.phone?ie.jsx("button",{onClick:t=>{t.stopPropagation();const r=`Hi ${s.name},\n\nTask: "${a.title}"\nProject: "${e.name}"\nDue: ${Tr(a.dueDate)}\n\nPlease check the task details and update the status.`;Oa(s,r)},className:"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-50 transition-colors",title:`Share on WhatsApp: ${s.phone}`,children:ie.jsx(st,{className:"w-4 h-4"})}):null})()]}),a.comments.length>0&&ie.jsxs("button",{onClick:e=>{e.stopPropagation(),ja(a)},className:"text-gray-400 hover:text-gray-700 p-0.5 rounded-full hover:bg-gray-100 transition-colors flex items-center gap-0.5",title:`${a.comments.length} comment${1!==a.comments.length?"s":""}`,children:[ie.jsx(at,{className:"w-3 h-3"}),ie.jsx("span",{className:"text-[10px] font-medium",children:a.comments.length})]})]})]})]},a.id)})})]},a))})]}),"documents"===y&&ie.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 p-4 md:p-6",children:[ie.jsxs("div",{className:"flex justify-between items-center mb-6",children:[ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-xl md:text-lg font-bold text-gray-800",children:"Project Documents"}),ie.jsx("p",{className:"text-base md:text-sm text-gray-500",children:"Shared files, layouts, and contracts."})]}),!aa&&ie.jsxs("span",{className:"text-sm md:text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["Viewing as ",c.role]})]}),ie.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[c.role!==Ft.VENDOR&&ie.jsxs("button",{onClick:()=>{ne(!0),ce([])},className:"border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center p-6 hover:bg-gray-50 hover:border-gray-400 transition-all text-gray-400 hover:text-gray-600 bg-white",children:[ie.jsx(St,{className:"w-8 h-8 mb-2"}),ie.jsx("span",{className:"text-base md:text-sm font-bold",children:"Upload File"})]}),(Us||[]).filter(e=>"pending"===e.approvalStatus?c.role===Ft.ADMIN||c.role===Ft.DESIGNER||e.uploadedBy===c.id:"approved"===e.approvalStatus?Array.isArray(e.sharedWith)&&e.sharedWith.includes(c.id)||c.role===Ft.ADMIN||e.uploadedBy===c.id:"rejected"===e.approvalStatus?c.role===Ft.ADMIN||c.role===Ft.DESIGNER||e.uploadedBy===c.id:c.role===Ft.ADMIN).sort((e,t)=>fa(t)-fa(e)).map(s=>ie.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow",children:[ie.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-10 pointer-events-none group-hover:pointer-events-auto",children:[ie.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[ie.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Comments",onClick:()=>Ca(s),children:ie.jsx(at,{className:"w-4 h-4"})}),ie.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"View",onClick:()=>window.open(s.url,"_blank"),children:ie.jsx(Re,{className:"w-4 h-4"})}),ie.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Download",onClick:()=>Ia(s),children:ie.jsx(Oe,{className:"w-4 h-4"})}),(s.uploadedBy===c.id||aa)&&ie.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Delete",onClick:()=>Sa(s),children:ie.jsx(kt,{className:"w-4 h-4"})}),c.role===Ft.ADMIN&&ie.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Edit Share",onClick:e=>{e.stopPropagation(),(e=>{try{Ge(e),Je(e.sharedWith||[]),Me(!0)}catch(t){}})(s)},children:ie.jsx(Dt,{className:"w-4 h-4"})})]}),c.role===Ft.ADMIN&&"pending"===s.approvalStatus&&ie.jsxs("div",{className:"flex items-center justify-center gap-2",children:[ie.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve",onClick:()=>Da(s),disabled:te(`approve-doc-${s.id}`),children:te(`approve-doc-${s.id}`)?ie.jsx(tn,{size:"md",color:"currentColor"}):ie.jsx(we,{className:"w-4 h-4"})}),ie.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject",onClick:()=>Aa(s),disabled:te(`reject-doc-${s.id}`),children:te(`reject-doc-${s.id}`)?ie.jsx(tn,{size:"md",color:"currentColor"}):ie.jsx(Et,{className:"w-4 h-4"})})]}),c.role===Ft.CLIENT&&"approved"===s.approvalStatus&&"approved"!==s.clientApprovalStatus&&ie.jsxs("div",{className:"flex items-center justify-center gap-2",children:[ie.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve as Client",onClick:()=>(async s=>{if(!te(`client-approve-doc-${s.id}`)){se(`client-approve-doc-${s.id}`);try{await ir(e.id,s.id,{clientApprovalStatus:"approved",clientApprovedBy:c.id,clientApprovedDate:(new Date).toISOString()}),await new Promise(e=>setTimeout(e,500));const a=t.filter(t=>t.id===e.leadDesignerId||!(!s.sharedWith?.includes(t.id)||t.id===c.id));a.length>0&&await Gr(s,c.name||"Unknown User",a,e.name,e.id,"approved"),m("Success",`Document "${s.name}" approved by you`,"success")}catch(Cn){m("Error","Failed to approve document","error")}finally{ae(`client-approve-doc-${s.id}`)}}})(s),disabled:te(`client-approve-doc-${s.id}`),children:te(`client-approve-doc-${s.id}`)?ie.jsx(tn,{size:"md",color:"currentColor"}):ie.jsx(we,{className:"w-4 h-4"})}),ie.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject as Client",onClick:()=>(async s=>{if(!te(`client-reject-doc-${s.id}`)){se(`client-reject-doc-${s.id}`);try{await ir(e.id,s.id,{clientApprovalStatus:"rejected",clientApprovedBy:c.id,clientApprovedDate:(new Date).toISOString()}),await new Promise(e=>setTimeout(e,500));const a=t.filter(t=>t.id===e.leadDesignerId||!(!s.sharedWith?.includes(t.id)||t.id===c.id));a.length>0&&await Gr(s,c.name||"Unknown User",a,e.name,e.id,"rejected"),m("Success",`Document "${s.name}" rejected by you`,"success")}catch(Cn){m("Error","Failed to reject document","error")}finally{ae(`client-reject-doc-${s.id}`)}}})(s),disabled:te(`client-reject-doc-${s.id}`),children:te(`client-reject-doc-${s.id}`)?ie.jsx(tn,{size:"md",color:"currentColor"}):ie.jsx(Et,{className:"w-4 h-4"})})]})]}),ie.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center overflow-hidden relative group",children:"image"===s.type?ie.jsx("img",{src:s.url||sn,alt:s.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiI+PC9yZWN0PjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ij48L2NpcmNsZT48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNiAxMCA1IDIxIj48L3BvbHlsaW5lPjwvc3ZnPg==",e.currentTarget.className="w-12 h-12 opacity-50",e.currentTarget.parentElement?.classList.add("flex","items-center","justify-center")}}):"pdf"===s.type?ie.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-50 to-red-100",children:[ie.jsx(Le,{className:"w-12 h-12 text-red-400 mb-2"}),ie.jsx("span",{className:"text-sm font-bold text-red-600 uppercase",children:"PDF"})]}):ie.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100",children:[ie.jsx(Le,{className:"w-12 h-12 text-blue-400 mb-2"}),ie.jsx("span",{className:"text-sm font-bold text-blue-600 uppercase",children:s.type})]})}),ie.jsxs("div",{className:"p-3",children:[ie.jsxs("div",{className:"flex justify-between items-start gap-2",children:[ie.jsx("p",{className:"text-lg md:text-sm font-bold text-gray-800 flex-1 truncate",title:s.name,children:s.name}),ie.jsx("span",{className:"text-sm md:text-xs text-gray-400 whitespace-nowrap",children:Tr(s.uploadDate)})]}),ie.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:(Array.isArray(s.sharedWith)?s.sharedWith:[]).map(e=>{const s=t.find(t=>t.id===e);return s?.name?ie.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-semibold",title:s.name,children:s.name.split(" ")[0]},e):null})}),ie.jsxs("div",{className:"flex flex-col gap-1 mt-2",children:[ie.jsx("div",{className:"flex-none w-auto",children:ie.jsxs("span",{className:"inline-block text-xs font-bold px-2 py-0.5 rounded "+("pending"===s.approvalStatus?"bg-yellow-100 text-yellow-700":"approved"===s.approvalStatus?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:["Admin: ","pending"===s.approvalStatus?"Pending":"approved"===s.approvalStatus?"Approved":"Rejected"]})}),"approved"===s.approvalStatus&&s.clientApprovalStatus&&ie.jsx("div",{className:"flex-none w-auto",children:ie.jsxs("span",{className:"inline-block text-xs font-bold px-2 py-0.5 rounded "+("approved"===s.clientApprovalStatus?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[s.clientApprovedBy&&t.find(e=>e.id===s.clientApprovedBy)?.name||"Client",": ","approved"===s.clientApprovalStatus?"Approved":"Rejected"]})})]}),s.comments&&s.comments.length>0&&ie.jsxs("div",{className:"mt-2 text-xs text-blue-600 font-medium",children:[s.comments.length," ",1===s.comments.length?"comment":"comments"]})]})]},s.id))]})]}),"financials"===y&&ra&&ie.jsxs("div",{className:"w-full mx-auto space-y-8 p-4 md:p-6",children:[ie.jsx("h3",{className:"text-lg md:text-base font-bold text-gray-800",children:"Financial Management"}),ie.jsxs("div",{className:"bg-gray-900 text-white p-4 md:p-8 rounded-xl shadow-lg flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[ie.jsxs("div",{children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("p",{className:"text-gray-400 text-sm md:text-xs font-bold uppercase mb-1",children:"Total Project Budget"}),aa&&ie.jsxs("button",{onClick:()=>{Os(!0),Rs(""),Fs("")},className:"text-xs bg-gray-800 hover:bg-gray-700 text-emerald-400 px-3 py-1 rounded border border-gray-700 transition-colors flex items-center gap-1",title:"Add to Project Budget",children:[ie.jsx(dt,{className:"w-3.5 h-3.5"})," Add Funds"]})]}),ie.jsxs("h2",{className:"text-3xl md:text-2xl font-bold tracking-tight",children:["",((e.initialBudget||e.budget)+_a).toLocaleString()]}),_a>0&&ie.jsxs("div",{className:"mt-3 space-y-1",children:[ie.jsxs("p",{className:"text-sm md:text-xs text-gray-400",children:["Initial Budget: ",(e.initialBudget||e.budget).toLocaleString()]}),ie.jsxs("p",{className:"text-sm md:text-xs text-emerald-400 font-medium",children:["Additional Budget: ",_a.toLocaleString()]})]})]}),ie.jsxs("div",{className:"text-left md:text-right",children:[ie.jsx("p",{className:"text-gray-400 text-sm md:text-xs font-bold uppercase mb-1",children:"Remaining Budget"}),ie.jsxs("h2",{className:"text-2xl md:text-xl font-bold "+((e.initialBudget||e.budget)+_a-(Ua+Wa)<0?"text-red-400":"text-emerald-400"),children:["",((e.initialBudget||e.budget)+_a-(Ua+Wa)).toLocaleString()]}),ie.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Budget - (Paid + Pending Expenses)"})]})]}),ie.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[ie.jsx("div",{className:"px-4 py-3 md:px-6 md:py-5 border-b border-gray-200 bg-gray-50",children:ie.jsx("h3",{className:"font-semibold text-base md:text-sm text-gray-800",children:"Financial Summary & Analysis"})}),ie.jsx("div",{className:"p-4 md:p-6 space-y-6",children:ie.jsxs("div",{className:"space-y-4",children:[ie.jsxs("h4",{className:"text-base md:text-sm font-bold text-gray-700 flex items-center gap-2",children:[ie.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),"Income Breakdown"]}),ie.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[ie.jsxs("div",{className:"p-4 md:p-6 bg-blue-50 rounded-lg border border-blue-100",children:[ie.jsx("p",{className:"text-sm md:text-xs text-blue-600 font-bold uppercase mb-1",children:"Estimated"}),ie.jsxs("p",{className:"text-xl md:text-lg font-bold text-blue-700",children:["",(e.initialBudget||e.budget).toLocaleString()]})]}),ie.jsxs("div",{className:"p-4 md:p-6 bg-purple-50 rounded-lg border border-purple-100",children:[ie.jsx("p",{className:"text-sm md:text-xs text-purple-600 font-bold uppercase mb-1",children:"Additional"}),ie.jsxs("p",{className:"text-xl md:text-lg font-bold text-purple-700",children:["",_a.toLocaleString()]})]}),ie.jsxs("div",{className:"p-4 md:p-6 bg-green-50 rounded-lg border border-green-100",children:[ie.jsx("p",{className:"text-sm md:text-xs text-green-600 font-bold uppercase mb-1",children:"Received"}),ie.jsxs("p",{className:"text-xl md:text-lg font-bold text-green-700",children:["",Va.toLocaleString()]}),ie.jsxs("p",{className:"text-sm md:text-xs text-green-600 mt-1",children:[Math.round(Va/((e.initialBudget||e.budget)+_a)*100)||0,"% of budget"]})]}),ie.jsxs("div",{className:"p-4 md:p-6 bg-red-50 rounded-lg border border-red-100",children:[ie.jsx("p",{className:"text-sm md:text-xs text-red-600 font-bold uppercase mb-1",children:"Expense"}),ie.jsxs("p",{className:"text-xl md:text-lg font-bold text-red-700",children:["",Ua.toLocaleString()]}),ie.jsxs("p",{className:"text-sm md:text-xs text-red-600 mt-1",children:[Math.round(Ua/((e.initialBudget||e.budget)+_a)*100)||0,"% of budget"]})]}),ie.jsxs("div",{className:"p-4 md:p-6 rounded-lg border "+(Va-Ua>=0?"bg-green-50 border-green-100":"bg-red-50 border-red-100"),children:[ie.jsx("p",{className:"text-sm md:text-xs font-bold uppercase mb-1 "+(Va-Ua>=0?"text-green-600":"text-red-600"),children:"Profit/Loss"}),ie.jsxs("p",{className:"text-xl md:text-lg font-bold "+(Va-Ua>=0?"text-green-700":"text-red-700"),children:[Va-Ua>=0?"+":"","",(Va-Ua).toLocaleString()]})]}),ie.jsxs("div",{className:"p-4 md:p-6 bg-orange-50 rounded-lg border border-orange-100",children:[ie.jsx("p",{className:"text-sm md:text-xs text-orange-600 font-bold uppercase mb-1",children:"Not Received"}),ie.jsxs("p",{className:"text-xl md:text-lg font-bold "+((e.initialBudget||e.budget)+_a-Va<0?"text-red-700":"text-orange-700"),children:["",((e.initialBudget||e.budget)+_a-Va).toLocaleString()]})]}),ie.jsxs("div",{className:"p-4 md:p-6 bg-gray-50 rounded-lg border border-gray-200",children:[ie.jsx("p",{className:"text-sm md:text-xs text-gray-600 font-bold uppercase mb-1",children:"Total"}),ie.jsxs("p",{className:"text-xl md:text-lg font-bold text-gray-700",children:["",((e.initialBudget||e.budget)+_a).toLocaleString()]})]})]})]})})]}),ie.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[300px]",children:[ie.jsxs("div",{className:"px-4 py-3 md:px-5 md:py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[ie.jsx("h3",{className:"font-semibold text-gray-800 text-lg md:text-base",children:"Transaction Ledger"}),ie.jsxs("div",{className:"flex gap-2 relative",children:[ie.jsxs("button",{onClick:()=>Lt(!Rt),className:"text-sm md:text-xs border px-3 py-1.5 rounded-lg hover:bg-white text-gray-700 flex items-center gap-1.5 font-medium transition-colors "+("all"!==Ot?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300"),children:[ie.jsx(Ve,{className:"w-3.5 h-3.5"}),ie.jsx("span",{className:"capitalize hidden sm:inline",children:"all"===Ot?"Filter":Ot})]}),Rt&&ie.jsxs(ie.Fragment,{children:[ie.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>Lt(!1)}),ie.jsx("div",{className:"absolute right-0 top-9 bg-white shadow-xl border border-gray-100 rounded-lg p-1 z-20 w-32 flex flex-col gap-0.5 animate-fade-in",children:["all","income","expense","pending","overdue"].map(e=>ie.jsx("button",{onClick:()=>{Bt(e),Lt(!1)},className:"text-left text-xs px-2.5 py-1.5 rounded capitalize font-medium "+(Ot===e?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50"),children:e},e))})]})]})]}),ie.jsx("div",{className:"overflow-x-auto scrollbar-thin",children:ie.jsxs("table",{className:"w-full text-sm text-left",children:[ie.jsx("thead",{className:"bg-white text-gray-600 border-b border-gray-100 sticky top-0 z-10",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-left",children:"Date"}),ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap",children:"Paid By"}),ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-left",children:"Received By"}),ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Type"}),ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Mode"}),ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Status"}),ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Amount"}),ie.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Approvals"}),ie.jsx("th",{className:"px-2 py-2 font-semibold text-center w-8"})]})}),ie.jsxs("tbody",{className:"divide-y divide-gray-50",children:[0===Ga.length&&ie.jsx("tr",{children:ie.jsx("td",{colSpan:9,className:"text-center py-8 text-gray-400 text-sm",children:0===Js.length?"No transactions recorded.":"No transactions match filters."})}),Ga.map(e=>ie.jsxs("tr",{className:"hover:bg-gray-50 group transition-colors",children:[ie.jsxs("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap text-sm md:text-xs text-left",children:[e.date,e.timestamp&&ie.jsx("div",{className:"text-gray-400 text-xs mt-0.5",children:new Date(e.timestamp).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),ie.jsx("td",{className:"px-4 py-2",style:{maxWidth:"150px"},children:ie.jsxs("div",{className:"flex flex-col gap-0.5",children:[ie.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:e.paidByOther?e.paidByOther.includes("(")?e.paidByOther.split("(")[0].trim():e.paidByOther:"admin"===e.paidBy?e.vendorName?e.vendorName:"-":"income"===e.type?e.paidTo?e.paidTo:"-":e.vendorName?e.vendorName:"-"}),"expense"===e.type&&ie.jsx("span",{className:"text-gray-600 break-words text-sm md:text-xs",children:e.description}),ie.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-xs",children:[ie.jsx("span",{className:"text-gray-400",children:"|"}),ie.jsx("span",{className:"flex-shrink-0 font-medium "+("client"===e.paidBy?"text-blue-700":"vendor"===e.paidBy?"text-purple-700":"designer"===e.paidBy?"text-orange-700":"admin"===e.paidBy?"text-red-700":"other"===e.paidBy?"text-gray-700":"income"===e.type?"text-green-700":"text-gray-700"),children:"client"===e.paidBy?"Client":"vendor"===e.paidBy?"Vendor":"designer"===e.paidBy?"Designer":"admin"===e.paidBy?"Admin":"other"===e.paidBy?e.paidByOther&&e.paidByOther.includes("(")?e.paidByOther.split("(")[1].replace(")","").trim():"Other":"income"===e.type?"Client":"expense"===e.type?"Proj":"N/A"})]})]})}),ie.jsx("td",{className:"px-2 py-2",style:{maxWidth:"150px"},children:ie.jsxs("div",{className:"flex flex-col gap-0.5",children:[ie.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:"admin-received"===e.receivedByRole?e.receivedByName?e.receivedByName:"-":e.receivedBy?e.receivedBy.includes("(")?e.receivedBy.split("(")[0].trim():e.receivedBy:e.paidTo?e.paidTo:e.vendorName?e.vendorName:"-"}),ie.jsxs("div",{className:"flex flex-col gap-1 text-sm md:text-xs",children:["expense"!==e.type&&ie.jsx("span",{className:"text-gray-600 break-words text-sm md:text-xs",children:e.description}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-gray-400",children:"|"}),ie.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${"admin-received"===e.receivedByRole?"text-red-700":"vendor-received"===e.receivedByRole?"text-purple-700":"designer-received"===e.receivedByRole?"text-orange-700":"client-received"===e.receivedByRole?"text-blue-700":"other-received"===e.receivedByRole?"text-gray-700":e.receivedBy?(()=>{const s=t.find(t=>t.name===(e.receivedBy?.includes("(")?e.receivedBy.split("(")[0].trim():e.receivedBy)),a=s?.role||(e.receivedBy?.includes("(")?e.receivedBy.split("(")[1].replace(")","").trim():"");return a===Ft.CLIENT||"Client"===a?"text-blue-700":a===Ft.VENDOR||"Vendor"===a?"text-purple-700":a===Ft.DESIGNER||"Designer"===a?"text-orange-700":a===Ft.ADMIN||"Admin"===a?"text-red-700":"income"===e.type?"text-green-700":"text-gray-700"})():"income"===e.type?"text-green-700":"text-gray-700"}`,children:"admin-received"===e.receivedByRole?"Admin":"vendor-received"===e.receivedByRole?"Vendor":"designer-received"===e.receivedByRole?"Designer":"client-received"===e.receivedByRole?"Client":"other-received"===e.receivedByRole?"Other":e.receivedBy&&e.receivedBy.includes("(")?e.receivedBy.split("(")[1].replace(")","").trim():"income"===e.type?ca.find(t=>t.name===e.receivedBy)?.role||"Team Member":ca.find(t=>t.name===e.receivedBy)?.role||"-"})]})]})]})}),ie.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:"income"===e.type?ie.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-green-600 text-sm md:text-xs font-bold",children:[ie.jsx(he,{className:"w-2.5 h-2.5 rotate-180"})," Received"]}):"expense"===e.type?ie.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-red-600 text-sm md:text-xs font-bold",children:[ie.jsx(he,{className:"w-2.5 h-2.5"})," Paid"]}):ie.jsx("span",{className:"text-purple-600 text-sm md:text-xs font-bold",children:"Design"})}),ie.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center text-sm md:text-xs text-gray-600 capitalize",children:e.paymentMode?e.paymentMode.replace("_"," "):"-"}),ie.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:ie.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-sm md:text-xs font-bold capitalize\n                          "+("paid"===e.status?"bg-green-100 text-green-700":"overdue"===e.status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:"paid"===e.status?"Paid":"overdue"===e.status?"Overdue":"Pending"})}),ie.jsxs("td",{className:"px-4 py-2 font-semibold whitespace-nowrap text-sm md:text-xs text-center "+("income"===e.type?"text-green-600":"text-gray-900"),children:["",e.amount.toLocaleString()]}),ie.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:[(e.isAdditionalBudget||"income"===e.type&&"Additional Budget"===e.category)&&ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),("approved"===e.clientApprovalForAdditionalBudget||!0===e.clientApproved)&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),"rejected"===e.clientApprovalForAdditionalBudget&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),("pending"===e.clientApprovalForAdditionalBudget||!e.clientApprovalForAdditionalBudget&&!e.clientApproved)&&c?.role===Ft.CLIENT&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Ta(e.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve",disabled:te(`approve-budget-${e.id}-client-approved`),children:te(`approve-budget-${e.id}-client-approved`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Ta(e.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject",disabled:te(`approve-budget-${e.id}-client-rejected`),children:te(`approve-budget-${e.id}-client-rejected`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),("pending"===e.clientApprovalForAdditionalBudget||!e.clientApprovalForAdditionalBudget&&!e.clientApproved)&&c?.role!==Ft.CLIENT&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),ie.jsx("span",{className:"text-gray-300",children:"|"}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),("approved"===e.adminApprovalForAdditionalBudget||!0===e.adminApproved)&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),"rejected"===e.adminApprovalForAdditionalBudget&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),("pending"===e.adminApprovalForAdditionalBudget||!e.adminApprovalForAdditionalBudget&&!e.adminApproved)&&c?.role===Ft.ADMIN&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Ta(e.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve",disabled:te(`approve-budget-${e.id}-admin-approved`),children:te(`approve-budget-${e.id}-admin-approved`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Ta(e.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject",disabled:te(`approve-budget-${e.id}-admin-rejected`),children:te(`approve-budget-${e.id}-admin-rejected`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),("pending"===e.adminApprovalForAdditionalBudget||!e.adminApprovalForAdditionalBudget&&!e.adminApproved)&&c?.role!==Ft.ADMIN&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),(e.isClientPayment||"income"===e.type&&"Additional Budget"!==e.category)&&ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),("approved"===e.clientApprovalForPayment||!0===e.clientApproved)&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),"rejected"===e.clientApprovalForPayment&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),("pending"===e.clientApprovalForPayment||!e.clientApprovalForPayment&&!e.clientApproved)&&c?.role===Ft.CLIENT&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Pa(e.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Confirm payment",disabled:te(`approve-payment-${e.id}-client-approved`),children:te(`approve-payment-${e.id}-client-approved`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Pa(e.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Dispute payment",disabled:te(`approve-payment-${e.id}-client-rejected`),children:te(`approve-payment-${e.id}-client-rejected`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),("pending"===e.clientApprovalForPayment||!e.clientApprovalForPayment&&!e.clientApproved)&&c?.role!==Ft.CLIENT&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),ie.jsx("span",{className:"text-gray-300",children:"|"}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),("approved"===e.adminApprovalForPayment||!0===e.adminApproved)&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),"rejected"===e.adminApprovalForPayment&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),("pending"===e.adminApprovalForPayment||!e.adminApprovalForPayment&&!e.adminApproved)&&c?.role===Ft.ADMIN&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Pa(e.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve payment",disabled:te(`approve-payment-${e.id}-admin-approved`),children:te(`approve-payment-${e.id}-admin-approved`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Pa(e.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject payment",disabled:te(`approve-payment-${e.id}-admin-rejected`),children:te(`approve-payment-${e.id}-admin-rejected`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),("pending"===e.adminApprovalForPayment||!e.adminApprovalForPayment&&!e.adminApproved)&&c?.role!==Ft.ADMIN&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),"expense"===e.type&&ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),!0===e.clientApproved&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),!1===e.clientApproved&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),void 0===e.clientApproved&&c?.role===Ft.CLIENT&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Ma(e.id,"client",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:te(`approve-expense-${e.id}-client-true`),children:te(`approve-expense-${e.id}-client-true`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Ma(e.id,"client",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:te(`approve-expense-${e.id}-client-false`),children:te(`approve-expense-${e.id}-client-false`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),void 0===e.clientApproved&&c?.role!==Ft.CLIENT&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),ie.jsx("span",{className:"text-gray-300",children:"|"}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),!0===e.adminApproved&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),!1===e.adminApproved&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),void 0===e.adminApproved&&c?.role===Ft.ADMIN&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Ma(e.id,"admin",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:te(`approve-expense-${e.id}-admin-true`),children:te(`approve-expense-${e.id}-admin-true`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Ma(e.id,"admin",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:te(`approve-expense-${e.id}-admin-false`),children:te(`approve-expense-${e.id}-admin-false`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),void 0===e.adminApproved&&c?.role!==Ft.ADMIN&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),!e.isAdditionalBudget&&!e.isClientPayment&&"expense"!==e.type&&ie.jsx("span",{className:"text-xs text-gray-300",children:"-"})]}),ie.jsx("td",{className:"px-2 py-2 text-center",children:ie.jsxs("div",{className:"flex items-center justify-center gap-1",children:[aa&&ie.jsx("button",{onClick:()=>$a(e.id),className:"text-gray-400 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-blue-50 rounded",title:"Edit Transaction",children:ie.jsx(lt,{className:"w-3.5 h-3.5"})}),ta&&ie.jsx("button",{onClick:()=>{us(e.id),xs(!0)},className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-50 rounded",title:"Delete Transaction",children:ie.jsx(kt,{className:"w-3.5 h-3.5"})})]})})]},e.id))]})]})})]}),ie.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[ie.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:ie.jsx("h3",{className:"font-semibold text-gray-800 text-lg md:text-base",children:ea?"My Payment Records":"Vendor Billing Report"})}),0===Js.filter(e=>{const s=t.filter(e=>e.role===Ft.VENDOR),a=new Set(s.map(e=>e.name)),r=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";if(ea)return e.vendorName===c.name||r(e.receivedByName)===c.name||r(e.paidByOther)===c.name||e.paidTo===c.name||e.receivedBy===c.name;const n=e.receivedByName&&a.has(r(e.receivedByName)),i=e.paidByOther&&a.has(r(e.paidByOther)),l="vendor-received"===e.receivedByRole;return!!e.vendorName&&a.has(e.vendorName)||"vendor"===e.paidBy||n||i||l}).length?ie.jsx("div",{className:"px-6 py-10 text-center text-gray-400",children:ea?"No payment records for you yet.":"No vendor transactions recorded yet."}):ie.jsx("div",{className:"overflow-x-auto",children:ie.jsxs("table",{className:"w-full text-sm",children:[ie.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700 text-sm md:text-sm",children:"Date"}),ie.jsx("th",{className:"px-4 py-2 font-bold text-gray-700 text-sm md:text-sm",children:"Paid By"}),ie.jsx("th",{className:"px-4 py-2 font-bold text-gray-700 text-left text-sm md:text-sm",children:"Received By (Vendor)"}),ie.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700 text-sm md:text-sm",children:"Description"}),ie.jsx("th",{className:"px-4 py-2 text-right font-bold text-gray-700 text-sm md:text-sm",children:"Amount"}),ie.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Admin Approval"}),ie.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Client Approval"}),ie.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Status"})]})}),ie.jsx("tbody",{children:Js.filter(e=>{const s=t.filter(e=>e.role===Ft.VENDOR),a=new Set(s.map(e=>e.name)),r=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";if(ea)return e.vendorName===c.name||r(e.receivedByName)===c.name||r(e.paidByOther)===c.name||e.paidTo===c.name||e.receivedBy===c.name;const n=e.receivedByName&&a.has(r(e.receivedByName)),i=e.paidByOther&&a.has(r(e.paidByOther)),l="vendor-received"===e.receivedByRole;return!!e.vendorName&&a.has(e.vendorName)||"vendor"===e.paidBy||n||i||l}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).map((e,s)=>ie.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 "+(s%2==0?"bg-white":"bg-gray-50/50"),children:[ie.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap text-sm md:text-xs text-left",children:e.date}),ie.jsx("td",{className:"px-4 py-2",children:ie.jsxs("div",{className:"flex flex-col gap-0.5",children:[ie.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:"income"===e.type?e.paidTo||e.paidByOther||"-":e.vendorName||"-"}),ie.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-xs",children:[ie.jsx("span",{className:"text-gray-400",children:"|"}),ie.jsx("span",{className:"flex-shrink-0 font-medium text-sm md:text-xs "+("client"===e.paidBy?"text-blue-700":"vendor"===e.paidBy?"text-purple-700":"designer"===e.paidBy?"text-orange-700":"admin"===e.paidBy?"text-red-700":"text-gray-700"),children:"income"===e.type?(()=>{const s=t.find(t=>t.name===(e.paidTo||e.paidByOther));return s?.role===Ft.CLIENT?"Client":s?.role===Ft.VENDOR?"Vendor":s?.role===Ft.DESIGNER?"Designer":s?.role===Ft.ADMIN?"Admin":"client"===e.paidBy?"Client":"vendor"===e.paidBy?"Vendor":"designer"===e.paidBy?"Designer":"admin"===e.paidBy?"Admin":"N/A"})():"client"===e.paidBy?"Client":"vendor"===e.paidBy?"Vendor":"designer"===e.paidBy?"Designer":"admin"===e.paidBy?"Admin":"N/A"})]})]})}),ie.jsx("td",{className:"px-2 py-2",style:{maxWidth:"150px"},children:ie.jsxs("div",{className:"flex flex-col gap-0.5",children:[ie.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:e.receivedBy?e.receivedBy.includes("(")?e.receivedBy.split("(")[0].trim():e.receivedBy:"-"}),ie.jsx("div",{className:"flex flex-col gap-1 text-sm md:text-xs",children:ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-gray-400",children:"|"}),ie.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${e.receivedBy?(()=>{const s=t.find(t=>t.name===(e.receivedBy?.includes("(")?e.receivedBy.split("(")[0].trim():e.receivedBy)),a=s?.role||(e.receivedBy?.includes("(")?e.receivedBy.split("(")[1].replace(")","").trim():"");return a===Ft.CLIENT||"Client"===a?"text-blue-700":a===Ft.VENDOR||"Vendor"===a?"text-purple-700":a===Ft.DESIGNER||"Designer"===a?"text-orange-700":a===Ft.ADMIN||"Admin"===a?"text-red-700":"text-gray-700"})():"text-gray-700"}`,children:e.receivedBy&&e.receivedBy.includes("(")?e.receivedBy.split("(")[1].replace(")","").trim():t.find(t=>t.name===e.receivedBy)?.role||"Vendor"})]})})]})}),ie.jsx("td",{className:"px-4 py-3 text-left text-gray-700 text-sm md:text-xs",children:e.description}),ie.jsxs("td",{className:"px-4 py-3 text-right text-gray-700 font-bold text-sm md:text-xs",children:["",e.amount.toLocaleString()]}),ie.jsx("td",{className:"px-4 py-3",children:ie.jsx("div",{className:"flex justify-center",children:ie.jsx("input",{type:"checkbox",checked:!0===e.adminApproved,disabled:!ta,title:e.adminApproved?"Click to revoke admin approval":"Admin approval checkbox","aria-label":"Approve or revoke as admin",onChange:t=>Ma(e.id,"admin",t.target.checked),className:"w-4 h-4 rounded border-gray-300 cursor-pointer hover:border-gray-400 disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-gray-100"})})}),ie.jsx("td",{className:"px-4 py-3",children:ie.jsx("div",{className:"flex justify-center",children:ie.jsx("input",{type:"checkbox",checked:!0===e.clientApproved,disabled:!Qs,title:e.clientApproved?"Click to revoke client approval":"Client approval checkbox","aria-label":"Approve or revoke as client",onChange:t=>Ma(e.id,"client",t.target.checked),className:"w-4 h-4 rounded border-gray-300 cursor-pointer hover:border-gray-400 disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-gray-100"})})}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsx("span",{className:"inline-block px-2 py-1 rounded text-sm md:text-xs font-medium "+(e.adminApproved&&e.clientApproved?"bg-green-100 text-green-700":e.adminApproved?"bg-blue-100 text-blue-700":e.clientApproved?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"),children:e.adminApproved&&e.clientApproved?"Approved":e.adminApproved?"Admin OK":e.clientApproved?"Client OK":"Pending"})})]},e.id))})]})}),"Designing"===e.type&&Js.filter(e=>{const s=t.filter(e=>e.role===Ft.VENDOR),a=new Set(s.map(e=>e.name)),r=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return!!e.vendorName&&a.has(e.vendorName)||"vendor"===e.paidBy||e.receivedByName&&a.has(r(e.receivedByName))||e.paidByOther&&a.has(r(e.paidByOther))||"vendor-received"===e.receivedByRole}).length>0&&ie.jsx("div",{className:"px-6 py-4 bg-gray-100 border-t border-gray-200",children:ie.jsxs("div",{className:"space-y-3",children:[ie.jsxs("div",{className:"flex justify-between items-center",children:[ie.jsx("span",{className:"text-sm md:text-xs font-semibold text-gray-700",children:"Total Vendor Transactions"}),(()=>{const e=Js.filter(e=>{const s=t.filter(e=>e.role===Ft.VENDOR),a=new Set(s.map(e=>e.name)),r=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return(!!e.vendorName&&a.has(e.vendorName)||"vendor"===e.paidBy||e.receivedByName&&a.has(r(e.receivedByName))||e.paidByOther&&a.has(r(e.paidByOther))||"vendor-received"===e.receivedByRole)&&!0===e.clientApproved&&!0===e.adminApproved}).reduce((e,t)=>e+t.amount,0);return ie.jsxs("span",{className:"font-semibold text-gray-900 text-lg md:text-sm",children:["",e.toLocaleString()]})})()]}),ie.jsx("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200 bg-gray-100 rounded-md px-3 py-2",children:ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("span",{className:"text-base md:text-xs font-semibold text-gray-700",children:"Designer Charges"}),ta&&!Ts&&ie.jsxs(ie.Fragment,{children:[ie.jsxs("span",{className:"text-base md:text-xs text-gray-700",children:["(",Es,"%)"]}),ie.jsx("button",{className:"ml-1 p-1 rounded hover:bg-gray-200",title:"Edit Designer Charges Percentage",onClick:()=>Ps(!0),children:ie.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:ie.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536M9 13h3l8-8a2.828 2.828 0 10-4-4l-8 8v3h3z"})})})]}),ta&&Ts&&ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("input",{type:"number",min:"0",max:"100",value:Es,onChange:e=>$s(parseFloat(e.target.value)||0),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:border-gray-500 bg-white","aria-label":"Designer Charges Percentage",title:"Enter designer charges percentage for vendor payments",placeholder:"0"}),ie.jsx("span",{className:"text-sm md:text-xs text-gray-700",children:"%"}),ie.jsx("button",{className:"ml-2 px-2 py-1 text-xs font-semibold rounded bg-gray-700 text-white hover:bg-gray-800 focus:outline-none border border-gray-700",onClick:()=>{ta&&Es!==(e.designerChargePercentage??0)&&(s({...e,designerChargePercentage:Es}),m("Designer Charges Updated","Designer Charges percent saved.","success",void 0,e.id,e.name)),Ps(!1)},title:"Save Designer Charges Percentage",children:"Save"})]}),!ta&&ie.jsxs("span",{className:"text-sm md:text-xs text-gray-700",children:["(",Es,"%)"]})]})}),(()=>{const e=Js.filter(e=>{const s=t.filter(e=>e.role===Ft.VENDOR),a=new Set(s.map(e=>e.name)),r=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return!!e.vendorName&&a.has(e.vendorName)||"vendor"===e.paidBy||e.receivedByName&&a.has(r(e.receivedByName))||e.paidByOther&&a.has(r(e.paidByOther))||"vendor-received"===e.receivedByRole}).reduce((e,t)=>e+t.amount,0),s=e*(Es/100),a=e+s;return ie.jsx("div",{className:"w-full mt-2 bg-gray-100 rounded px-3 py-2 text-sm md:text-xs",children:ie.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4 sm:items-center sm:justify-between",children:[ie.jsxs("span",{className:"block min-w-[140px] mb-1 sm:mb-0",children:["Total Vendor Amount: ",ie.jsxs("span",{className:"font-semibold text-gray-900",children:["",e.toLocaleString()]})]}),ie.jsxs("span",{className:"block min-w-[120px] mb-1 sm:mb-0",children:["Designer Charges: ",ie.jsxs("span",{className:"font-semibold text-gray-700",children:[Es,"%"]})]}),ie.jsxs("span",{className:"block min-w-[150px] mb-1 sm:mb-0",children:["Calculated Charges: ",ie.jsxs("span",{className:"font-semibold text-gray-700",children:["",s.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),ie.jsxs("span",{className:"block min-w-[130px]",children:["Final Amount: ",ie.jsxs("span",{className:"font-semibold text-green-700",children:["",a.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})})})()]})})]})]}),"timeline"===y&&!ea&&ie.jsx("div",{className:"max-w-3xl mx-auto p-4 md:p-8",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-8 overflow-hidden",children:[ie.jsx("h3",{className:"text-xl md:text-lg font-bold text-gray-800 mb-6",children:"Project Timeline"}),ie.jsxs("div",{className:"relative border-l-2 border-gray-100 ml-3 space-y-8",children:[(!_s||0===_s.length)&&ie.jsx("div",{className:"pl-6 text-gray-400 italic",children:"No timeline events yet. Add milestones to track project progress."}),_s?.sort((e,t)=>{const s=new Date(e.endDate||e.startDate).getTime();return new Date(t.endDate||t.startDate).getTime()-s}).map(e=>ie.jsxs("div",{className:"relative pl-8",children:[ie.jsx("span",{className:"absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm\n                        "+("completed"===e.status?"bg-green-500":"in-progress"===e.status?"bg-blue-500":"bg-gray-400")}),ie.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start",children:[ie.jsxs("div",{className:"flex-1",children:[ie.jsx("p",{className:"font-bold text-gray-800 text-lg md:text-base",children:e.title||e.milestone}),ie.jsx("p",{className:"text-gray-600 text-base md:text-sm mt-0.5",children:e.description}),ie.jsx("div",{className:"flex items-center gap-2 mt-2",children:ie.jsx("span",{className:"text-sm md:text-xs px-2.5 py-1.5 rounded-full font-medium\n                                 "+("completed"===e.status?"bg-green-100 text-green-700":"in-progress"===e.status?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:e.status})})]}),ie.jsxs("div",{className:"text-sm md:text-xs text-gray-400 mt-2 sm:mt-0 font-mono whitespace-nowrap",children:[ie.jsx("div",{children:Tr(e.endDate||e.startDate)}),ie.jsx("div",{className:"text-gray-300",children:new Date(e.endDate||e.startDate).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]})]})]},e.id))]})]})}),"team"===y&&ie.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 md:p-8",children:ie.jsxs("div",{className:"bg-white p-4 md:p-8 rounded-xl border border-gray-200",children:[ie.jsx("h3",{className:"font-bold text-lg md:text-base text-gray-800 mb-4",children:"Project Clients"}),ie.jsx("div",{className:"space-y-2",children:(()=>{const s=Array.from(new Set([e.clientId,...e.clientIds||[]].filter(Boolean)));return 0===s.length?ie.jsx("p",{className:"text-gray-500 text-sm",children:"No clients assigned"}):s.map(s=>{const a=t.find(e=>e.id===s);return a?ie.jsxs("div",{className:"flex items-center justify-between border-b border-gray-50 pb-2",children:[ie.jsx("div",{className:"flex items-center gap-4",children:ie.jsxs("div",{children:[ie.jsx("p",{className:"text-base md:text-sm font-bold text-gray-900",children:a.name}),ie.jsx("p",{className:"text-xs text-gray-500",children:"Client"})]})}),c.role===Ft.ADMIN&&ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("button",{onClick:()=>(async t=>{if(t.email&&t.email.trim()){h("Sending payment reminder...");try{const s=await(async(e,t,s)=>Lr({to:e,recipientName:t,subject:`Payment Reminder: ${s}`,htmlContent:`\n    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">\n      <div style="background: linear-gradient(135deg, #ca8a04 0%, #b45309 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">\n        <h2 style="color: #fff; margin: 0; font-size: 24px;"> Payment Reminder</h2>\n      </div>\n      \n      <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">\n        <p style="color: #333; font-size: 16px;">Hi <strong>${t}</strong>,</p>\n        \n        <p style="color: #555; font-size: 14px;">This is a gentle reminder regarding pending payments for the following project:</p>\n        \n        <div style="background-color: #fef3c7; border-left: 4px solid #ca8a04; padding: 15px; margin: 20px 0; border-radius: 4px;">\n          <p style="margin: 8px 0; color: #333;"><strong>Project:</strong> ${s}</p>\n          \n        </div>\n        \n        <p style="color: #555; font-size: 14px;">Please clear the dues at your earliest convenience to avoid any service delays.</p>\n        \n        <p style="margin-top: 30px; color: #999; font-size: 12px; border-top: 1px solid #e5e7eb; padding-top: 20px;">\n          Regards,<br>\n          <strong>ID ERP System</strong>\n        </p>\n      </div>\n    </div>\n  `}))(t.email,t.name,e.name);s.success?m("Success",`Payment reminder sent to ${t.name}`,"success"):m("Error",s.error||"Failed to send email","error")}catch(Cn){m("Error","Failed to send payment reminder","error")}finally{b()}}else m("Error",`Email not found for ${t.name}`,"error")})(a),className:"text-gray-400 hover:text-green-600 p-2.5 rounded-full hover:bg-green-50 transition-colors",title:"Send Payment Reminder Email",children:ie.jsx(_e,{className:"w-5 h-5"})}),ie.jsx("button",{onClick:()=>{const t=`${window.location.origin}${window.location.pathname}?projectId=${e.id}`;navigator.clipboard.writeText(t).then(()=>{m("Success","Project link copied to clipboard","success",c?.id,e.id,e.name)}).catch(()=>{m("Error","Failed to copy link","error",c?.id,e.id,e.name)})},className:"text-gray-400 hover:text-blue-600 p-2.5 rounded-full hover:bg-blue-50 transition-colors",title:"Copy project link",children:ie.jsx(Ke,{className:"w-5 h-5"})})]})]},s):null})})()}),ie.jsxs("div",{className:"flex items-center justify-between border-b border-gray-50 pb-2",children:[ie.jsx("div",{className:"flex items-center gap-4",children:ie.jsxs("div",{children:[ie.jsx("p",{className:"text-base md:text-sm font-bold text-gray-900",children:da(e.leadDesignerId)}),ie.jsx("p",{className:"text-sm text-gray-500",children:"Lead Designer"})]})}),c.role===Ft.ADMIN&&e.leadDesignerId&&ie.jsx("button",{onClick:()=>Is(!0),className:"text-red-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded transition-colors",title:"Remove Lead Designer",children:ie.jsx(Et,{className:"w-4 h-4"})})]}),(()=>{const a=e.teamMembers?e.teamMembers.map(e=>t.find(t=>t.id===e)).filter(e=>void 0!==e&&e.role===Ft.DESIGNER):[];return 0===a.length?null:ie.jsxs(ie.Fragment,{children:[ie.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-2",children:"Designers"}),a.map(t=>ie.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors border border-transparent hover:border-gray-100",children:[ie.jsxs("div",{className:"flex-1",children:[ie.jsx("p",{className:"font-bold text-gray-800 text-base md:text-sm",children:t.name}),ie.jsx("p",{className:"text-sm text-gray-500",children:t.role})]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("button",{onClick:()=>As(t),className:"text-blue-500 hover:text-blue-700 text-sm font-medium px-2 py-1 hover:bg-blue-50 rounded transition-colors",title:"View designer details and projects",children:"View Details"}),aa&&ie.jsx("button",{onClick:()=>{const a={...e,teamMembers:(e.teamMembers||[]).filter(e=>e!==t.id)};s(a),m("Success",`${t.name} removed from team`,"success")},className:"text-red-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded transition-colors",title:"Remove Member",children:ie.jsx(Et,{className:"w-4 h-4"})})]})]},t.id))]})})(),or.length>0&&ie.jsx(ie.Fragment,{children:ie.jsx("div",{className:"pt-4 space-y-6",children:or.map(t=>ie.jsxs("div",{children:[ie.jsxs("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-3 border-b border-gray-100 pb-1 flex items-center gap-2",children:[ie.jsx(jt,{className:"w-4 h-4"})," ",t]}),ie.jsx("div",{className:"grid grid-cols-1 gap-3",children:er[t].map(t=>(Js.filter(e=>{const s=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return e.adminApproved&&e.clientApproved&&(e.vendorName===t.name||s(e.receivedByName)===t.name||s(e.paidByOther)===t.name||e.paidTo===t.name||e.receivedBy===t.name)}).reduce((e,t)=>e+(t.amount||0),0),ie.jsxs("div",{onClick:()=>{ea&&t.id!==c.id||Cs(t)},className:"flex items-center gap-3 p-3 rounded-lg transition-colors border border-transparent "+(ea&&t.id!==c.id?"opacity-60 cursor-default":"hover:bg-gray-50 hover:border-gray-100 cursor-pointer group"),title:ea&&t.id!==c.id?"You can only view your own billing report":"Click to view billing report",children:[ie.jsxs("div",{className:"flex-1",children:[ie.jsx("p",{className:"font-bold text-gray-800 text-base md:text-sm",children:t.name}),ie.jsx("p",{className:"text-sm text-gray-500",children:t.company||"Independent"})]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2.5 py-1.5 rounded-full font-medium",children:[e.tasks.filter(e=>e.assigneeId===t.id).length," Tasks"]}),ta&&ie.jsx("button",{onClick:a=>{a.stopPropagation();const r=(e.hiddenVendors||[]).includes(t.id),n={...e,hiddenVendors:r?(e.hiddenVendors||[]).filter(e=>e!==t.id):[...e.hiddenVendors||[],t.id]};s(n);const i=r?"shown":"hidden";m("Success",`${t.name} ${i} from clients`,"success")},className:"p-1.5 rounded transition-colors "+((e.hiddenVendors||[]).includes(t.id)?"text-gray-400 hover:text-gray-600 hover:bg-gray-100":"text-blue-500 hover:text-blue-700 hover:bg-blue-50"),title:(e.hiddenVendors||[]).includes(t.id)?"Show to clients":"Hide from clients",children:(e.hiddenVendors||[]).includes(t.id)?ie.jsx(Be,{className:"w-4 h-4"}):ie.jsx(Re,{className:"w-4 h-4"})}),ea&&t.id!==c.id?null:ie.jsx(Ie,{className:"w-4 h-4 text-gray-300 group-hover:text-gray-500"})]})]},t.id)))})]},t))})})]})})]}),"team"===y&&Ss&&ie.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-lg border border-gray-200 mt-8 mb-8 p-4 md:p-6",children:[ie.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:["Vendor Financials: ",ie.jsx("span",{className:"text-purple-700",children:Ss.name})]}),ie.jsx("div",{className:"overflow-x-auto",children:ie.jsxs("table",{className:"w-full text-sm",children:[ie.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700",children:"Date"}),ie.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Description"}),ie.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Amount"}),ie.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Designer Charge"}),ie.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Status"})]})}),ie.jsx("tbody",{children:Js.filter(e=>{const t=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return e.adminApproved&&e.clientApproved&&(e.vendorName===Ss.name||t(e.receivedByName)===Ss.name||t(e.paidByOther)===Ss.name||e.paidTo===Ss.name||e.receivedBy===Ss.name)}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).map((t,s)=>{const a=e.designerChargePercentage||0,r=Math.round((t.amount||0)*a/100);return ie.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 "+(s%2==0?"bg-white":"bg-gray-50/50"),children:[ie.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap text-xs text-left",children:t.date}),ie.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.description||"-"}),ie.jsxs("td",{className:"px-4 py-3 text-right text-gray-900 font-bold",children:["",t.amount?.toLocaleString()]}),ie.jsxs("td",{className:"px-4 py-3 text-right text-orange-700 font-bold",children:["",r.toLocaleString()," ",ie.jsxs("span",{className:"text-xs text-gray-400",children:["(",a,"%)"]})]}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700",children:"Approved"})})]},t.id)})})]})})]}),Vt&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] flex flex-col animate-fade-in",children:[ie.jsx("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:ie.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[ie.jsx(Ct,{className:"w-5 h-5"})," Add to Project"]})}),ie.jsxs("div",{className:"p-4 md:p-6 space-y-4 flex-1 overflow-y-auto scrollbar-thin",children:[ie.jsxs("div",{className:"flex gap-2 bg-gray-100 p-1 rounded-lg",children:[ie.jsx("button",{onClick:()=>{qt("client"),Gt("")},className:"flex-1 py-2 rounded font-medium text-sm transition-colors "+("client"===Ht?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Add Client"}),ie.jsx("button",{onClick:()=>{qt("member"),Gt("")},className:"flex-1 py-2 rounded font-medium text-sm transition-colors "+("member"===Ht?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Add Vendor"})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"text-sm font-bold text-gray-500 uppercase",children:["Select ","client"===Ht?"Clients":"Vendors"]}),ie.jsx("div",{className:"border rounded-lg p-3 space-y-2 max-h-48 overflow-y-auto mt-2 border-gray-300",children:"client"===Ht?0===t.filter(t=>t.role===Ft.CLIENT&&t.id!==e.clientId&&!(e.clientIds||[]).includes(t.id)).length?ie.jsx("p",{className:"text-gray-500 text-sm",children:"No clients available to add"}):t.filter(t=>t.role===Ft.CLIENT&&t.id!==e.clientId&&!(e.clientIds||[]).includes(t.id)).map(e=>ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[ie.jsx("input",{type:"checkbox",checked:_t.includes(e.id),onChange:t=>{const s=_t.split(",").filter(Boolean),a=t.target.checked?[...s,e.id]:s.filter(t=>t!==e.id);Gt(a.join(","))},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),ie.jsx("span",{className:"text-sm text-gray-700",children:e.name})]},e.id)):0===t.filter(t=>t.role===Ft.VENDOR&&!(e.teamMembers||[]).includes(t.id)).length?ie.jsx("p",{className:"text-gray-500 text-sm",children:"No vendors available to add"}):t.filter(t=>t.role===Ft.VENDOR&&!(e.teamMembers||[]).includes(t.id)).map(e=>ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[ie.jsx("input",{type:"checkbox",checked:_t.includes(e.id),onChange:t=>{const s=_t.split(",").filter(Boolean),a=t.target.checked?[...s,e.id]:s.filter(t=>t!==e.id);Gt(a.join(","))},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),ie.jsx("span",{className:"text-sm text-gray-700",children:e.name})]},e.id))}),ie.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"client"===Ht?"Select clients to add as additional contacts for this project.":"Select vendors to add to this project."})]}),ie.jsxs("div",{className:"flex gap-3 pt-2",children:[ie.jsx("button",{onClick:()=>{Ut(!1),Gt("")},className:"flex-1 py-2 text-gray-500 hover:bg-gray-100 rounded",children:"Cancel"}),ie.jsxs("button",{onClick:async()=>{if(!_t)return void m("Validation Error","Please select at least one user","error");const a=_t.split(",").filter(Boolean);try{if("client"===Ht){const r=a.filter(t=>t!==e.clientId&&!(e.clientIds||[]).includes(t));if(0===r.length)return void m("Info","All selected clients are already added","info");const n=[...e.clientIds||[],...r];r.forEach(s=>{const a=t.find(e=>e.id===s);ua("Client Added",`${a?.name} added as client to project`),ga(s,"Added to Project",`You have been added as a client to "${e.name}"`,"success","dashboard")}),s({...e,clientIds:n}),m("Success",`${r.length} client${1!==r.length?"s":""} added`,"success")}else if("member"===Ht){const r=a.filter(t=>!(e.teamMembers||[]).includes(t));if(0===r.length)return void m("Info","All selected members are already added","info");const n=[...e.teamMembers||[],...r];r.forEach(s=>{const a=t.find(e=>e.id===s);ua("Team Member Added",`${a?.name} added as team member to project`),ga(s,"Added to Project",`You have been added to "${e.name}"`,"success","dashboard")}),s({...e,teamMembers:n}),m("Success",`${r.length} member${1!==r.length?"s":""} added`,"success")}Ut(!1),Gt("")}catch(Cn){m("Error","Failed to add member.","error")}},className:"flex-1 py-2 bg-gray-900 text-white rounded font-bold hover:bg-gray-800",children:["Add ","client"===Ht?"Clients":"Vendors"]})]})]})]})}),document.body),et&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[ie.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 flex-shrink-0",children:[ie.jsxs("h3",{className:"text-2xl md:text-lg font-bold text-gray-900 flex items-center gap-2",children:[ie.jsx(_e,{className:"w-5 h-5"})," ",rt?"Edit Transaction":"Record Transaction"]}),ie.jsx("button",{onClick:()=>{tt(!1),Tt(!1),ot(null),It(""),ht(""),ft("")},className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close modal",children:ie.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ie.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),ie.jsxs("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-thin space-y-3",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:["Amount ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("div",{className:"relative mt-1",children:[ie.jsx("span",{className:"absolute left-3 top-2 text-gray-400",children:""}),ie.jsx("input",{type:"number",className:`${va($t&&!ct.amount)} pl-7`,placeholder:"0.00",title:"Enter transaction amount",value:ct.amount||"",onChange:e=>mt({...ct,amount:parseFloat(e.target.value)})})]})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:["Description ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"text",className:`${va($t&&!ct.description)} mt-1`,placeholder:"e.g. Initial Deposit, Paint Supplies",title:"Enter transaction description",value:ct.description||"",onChange:e=>mt({...ct,description:e.target.value})})]}),ie.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Type"}),ie.jsxs("div",{className:"flex gap-2 mt-1",children:[ie.jsx("button",{onClick:()=>mt({...ct,type:"income"}),className:"flex-1 py-2 text-base md:text-xs font-bold rounded "+("income"===ct.type?"bg-green-100 text-green-700 ring-2 ring-green-500":"bg-gray-50 text-gray-500"),children:"Income"}),ie.jsx("button",{onClick:()=>mt({...ct,type:"expense"}),className:"flex-1 py-2 text-base md:text-xs font-bold rounded "+("expense"===ct.type?"bg-red-100 text-red-700 ring-2 ring-red-500":"bg-gray-50 text-gray-500"),children:"Expense"})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Date"}),ie.jsx("input",{type:"date",className:`${va($t&&!ct.date)} mt-1 text-base md:text-xs`,title:"Select transaction date",value:ct.date||"",onChange:e=>mt({...ct,date:e.target.value})})]})]}),"expense"===ct.type&&ie.jsxs(ie.Fragment,{children:[ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By"}),ie.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[ie.jsx("button",{onClick:()=>mt({...ct,paidBy:"client"}),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("client"===ct.paidBy?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"),children:"Client"}),ie.jsx("button",{onClick:()=>mt({...ct,paidBy:"vendor"}),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("vendor"===ct.paidBy?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"),children:"Vendor"}),ie.jsx("button",{onClick:()=>mt({...ct,paidBy:"designer"}),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("designer"===ct.paidBy?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"),children:"Designer"}),ie.jsx("button",{onClick:()=>mt({...ct,paidBy:"admin"}),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("admin"===ct.paidBy?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"),children:"Admin"}),ie.jsx("button",{onClick:()=>mt({...ct,paidBy:"other"}),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("other"===ct.paidBy?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"),children:"Other"})]})]}),"client"===ct.paidBy&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ct.vendorName||"",onChange:e=>mt({...ct,vendorName:e.target.value}),title:"Select a client from the list",children:[ie.jsx("option",{value:"",children:"Select a client..."}),t.filter(e=>e.role===Ft.CLIENT).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"vendor"===ct.paidBy&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ct.vendorName||"",onChange:e=>mt({...ct,vendorName:e.target.value}),title:"Select a vendor from the list",children:[ie.jsx("option",{value:"",children:"Select a vendor..."}),t.filter(e=>e.role===Ft.VENDOR).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"designer"===ct.paidBy&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ct.vendorName||"",onChange:e=>mt({...ct,vendorName:e.target.value}),title:"Select a designer from the list",children:[ie.jsx("option",{value:"",children:"Select a designer..."}),t.filter(e=>e.role===Ft.DESIGNER).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"admin"===ct.paidBy&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ct.vendorName||"",onChange:e=>mt({...ct,vendorName:e.target.value}),title:"Select an admin from the list",children:[ie.jsx("option",{value:"",children:"Select an admin..."}),t.filter(e=>e.role===Ft.ADMIN).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"other"===ct.paidBy&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By (Name & Role)"}),ie.jsx("input",{type:"text",className:`${va(!1)} mt-1`,placeholder:"e.g. John Smith (Partner) or Supplier (Vendor)",title:"Enter who paid (name and role in parentheses)",value:ct.paidByOther||"",onChange:e=>mt({...ct,paidByOther:e.target.value})})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By"}),ie.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[ie.jsx("button",{onClick:()=>ft("client"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("client"===yt?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"),children:"Client"}),ie.jsx("button",{onClick:()=>ft("vendor"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("vendor"===yt?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"),children:"Vendor"}),ie.jsx("button",{onClick:()=>ft("designer"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("designer"===yt?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"),children:"Designer"}),ie.jsx("button",{onClick:()=>ft("admin"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("admin"===yt?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"),children:"Admin"}),ie.jsx("button",{onClick:()=>ft("other"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("other"===yt?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"),children:"Other"})]})]}),"client"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ut||"",onChange:e=>ht(e.target.value),title:"Select a client from the project",children:[ie.jsx("option",{value:"",children:"Select a client..."}),ca.filter(e=>e.role===Ft.CLIENT).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"vendor"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ut||"",onChange:e=>ht(e.target.value),title:"Select a vendor from the project",children:[ie.jsx("option",{value:"",children:"Select a vendor..."}),ca.filter(e=>e.role===Ft.VENDOR).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"designer"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ut||"",onChange:e=>ht(e.target.value),title:"Select a designer from the project",children:[ie.jsx("option",{value:"",children:"Select a designer..."}),ca.filter(e=>e.role===Ft.DESIGNER).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"admin"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ut||"",onChange:e=>ht(e.target.value),title:"Select an admin from the list",children:[ie.jsx("option",{value:"",children:"Select an admin..."}),t.filter(e=>e.role===Ft.ADMIN).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"other"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By (Name & Role)"}),ie.jsx("input",{type:"text",className:`${va(!1)} mt-1`,placeholder:"e.g. John Smith (Contractor) or Supplier (Vendor)",title:"Enter who received (name and role in parentheses)",value:ut||"",onChange:e=>ht(e.target.value)})]})]}),"income"===ct.type&&ie.jsxs(ie.Fragment,{children:[ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By"}),ie.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[ie.jsx("button",{onClick:()=>ft("client"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("client"===yt?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"),children:"Client"}),ie.jsx("button",{onClick:()=>ft("vendor"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("vendor"===yt?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"),children:"Vendor"}),ie.jsx("button",{onClick:()=>ft("designer"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("designer"===yt?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"),children:"Designer"}),ie.jsx("button",{onClick:()=>ft("admin"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("admin"===yt?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"),children:"Admin"}),ie.jsx("button",{onClick:()=>ft("other"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("other"===yt?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"),children:"Other"})]})]}),"client"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:vt||"",onChange:e=>It(e.target.value),title:"Select a client from the project",children:[ie.jsx("option",{value:"",children:"Select a client..."}),ca.filter(e=>e.role===Ft.CLIENT).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"vendor"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:vt||"",onChange:e=>It(e.target.value),title:"Select a vendor from the project",children:[ie.jsx("option",{value:"",children:"Select a vendor..."}),ca.filter(e=>e.role===Ft.VENDOR).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"designer"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:vt||"",onChange:e=>It(e.target.value),title:"Select a designer from the project",children:[ie.jsx("option",{value:"",children:"Select a designer..."}),ca.filter(e=>e.role===Ft.DESIGNER).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"admin"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:vt||"",onChange:e=>It(e.target.value),title:"Select an admin from the list",children:[ie.jsx("option",{value:"",children:"Select an admin..."}),t.filter(e=>e.role===Ft.ADMIN).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"other"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By (Name & Role)"}),ie.jsx("input",{type:"text",className:`${va(!1)} mt-1`,placeholder:"e.g. John Smith (Partner) or Supplier (Vendor)",title:"Enter who paid (name and role in parentheses)",value:vt||"",onChange:e=>It(e.target.value)})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By"}),ie.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[ie.jsx("button",{onClick:()=>ft(""),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+(""===yt?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"),children:"Project"}),ie.jsx("button",{onClick:()=>ft("vendor-received"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("vendor-received"===yt?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"),children:"Vendor"}),ie.jsx("button",{onClick:()=>ft("designer-received"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("designer-received"===yt?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"),children:"Designer"}),ie.jsx("button",{onClick:()=>ft("admin-received"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("admin-received"===yt?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"),children:"Admin"}),ie.jsx("button",{onClick:()=>ft("other-received"),className:"py-2 px-2 text-base md:text-xs font-bold rounded "+("other-received"===yt?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"),children:"Other"})]})]}),"vendor-received"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ut||"",onChange:e=>ht(e.target.value),title:"Select a vendor from the project",children:[ie.jsx("option",{value:"",children:"Select a vendor..."}),ca.filter(e=>e.role===Ft.VENDOR).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"designer-received"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ut||"",onChange:e=>ht(e.target.value),title:"Select a designer from the project",children:[ie.jsx("option",{value:"",children:"Select a designer..."}),ca.filter(e=>e.role===Ft.DESIGNER).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"admin-received"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),ie.jsxs("select",{className:`${va(!1)} mt-1`,value:ut||"",onChange:e=>ht(e.target.value),title:"Select an admin from the list",children:[ie.jsx("option",{value:"",children:"Select an admin..."}),t.filter(e=>e.role===Ft.ADMIN).map(e=>ie.jsx("option",{value:e.name,children:e.name},e.id))]})]}),"other-received"===yt&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By (Name & Role)"}),ie.jsx("input",{type:"text",className:`${va(!1)} mt-1`,placeholder:"e.g. John Smith (Contractor) or Supplier (Vendor)",title:"Enter who received (name and role in parentheses)",value:ut||"",onChange:e=>ht(e.target.value)})]})]}),ie.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Category"}),ie.jsxs("select",{className:`${va($t&&!ct.category)} mt-1 text-base md:text-xs`,value:ct.category||"",onChange:e=>{mt({...ct,category:e.target.value}),"Others"!==e.target.value&&gt("")},"aria-label":"Transaction category",children:[ie.jsx("option",{value:"",children:"Select..."}),"income"===ct.type?ie.jsxs(ie.Fragment,{children:[ie.jsx("option",{value:"Advance",children:"Advance"}),ie.jsx("option",{value:"Milestone 1",children:"Milestone 1"}),ie.jsx("option",{value:"Milestone 2",children:"Milestone 2"}),ie.jsx("option",{value:"Final Payment",children:"Final Payment"}),ie.jsx("option",{value:"Additional Budget",children:"Additional Budget"}),ie.jsx("option",{value:"Others",children:"Others (please specify)"})]}):ie.jsxs(ie.Fragment,{children:[ie.jsx("option",{value:"Materials",children:"Materials"}),ie.jsx("option",{value:"Labor",children:"Labor"}),ie.jsx("option",{value:"Permits/Fees",children:"Permits/Fees"}),ie.jsx("option",{value:"Furniture",children:"Furniture"}),ie.jsx("option",{value:"Misc",children:"Misc"})]})]})]}),"income"===ct.type&&"Others"===ct.category&&ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Specify Category"}),ie.jsx("input",{type:"text",className:`${va($t&&!pt)} mt-1 text-base md:text-xs`,placeholder:"Enter custom category",value:pt,onChange:e=>gt(e.target.value)})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Mode"}),ie.jsxs("select",{className:`${va(!1)} mt-1 text-base md:text-xs`,value:ct.paymentMode||"",onChange:e=>mt({...ct,paymentMode:e.target.value}),"aria-label":"Payment mode",children:[ie.jsx("option",{value:"",children:"Select..."}),ie.jsx("option",{value:"cash",children:"Cash"}),ie.jsx("option",{value:"upi",children:"UPI"}),ie.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),ie.jsx("option",{value:"cheque",children:"Cheque"}),ie.jsx("option",{value:"credit_card",children:"Credit Card"}),ie.jsx("option",{value:"other",children:"Other"})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Status"}),ie.jsxs("select",{className:`${va(!1)} mt-1 text-base md:text-xs`,value:ct.status||"pending",onChange:e=>mt({...ct,status:e.target.value}),"aria-label":"Transaction status",children:[ie.jsx("option",{value:"pending",children:"Pending"}),ie.jsx("option",{value:"paid",children:"Paid"}),ie.jsx("option",{value:"overdue",children:"Overdue"})]})]})]}),"income"===ct.type&&"Additional Budget"===ct.category&&ie.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[ie.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Approvals Required"}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:c?.role!==Ft.CLIENT?.5:1,pointerEvents:c?.role!==Ft.CLIENT?"none":"auto"},children:[ie.jsx("input",{type:"checkbox",checked:"approved"===ct.clientApprovalForAdditionalBudget,onChange:e=>mt({...ct,clientApprovalForAdditionalBudget:e.target.checked?"approved":"pending"}),disabled:c?.role!==Ft.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client approval for additional budget"}),ie.jsxs("span",{className:"text-sm text-gray-700",children:["Client Approval","approved"===ct.clientApprovalForAdditionalBudget&&ie.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),"rejected"===ct.clientApprovalForAdditionalBudget&&ie.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:c?.role!==Ft.ADMIN?.5:1,pointerEvents:c?.role!==Ft.ADMIN?"none":"auto"},children:[ie.jsx("input",{type:"checkbox",checked:"approved"===ct.adminApprovalForAdditionalBudget,onChange:e=>mt({...ct,adminApprovalForAdditionalBudget:e.target.checked?"approved":"pending"}),disabled:c?.role!==Ft.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval for additional budget"}),ie.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval","approved"===ct.adminApprovalForAdditionalBudget&&ie.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),"rejected"===ct.adminApprovalForAdditionalBudget&&ie.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),"income"===ct.type&&"Additional Budget"!==ct.category&&ie.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[ie.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Payment Approvals"}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:c?.role!==Ft.CLIENT?.5:1,pointerEvents:c?.role!==Ft.CLIENT?"none":"auto"},children:[ie.jsx("input",{type:"checkbox",checked:"approved"===ct.clientApprovalForPayment,onChange:e=>mt({...ct,clientApprovalForPayment:e.target.checked?"approved":"pending"}),disabled:c?.role!==Ft.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client confirmation of payment"}),ie.jsxs("span",{className:"text-sm text-gray-700",children:["Client Confirmation","approved"===ct.clientApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),"rejected"===ct.clientApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:c?.role!==Ft.ADMIN?.5:1,pointerEvents:c?.role!==Ft.ADMIN?"none":"auto"},children:[ie.jsx("input",{type:"checkbox",checked:"approved"===ct.adminApprovalForPayment,onChange:e=>mt({...ct,adminApprovalForPayment:e.target.checked?"approved":"pending"}),disabled:c?.role!==Ft.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval of payment"}),ie.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval","approved"===ct.adminApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),"rejected"===ct.adminApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),"expense"===ct.type&&ie.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[ie.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Payment Approvals"}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:c?.role!==Ft.CLIENT?.5:1,pointerEvents:c?.role!==Ft.CLIENT?"none":"auto"},children:[ie.jsx("input",{type:"checkbox",checked:"approved"===ct.clientApprovalForPayment,onChange:e=>mt({...ct,clientApprovalForPayment:e.target.checked?"approved":"pending"}),disabled:c?.role!==Ft.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client approval of expense"}),ie.jsxs("span",{className:"text-sm text-gray-700",children:["Client Approval","approved"===ct.clientApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),"rejected"===ct.clientApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:c?.role!==Ft.ADMIN?.5:1,pointerEvents:c?.role!==Ft.ADMIN?"none":"auto"},children:[ie.jsx("input",{type:"checkbox",checked:"approved"===ct.adminApprovalForPayment,onChange:e=>mt({...ct,adminApprovalForPayment:e.target.checked?"approved":"pending"}),disabled:c?.role!==Ft.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval of expense"}),ie.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval","approved"===ct.adminApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),"rejected"===ct.adminApprovalForPayment&&ie.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),ie.jsxs("div",{className:"pt-2 flex gap-3",children:[ie.jsx("button",{onClick:()=>{tt(!1),Tt(!1),ot(null),It(""),ht(""),ft(""),gt("")},className:"flex-1 py-2 text-base md:text-xs text-gray-500 hover:bg-gray-100 rounded font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:Pt,title:"Close transaction modal",children:"Cancel"}),ie.jsx("button",{onClick:async()=>{const t="Others"===ct.category?pt:ct.category;if(!(ct.amount&&ct.description&&t&&ct.date))return Tt(!0),void m("Validation Error",`Please fill all required fields for "${e.name}"`,"error",void 0,e.id,e.name);if(!Pt){if(!rt&&Js.some(e=>e.vendorName===ct.vendorName&&e.amount===Number(ct.amount)&&e.type===ct.type&&e.date===ct.date&&e.description===ct.description))return void m("Duplicate Detected","This transaction already exists. Please check the records above.","warning",void 0,e.id,e.name);Mt(!0);try{let r,n=[...Js];if(rt){let t={...Js.find(e=>e.id===rt),...ct,amount:Number(ct.amount),paidBy:"income"===ct.type?"other"===yt?"other":"client"===yt?"client":"vendor"===yt?"vendor":"designer"===yt?"designer":"admin"===yt?"admin":ct.paidBy:ct.paidBy,paidByRole:"income"===ct.type?"other"===yt?"other":"client"===yt?"client":"vendor"===yt?"vendor":"designer"===yt?"designer":"admin"===yt?"admin":void 0:void 0,paidTo:"income"===ct.type?ct.vendorName||vt:vt||ct.paidTo,paidByOther:"income"===ct.type&&"other"===yt?vt:ct.paidByOther,receivedBy:"income"===ct.type?"vendor-received"===yt||"designer-received"===yt||"admin-received"===yt||"other-received"===yt||"admin"===yt||"client"===yt||"vendor"===yt||"designer"===yt?ut:ct.receivedBy:ut||ct.receivedBy,receivedByRole:"client-received"===yt?"client-received":"vendor-received"===yt?"vendor-received":"designer-received"===yt?"designer-received":"admin-received"===yt?"admin-received":"other-received"===yt?"other-received":"client"===yt?"client-received":"vendor"===yt?"vendor-received":"designer"===yt?"designer-received":"admin"===yt?"admin-received":"other"===yt?"other-received":void 0,receivedByName:"expense"===ct.type||"income"===ct.type?ut:ct.receivedByName};("income"===t.type&&"paid"===t.status||"expense"===t.type&&"paid"===t.status)&&(t.status="paid");let s="in-progress";"paid"===t.status?s="completed":"overdue"===t.status&&(s="in-progress");const a=`Type: ${t.type} | Amount: ${t.amount.toLocaleString()} | Category: ${t.category} | Mode: ${t.paymentMode||"N/A"} | Status: ${t.status}${t.vendorName?` | Vendor: ${t.vendorName}`:""}`;await sr(e.id,`Transaction Updated: ${t.description}`,a,s,t.date,t.date),n=n.map(e=>e.id===rt?t:e),r=ua("Financial",`Updated transaction: ${t.description} (${t.type} - ${t.amount.toLocaleString()})`)}else{const s={id:Math.random().toString(36).substr(2,9),date:ct.date,timestamp:(new Date).toISOString(),description:ct.description,amount:Number(ct.amount),type:ct.type,status:ct.status||"pending",category:t,vendorName:ct.vendorName,paidBy:"income"===ct.type?"other"===yt?"other":"client"===yt?"client":"vendor"===yt?"vendor":"designer"===yt?"designer":"admin"===yt?"admin":void 0:ct.paidBy,paidByRole:"income"===ct.type?"other"===yt?"other":"client"===yt?"client":"vendor"===yt?"vendor":"designer"===yt?"designer":"admin"===yt?"admin":void 0:void 0,paidTo:"income"===ct.type?ct.vendorName||vt:ct.paidTo,paidByOther:"income"===ct.type&&"other"===yt?vt:ct.paidByOther,receivedBy:"income"===ct.type?"vendor-received"===yt||"designer-received"===yt||"admin-received"===yt||"other-received"===yt||"admin"===yt||"client"===yt||"vendor"===yt||"designer"===yt?ut:void 0:ut||ct.receivedBy,receivedByRole:"client-received"===yt?"client-received":"vendor-received"===yt?"vendor-received":"designer-received"===yt?"designer-received":"admin-received"===yt?"admin-received":"other-received"===yt?"other-received":"client"===yt?"client-received":"vendor"===yt?"vendor-received":"designer"===yt?"designer-received":"admin"===yt?"admin-received":"other"===yt?"other-received":void 0,receivedByName:"expense"===ct.type||"income"===ct.type?ut:void 0,paymentMode:ct.paymentMode,adminApproved:ct.adminApproved,clientApproved:ct.clientApproved,isAdditionalBudget:"income"===ct.type&&"Additional Budget"===t,clientApprovalForAdditionalBudget:"income"===ct.type&&"Additional Budget"===t?ct.clientApprovalForAdditionalBudget||"pending":void 0,adminApprovalForAdditionalBudget:"income"===ct.type&&"Additional Budget"===t?ct.adminApprovalForAdditionalBudget||"pending":void 0,isClientPayment:"income"===ct.type&&"Additional Budget"!==t,clientApprovalForPayment:"income"===ct.type&&"Additional Budget"!==t?ct.clientApprovalForPayment||"pending":void 0,adminApprovalForPayment:"income"===ct.type&&"Additional Budget"!==t?ct.adminApprovalForPayment||"pending":void 0};let a="planned";"paid"===s.status?a="completed":"pending"!==s.status&&"overdue"!==s.status||(a="in-progress");const i=`Type: ${s.type} | Amount: ${s.amount.toLocaleString()} | Category: ${s.category} | Mode: ${s.paymentMode||"N/A"} | Status: ${s.status} | Paid By: ${s.paidBy||"N/A"}${s.vendorName?` | Vendor: ${s.vendorName}`:""}`;await sr(e.id,`Financial: ${"income"===s.type?"Income":"Expense"} - ${s.description}`,i,a,s.date,s.date),n.push(s),r=ua("Financial",`Added ${s.type}: ${s.amount.toLocaleString()} for ${s.description}`)}try{if(rt){const t=n.find(e=>e.id===rt);t&&await Or(e.id,rt,t)}else{const t=n[n.length-1],s=await Mr(e.id,{date:t.date,timestamp:t.timestamp,description:t.description,amount:t.amount,type:t.type,status:t.status,category:t.category,vendorName:t.vendorName,paidBy:t.paidBy,paidByRole:t.paidByRole,paidTo:t.paidTo,paidByOther:t.paidByOther,receivedBy:t.receivedBy,receivedByRole:t.receivedByRole,receivedByName:t.receivedByName,paymentMode:t.paymentMode,adminApproved:t.adminApproved,clientApproved:t.clientApproved,isAdditionalBudget:t.isAdditionalBudget,clientApprovalForAdditionalBudget:t.clientApprovalForAdditionalBudget,adminApprovalForAdditionalBudget:t.adminApprovalForAdditionalBudget,isClientPayment:t.isClientPayment,clientApprovalForPayment:t.clientApprovalForPayment,adminApprovalForPayment:t.adminApprovalForPayment});t.id=s}}catch(a){throw new Error("Failed to save transaction to database")}s({...e,financials:rt?e.financials:n,activityLog:[r,...e.activityLog||[]]}),xa("Budget Update",`${rt?"Updated":"New"} transaction "${ct.description}" in "${e.name}"`,c.id,"financials"),mt({date:(new Date).toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0}),tt(!1),ot(null),Tt(!1),Mt(!1),It(""),ht(""),ft(""),gt(""),m("Success",`Transaction ${rt?"updated":"added"} and saved to database.`,"success",void 0,e.id,e.name)}catch(Cn){const s=Cn.message?.includes("database")?"Failed to save transaction. Please try again.":"Transaction saved locally. Please refresh the page or contact support if changes don't appear.";m("Error",s,"error",void 0,e.id,e.name),tt(!1),ot(null),Mt(!1),It(""),ht(""),ft(""),gt("")}}},disabled:Pt,className:"flex-1 py-2 text-base md:text-xs bg-gray-900 text-white rounded font-bold hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all",title:"Save transaction entry",children:Pt?"Saving...":rt?"Update Entry":"Add Entry"})]})]})]})}),document.body),re&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[ie.jsx("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:ie.jsxs("h3",{className:"text-xl md:text-lg font-bold flex items-center gap-2 text-gray-900",children:[ie.jsx(St,{className:"w-5 h-5 md:w-4 md:h-4"})," Upload Document"]})}),ie.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 scrollbar-thin space-y-4",children:[ie.jsx("input",{type:"text",placeholder:"Document Name (e.g. FloorPlan.pdf) - optional when uploading files",className:`${va(me&&!le.name&&0===de.length)} text-base md:text-sm`,value:le.name,onChange:e=>oe({...le,name:e.target.value})}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Share With Project Team:"}),ie.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:[Ft.CLIENT,Ft.VENDOR,Ft.DESIGNER].map(e=>{const t=ca.filter(t=>t.role===e);return 0===t.length?null:ie.jsxs("div",{children:[ie.jsxs("p",{className:"text-base md:text-xs font-bold text-gray-600 uppercase mb-2",children:[e,"s"]}),ie.jsx("div",{className:"space-y-1 ml-2",children:t.map(e=>ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-white p-1.5 rounded border border-transparent hover:border-gray-200",children:[ie.jsx("input",{type:"checkbox",checked:le.sharedWith.includes(e.id),onChange:t=>{t.target.checked?oe({...le,sharedWith:[...le.sharedWith,e.id]}):oe({...le,sharedWith:le.sharedWith.filter(t=>t!==e.id)})}}),ie.jsx("span",{className:"text-base md:text-sm text-gray-800",children:e.name})]},e.id))})]},e)})})]}),Zs.length>0&&ie.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[ie.jsx("label",{htmlFor:"attach-task-select",className:"text-base md:text-xs font-bold text-blue-600 uppercase mb-2 block",children:"Attach to Task (Optional):"}),ie.jsxs("select",{id:"attach-task-select",title:"Select a task to attach documents to","aria-label":"Select a task to attach documents to",value:le.attachToTaskId||"",onChange:e=>{oe({...le,attachToTaskId:e.target.value||void 0})},className:"w-full p-2 border border-blue-300 rounded bg-white text-base md:text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[ie.jsx("option",{value:"",children:"-- Don't attach to any task --"}),Zs.map(e=>ie.jsxs("option",{value:e.id,children:[e.title," (",e.status,")"]},e.id))]})]}),ie.jsxs("div",{className:"bg-gray-50 p-4 md:p-6 rounded-lg border-2 border-dashed border-gray-300 text-base md:text-sm text-gray-500 hover:bg-gray-100 hover:border-gray-400 transition-colors cursor-pointer relative",onClick:()=>xe.current?.click(),children:[de.length>0?ie.jsxs("div",{className:"flex flex-col items-start gap-2",children:[ie.jsxs("div",{className:"w-full flex items-center gap-2",children:[ie.jsx(Fe,{className:"w-8 h-8 text-blue-500 flex-shrink-0"}),ie.jsxs("div",{className:"flex-1 text-left",children:[ie.jsxs("p",{className:"font-bold text-base md:text-sm text-gray-800",children:[de.length," file(s) selected"]}),ie.jsxs("p",{className:"text-sm md:text-xs text-gray-400",children:["Total size: ",(de.reduce((e,t)=>e+t.size,0)/1024).toFixed(1)," KB"]})]})]}),ie.jsx("div",{className:"w-full mt-2 max-h-32 overflow-y-auto border-t border-gray-200 pt-2",children:de.map((e,t)=>ie.jsxs("div",{className:"flex items-center justify-between text-sm md:text-xs text-gray-600 bg-white p-1.5 rounded mb-1",children:[ie.jsx("span",{className:"truncate flex-1",children:e.name}),ie.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),ce(de.filter((e,s)=>s!==t))},className:"ml-2 text-gray-400 hover:text-red-500 flex-shrink-0 text-lg md:text-base",title:"Remove file",children:""})]},t))})]}):ie.jsxs("div",{className:"flex flex-col items-center",children:[ie.jsx(St,{className:"w-8 h-8 text-gray-300 mb-2"}),ie.jsx("p",{className:"text-base md:text-sm",children:"Click to select files"}),ie.jsx("p",{className:"text-sm md:text-xs text-gray-400 mt-1",children:"or drag and drop here (multiple files supported)"})]}),ie.jsx("input",{type:"file",multiple:!0,ref:xe,onChange:e=>{const t=Array.from(e.target.files||[]);ce(t)},className:"hidden",title:"Select files to upload"})]}),ie.jsxs("div",{className:"flex gap-2 pt-2",children:[ie.jsx("button",{onClick:()=>ne(!1),className:"flex-1 py-2 md:py-1.5 text-base md:text-xs text-gray-500 hover:bg-gray-100 rounded",children:"Cancel"}),ie.jsx("button",{onClick:async()=>{if(0===de.length&&!le.name)return pe(!0),void m("Validation Error",`Please select files or enter a name for "${e.name}".`,"error",void 0,e.id,e.name);wa(!0);try{const r=de.length>0?de:[{name:le.name}],n=[],i=[],l=[];for(let s=0;s<r.length;s++){const o=r[s],d=o.name||le.name;try{if(!o||"object"!=typeof o)throw new Error(`Invalid file at index ${s}`);let r="other";o.type&&(o.type.startsWith("image/")?r="image":"application/pdf"===o.type&&(r="pdf"));let p="";if(o instanceof File&&o.size>0)try{const t=d.replace(/[^a-zA-Z0-9._-]/g,"_"),r=`projects/${e.id}/documents/${Date.now()}_${s}_${t}`;let n=!1,i=null;const l=2;for(let e=0;e<=l&&!n;e++)try{p=await Zr(o,r),n=!0}catch(a){i=a,e<l&&await new Promise(t=>setTimeout(t,1e3*(e+1)))}if(!n)throw i||new Error(`Failed to upload ${d}`)}catch(a){const t=a instanceof Error?a.message:String(a);i.push(d),m("Upload Failed",`Failed to upload "${d}": ${t}`,"error",void 0,e.id,e.name);continue}else{if(o instanceof File&&0===o.size){const t=`File "${d}" is empty (0 bytes)`;i.push(d),m("Invalid File",t,"error",void 0,e.id,e.name);continue}p="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iI2VmZWZlZiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjI0IiBmaWxsPSIjYWFhIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QbGFjZWhvbGRlcjwvdGV4dD48L3N2Zz4="}const x={name:d,type:r,url:p,uploadedBy:c.id,uploadDate:(new Date).toISOString(),sharedWith:le.sharedWith.length>0?le.sharedWith:[Ft.ADMIN,Ft.DESIGNER,Ft.CLIENT],approvalStatus:"pending"},g=await nr(e.id,x);n.push(g);const u=le.sharedWith.length>0?le.sharedWith.map(e=>{if(e===Ft.ADMIN||e===Ft.DESIGNER||e===Ft.CLIENT)return e;const s=t.find(t=>t.id===e);return s?.name||e}).join(", "):"Admin, Designer, Client",h=(new Date).toISOString();sr(e.id,`Document Uploaded: ${d}`,`${d} (${r}) uploaded by ${c.name}. Shared with: ${u}`,"completed",h,h).catch(e=>{}),l.push({createdDocId:g,doc:x,fileName:d})}catch(Cn){i.push(d)}s<r.length-1&&await new Promise(e=>setTimeout(e,500))}let o={...e};if(le.attachToTaskId&&n.length>0){const t=Zs.find(e=>e.id===le.attachToTaskId);if(t){const s=t.documents||[],a=n.filter(e=>!s.includes(e));if(a.length>0){const r=[...s,...a];ar(e.id,t.id,{...t,documents:r}).catch(e=>{}),k?.id===t.id&&I({...k,documents:r});const n=Zs.map(e=>e.id===t.id?{...e,documents:r}:e);o={...o,tasks:n}}}}const d=ua("Document Uploaded",`Uploaded ${n.length} document(s)${i.length>0?` (${i.length} failed)`:""}`);o={...o,activityLog:[d,...o.activityLog||[]]},s(o),n.length>0&&m("Success",`${n.length} document(s) uploaded successfully${i.length>0?`. Failed: ${i.join(", ")}`:""}.`,"success",void 0,e.id,e.name);const p=l.map(async s=>{const a={...s.doc,id:s.createdDocId},r=[],n=t.filter(e=>e.role===Ft.ADMIN&&e.tenantId===c.tenantId);r.push(...n);const i=le.sharedWith.filter(e=>e!==Ft.ADMIN&&e!==Ft.DESIGNER&&e!==Ft.CLIENT),l=t.filter(e=>i.includes(e.id));r.push(...l);const o=r.filter((e,t,s)=>s.findIndex(t=>t.id===e.id)===t&&e.id!==c.id);o.length>0&&(async(e,t,s,a,r)=>{const n=Rr(),i=r?`${n}?projectId=${r}&tab=documents`:void 0;for(const l of a)if(l.email)try{const a=`\n        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\n          <h2 style="color: #1f2937;">New Document Uploaded</h2>\n          <p>Hi ${l.name},</p>\n          <p><strong>${t}</strong> uploaded a new document in project <strong>${s}</strong>:</p>\n          \n          <div style="background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">\n            <p style="margin: 0; color: #4b5563;"><strong>Document:</strong> ${e.name}</p>\n            <p style="margin: 10px 0 0 0; color: #6b7280;"><strong>Type:</strong> ${e.type}</p>\n          </div>\n          \n          <p style="margin-top: 20px;">\n            <a href="${i}" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">View Document</a>\n          </p>\n        </div>\n      `;(await Lr({to:l.email,recipientName:l.name,subject:`New Document Uploaded: ${e.name} - ${s}`,htmlContent:a})).success&&await Sr(l.id,`New Document - ${s}`,`${t} uploaded "${e.name}" (${e.type})`,i)}catch(Cn){}})(a,c.name,e.name,o,e.id).catch(e=>{})});Promise.allSettled(p).catch(e=>{}),xa("Files Added",`${c.name} uploaded ${n.length} document(s) to "${e.name}"`,c.id,"documents"),ne(!1),oe({name:"",type:"other",sharedWith:[]}),ce([]),pe(!1),m("Success",`${n.length} document(s) uploaded successfully to "${e.name}"`,"success",void 0,e.id,e.name)}catch(Cn){m("Error","Unable to upload document(s). Please check file size and try again.","error",void 0,e.id,e.name)}finally{wa(!1)}},className:"flex-1 py-2 md:py-1.5 text-base md:text-xs bg-gray-900 text-white rounded font-bold hover:bg-gray-800",disabled:Na,children:Na?ie.jsxs("span",{className:"flex items-center justify-center gap-2",children:[ie.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[ie.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),ie.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Uploading..."]}):"Upload"})]})]})]})}),document.body),Pe&&We&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[ie.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:[ie.jsx("h3",{className:"text-lg font-bold",children:"Edit Shared Users"}),ie.jsx("p",{className:"text-sm text-gray-500",children:"Modify who can access this document after approval."})]}),ie.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4",children:ie.jsxs("div",{children:[ie.jsx("label",{className:"text-sm font-semibold",children:"Select Users"}),ie.jsx("div",{className:"mt-2 space-y-2 max-h-56 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:ca.map(e=>ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-white p-1.5 rounded border border-transparent hover:border-gray-200",children:[ie.jsx("input",{type:"checkbox",checked:qe.includes(e.id),onChange:t=>{t.target.checked?Je(t=>Array.from(new Set([...t,e.id]))):Je(t=>t.filter(t=>t!==e.id))}}),ie.jsxs("span",{className:"text-sm text-gray-800",children:[e.name," (",e.role,")"]})]},e.id))})]})}),ie.jsxs("div",{className:"p-4 md:p-6 border-t border-gray-100 flex gap-3",children:[ie.jsx("button",{onClick:()=>{Me(!1),Ge(null),Je([])},className:"flex-1 py-2 text-base text-gray-500 hover:bg-gray-100 rounded font-medium",children:"Cancel"}),ie.jsx("button",{onClick:async()=>{try{await ir(e.id,We.id,{sharedWith:qe}),m("Shared Users Updated",`Shared list updated for ${We.name}`,"success",void 0,e.id,e.name)}catch(t){m("Update Failed","Could not update shared users","error")}finally{Me(!1),Ge(null),Je([])}},className:"flex-1 py-2 bg-blue-600 text-white rounded font-bold hover:bg-blue-700",children:"Save"})]})]})}),document.body),N&&k&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[ie.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[ie.jsx("div",{className:"flex items-center gap-2",children:ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:k.id?"Edit Task Details":"Create New Task"}),ie.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 font-medium mt-0.5",children:[ie.jsx(ze,{className:"w-3 h-3"}),ie.jsx("span",{children:e.name})]})]})}),ie.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600",title:"Close task modal",children:ie.jsx(Et,{})})]}),ba(k)&&ie.jsxs("div",{className:"bg-red-50 border-b border-red-100 px-4 py-2 flex items-center gap-2 text-red-700 text-sm",children:[ie.jsx(Se,{className:"w-4 h-4"}),ie.jsx("span",{className:"font-bold",children:"Dependency Locked:"}),ie.jsxs("span",{children:["This task is blocked by pending dependencies: ",ya(k).map(e=>e.title).join(", "),"."]})]}),cr&&ie.jsxs("div",{className:"bg-gray-800 text-white px-4 py-3 flex items-center justify-between shadow-md",children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(ye,{className:"w-5 h-5 text-red-400"}),ie.jsxs("span",{className:"font-bold uppercase tracking-wide",children:["Task Frozen: ",k.status]})]}),ie.jsx("span",{className:"text-xs opacity-70",children:"Interaction disabled by Admin."})]}),ie.jsxs("div",{className:"flex md:hidden border-b border-gray-200 bg-white flex-shrink-0",children:[ie.jsx("button",{onClick:()=>F("details"),className:"flex-1 py-3 text-sm font-bold text-center "+("details"===L?"text-gray-900 border-b-2 border-gray-900":"text-gray-500"),children:"Details"}),ie.jsx("button",{onClick:()=>F("activity"),className:"flex-1 py-3 text-sm font-bold text-center "+("activity"===L?"text-gray-900 border-b-2 border-gray-900":"text-gray-500"),children:"Activity"})]}),ie.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden "+(cr?"pointer-events-none opacity-80 bg-gray-50":""),children:[ie.jsx("div",{className:"w-full md:w-1/2 p-6 overflow-y-auto border-r border-gray-100 bg-white "+("activity"===L?"hidden md:block":"block"),children:ie.jsxs("div",{className:"space-y-4",children:[ta&&ie.jsxs("div",{className:"bg-gray-900 p-3 rounded-lg pointer-events-auto",children:[ie.jsxs("p",{className:"text-xs font-bold text-gray-400 uppercase mb-2 flex items-center gap-1",children:[ie.jsx(bt,{className:"w-3 h-3"})," Admin Actions"]}),ie.jsxs("div",{className:"flex gap-2",children:[ie.jsxs("button",{onClick:()=>La(k),className:"flex-1 bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",disabled:k.status===Wt.DONE,children:[ie.jsx(Ce,{className:"w-3 h-3"})," Mark Done"]}),k.status===Wt.ON_HOLD?ie.jsxs("button",{onClick:()=>I({...k,status:Er(k,Wt.IN_PROGRESS)}),className:"flex-1 bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[ie.jsx(Ee,{className:"w-3 h-3"})," Resume"]}):ie.jsxs("button",{onClick:()=>I({...k,status:Wt.ON_HOLD}),className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[ie.jsx(Ae,{className:"w-3 h-3"})," Hold"]}),k.status===Wt.ABORTED?ie.jsxs("button",{onClick:()=>I({...k,status:Er(k,Wt.IN_PROGRESS)}),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[ie.jsx(Ue,{className:"w-3 h-3"})," Restore"]}):ie.jsxs("button",{onClick:()=>I({...k,status:Wt.ABORTED}),className:"flex-1 bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[ie.jsx(ye,{className:"w-3 h-3"})," Abort"]})]})]}),k.id&&k.status!==Wt.DONE&&!ta&&c?.id===k.assigneeId&&!cr&&ie.jsxs("div",{className:"bg-green-50 border border-green-100 p-3 rounded-lg mb-4 flex items-center justify-between",children:[ie.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[ie.jsx(Ce,{className:"w-5 h-5"}),ie.jsx("span",{className:"font-bold text-sm",children:"Complete this task?"})]}),ie.jsx("button",{onClick:()=>La(k),className:"bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 px-4 rounded flex items-center gap-1 transition-colors",children:"Mark as Done"})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Title ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),aa?ie.jsx("input",{type:"text",className:`${va(M&&!k.title,cr)} font-semibold mt-1`,placeholder:"Task title",value:k.title||"",onChange:e=>I({...k,title:e.target.value}),disabled:cr}):ie.jsx("p",{className:"font-bold text-gray-800 mt-1",children:k.title})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Category"}),aa?ie.jsx("select",{className:`${va(!1,cr)} mt-1`,value:k.category||"General",onChange:e=>I({...k,category:e.target.value}),disabled:cr,"aria-label":"Task category",children:Yr.map(e=>ie.jsx("option",{value:e,children:e},e))}):ie.jsx("span",{className:"block mt-1 text-sm bg-gray-100 w-fit px-2 py-1 rounded text-gray-800",children:k.category||"General"})]}),ie.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Start Date ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),aa?ie.jsx("input",{type:"date",className:`${va(M&&!k.startDate,cr)} mt-1`,title:"Select start date",value:k.startDate||"",onChange:e=>I({...k,startDate:e.target.value}),disabled:cr}):ie.jsx("p",{className:"text-sm mt-1 text-gray-800",children:Tr(k.startDate)})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Due Date ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),aa?ie.jsx("input",{type:"date",className:`${va(M&&!k.dueDate,cr)} mt-1`,title:"Select due date",value:k.dueDate||"",onChange:e=>I({...k,dueDate:e.target.value}),disabled:cr}):ie.jsx("p",{className:"text-sm mt-1 text-gray-800",children:Tr(k.dueDate)})]})]}),ie.jsxs("div",{children:[ie.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[ie.jsx(Ke,{className:"w-3 h-3 text-gray-400"}),ie.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Dependencies"})]}),aa?ie.jsx("div",{className:"mt-1 p-2 border rounded max-h-24 overflow-y-auto bg-white border-gray-200 "+(cr?"opacity-50":""),children:Zs.filter(e=>e.id!==k.id).length>0?Zs.filter(e=>e.id!==k.id).map(e=>ie.jsxs("label",{className:"flex items-center gap-2 mb-1 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[ie.jsx("input",{type:"checkbox",checked:(k.dependencies||[]).includes(e.id),onChange:t=>((e,t)=>{if(!k||ha(k.status))return;let s=k.dependencies||[];s=t?[...s,e]:s.filter(t=>t!==e);let a=k.startDate;if(s.length>0){const e=Zs.filter(e=>s.includes(e.id)),t=e.reduce((e,t)=>new Date(t.dueDate)>new Date(e)?t.dueDate:e,e[0]?.dueDate||"");t&&(a=t)}I({...k,dependencies:s,startDate:a})})(e.id,t.target.checked),disabled:cr,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),ie.jsx("span",{className:"text-sm text-gray-700 truncate",children:e.title}),ie.jsxs("span",{className:"text-xs text-gray-400 ml-auto",children:["Ends: ",e.dueDate]})]},e.id)):ie.jsx("p",{className:"text-xs text-gray-400 italic",children:"No other tasks available"})}):ie.jsx("div",{className:"mt-1 text-sm text-gray-600",children:(k.dependencies||[]).length>0?Zs.filter(e=>(k.dependencies||[]).includes(e.id)).map(e=>ie.jsxs("div",{className:"flex items-center gap-1 text-xs bg-gray-50 border border-gray-200 rounded px-2 py-1 mb-1",children:[ie.jsx(Ke,{className:"w-3 h-3 text-gray-400"})," ",e.title,e.status!==Wt.DONE&&ie.jsx("span",{className:"text-red-500 font-bold ml-1",children:"(Pending)"})]},e.id)):ie.jsx("span",{className:"text-gray-400 italic text-xs",children:"No dependencies"})})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Assignee & Priority"}),ie.jsxs("div",{className:"flex gap-4 mt-1",children:[aa?ie.jsxs("select",{className:`${va(!1,cr)} flex-1`,value:k.assigneeId||"",onChange:e=>I({...k,assigneeId:e.target.value}),disabled:cr,"aria-label":"Task assignee",children:[ie.jsx("option",{value:"",children:"Unassigned"}),t.filter(e=>e.role===Ft.DESIGNER||e.role===Ft.VENDOR).map(e=>ie.jsx("option",{value:e.id,children:e.name},e.id))]}):ie.jsx("p",{className:"flex-1 text-sm bg-gray-50 p-2 rounded text-gray-800",children:da(k.assigneeId||"")}),aa?ie.jsxs("select",{className:"w-32 p-2 border rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-900 "+(cr?"bg-gray-100 text-gray-500":"bg-white text-gray-900"),value:k.priority||"medium",onChange:e=>I({...k,priority:e.target.value}),disabled:cr,"aria-label":"Task priority",children:[ie.jsx("option",{value:"low",children:"Low"}),ie.jsx("option",{value:"medium",children:"Medium"}),ie.jsx("option",{value:"high",children:"High"})]}):ie.jsx("span",{className:"p-2 border rounded bg-gray-50 uppercase text-xs font-bold flex items-center text-gray-800",children:k.priority})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Current Status"}),ie.jsxs("div",{className:"mt-1 w-full p-2 border rounded bg-gray-50 text-gray-700 font-bold flex justify-between items-center flex-wrap gap-2 "+(cr?"border-red-300 bg-red-50":"border-gray-200"),children:[ie.jsx("span",{children:k.status||Wt.TODO}),k.status===Wt.REVIEW&&ie.jsxs("div",{className:"flex gap-1 flex-wrap",children:["approved"===k.approvals?.completion?.client?.status&&"approved"===k.approvals?.completion?.admin?.status&&ie.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded font-normal",children:"Approved by Both"}),"approved"===k.approvals?.completion?.client?.status&&!k.approvals?.completion?.admin?.status&&ie.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded font-normal",children:"Waiting for Admin Approval"}),"approved"===k.approvals?.completion?.admin?.status&&!k.approvals?.completion?.client?.status&&ie.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded font-normal",children:"Waiting for Client Approval"}),!k.approvals?.completion?.client?.status&&!k.approvals?.completion?.admin?.status&&ie.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-normal",children:"Under Review"}),"rejected"===k.approvals?.completion?.client?.status&&ie.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded font-normal",children:"Rejected by Client"}),"rejected"===k.approvals?.completion?.designer?.status&&ie.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded font-normal",children:"Rejected by Designer"})]}),ie.jsx("span",{className:"text-xs font-normal text-gray-400 italic",children:cr?"Frozen by Admin":"Auto-updated via progress"})]})]}),ie.jsxs("div",{className:"pt-4 border-t border-gray-100 flex flex-col "+(k.subtasks&&k.subtasks.length>0?"h-64 max-h-[400px]":""),children:[ie.jsxs("div",{className:"flex justify-between items-center mb-2",children:[ie.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase block",children:"Checklist"}),aa&&!cr&&(!k.subtasks||0===k.subtasks.length)&&ie.jsxs("button",{onClick:()=>{const e={id:Math.random().toString(),title:"New Item",isCompleted:!1};I({...k,subtasks:[...k.subtasks||[],e]}),setTimeout(()=>{const e=document.getElementById("checklist-container");e&&(e.scrollTop=e.scrollHeight)},100)},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[ie.jsx(dt,{className:"w-3 h-3"})," Add"]})]}),ie.jsxs("div",{className:"space-y-2 pr-2 custom-scrollbar "+(k.subtasks&&k.subtasks.length>0?"flex-1 overflow-y-auto min-h-[200px] border border-gray-200 rounded-lg p-3":""),id:"checklist-container",children:[k.subtasks?.map((e,t)=>ie.jsxs("div",{className:"flex items-center gap-2 p-2 rounded transition-opacity",style:{opacity:!aa&&c.id!==k.assigneeId||ba(k)||cr?.5:1},children:[ie.jsx("button",{type:"button",onClick:()=>{const e=[...k.subtasks||[]];e[t].isCompleted=!e[t].isCompleted,I({...k,subtasks:e})},disabled:!aa&&c.id!==k.assigneeId||ba(k)||cr,title:"Toggle subtask completion","aria-label":"Toggle subtask completion",className:`flex-shrink-0 w-4 h-4 rounded-full border flex items-center justify-center transition-all duration-200 ${e.isCompleted?"bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600":"border-gray-400 hover:border-green-400 hover:bg-green-50"} disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:border-gray-300`,children:e.isCompleted&&ie.jsx(we,{className:"w-3 h-3 text-white"})}),aa?ie.jsx("input",{type:"text",value:e.title,placeholder:"New Item",disabled:cr,onFocus:s=>{if("New Item"===e.title){const e=[...k.subtasks||[]];e[t].title="",I({...k,subtasks:e})}},onChange:e=>{const s=[...k.subtasks||[]];s[t].title=e.target.value,I({...k,subtasks:s})},className:"flex-1 p-1 border-b border-transparent focus:border-gray-300 outline-none text-sm bg-white text-gray-900 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"}):ie.jsx("span",{className:"flex-1 text-sm pointer-events-none "+(e.isCompleted?"line-through text-gray-400":"text-gray-800"),children:e.title}),aa&&!cr&&ie.jsx("button",{onClick:()=>{const t=k.subtasks?.filter(t=>t.id!==e.id);I({...k,subtasks:t})},className:"text-gray-300 hover:text-red-500",title:"Delete subtask","aria-label":"Delete subtask",children:ie.jsx(Et,{className:"w-4 h-4"})})]},e.id)),(!k.subtasks||0===k.subtasks.length)&&ie.jsx("p",{className:"text-xs text-gray-400 italic",children:"No checklist items"}),aa&&!cr&&k.subtasks&&k.subtasks.length>0&&ie.jsxs("button",{id:"add-checklist-btn",onClick:e=>{const t={id:Math.random().toString(),title:"New Item",isCompleted:!1};I({...k,subtasks:[...k.subtasks||[],t]}),setTimeout(()=>{const e=document.getElementById("checklist-container");e&&(e.scrollTop=e.scrollHeight)},100)},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-2 pt-2",children:[ie.jsx(dt,{className:"w-3 h-3"})," Add Item"]})]})]})]})}),ie.jsxs("div",{className:"w-full md:w-1/2 flex flex-col bg-gray-50/50 "+("details"===L?"hidden md:flex":"flex"),children:[k.approvals&&ie.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white",children:[ie.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[ie.jsx(bt,{className:"w-4 h-4 text-gray-500"}),ie.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase",children:"Approvals"})]}),ie.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ie.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-100",children:[ie.jsx("p",{className:"text-sm font-bold text-gray-500 mb-2",children:"1. Start Approval"}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("div",{className:"flex justify-between items-center",children:[ie.jsx("span",{className:"text-sm text-gray-600",children:"Client"}),"pending"===k.approvals?.start?.client?.status?Qs&&!cr?ie.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[ie.jsx("button",{onClick:()=>za("start","approve"),disabled:"start-approve-client"===V,className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve start",children:"start-approve-client"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(wt,{className:"w-3 h-3"})}),ie.jsx("button",{onClick:()=>za("start","reject"),disabled:"start-reject-client"===V,className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject start",children:"start-reject-client"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(Nt,{className:"w-3 h-3"})})]}):ie.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-sm font-bold px-1.5 py-0.5 rounded capitalize "+("approved"===k.approvals?.start?.client?.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:k.approvals?.start?.client?.status}),ta&&!cr&&!("approved"===k.approvals?.start?.client?.status&&"approved"===k.approvals?.start?.admin?.status)&&ie.jsx("button",{onClick:()=>za("start","revoke","client"),disabled:"start-revoke-client"===V,className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]}),ie.jsxs("div",{className:"flex justify-between items-center",children:[ie.jsx("span",{className:"text-sm text-gray-600",children:"Admin"}),"pending"===k.approvals?.start?.admin?.status?ta&&!cr?ie.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[ie.jsx("button",{onClick:()=>za("start","approve"),disabled:"start-approve-admin"===V,className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve start",children:"start-approve-admin"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(wt,{className:"w-3 h-3"})}),ie.jsx("button",{onClick:()=>za("start","reject"),disabled:"start-reject-admin"===V,className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject start",children:"start-reject-admin"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(Nt,{className:"w-3 h-3"})})]}):ie.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-sm font-bold px-1.5 py-0.5 rounded capitalize "+("approved"===k.approvals?.start?.admin?.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:k.approvals?.start?.admin?.status}),ta&&!cr&&!("approved"===k.approvals?.start?.client?.status&&"approved"===k.approvals?.start?.admin?.status)&&ie.jsx("button",{onClick:()=>za("start","revoke","admin"),disabled:"start-revoke-admin"===V,className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]})]})]}),ie.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-100",children:[ie.jsx("p",{className:"text-sm font-bold text-gray-500 mb-2",children:"2. End Approval"}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("div",{className:"flex justify-between items-center",children:[ie.jsx("span",{className:"text-sm text-gray-600",children:"Client"}),"pending"===k.approvals?.completion?.client?.status?Qs&&!cr?ie.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[ie.jsx("button",{onClick:()=>za("completion","approve"),disabled:"completion-approve-client"===V,className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve completion",children:"completion-approve-client"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(wt,{className:"w-3 h-3"})}),ie.jsx("button",{onClick:()=>za("completion","reject"),disabled:"completion-reject-client"===V,className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject completion",children:"completion-reject-client"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(Nt,{className:"w-3 h-3"})})]}):ie.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-bold px-1.5 py-0.5 rounded capitalize "+("approved"===k.approvals?.completion?.client?.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:k.approvals?.completion?.client?.status}),ta&&!cr&&!("approved"===k.approvals?.completion?.client?.status&&"approved"===k.approvals?.completion?.admin?.status)&&ie.jsx("button",{onClick:()=>za("completion","revoke","client"),disabled:"completion-revoke-client"===V,className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]}),ie.jsxs("div",{className:"flex justify-between items-center",children:[ie.jsx("span",{className:"text-sm text-gray-600",children:"Admin"}),"pending"===k.approvals?.completion?.admin?.status?ta&&!cr?ie.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[ie.jsx("button",{onClick:()=>za("completion","approve"),disabled:"completion-approve-admin"===V,className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve completion",children:"completion-approve-admin"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(wt,{className:"w-3 h-3"})}),ie.jsx("button",{onClick:()=>za("completion","reject"),disabled:"completion-reject-admin"===V,className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject completion",children:"completion-reject-admin"===V?ie.jsx(tn,{size:"sm",color:"currentColor"}):ie.jsx(Nt,{className:"w-3 h-3"})})]}):ie.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-bold px-1.5 py-0.5 rounded capitalize "+("approved"===k.approvals?.completion?.admin?.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:k.approvals?.completion?.admin?.status}),ta&&!cr&&!("approved"===k.approvals?.completion?.client?.status&&"approved"===k.approvals?.completion?.admin?.status)&&ie.jsx("button",{onClick:()=>za("completion","revoke","admin"),disabled:"completion-revoke-admin"===V,className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]})]})]})]})]}),ie.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:ie.jsxs("button",{onClick:()=>{ue(null),Qe(!0)},className:"w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors group",title:"View task documents",children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(Fe,{className:"w-4 h-4 text-blue-600"}),ie.jsx("span",{className:"text-xs font-bold text-blue-900 uppercase",children:"Task Documents"}),k.documents&&dr(k.documents)>0&&ie.jsx("span",{className:"bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:dr(k.documents)})]}),ie.jsx(Ie,{className:"w-4 h-4 text-blue-600 group-hover:translate-x-0.5 transition-transform"})]})}),ie.jsxs("div",{className:"flex-1 flex flex-col p-4 overflow-hidden",children:[ie.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[ie.jsx(at,{className:"w-4 h-4 text-gray-500"}),ie.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase",children:"Comments"})]}),ie.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4 pr-1",children:[0===k.comments?.length&&ie.jsx("p",{className:"text-center text-sm text-gray-400 py-4",children:"No comments yet. Start the discussion!"}),k.comments?.map(e=>{const t=e.userId===c.id;return ie.jsx("div",{className:"flex gap-2 "+(t?"flex-row-reverse":""),children:ie.jsxs("div",{className:"p-2 rounded-lg max-w-[85%] text-sm "+(t?"bg-blue-100 text-blue-900":"bg-white border border-gray-200 text-gray-700"),children:[ie.jsx("p",{className:"text-xs font-bold opacity-70 mb-1",children:da(e.userId,e.userName)}),ie.jsx("p",{children:e.text}),ie.jsx("p",{className:"text-xs opacity-60 mt-1 text-right",children:$r(e.timestamp)})]})},e.id)}),ie.jsx("div",{ref:Y})]}),ie.jsxs("div",{className:"relative "+(cr?"opacity-50 pointer-events-none":""),children:[ie.jsx("input",{type:"text",className:"w-full p-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm bg-white text-gray-900",placeholder:"Type a message...",value:G,onChange:e=>H(e.target.value),onKeyDown:e=>"Enter"===e.key&&Fa(),disabled:cr}),ie.jsx("button",{onClick:Fa,disabled:cr,className:"absolute right-2 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800",title:"Send comment",children:ie.jsx(xt,{className:"w-4 h-4"})})]})]})]})]}),ie.jsxs("div",{className:"p-4 border-t border-gray-100 flex justify-between items-center bg-white",children:[ie.jsx("div",{children:ta&&k.id&&ie.jsxs("button",{onClick:()=>{k?.id?(ds(k),ls(!0)):m("Error","Cannot delete a task that has not been saved yet.","error")},className:"px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-2",title:"Delete this task permanently",children:[ie.jsx(ye,{className:"w-4 h-4"})," Delete Task"]})}),ie.jsxs("div",{className:"flex gap-3",children:[ie.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg",title:"Cancel",children:"Cancel"}),(!cr||ta)&&ie.jsx("button",{onClick:async()=>{if(!k?.title||!k.startDate||!k.dueDate)return R(!0),void m("Validation Error",`Please complete all required fields for "${e.name}"`,"error",void 0,e.id,e.name);if(!ha(k.status)||ta){_(!0);try{const a={start:{client:{status:"pending"},admin:{status:"pending"}},completion:{client:{status:"pending"},admin:{status:"pending"}}};let r=k.status||Wt.TODO;ha(r)||(r=Er(k,r));const n=!k.id,i={id:k.id||Math.random().toString(36).substr(2,9),title:k.title,description:k.description,status:r,category:k.category||"General",assigneeId:k.assigneeId||"",startDate:k.startDate,dueDate:k.dueDate,priority:k.priority||"medium",dependencies:k.dependencies||[],subtasks:k.subtasks||[],comments:k.comments||[],approvals:k.approvals||a};if(i.dependencies?.includes(i.id))return void m("Dependency Error","A task cannot depend on itself.","error");if(i.status!==Wt.TODO&&!ha(i.status)&&("approved"!==i.approvals?.start?.client?.status||"approved"!==i.approvals?.start?.admin?.status||"approved"!==i.approvals?.completion?.client?.status||"approved"!==i.approvals?.completion?.admin?.status)){const e=ya(i);if(e.length>0)return void m("Blocked",`Cannot start task. Blocked by: ${e.map(e=>e.title).join(", ")}.`,"error")}let l=[...Zs];const o=l.findIndex(e=>e.id===i.id);let d;const p=Zs.find(e=>e.id===i.id);if(n){l.push(i),d=ua("Task Created",`Created new task "${i.title}"`,"creation"),await(async(e,t)=>{try{const a=C(ka,"projects",e,"tasks"),r=T(a),n=Object.fromEntries(Object.entries({...t}).filter(([e,t])=>void 0!==t));if(await O(r,{...n,createdAt:new Date,updatedAt:new Date}),t.assigneeId){const a=T(ka,"projects",e);try{const e=await $(T(ka,"users",t.assigneeId));(e.exists()&&"Vendor"===e.data().role||(await $(T(ka,"vendors",t.assigneeId))).exists())&&await P(a,{vendorIds:z(t.assigneeId)})}catch(s){}}return r.id}catch(Cn){throw Cn}})(e.id,i);const s=i.assigneeId?da(i.assigneeId):"Unassigned",a=(new Date).toISOString();if(await sr(e.id,`Task Created: ${i.title}`,`Assigned to ${s}. Priority: ${i.priority}, Due: ${i.dueDate}`,"planned",a,a),i.assigneeId){const s=t.find(e=>e.id===i.assigneeId);s&&await Wr(i,s,e.name,e.id,"created"),ga(i.assigneeId,"New Task Assignment",`You have been assigned to task "${i.title}" in "${e.name}"`,"info","plan")}}else{o>=0&&(l[o]=i);const s=[];p?.status!==i.status&&s.push(`Status: ${p?.status}  ${i.status}`),p?.priority!==i.priority&&s.push(`Priority: ${p?.priority}  ${i.priority}`),p?.assigneeId!==i.assigneeId&&s.push(`Assigned to: ${da(p?.assigneeId||"")}  ${da(i.assigneeId)}`),p?.title!==i.title&&s.push("Title changed"),p?.description!==i.description&&s.push("Description updated");const a=s.length>0?` (${s.join(", ")})`:"";d=ua("Task Updated",`Updated task details for "${i.title}"${a}`),await ar(e.id,i.id,i);const r=Dr(i),n=i.assigneeId?da(i.assigneeId):"Unassigned",c=`Priority: ${i.priority} | Status: ${i.status} | Assigned to: ${n} | Progress: ${r}% | Due: ${i.dueDate}${a?" | Changes: "+a:""}`,m=(new Date).toISOString();if(await sr(e.id,`Task Updated: ${i.title}`,c,i.status===Wt.DONE?"completed":"in-progress",m,m),p&&p.assigneeId!==i.assigneeId&&i.assigneeId){const s=t.find(e=>e.id===i.assigneeId);s&&await Wr(i,s,e.name,e.id,"updated"),ga(i.assigneeId,"Task Reassignment",`You have been assigned to task "${i.title}" in "${e.name}"`,"info","plan")}}xa("Task Update",`Task "${i.title}" ${n?"created":"updated"} in "${e.name}"`,c.id,"plan"),s(n?{...e,activityLog:[d,...e.activityLog||[]]}:{...e,tasks:l,activityLog:[d,...e.activityLog||[]]}),m("Task Saved",`Task "${i.title}" has been saved in "${e.name}".`,"success",void 0,e.id,e.name),w(!1),I(null),R(!1),await new Promise(e=>setTimeout(e,500))}catch(Cn){m("Error","Unable to save task. Please check your input and try again.","error",void 0,e.id,e.name)}finally{_(!1)}}else m("Action Denied","This task is frozen and cannot be modified.","error")},disabled:W,className:"px-6 py-2 text-sm font-bold bg-gray-900 text-white rounded-lg hover:bg-gray-800 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",title:"Save task",children:W?ie.jsxs(ie.Fragment,{children:[ie.jsx(tn,{size:"sm",color:"currentColor"}),k.id?"Saving...":"Creating..."]}):ie.jsx(ie.Fragment,{children:k.id?"Save Changes":"Create Task"})})]})]})]})}),document.body),be&&ge&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[ie.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx(Le,{className:"w-5 h-5 text-gray-400"}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"font-bold text-gray-900",children:ge.name}),ie.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded ",Tr(ge.uploadDate)]})]})]}),ie.jsx("button",{onClick:()=>ve(!1),className:"text-gray-400 hover:text-gray-600",title:"Close document modal",children:ie.jsx(Et,{className:"w-5 h-5"})})]}),ie.jsx("div",{className:"flex-1 max-h-[45%] overflow-hidden bg-gray-50 flex items-center justify-center",children:"image"===ge.type?ie.jsx("img",{src:ge.url||sn,alt:ge.name,className:"max-h-full max-w-full object-contain"}):"pdf"===ge.type?ie.jsxs("div",{className:"text-center space-y-4",children:[ie.jsxs("div",{className:"w-24 h-32 mx-auto bg-gradient-to-br from-red-50 to-red-100 rounded-lg flex flex-col items-center justify-center border-2 border-red-200",children:[ie.jsx(Le,{className:"w-12 h-12 text-red-500 mb-2"}),ie.jsx("span",{className:"text-xs font-bold text-red-600 uppercase",children:"PDF"})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-gray-700 font-medium mb-2",children:ge.name}),ie.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"PDF documents cannot be previewed in-browser"})]}),ie.jsx("button",{onClick:()=>window.open(ge.url,"_blank"),className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800",children:"Open PDF in New Tab"})]}):ie.jsxs("div",{className:"text-center space-y-4",children:[ie.jsxs("div",{className:"w-24 h-32 mx-auto bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg flex flex-col items-center justify-center border-2 border-blue-200",children:[ie.jsx(Le,{className:"w-12 h-12 text-blue-500 mb-2"}),ie.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase",children:ge.type})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-gray-700 font-medium mb-2",children:ge.name}),ie.jsxs("p",{className:"text-gray-500 text-sm mb-4",children:[ge.type.toUpperCase()," files cannot be previewed in-browser"]})]}),ie.jsx("button",{onClick:()=>window.open(ge.url,"_blank"),className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800",children:"Open in New Tab"})]})}),ie.jsxs("div",{className:"border-t border-gray-100 flex flex-col flex-1 min-h-[45%] bg-white",children:[ie.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[ie.jsxs("h4",{className:"text-xs font-bold text-gray-700 uppercase mb-3",children:["Comments (",ge.comments?.length||0,")"]}),ge.comments&&0===ge.comments.length?ie.jsx("p",{className:"text-center text-xs text-gray-400 py-4",children:"No comments yet. Start discussing!"}):ge.comments?.map(e=>ie.jsx("div",{className:"flex gap-2",children:ie.jsxs("div",{className:"flex-1",children:[ie.jsx("p",{className:"text-[10px] font-bold text-gray-700",children:da(e.userId,e.userName)}),ie.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:e.text}),ie.jsx("p",{className:"text-[9px] text-gray-400 mt-1",children:$r(e.timestamp)})]})},e.id))]}),ie.jsxs("div",{className:"p-3 border-t border-gray-100 flex gap-2",children:[ie.jsx("input",{type:"text",placeholder:"Add a comment...",value:je,onChange:e=>ke(e.target.value),onKeyDown:e=>"Enter"===e.key&&!De&&Ea(),disabled:De,className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 disabled:opacity-50"}),ie.jsx("button",{onClick:Ea,disabled:!je.trim()||De,className:"px-3 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 disabled:opacity-50",title:"Send comment",children:De?ie.jsx(tn,{size:"sm",className:"text-white"}):ie.jsx(xt,{className:"w-4 h-4"})})]})]})]})}),document.body),is&&os&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200 overflow-hidden",children:[ie.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:ie.jsx(Se,{className:"w-6 h-6 text-red-600"})}),ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Task?"}),ie.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),ie.jsxs("div",{className:"p-6",children:[ie.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the task ",ie.jsxs("span",{className:"font-bold text-gray-900",children:['"',os.title,'"']}),"?"]}),ie.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:ie.jsxs("p",{className:"text-xs text-red-700",children:[ie.jsx("span",{className:"font-bold",children:" Warning:"})," This task will be removed from the project immediately. All associated data will be lost."]})})]}),ie.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[ie.jsx("button",{onClick:()=>{ls(!1),ds(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),ie.jsxs("button",{onClick:async()=>{if(os?.id)try{await(async(e,t)=>{try{await B(T(ka,"projects",e,"tasks",t))}catch(Cn){throw Cn}})(e.id,os.id);const t=Zs.filter(e=>e.id!==os.id),a=ua("Task Deleted",`Deleted task "${os.title}"`);s({...e,tasks:t,activityLog:[a,...e.activityLog||[]]}),m("Task Deleted",`Task "${os.title}" has been deleted from "${e.name}".`,"success",void 0,e.id,e.name),w(!1),I(null),ls(!1),ds(null)}catch(Cn){m("Error","Unable to delete task. Please try again.","error",void 0,e.id,e.name),ls(!1),ds(null)}else m("Error","Cannot delete a task that has not been saved yet.","error")},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm task deletion",children:[ie.jsx(ye,{className:"w-4 h-4"})," Delete Task"]})]})]})}),document.body),hs&&ys&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[ie.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:ie.jsx(Se,{className:"w-6 h-6 text-red-600"})}),ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Meeting?"}),ie.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),ie.jsxs("div",{className:"p-6",children:[ie.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the meeting ",ie.jsxs("span",{className:"font-bold text-gray-900",children:['"',ys.title,'"']}),"?"]}),ie.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:ie.jsxs("p",{className:"text-xs text-red-700",children:[ie.jsx("span",{className:"font-bold",children:" Warning:"})," This meeting and all associated comments will be removed from the project immediately."]})})]}),ie.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[ie.jsx("button",{onClick:()=>{bs(!1),fs(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),ie.jsxs("button",{onClick:()=>{ys&&((async(t,s)=>{try{await(async(e,t)=>{try{await B(T(ka,"projects",e,"meetings",t))}catch(Cn){throw Cn}})(e.id,t),m("Success",`Meeting "${s}" deleted successfully`,"success")}catch(Cn){m("Error","Failed to delete meeting","error")}})(ys.id,ys.title),bs(!1),fs(null))},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm meeting deletion",children:[ie.jsx(ye,{className:"w-4 h-4"})," Delete Meeting"]})]})]})}),document.body),vs&&Ns&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[ie.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:ie.jsx(Se,{className:"w-6 h-6 text-red-600"})}),ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Document?"}),ie.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),ie.jsxs("div",{className:"p-6",children:[ie.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the document ",ie.jsxs("span",{className:"font-bold text-gray-900",children:['"',Ns.name,'"']}),"?"]}),ie.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:ie.jsxs("p",{className:"text-xs text-red-700",children:[ie.jsx("span",{className:"font-bold",children:"Warning:"})," This document will be permanently removed from the project and any tasks it is attached to."]})})]}),ie.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[ie.jsx("button",{onClick:()=>{js(!1),ws(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),ie.jsxs("button",{onClick:async()=>{if(!Ns)return;const t=Ns;try{await(async(e,t)=>{try{await B(T(ka,"projects",e,"documents",t))}catch(Cn){throw Cn}})(e.id,t.id);const a=Zs.map(e=>e.documents?.includes(t.id)?{...e,documents:e.documents.filter(e=>e!==t.id)}:e);k?.documents?.includes(t.id)&&I({...k,documents:k.documents.filter(e=>e!==t.id)});const r=a.filter(e=>e.documents&&e.documents.length!==Zs.find(t=>t.id===e.id)?.documents?.length);for(const t of r)await ar(e.id,t.id,{documents:t.documents});s({...e,tasks:a}),m("Success",`Document "${t.name}" deleted successfully`,"success"),ve(!1)}catch(Cn){m("Error","Failed to delete document","error")}finally{js(!1),ws(null)}},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm document deletion",children:[ie.jsx(kt,{className:"w-4 h-4"})," Delete Document"]})]})]})}),document.body),ks&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200 overflow-hidden",children:[ie.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:ie.jsx(Se,{className:"w-6 h-6 text-red-600"})}),ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Remove Lead Designer?"}),ie.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This will unassign the primary designer."})]})]})}),ie.jsxs("div",{className:"p-6",children:[ie.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to remove ",ie.jsxs("span",{className:"font-bold text-gray-900",children:['"',da(e.leadDesignerId),'"']})," as the Lead Designer of this project?"]}),ie.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:ie.jsxs("p",{className:"text-xs text-red-700",children:[ie.jsx("span",{className:"font-bold",children:" Warning:"})," This designer will no longer be the primary contact for this project. They can still be added as a team member."]})})]}),ie.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[ie.jsx("button",{onClick:()=>Is(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel removal",children:"Cancel"}),ie.jsxs("button",{onClick:async()=>{try{Is(!1),h("Updating Project...");const t={...e,leadDesignerId:""};await p(e.id,{leadDesignerId:""}),s(t),m("Success","Lead Designer removed from project","success")}catch(Cn){m("Error",Cn.message||"Failed to remove lead designer","error")}finally{b()}},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm removal",children:[ie.jsx(ye,{className:"w-4 h-4"})," Remove Designer"]})]})]})}),document.body),Ss&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[ie.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[ie.jsx("div",{className:"flex items-center gap-4",children:ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:Ss.name}),ie.jsx("p",{className:"text-sm text-gray-500",children:"Billing Report"})]})}),ie.jsx("button",{onClick:()=>Cs(null),className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Close vendor billing panel",children:ie.jsx(Et,{className:"w-5 h-5"})})]}),ie.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:0===Js.filter(e=>{const t=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return e.adminApproved&&e.clientApproved&&(e.vendorName===Ss.name||t(e.receivedByName)===Ss.name||t(e.paidByOther)===Ss.name||e.paidTo===Ss.name||e.receivedBy===Ss.name)}).length?ie.jsx("div",{className:"text-center py-10 text-gray-400 border-2 border-dashed border-gray-100 rounded-xl",children:"No approved billing records found for this vendor."}):ie.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:ie.jsxs("table",{className:"w-full text-sm text-left",children:[ie.jsx("thead",{className:"bg-gray-50 border-b border-gray-200 text-gray-600 font-semibold",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-3",children:"Date"}),ie.jsx("th",{className:"px-4 py-3",children:"Paid By"}),ie.jsx("th",{className:"px-4 py-3",children:"Received By"}),ie.jsx("th",{className:"px-4 py-3",children:"Description"}),ie.jsx("th",{className:"px-4 py-3 text-right",children:"Amount"}),ie.jsx("th",{className:"px-4 py-3 text-center",children:"Approvals"})]})}),ie.jsx("tbody",{className:"divide-y divide-gray-100",children:Js.filter(e=>{const t=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return e.adminApproved&&e.clientApproved&&(e.vendorName===Ss.name||t(e.receivedByName)===Ss.name||t(e.paidByOther)===Ss.name||e.paidTo===Ss.name||e.receivedBy===Ss.name)}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).map(e=>ie.jsxs("tr",{className:"hover:bg-gray-50",children:[ie.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap",children:e.date}),ie.jsx("td",{className:"px-4 py-3",children:ie.jsxs("div",{className:"flex flex-col gap-0.5",children:[ie.jsx("div",{className:"font-bold text-gray-900 text-xs",children:"income"===e.type?e.paidTo||e.paidByOther||"-":e.vendorName||"-"}),ie.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[ie.jsx("span",{className:"text-gray-400",children:"|"}),ie.jsx("span",{className:"flex-shrink-0 font-medium text-sm md:text-xs "+("client"===e.paidBy?"text-blue-700":"vendor"===e.paidBy?"text-purple-700":"designer"===e.paidBy?"text-orange-700":"admin"===e.paidBy?"text-red-700":"text-gray-700"),children:"income"===e.type?(()=>{const s=t.find(t=>t.name===(e.paidTo||e.paidByOther));return s?.role===Ft.CLIENT?"Client":s?.role===Ft.VENDOR?"Vendor":s?.role===Ft.DESIGNER?"Designer":s?.role===Ft.ADMIN?"Admin":"client"===e.paidBy?"Client":"vendor"===e.paidBy?"Vendor":"designer"===e.paidBy?"Designer":"admin"===e.paidBy?"Admin":"N/A"})():"client"===e.paidBy?"Client":"vendor"===e.paidBy?"Vendor":"designer"===e.paidBy?"Designer":"admin"===e.paidBy?"Admin":"N/A"})]})]})}),ie.jsx("td",{className:"px-4 py-3",children:ie.jsxs("div",{className:"flex flex-col gap-0.5",children:[ie.jsx("div",{className:"font-bold text-gray-900 text-xs",children:e.receivedBy?e.receivedBy.includes("(")?e.receivedBy.split("(")[0].trim():e.receivedBy:"-"}),ie.jsx("div",{className:"flex flex-col gap-1 text-xs",children:ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-gray-400",children:"|"}),ie.jsx("span",{className:`flex-shrink-0 font-medium text-xs ${e.receivedBy?(()=>{const s=t.find(t=>t.name===(e.receivedBy?.includes("(")?e.receivedBy.split("(")[0].trim():e.receivedBy)),a=s?.role||(e.receivedBy?.includes("(")?e.receivedBy.split("(")[1].replace(")","").trim():"");return a===Ft.CLIENT||"Client"===a?"text-blue-700":a===Ft.VENDOR||"Vendor"===a?"text-purple-700":a===Ft.DESIGNER||"Designer"===a?"text-orange-700":a===Ft.ADMIN||"Admin"===a?"text-red-700":"text-gray-700"})():"text-gray-700"}`,children:e.receivedBy&&e.receivedBy.includes("(")?e.receivedBy.split("(")[1].replace(")","").trim():t.find(t=>t.name===e.receivedBy)?.role||"Vendor"})]})})]})}),ie.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:e.description}),ie.jsxs("td",{className:"px-4 py-3 text-right font-bold text-gray-800",children:["",e.amount.toLocaleString()]}),ie.jsxs("td",{className:"px-4 py-3 text-center",children:[(e.isClientPayment||"income"===e.type)&&ie.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),("approved"===e.clientApprovalForPayment||!0===e.clientApproved)&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),"rejected"===e.clientApprovalForPayment&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),("pending"===e.clientApprovalForPayment||void 0===e.clientApprovalForPayment||null===e.clientApprovalForPayment)&&!e.clientApproved&&c?.role===Ft.CLIENT&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Pa(e.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Confirm payment",disabled:te(`approve-payment-${e.id}-client-approved`),children:te(`approve-payment-${e.id}-client-approved`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Pa(e.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Dispute payment",disabled:te(`approve-payment-${e.id}-client-rejected`),children:te(`approve-payment-${e.id}-client-rejected`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),("pending"===e.clientApprovalForPayment||void 0===e.clientApprovalForPayment||null===e.clientApprovalForPayment)&&!e.clientApproved&&c?.role!==Ft.CLIENT&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),ie.jsx("span",{className:"text-gray-300",children:"|"}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),("approved"===e.adminApprovalForPayment||!0===e.adminApproved)&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),"rejected"===e.adminApprovalForPayment&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),("pending"===e.adminApprovalForPayment||void 0===e.adminApprovalForPayment||null===e.adminApprovalForPayment)&&!e.adminApproved&&c?.role===Ft.ADMIN&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Pa(e.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve payment",disabled:te(`approve-payment-${e.id}-admin-approved`),children:te(`approve-payment-${e.id}-admin-approved`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Pa(e.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject payment",disabled:te(`approve-payment-${e.id}-admin-rejected`),children:te(`approve-payment-${e.id}-admin-rejected`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),("pending"===e.adminApprovalForPayment||void 0===e.adminApprovalForPayment||null===e.adminApprovalForPayment)&&!e.adminApproved&&c?.role!==Ft.ADMIN&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),"expense"===e.type&&ie.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),!0===e.clientApproved&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),!1===e.clientApproved&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(void 0===e.clientApproved||null===e.clientApproved)&&c?.role===Ft.CLIENT&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Ma(e.id,"client",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:te(`approve-expense-${e.id}-client-true`),children:te(`approve-expense-${e.id}-client-true`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Ma(e.id,"client",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:te(`approve-expense-${e.id}-client-false`),children:te(`approve-expense-${e.id}-client-false`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),(void 0===e.clientApproved||null===e.clientApproved)&&c?.role!==Ft.CLIENT&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),ie.jsx("span",{className:"text-gray-300",children:"|"}),ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),!0===e.adminApproved&&ie.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),!1===e.adminApproved&&ie.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(void 0===e.adminApproved||null===e.adminApproved)&&c?.role===Ft.ADMIN&&ie.jsxs("div",{className:"flex gap-0.5",children:[ie.jsx("button",{onClick:()=>Ma(e.id,"admin",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:te(`approve-expense-${e.id}-admin-true`),children:te(`approve-expense-${e.id}-admin-true`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""}),ie.jsx("button",{onClick:()=>Ma(e.id,"admin",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:te(`approve-expense-${e.id}-admin-false`),children:te(`approve-expense-${e.id}-admin-false`)?ie.jsx(tn,{size:"sm",color:"currentColor"}):""})]}),(void 0===e.adminApproved||null===e.adminApproved)&&c?.role!==Ft.ADMIN&&ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),!e.isAdditionalBudget&&!e.isClientPayment&&"expense"!==e.type&&ie.jsx("span",{className:"text-xs text-gray-300",children:"-"})]})]},e.id))})]})})}),ie.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50",children:(()=>{const t=Js.filter(e=>{const t=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"";return e.adminApproved&&e.clientApproved&&(e.vendorName===Ss.name||t(e.receivedByName)===Ss.name||t(e.paidByOther)===Ss.name||e.paidTo===Ss.name||e.receivedBy===Ss.name)}),s=t.filter(e=>{return((t=e.receivedByName)?t.includes("(")?t.split("(")[0].trim():t.trim():"")===Ss.name||e.receivedBy===Ss.name;var t}).reduce((e,t)=>e+t.amount,0),a=t.filter(e=>{return e.vendorName===Ss.name||((t=e.paidByOther)?t.includes("(")?t.split("(")[0].trim():t.trim():"")===Ss.name||e.paidTo===Ss.name;var t}).reduce((e,t)=>e+t.amount,0),r=s-a,n=r*(Es/100),i=r+n;return ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("div",{className:"flex justify-between items-center text-sm",children:[ie.jsx("span",{className:"text-gray-600",children:"Total Paid To Vendor (Received):"}),ie.jsxs("span",{className:"font-medium text-gray-900",children:["",s.toLocaleString()]})]}),ie.jsxs("div",{className:"flex justify-between items-center text-sm",children:[ie.jsx("span",{className:"text-gray-600",children:"Less: Paid By Vendor (Expenses):"}),ie.jsxs("span",{className:"font-medium text-red-600",children:["- ",a.toLocaleString()]})]}),ie.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[ie.jsx("span",{className:"font-bold text-gray-800",children:"Net Amount:"}),ie.jsxs("span",{className:"font-bold text-gray-900",children:["",r.toLocaleString()]})]}),"Designing"===e.type&&ie.jsxs(ie.Fragment,{children:[ie.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200 border-dashed",children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("span",{className:"text-sm font-bold text-gray-700",children:"Designer Charges"}),c.role===Ft.ADMIN?ie.jsxs("div",{className:"flex items-center gap-1",children:[ie.jsx("input",{type:"number",min:"0",max:"100",value:Es,onChange:e=>$s(parseFloat(e.target.value)||0),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:border-blue-500","aria-label":"Designer Charges Percentage",title:"Enter designer charges percentage",placeholder:"0"}),ie.jsx("span",{className:"text-sm text-gray-500",children:"%"})]}):ie.jsxs("span",{className:"text-sm text-gray-500",children:["(",Es,"%)"]})]}),ie.jsxs("div",{className:"text-md font-semibold text-orange-700",children:["+ ",n.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),ie.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-300",children:[ie.jsx("div",{className:"text-base font-bold text-gray-800",children:"Final Payable"}),ie.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["",i.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})]})})()})]})}),document.body),Ds&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[ie.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[ie.jsx("div",{className:"flex items-center gap-4",children:ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:Ds.name}),ie.jsx("p",{className:"text-sm text-gray-500",children:"Designer Details & Projects"})]})}),ie.jsxs("div",{className:"flex items-center gap-2",children:[aa&&ie.jsx("button",{onClick:()=>{m("Info","Designer edit functionality coming soon","info")},className:"text-emerald-600 hover:text-emerald-700 text-sm font-medium px-3 py-1.5 hover:bg-emerald-50 rounded transition-colors",title:"Edit designer details",children:"Edit"}),ie.jsx("button",{onClick:()=>As(null),className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Close designer details",children:ie.jsx(Et,{className:"w-5 h-5"})})]})]}),ie.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[ie.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 border border-gray-100",children:ie.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Name"}),ie.jsx("p",{className:"text-sm font-bold text-gray-900 mt-1",children:Ds.name})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Specialty"}),ie.jsx("p",{className:"text-sm font-bold text-gray-900 mt-1",children:Ds.specialty||"General Design"})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Email"}),ie.jsx("p",{className:"text-sm text-gray-700 mt-1",children:Ds.email})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Phone"}),ie.jsx("p",{className:"text-sm text-gray-700 mt-1",children:Ds.phone||"N/A"})]})]})}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-sm font-bold text-gray-800 mb-4",children:"Assigned Projects"}),0===e.tasks.filter(e=>e.assigneeId===Ds.id).length?ie.jsx("div",{className:"text-center py-8 text-gray-400 border-2 border-dashed border-gray-100 rounded-lg",children:"No tasks assigned to this designer in this project."}):ie.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:ie.jsxs("table",{className:"w-full text-sm",children:[ie.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-3 text-left font-bold text-gray-700 text-sm",children:"Project Name"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Work Progress"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Percentage"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Deadline"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Pending Tasks"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Completed Tasks"})]})}),ie.jsx("tbody",{children:(()=>{const t=e.tasks.filter(e=>e.assigneeId===Ds.id),s=t.filter(e=>e.status===Wt.DONE).length,a=t.filter(e=>{const t="approved"===e?.approvals?.completion?.admin?.status,s=e?.approvals?.completion?.client?.status,a=!s||"pending"===s;return!(e.status===Wt.DONE&&t&&a)&&e.status!==Wt.DONE&&e.status!==Wt.REVIEW}).length,r=t.length>0?Math.round(s/t.length*100):0;return ie.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[ie.jsx("td",{className:"px-4 py-3 text-left text-gray-900 font-medium text-xs",children:e.name}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 max-w-xs mx-auto",children:ie.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:`${r}%`}})})}),ie.jsxs("td",{className:"px-4 py-3 text-center font-semibold text-gray-900 text-xs",children:[r,"%"]}),ie.jsx("td",{className:"px-4 py-3 text-center text-gray-600 text-xs whitespace-nowrap",children:Tr(e.deadline)}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsx("span",{className:"inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800",children:a})}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsx("span",{className:"inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:s})})]})})()})]})})]})]}),ie.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50",children:(()=>{const t=e.tasks.filter(e=>e.assigneeId===Ds.id),s=t.filter(e=>e.status===Wt.DONE).length,a=t.length;return ie.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Total Project Tasks"}),ie.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:a})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Completed"}),ie.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:s})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Remaining"}),ie.jsx("p",{className:"text-2xl font-bold text-orange-600 mt-1",children:a-s})]})]})})()})]})}),document.body),Ms&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[ie.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-200 bg-gradient-to-r from-emerald-50 to-green-50 flex-shrink-0",children:[ie.jsxs("h3",{className:"text-xl md:text-lg font-bold text-gray-900 flex items-center gap-2",children:[ie.jsx(dt,{className:"w-5 h-5 md:w-4 md:h-4 text-emerald-600"})," Add Additional Budget"]}),ie.jsx("p",{className:"text-base md:text-sm text-gray-600 mt-1",children:"Increase the project budget with client approval"})]}),ie.jsxs("div",{className:"p-4 md:p-6 space-y-4 flex-1 overflow-y-auto scrollbar-thin",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-base md:text-sm font-medium text-gray-700 mb-2",children:["Budget Amount ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("div",{className:"relative",children:[ie.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-semibold text-lg md:text-base",children:""}),ie.jsx("input",{type:"number",value:Bs,onChange:e=>Rs(e.target.value),placeholder:"Enter amount",className:"w-full pl-7 pr-4 py-3 md:py-2 text-base md:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none",min:"0"})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-base md:text-sm font-medium text-gray-700 mb-2",children:"Reason/Description"}),ie.jsx("textarea",{value:Ls,onChange:e=>Fs(e.target.value),placeholder:"Why is additional budget needed? (optional)",className:"w-full px-4 py-3 md:py-2 text-base md:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none resize-none",rows:3})]}),Bs&&ie.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 md:p-3",children:ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("div",{className:"flex justify-between",children:[ie.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Current Budget:"}),ie.jsxs("span",{className:"text-base md:text-sm font-semibold text-gray-900",children:["",e.budget.toLocaleString()]})]}),ie.jsxs("div",{className:"flex justify-between",children:[ie.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Additional Amount:"}),ie.jsxs("span",{className:"text-base md:text-sm font-semibold text-emerald-600",children:["+",parseFloat(Bs||"0").toLocaleString()]})]}),ie.jsxs("div",{className:"border-t border-emerald-200 pt-2 flex justify-between",children:[ie.jsx("span",{className:"text-base md:text-sm font-medium text-gray-900",children:"New Total:"}),ie.jsxs("span",{className:"text-base md:text-sm font-bold text-emerald-700",children:["",(e.budget+parseFloat(Bs||"0")).toLocaleString()]})]})]})})]}),ie.jsxs("div",{className:"p-4 md:p-6 border-t border-gray-200 bg-gray-50 flex gap-3 justify-end",children:[ie.jsx("button",{onClick:()=>{Os(!1),Rs(""),Fs("")},className:"px-4 py-2 md:py-1.5 text-base md:text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),ie.jsxs("button",{onClick:async()=>{if(!Bs||isNaN(parseFloat(Bs)))return void m("Validation","Please enter a valid budget amount","error",e.clientId,e.id,e.name);const s=parseFloat(Bs);try{const a=t.find(t=>t.id===e.clientId),r=a?.name||"Client",n=t.find(e=>e.role===Ft.ADMIN),i=n?.name||"Admin";await Mr(e.id,{date:(new Date).toISOString().split("T")[0],timestamp:(new Date).toISOString(),description:Ls||`Additional Budget Increase: ${s.toLocaleString()}`,amount:s,type:"income",category:"Additional Budget",status:"pending",paidBy:"client",paidByOther:r,receivedBy:i,receivedByName:i,receivedByRole:"admin-received",isAdditionalBudget:!0,clientApprovalForAdditionalBudget:"pending",adminApprovalForAdditionalBudget:"pending"}),sr(e.id,`Budget Increase Requested: ${s.toLocaleString()}`,`Budget increase of ${s.toLocaleString()} requested by ${c.name}. Reason: ${Ls||"Not specified"}. Awaiting Client and Admin approval.`,"in-progress",(new Date).toISOString(),(new Date).toISOString()),ua("Budget",`Budget increase of ${s.toLocaleString()} requested by ${c.name}. Awaiting approvals. Reason: ${Ls||"Not specified"}`),m("Request",`Budget increase of ${s.toLocaleString()} requested. Awaiting Client and Admin approval.`,"success",e.clientId,e.id,e.name),Os(!1),Rs(""),Fs("")}catch(Cn){m("Error","Failed to create additional budget record","error",e.clientId,e.id,e.name)}},className:"px-4 py-2 md:py-1.5 text-base md:text-xs font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2",children:[ie.jsx(dt,{className:"w-4 h-4 md:w-3 md:h-3"})," Add Budget"]})]})]})}),document.body),ie.jsx(en,{isOpen:Kt,onClose:()=>{Yt(!1),Zt(null)},onSubmit:async t=>{try{Qt(!0);const s=await(async(e,t)=>{try{const s=C(ka,"projects",e,"meetings"),a=T(s),r=Object.fromEntries(Object.entries({...t}).filter(([e,t])=>void 0!==t));return await O(a,{...r,createdAt:new Date,updatedAt:new Date}),a.id}catch(Cn){throw Cn}})(e.id,t);if(await sr(e.id,`Meeting Created: ${t.title}`,`Meeting Type: ${t.type}. Attendees: ${t.attendees.length}. Date: ${t.date}`,"planned",t.date,t.date).catch(e=>{}),t.attendees&&t.attendees.length>0){const a=ca.filter(e=>t.attendees.includes(e.id)),r={...t,id:s};await Ur(r,a,e.name,e.id,"created")}m("Success","Meeting added successfully","success")}catch(Cn){throw m("Error","Failed to add meeting","error"),Cn}finally{Qt(!1)}},onUpdate:async t=>{try{if(Qt(!0),await(async(e,t,s)=>{try{const a=Object.fromEntries(Object.entries({...s}).filter(([e,t])=>void 0!==t));await P(T(ka,"projects",e,"meetings",t),{...a,updatedAt:new Date})}catch(Cn){throw Cn}})(e.id,t.id,t),t.attendees&&t.attendees.length>0){const s=ca.filter(e=>t.attendees.includes(e.id));await Ur(t,s,e.name,e.id,"updated")}m("Success","Meeting updated successfully","success")}catch(Cn){throw m("Error","Failed to update meeting","error"),Cn}finally{Qt(!1)}},teamMembers:ca,isLoading:Xt,editingMeeting:Jt}),Ze&&k&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-4",children:ie.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-5xl h-[80vh] flex flex-col overflow-hidden",children:[ie.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx(Fe,{className:"w-5 h-5 text-blue-600"}),ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Task Documents"}),k.documents&&dr(k.documents)>0&&ie.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:dr(k.documents)})]}),ie.jsx("button",{type:"button",onClick:()=>Qe(!1),className:"text-gray-500 hover:text-gray-700 p-1 hover:bg-gray-100 rounded transition-colors",title:"Close modal","aria-label":"Close documents modal",children:ie.jsx(Et,{className:"w-5 h-5"})})]}),ie.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:dr(k.documents)>0?ie.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:(mr=k.documents,mr&&0!==mr.length?Us.filter(e=>mr.includes(e.id)):[]).filter(e=>"pending"===e.approvalStatus?c.role===Ft.ADMIN||c.role===Ft.DESIGNER||e.uploadedBy===c.id:"approved"===e.approvalStatus?Array.isArray(e.sharedWith)&&e.sharedWith.includes(c.id)||c.role===Ft.ADMIN||e.uploadedBy===c.id:"rejected"===e.approvalStatus?c.role===Ft.ADMIN||c.role===Ft.DESIGNER||e.uploadedBy===c.id:c.role===Ft.ADMIN).map(e=>ie.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow",children:[ie.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-10",children:[ie.jsxs("div",{className:"flex items-center justify-center gap-2",children:[ie.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Comments",onClick:()=>Ca(e),children:ie.jsx(at,{className:"w-4 h-4"})}),ie.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"View",onClick:()=>window.open(e.url,"_blank"),children:ie.jsx(Re,{className:"w-4 h-4"})}),ie.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Download",onClick:()=>Ia(e),children:ie.jsx(Oe,{className:"w-4 h-4"})}),(e.uploadedBy===c.id||aa)&&ie.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Delete",onClick:()=>Sa(e),children:ie.jsx(kt,{className:"w-4 h-4"})})]}),c.role===Ft.ADMIN&&"pending"===e.approvalStatus&&ie.jsxs("div",{className:"flex items-center justify-center gap-2",children:[ie.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve",onClick:()=>Da(e),disabled:te(`approve-doc-${e.id}`),children:te(`approve-doc-${e.id}`)?ie.jsx(tn,{size:"md",color:"currentColor"}):ie.jsx(we,{className:"w-4 h-4"})}),ie.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject",onClick:()=>Aa(e),disabled:te(`reject-doc-${e.id}`),children:te(`reject-doc-${e.id}`)?ie.jsx(tn,{size:"md",color:"currentColor"}):ie.jsx(Et,{className:"w-4 h-4"})})]})]}),ie.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center overflow-hidden relative group",children:"image"===e.type?ie.jsx("img",{src:e.url||sn,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiI+PC9yZWN0PjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ij48L2NpcmNsZT48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNiAxMCA1IDIxIj48L3BvbHlsaW5lPjwvc3ZnPg==",e.currentTarget.className="w-12 h-12 opacity-50",e.currentTarget.parentElement?.classList.add("flex","items-center","justify-center")}}):"pdf"===e.type?ie.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-50 to-red-100",children:[ie.jsx(Le,{className:"w-12 h-12 text-red-400 mb-2"}),ie.jsx("span",{className:"text-xs font-bold text-red-600 uppercase",children:"PDF"})]}):ie.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100",children:[ie.jsx(Le,{className:"w-12 h-12 text-blue-400 mb-2"}),ie.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase",children:e.type})]})}),ie.jsxs("div",{className:"p-3",children:[ie.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",title:e.name,children:e.name}),ie.jsxs("div",{className:"flex justify-between items-center mt-2",children:[ie.jsx("span",{className:"text-xs text-gray-400",children:Tr(e.uploadDate)}),ie.jsx("span",{className:"text-xs font-bold px-2 py-0.5 rounded "+("pending"===e.approvalStatus?"bg-yellow-100 text-yellow-700":"approved"===e.approvalStatus?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:"pending"===e.approvalStatus?"Approval Pending":"approved"===e.approvalStatus?"Approved":"Rejected"})]}),ie.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:(Array.isArray(e.sharedWith)?e.sharedWith:[]).map(e=>{const s=t.find(t=>t.id===e);return ie.jsx("span",{className:"text-[8px] bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded",title:s?.name,children:s?.name?.split(" ")[0]||"Unknown"},e)})}),e.comments&&e.comments.length>0&&ie.jsxs("div",{className:"mt-2 text-xs text-blue-600 font-medium",children:[e.comments.length," ",1===e.comments.length?"comment":"comments"]})]})]},e.id))}):ie.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[ie.jsx(Fe,{className:"w-16 h-16 text-gray-300 mb-3"}),ie.jsx("p",{className:"text-gray-400 font-medium",children:"No documents attached to this task"}),ie.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Upload documents and attach them to this task"})]})}),aa&&!cr&&ie.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-end",children:ie.jsxs("button",{onClick:()=>{Qe(!1),ne(!0),oe({...le,attachToTaskId:k.id})},className:"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors font-semibold text-sm",title:"Add documents to task",children:[ie.jsx(dt,{className:"w-4 h-4"})," Add Documents"]})})]})}),document.body),cs&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[ie.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:ie.jsx(Se,{className:"w-6 h-6 text-red-600"})}),ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Project?"}),ie.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),ie.jsxs("div",{className:"p-6",children:[ie.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the project ",ie.jsxs("span",{className:"font-bold text-gray-900",children:['"',e.name,'"']}),"?"]}),ie.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:ie.jsxs("p",{className:"text-xs text-red-700",children:[ie.jsx("span",{className:"font-bold",children:" Warning:"})," This project and all associated data (tasks, documents, meetings, financials) will be permanently deleted."]})})]}),ie.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[ie.jsx("button",{onClick:()=>ms(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),ie.jsxs("button",{onClick:async()=>{ms(!1);try{await x(e.id),m("Success","Project deleted successfully","success"),i()}catch(Cn){m("Error","Failed to delete project","error")}},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm project deletion",children:[ie.jsx(kt,{className:"w-4 h-4"})," Delete Project"]})]})]})}),document.body),ps&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[ie.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:ie.jsx(Se,{className:"w-6 h-6 text-red-600"})}),ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Transaction?"}),ie.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),ie.jsxs("div",{className:"p-6",children:[ie.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"Are you sure you want to delete this transaction?"}),ie.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:ie.jsxs("p",{className:"text-xs text-red-700",children:[ie.jsx("span",{className:"font-bold",children:" Warning:"})," This financial record will be permanently removed from the project ledger."]})})]}),ie.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[ie.jsx("button",{onClick:()=>{xs(!1),us(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),ie.jsxs("button",{onClick:async()=>{if(gs)try{await u(gs),m("Transaction Deleted","The transaction was deleted successfully.","success"),xs(!1),us(null)}catch(e){m("Error","Failed to delete transaction.","error")}},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm transaction deletion",children:[ie.jsx(kt,{className:"w-4 h-4"})," Delete Transaction"]})]})]})}),document.body)]});var mr},rn=async(e,t,s)=>{const a=_().find(e=>"SecondaryApp"===e.name)||w(ja,"SecondaryApp"),r=_().find(e=>"SecondaryApp"===e.name)?k(a):G(a,{persistence:H}),n=I(a);try{let t="";t="phone"===e.authMethod?`phone_${(e.phone||"").replace(/\D/g,"")}`:(await q(r,e.email,e.password)).user.uid;const s=(e.phone||"").replace(/\D/g,"");let a=e.tenantId,o=e.tenantIds||[];if(e.role===Ft.ADMIN&&!a)try{a=(await K(C(n,"tenants"),{name:e.company||`${e.name}'s Organization`,ownerId:t,createdAt:(new Date).toISOString(),status:"active"})).id}catch(i){a=t}e.role!==Ft.VENDOR&&e.role!==Ft.DESIGNER||0!==o.length||(o=a?[a]:[t]);const d={id:t,name:e.name,email:e.email,role:e.role,phone:s||"",password:e.password,authMethod:e.authMethod||"email",tenantId:a||t};(e.role===Ft.VENDOR||e.role===Ft.DESIGNER)&&o.length>0&&(d.tenantIds=o),e.company&&(d.company=e.company),e.specialty&&(d.specialty=e.specialty),e.password&&(d.password=e.password),await O(T(n,"users",t),d);const c=e.role.toLowerCase()+"s";if(await O(T(n,c,t),d),"phone"===e.authMethod)try{const t=`\n          <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">\n            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">\n              <h2 style="color: #fff; margin: 0; font-size: 24px;"> Welcome to Kydo Solutions!</h2>\n            </div>\n            \n            <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">\n              <p style="color: #333; font-size: 16px;">Hi <strong>${e.name}</strong>,</p>\n              \n              <p style="color: #555; font-size: 14px;">Your account has been created on Kydo Solutions. You can now log in using your phone number with OTP (One-Time Password).</p>\n              \n              <div style="background-color: #f3f4f6; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #ef4444;">\n                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your Phone Number:</strong></p>\n                <p style="margin: 5px 0 15px 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${e.phone}</p>\n                \n                <p style="margin: 0; color: #333; font-size: 14px;"><strong>How to Login:</strong></p>\n                <ol style="margin: 5px 0 0 0; color: #1f2937; font-size: 14px;">\n                  <li>Go to the Kydo Solutions login page</li>\n                  <li>Click the "Phone" tab</li>\n                  <li>Enter your phone number: ${e.phone}</li>\n                  <li>Click "Send OTP"</li>\n                  <li>You'll receive an SMS with a 6-digit OTP</li>\n                  <li>Enter the OTP and click "Verify OTP"</li>\n                </ol>\n              </div>\n              \n              <p style="color: #555; font-size: 14px;">\n                <strong>Important:</strong> Keep your phone number safe. You'll need it to log in.\n              </p>\n\n              \n              <div style="margin-top: 30px; text-align: center;">\n                <a href="https://btw-erp.web.app" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 30px; border-radius: 6px; text-decoration: none; display: inline-block; font-weight: 600;">\n                  Go to Kydo Solutions\n                </a>\n              </div>\n              \n              <p style="color: #9ca3af; font-size: 12px; margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 20px;">\n                If you have any questions, please contact the administrator.\n              </p>\n            </div>\n          </div>\n        `;await Lr({to:e.email,recipientName:e.name,subject:"Welcome to Kydo Solutions - Phone-Based Login Instructions",htmlContent:t})}catch(l){}else try{const t=`\n          <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">\n            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">\n              <h2 style="color: #fff; margin: 0; font-size: 24px;"> Welcome to Kydo Solutions!</h2>\n            </div>\n            \n            <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">\n              <p style="color: #333; font-size: 16px;">Hi <strong>${e.name}</strong>,</p>\n              \n              <p style="color: #555; font-size: 14px;">Your account has been created on Kydo Solutions. Here are your login credentials:</p>\n              \n              <div style="background-color: #f3f4f6; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #ef4444;">\n                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your ID (Email):</strong></p>\n                <p style="margin: 5px 0 15px 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${e.email}</p>\n                \n                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your Password:</strong></p>\n                <p style="margin: 5px 0 0 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${e.password}</p>\n              </div>\n              \n              <p style="color: #555; font-size: 14px;">\n                <strong>Keep these credentials safe!</strong> You can change your password after logging in for the first time.\n              </p>\n              \n              <div style="margin-top: 30px; text-align: center;">\n                <a href="https://btw-erp.web.app" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 30px; border-radius: 6px; text-decoration: none; display: inline-block; font-weight: 600;">\n                  Go to Kydo Solutions\n                </a>\n              </div>\n              \n              <p style="color: #9ca3af; font-size: 12px; margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 20px;">\n                If you have any questions, please contact the administrator.\n              </p>\n            </div>\n          </div>\n        `;await Lr({to:e.email,recipientName:e.name,subject:"Welcome to Kydo Solutions - Your Account Credentials",htmlContent:t})}catch(l){}return t}catch(Cn){throw"auth/email-already-in-use"===Cn.code?new Error("This email is already registered."):"auth/weak-password"===Cn.code?new Error("Password is too weak. Use at least 6 characters."):"auth/invalid-email"===Cn.code?new Error("Invalid email address."):new Error(Cn.message||"Failed to create user")}finally{try{await Y(a)}catch(o){}}},nn=({users:e,roleFilter:t,onAddUser:s,projects:i=[],onSelectProject:l,onSelectTask:o})=>{const{user:d,adminCredentials:c}=Ka(),{addNotification:m}=Xa(),{showLoading:p,hideLoading:x}=tr(),[g,u]=a.useState(!1),[h,b]=a.useState(null),[y,f]=a.useState(!1),[v,j]=a.useState(null),[N,w]=a.useState(!1),[k,I]=a.useState(!1),[S,P]=a.useState(null),[M,B]=a.useState(null),[R,L]=a.useState(!1),[F,z]=a.useState("email"),[V,U]=a.useState({role:"All"===t?Ft.CLIENT:t}),[W,_]=a.useState(null),[G,H]=a.useState(!1),[q,K]=a.useState(!1),[Y,J]=a.useState(null),[Z,X]=a.useState("email"),[Q,ee]=a.useState([]),[te,se]=a.useState([]),[ae,re]=a.useState({}),[ne,le]=a.useState(null),[oe,de]=a.useState({}),ce=i,[me,pe]=a.useState(null),[xe,ge]=a.useState(!1),[ue,he]=a.useState({});a.useEffect(()=>{if(0===i.length)return void he({});const e=[];return i.forEach(t=>{try{const s=C(ka,"projects",t.id,"finances"),a=E(s,e=>{const s=e.docs.map(e=>({...e.data(),id:e.id}));he(e=>({...e,[t.id]:s}))},e=>{});e.push(a)}catch(Cn){}}),()=>{e.forEach(e=>e())}},[i]),a.useEffect(()=>{},[i]),a.useEffect(()=>{},[ue]),a.useEffect(()=>{if(!d||d.role!==Ft.ADMIN)return void se([]);const e=(e=>{const t=D(C(ka,"tenants"),A("ownerId","==",e));return E(t,e=>{(e=>{se(e)})(e.docs.map(e=>({id:e.id,...e.data()})))})})(d.id);return()=>e()},[d]),a.useEffect(()=>{h&&(ge(!0),$(T(ka,"vendors",h.id)).then(e=>{e.exists()?pe(e.data()):pe(null)}).finally(()=>ge(!1)))},[h]);const be=r.useMemo(()=>{let s="All"===t?e.filter(e=>e.role!==Ft.ADMIN):e.filter(e=>e.role===t);if(d?.role===Ft.VENDOR&&t===Ft.ADMIN){const e=d.tenantIds||[];s=s.filter(t=>0===e.length||e.includes(t.tenantId))}return d?.role===Ft.DESIGNER&&t===Ft.CLIENT&&(s=((e,t,s)=>{const a=new Set(s.filter(e=>e.leadDesignerId===t||(e.teamMembers||[]).includes(t)).flatMap(e=>{const t=[];return e.clientId&&t.push(e.clientId),e.clientIds&&t.push(...e.clientIds),t}));return e.filter(e=>a.has(e.id))})(s,d.id,i)),s},[e,t,d,i]),ye=r.useMemo(()=>{if(t!==Ft.VENDOR)return null;const e={};return be.forEach(t=>{const s=t.specialty||"General";e[s]||(e[s]=[]),e[s].push(t)}),e},[be,t]),fe=r.useMemo(()=>ye?Object.keys(ye).sort((e,t)=>{const s=Yr.indexOf(e),a=Yr.indexOf(t);return(-1===s?999:s)-(-1===a?999:a)}):[],[ye]),Ne=e=>{_(e);const t=e.email&&e.email.endsWith("@kydo-phone-auth.local");U({name:e.name,email:t?"":e.email,role:e.role,phone:e.phone,company:e.company,specialty:e.specialty}),X(t?"phone":"email"),u(!0)},we=e=>`\n    w-full px-3 py-2 border rounded-lg focus:outline-none transition-all\n    bg-white text-gray-900 placeholder-gray-400\n    ${G&&!e?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}\n  `,ke=({user:e,hideRole:t=!1,hideSpecialty:s=!1,isVendor:a=!1})=>{return ie.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow h-full flex flex-col",children:[ie.jsxs("div",{className:"p-6 flex-1",children:[ie.jsxs("div",{className:"flex items-start justify-between gap-3",children:[ie.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[ie.jsx(Cr,{avatar:e.avatar,name:e.name,size:"md",role:String(e.role).toLowerCase()}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-base md:text-sm font-bold text-gray-900",children:e.name}),e.company&&ie.jsxs("p",{className:"text-xs md:text-xs font-medium text-gray-500 flex items-center gap-1",children:[ie.jsx(je,{className:"w-3 h-3"})," ",e.company]})]})]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[a&&ie.jsx("button",{onClick:()=>{P(e),I(!0)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Accounts",children:ie.jsx(Pe,{className:"w-5 h-5"})}),!t&&ie.jsx("span",{className:"px-2 py-1 rounded text-xs md:text-xs font-bold uppercase tracking-wide\n                  "+(e.role===Ft.CLIENT?"bg-blue-100 text-blue-700":e.role===Ft.VENDOR?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700"),children:e.role})]})]}),ie.jsx("div",{className:"mt-2",children:!s&&e.specialty&&ie.jsx("p",{className:"text-xs md:text-xs text-gray-400 mt-1",children:e.specialty})}),ie.jsxs("div",{className:"mt-4 space-y-2 border-t border-gray-100 pt-4",children:[e.email&&!e.email.endsWith("@kydo-phone-auth.local")&&ie.jsxs("a",{href:`mailto:${e.email}`,className:"flex items-center gap-2 text-base md:text-sm text-gray-600 hover:text-blue-600 group transition-colors",children:[ie.jsx(et,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"}),ie.jsx("span",{className:"truncate",children:e.email})]}),e.phone&&ie.jsxs("a",{href:`tel:${e.phone}`,className:"flex items-center gap-2 text-base md:text-sm text-gray-600 hover:text-blue-600 group transition-colors",children:[ie.jsx(ot,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"}),ie.jsx("span",{className:"text-base md:text-sm",children:(r=e.phone,r.startsWith("+91")?"+91 "+r.slice(3):r)})]})]})]}),ie.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-100 flex justify-between items-center mt-auto",children:[a?ie.jsxs("button",{onClick:()=>(b(e),void f(!0)),className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:["View Details ",ie.jsx(Ie,{className:"w-3 h-3"})]}):e.role===Ft.DESIGNER?ie.jsxs("button",{onClick:()=>{j(e),w(!0)},className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:["View Details ",ie.jsx(Ie,{className:"w-3 h-3"})]}):d?.role===Ft.DESIGNER&&e.role===Ft.CLIENT?ie.jsx("button",{className:"text-base md:text-sm font-medium text-gray-400 cursor-not-allowed",title:"Designers cannot edit client profiles",children:"View Profile"}):ie.jsx("button",{onClick:()=>Ne(e),className:"text-base md:text-sm font-medium text-gray-500 hover:text-gray-900",children:"View Profile"}),d?.role===Ft.DESIGNER?ie.jsx("button",{className:"text-base md:text-sm font-medium text-gray-400 cursor-not-allowed",title:"Designers cannot assign users to projects",disabled:!0,children:"Assign to Project"}):ie.jsx("button",{onClick:()=>(e=>{J(e),K(!0)})(e),className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800",children:"Assign to Project"})]})]});var r};return ie.jsxs("div",{className:"animate-fade-in pb-12",children:[ie.jsxs("div",{className:"flex justify-between items-center mb-6",children:[ie.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All"===t?"Directory":`${t}s`}),ie.jsx("div",{className:"flex items-center gap-3",children:!(d?.role===Ft.DESIGNER&&t===Ft.CLIENT)&&ie.jsxs("button",{onClick:()=>{_(null),U({role:"All"===t?Ft.CLIENT:t,phone:"+91 "}),ee([]),u(!0)},className:"bg-gray-900 text-white px-4 py-2.5 md:px-4 md:py-2 rounded-lg text-base md:text-sm font-medium hover:bg-gray-800 transition-colors flex items-center gap-2",children:[ie.jsx(dt,{className:"w-4 h-4 md:w-4 md:h-4"}),"Add ","All"===t?"Person":t]})})]}),ye?ie.jsx("div",{className:"space-y-8",children:fe.length>0?fe.map(e=>ie.jsxs("div",{children:[ie.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wide mb-4 flex items-center gap-2 border-b border-gray-200 pb-2",children:[ie.jsx(jt,{className:"w-4 h-4"})," ",e]}),ie.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ye[e].map(e=>ie.jsx("div",{children:ie.jsx(ke,{user:e,hideRole:!0,hideSpecialty:!0,isVendor:!0})},e.id))})]},e)):ie.jsx("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:ie.jsxs("div",{className:"text-center",children:[ie.jsx(ve,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),ie.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No vendors yet"}),ie.jsx("p",{className:"text-gray-500",children:'No vendors have been added yet. Click "Add Vendor" to create one.'})]})})}):ie.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:be.length>0?be.map(e=>ie.jsx("div",{children:ie.jsx(ke,{user:e,isVendor:t===Ft.VENDOR,hideRole:t===Ft.CLIENT||t===Ft.DESIGNER})},e.id)):ie.jsx("div",{className:"col-span-full flex flex-col items-center justify-center py-20 px-4",children:ie.jsxs("div",{className:"text-center",children:[ie.jsx(ve,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),ie.jsxs("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:["No ","All"===t?"team members":t.toLowerCase()+"s"," yet"]}),ie.jsx("p",{className:"text-gray-500",children:"All"===t?"Team members will appear here once they are added.":`${t}s will appear here once they are added.`})]})})}),g&&ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[75vh] overflow-hidden animate-fade-in flex flex-col",children:[ie.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-100 bg-gray-50 flex-shrink-0",children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:W?"Edit Profile":`Add New ${"All"===t?"Person":t}`}),ie.jsx("button",{onClick:()=>{u(!1),_(null),ee([])},className:"text-gray-400 hover:text-gray-600",title:"Close add person dialog",children:ie.jsx(Et,{className:"w-5 h-5"})})]}),ie.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{if(!V.name||!V.role||!V.phone)return H(!0),m("Missing Information","Please fill in all compulsory fields marked with *","error"),!1;if(W){if(!V.email)return H(!0),m("Missing Information","Please fill in all compulsory fields marked with *","error"),!1}else{if("email"===Z&&!V.email)return H(!0),m("Missing Email","Email is required for email-based authentication","error"),!1;if("phone"===Z&&!V.phone)return H(!0),m("Missing Phone","Phone number is required for phone-based authentication","error"),!1}return!((V.phone||"").replace(/\D/g,"").length<4&&(H(!0),m("Invalid Phone","Phone number must have at least 4 digits","error"),1))})())try{if(p(`Creating ${V.role}...`),W){const e={...W,...V};return await(async e=>{try{const t=T(ka,"users",e.id),s=e.role.toLowerCase()+"s",a=T(ka,s,e.id),r={name:e.name,email:e.email,role:e.role,phone:e.phone||""};e.company&&(r.company=e.company),e.specialty&&(r.specialty=e.specialty),e.tenantId&&(r.tenantId=e.tenantId),e.tenantIds&&(r.tenantIds=e.tenantIds),await O(t,r,{merge:!0}),await O(a,r,{merge:!0})}catch(Cn){throw new Error(Cn.message||"Failed to update user")}})(e),m("Success","User profile updated successfully","success"),u(!1),_(null),U({role:"All"===t?Ft.CLIENT:t}),void H(!1)}let e=V.email;"phone"===Z&&(e="");const s=(V.phone||"").replace(/\D/g,"").slice(-6),a=await rn({id:"",name:V.name,email:e||"",role:V.role,company:V.company||void 0,specialty:V.specialty||void 0,phone:V.phone||void 0,password:s,authMethod:Z,tenantId:d?.tenantId,tenantIds:(V.role===Ft.VENDOR||V.role===Ft.DESIGNER)&&Q.length>0?Q:void 0});if(V.name,"phone"===Z||V.email,V.role,V.company,V.specialty,V.phone,(V.role===Ft.VENDOR||V.role===Ft.DESIGNER)&&Q.length,m("Success",`${V.role} ${V.name} created successfully!`,"success"),"phone"===Z){const e={id:a,name:V.name,email:"",role:V.role,company:V.company||void 0,specialty:V.specialty||void 0,phone:V.phone||void 0,password:s,authMethod:"phone"};le(e)}u(!1),_(null),U({role:"All"===t?Ft.CLIENT:t}),H(!1),ee([])}catch(Cn){m("Error",Cn.message||"Failed to create user. Please try again.","error")}finally{x()}},className:"overflow-y-auto flex-1",children:[ie.jsxs("div",{className:"p-5 space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Full Name ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"text",className:we(V.name),placeholder:"e.g. John Doe",value:V.name||"",onChange:e=>U({...V,name:e.target.value})})]}),ie.jsx("div",{className:"grid grid-cols-2 gap-3",children:ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Role ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("select",{title:"Select user role",className:"w-full px-3 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 text-sm "+(G&&!V.role?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"),value:V.role||"",onChange:e=>{const t=e.target.value;U({...V,role:t})},children:[ie.jsx("option",{value:"",children:"Select Role"}),d?.role!==Ft.DESIGNER&&ie.jsx("option",{value:Ft.CLIENT,children:"Client"}),ie.jsx("option",{value:Ft.DESIGNER,children:"Designer"}),ie.jsx("option",{value:Ft.VENDOR,children:"Vendor"}),d?.role===Ft.ADMIN&&ie.jsx("option",{value:Ft.ADMIN,children:"Admin"})]})]})}),!W&&ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Authentication Method ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("div",{className:"flex gap-3",children:[ie.jsx("button",{type:"button",onClick:()=>X("email"),className:"flex-1 py-2 px-3 rounded-lg border-2 transition-colors font-medium text-sm "+("email"===Z?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),title:"User will log in with email and password",children:"Email"}),ie.jsx("button",{type:"button",onClick:()=>{X("phone"),U(e=>({...e,email:""}))},className:"flex-1 py-2 px-3 rounded-lg border-2 transition-colors font-medium text-sm "+("phone"===Z?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),title:"User will log in with phone number and OTP",children:"Phone"})]})]}),"email"===Z&&ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Email Id ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"email",className:we(V.email),placeholder:"john@example.com",value:V.email||"",onChange:e=>U({...V,email:e.target.value})})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["phone"===Z?"Phone Number (Login ID)":"Phone Number"," ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"tel",className:we(V.phone),placeholder:"+91 98765 43210",value:V.phone||"",onChange:e=>U({...V,phone:e.target.value})}),"email"===Z&&ie.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 6 digits will automatically become their initial password."})]}),V.role===Ft.VENDOR&&ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:"Company Name"}),ie.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent bg-white text-gray-900 text-sm",placeholder:"e.g. ABC Construction",value:V.company||"",onChange:e=>U({...V,company:e.target.value})})]}),V.role===Ft.VENDOR&&ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:"Specialty"}),ie.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent bg-white text-gray-900 text-sm",placeholder:"e.g. Flooring",value:V.specialty||"",onChange:e=>U({...V,specialty:e.target.value})})]}),(V.role===Ft.VENDOR||V.role===Ft.DESIGNER)&&te.length>0&&ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Assign to Firms (Multi-Tenant)"}),ie.jsx("div",{className:"space-y-2",children:te.map(e=>ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[ie.jsx("input",{type:"checkbox",checked:Q.includes(e.id),onChange:t=>{t.target.checked?ee([...Q,e.id]):ee(Q.filter(t=>t!==e.id))},className:"w-4 h-4 text-gray-900 rounded border-gray-300 focus:ring-gray-900"}),ie.jsx("span",{className:"text-sm text-gray-700",children:e.name||e.companyName||`Firm ${e.id.substring(0,5)}`})]},e.id))}),ie.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Select one or more firms this ",V.role?.toLowerCase()," can work with"]})]})]}),ie.jsx("div",{className:"p-5 border-t border-gray-100 bg-gray-50 flex-shrink-0 sticky bottom-0",children:ie.jsx("button",{type:"submit",className:"w-full bg-gray-900 text-white font-bold py-2.5 rounded-lg hover:bg-gray-800 transition-colors text-sm",children:W?"Save Changes":"Create Account"})})]})]})}),y&&h&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[ie.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[ie.jsxs("div",{className:"flex items-center gap-4",children:[ie.jsx(Cr,{avatar:h.avatar,name:h.name,size:"md",role:String(h.role).toLowerCase()}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-xl sm:text-lg font-bold text-gray-900",children:h.name}),ie.jsxs("p",{className:"text-sm sm:text-xs text-gray-500",children:[h.specialty,"  ",h.company]})]})]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("button",{onClick:()=>{f(!1),Ne(h)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Vendor Profile",children:ie.jsx(vt,{className:"w-6 h-6 sm:w-5 sm:h-5"})}),ie.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600",title:"Close vendor detail panel",children:ie.jsx(Et,{className:"w-6 h-6 sm:w-5 sm:h-5"})})]})]}),ie.jsx("div",{className:"p-6 space-y-6",children:(()=>{const e=ce.filter(e=>e.tasks?.some(e=>e.assigneeId===h?.id)).map(e=>{const t=e.tasks?.filter(e=>e.assigneeId===h?.id)||[],s=t.reduce((e,t)=>e+Dr(t),0),a=t.length>0?Math.round(s/t.length):0,r=t.filter(e=>e.status===Wt.DONE).length;return{project:e,tasks:t,totalTasks:t.length,completedTasks:r,progressPercentage:a}});return ie.jsxs("div",{children:[ie.jsx("h4",{className:"text-base sm:text-sm font-bold text-gray-800 mb-4",children:"Project-wise Tasks & Progress"}),0===e.length?ie.jsx("p",{className:"text-base sm:text-sm text-gray-500 text-center py-6",children:"No tasks assigned"}):ie.jsx("div",{className:"space-y-6",children:e.map(({project:e,tasks:t,totalTasks:s,completedTasks:a,progressPercentage:r})=>{const n=!1!==ae[e.id],i=t.length>0?t.reduce((e,t)=>t.dueDate?e?new Date(t.dueDate)>new Date(e)?t.dueDate:e:t.dueDate:e,null):null,d=i?Tr(i):"N/A";return ie.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[ie.jsxs("button",{onClick:()=>{re(t=>({...t,[e.id]:!t[e.id]}))},className:"w-full bg-gray-50 p-4 border-b border-gray-200 hover:bg-gray-100 transition-colors flex justify-between items-start",children:[ie.jsxs("div",{className:"flex justify-between items-start flex-1 gap-4",children:[ie.jsxs("div",{className:"flex-1",children:[ie.jsx("h5",{className:"font-semibold text-gray-900 text-base sm:text-sm text-left cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l?.(e),children:e.name}),ie.jsxs("p",{className:"text-sm sm:text-xs text-gray-500 mt-1 text-left",children:["DueDate: ",d]})]}),ie.jsxs("span",{className:"text-sm sm:text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-md font-medium whitespace-nowrap",children:[a,"/",s," Completed"]})]}),ie.jsx(Ie,{className:"w-5 h-5 text-gray-600 ml-4 transition-transform flex-shrink-0 "+(n?"rotate-90":"")})]}),ie.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[ie.jsxs("div",{className:"flex justify-between items-center mb-2",children:[ie.jsx("span",{className:"text-sm sm:text-xs font-medium text-gray-600",children:"Work Completed"}),ie.jsxs("span",{className:"text-base sm:text-sm font-bold text-gray-900",children:[r,"%"]})]}),ie.jsx("div",{className:"w-full bg-gray-300 rounded-full h-2",children:ie.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${r}%`}})})]}),n&&ie.jsx("div",{className:"overflow-x-auto",children:ie.jsxs("table",{className:"w-full",children:[ie.jsxs("colgroup",{children:[ie.jsx("col",{style:{width:"30%"}}),ie.jsx("col",{style:{width:"20%"}}),ie.jsx("col",{style:{width:"30%"}}),ie.jsx("col",{style:{width:"20%"}})]}),ie.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"text-left px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Task Title"}),ie.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Status"}),ie.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Progress"}),ie.jsx("th",{className:"text-left px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Deadline"})]})}),ie.jsx("tbody",{className:"divide-y divide-gray-200",children:t.map(t=>{const s=Dr(t),a=t.dueDate?Tr(t.dueDate):"No deadline",r=t.dependencies&&t.dependencies.length>0&&t.dependencies.some(t=>{const s=e.tasks?.find(e=>e.id===t);return s&&s.status!==Wt.DONE}),n=t.status===Wt.DONE?"bg-green-100 text-green-800":t.status===Wt.IN_PROGRESS?"bg-blue-100 text-blue-800":t.status===Wt.REVIEW?"bg-purple-100 text-purple-800":t.status===Wt.TODO?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return ie.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[ie.jsx("td",{className:"px-2 sm:px-4 py-3 text-base sm:text-sm text-gray-700",children:ie.jsxs("div",{className:"flex items-center gap-2 min-w-0 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>o?.(t,e),children:[ie.jsx("span",{className:"truncate",children:t.title}),r&&ie.jsx(Xe,{className:"w-3 h-3 text-red-400 flex-shrink-0","aria-label":"Task blocked - waiting for dependencies"})]})}),ie.jsx("td",{className:"px-2 sm:px-4 py-3 text-center",children:ie.jsx("span",{className:`px-2 py-1 rounded-md text-sm sm:text-xs font-medium whitespace-nowrap ${n}`,children:t.status===Wt.DONE?"Completed":t.status})}),ie.jsx("td",{className:"px-2 sm:px-4 py-3 text-center",children:ie.jsxs("div",{className:"flex items-center gap-0.5 justify-center",children:[ie.jsx("div",{className:"bg-gray-200 rounded-full h-2",style:{width:"50px"},children:ie.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(100===s?"bg-green-500":"bg-blue-500"),style:{width:`${s}%`}})}),ie.jsxs("span",{className:"text-sm sm:text-xs font-medium text-gray-700 min-w-[30px]",children:[s,"%"]})]})}),ie.jsx("td",{className:"px-2 sm:px-4 py-3 text-base sm:text-sm text-gray-700 whitespace-nowrap",children:a})]},t.id)})})]})})]},e.id)})})]})})()})]})}),document.body),q&&Y&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md animate-fade-in max-h-[80vh] flex flex-col",children:[ie.jsxs("div",{className:"p-5 border-b border-gray-100 bg-gray-50 flex justify-between items-center flex-shrink-0",children:[ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Assign to Project"}),ie.jsxs("p",{className:"text-xs text-gray-500",children:["Add ",Y.name," to a project team"]})]}),ie.jsx("button",{type:"button",onClick:()=>K(!1),className:"text-gray-400 hover:text-gray-600","aria-label":"Close assign modal",title:"Close",children:ie.jsx(Et,{className:"w-5 h-5"})})]}),ie.jsx("div",{className:"p-2 overflow-y-auto flex-1",children:0===i.length?ie.jsx("div",{className:"text-center py-8 text-gray-500",children:"No projects available"}):ie.jsx("div",{className:"space-y-1",children:ce.map(e=>{const t=e.clientId===Y.id||e.leadDesignerId===Y.id||(e.clientIds||[]).includes(Y.id)||(e.teamMembers||[]).includes(Y.id);return ie.jsxs("button",{onClick:()=>!t&&(async e=>{if(Y)try{const t={...e};let s=!1;if(Y.role===Ft.CLIENT){const a=e.clientIds||[];if(a.includes(Y.id)||e.clientId===Y.id)return void m("Info","User is already a client on this project","info");t.clientIds=[...a,Y.id],s=!0}else{const a=e.teamMembers||[];if(a.includes(Y.id)||e.leadDesignerId===Y.id)return void m("Info","User is already in the team","info");t.teamMembers=[...a,Y.id],s=!0}if(s){const s={};Y.role===Ft.CLIENT?s.clientIds=t.clientIds:s.teamMembers=t.teamMembers,await $a(e.id,s),m("Success",`Added ${Y.name} to ${e.name}`,"success"),K(!1),J(null)}}catch(Cn){m("Error","Failed to assign user","error")}})(e),disabled:t,className:"w-full text-left p-3 rounded-lg flex items-center justify-between transition-colors "+(t?"bg-gray-50 opacity-60 cursor-not-allowed":"hover:bg-blue-50 hover:border-blue-100 border border-transparent"),children:[ie.jsxs("div",{children:[ie.jsx("p",{className:"font-bold text-gray-800 text-sm cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l?.(e),children:e.name}),ie.jsx("p",{className:"text-xs text-gray-500",children:e.status})]}),t?ie.jsxs("span",{className:"text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded-full flex items-center gap-1",children:[ie.jsx(Ce,{className:"w-3 h-3"})," Added"]}):ie.jsx(dt,{className:"w-4 h-4 text-gray-400"})]},e.id)})})})]})}),document.body),N&&v&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[ie.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[ie.jsxs("div",{className:"flex items-center gap-4",children:[ie.jsx(Cr,{avatar:v.avatar,name:v.name,size:"md",role:String(v.role).toLowerCase()}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-2xl sm:text-xl font-bold text-gray-900",children:v.name}),ie.jsx("p",{className:"text-base sm:text-sm text-gray-500",children:v.specialty||"Designer"})]})]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("button",{onClick:()=>{w(!1),Ne(v)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Designer Profile",children:ie.jsx(vt,{className:"w-6 h-6 sm:w-5 sm:h-5"})}),ie.jsx("button",{onClick:()=>{w(!1),j(null)},className:"text-gray-400 hover:text-gray-600",title:"Close designer details",children:ie.jsx(Et,{className:"w-6 h-6 sm:w-5 sm:h-5"})})]})]}),ie.jsx("div",{className:"p-6 space-y-6",children:(()=>{const e=ce.filter(e=>e.tasks?.some(e=>e.assigneeId===v.id)).map(e=>({project:e,tasks:e.tasks.filter(e=>e.assigneeId===v.id),projectFinancials:ue[e.id]||[]}));return 0===e.length?ie.jsx("p",{className:"text-lg sm:text-base text-gray-500 text-center py-6",children:"No tasks assigned"}):ie.jsx("div",{className:"space-y-6",children:e.map(({project:e,tasks:t,projectFinancials:s})=>{const a=s.filter(e=>e.adminApproved&&e.clientApproved&&"income"===e.type).reduce((e,t)=>e+(t.amount||0),0),r=!0===oe[e.id];return ie.jsxs("div",{children:[ie.jsxs("div",{className:"mb-3",children:[ie.jsx("h4",{className:"text-lg sm:text-base font-bold text-gray-800 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l?.(e),children:e.name}),ie.jsxs("p",{className:"text-base sm:text-sm text-gray-500 mt-1",children:["Total Payment Received: ",ie.jsxs("span",{className:"font-semibold text-gray-900",children:["",a.toLocaleString()]})]})]}),ie.jsxs("button",{onClick:()=>{de(t=>({...t,[e.id]:!t[e.id]}))},className:"w-full px-4 py-2.5 bg-gradient-to-r from-blue-50 to-blue-100 flex justify-between items-center transition-colors text-left border border-blue-200 rounded-t-lg",children:[ie.jsxs("span",{className:"text-sm font-semibold text-blue-900",children:["Tasks (",t.length,")"]}),ie.jsx(Ie,{className:"w-5 h-5 text-blue-600 transition-transform "+(r?"rotate-90":"")})]}),r&&ie.jsx("div",{className:"overflow-x-auto border border-gray-200 border-t-0 rounded-b-lg",children:ie.jsxs("table",{className:"w-full text-lg sm:text-base",children:[ie.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-3 text-left font-bold text-gray-700 text-base sm:text-sm",children:"Task Name"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Progress"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Status"}),ie.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Due Date"})]})}),ie.jsx("tbody",{children:t.map(t=>{const s=Dr(t),a=t.dueDate?new Date(t.dueDate).toLocaleDateString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",r=t.status===Wt.DONE?"bg-green-100 text-green-800":t.status===Wt.IN_PROGRESS?"bg-blue-100 text-blue-800":t.status===Wt.REVIEW?"bg-purple-100 text-purple-800":t.status===Wt.OVERDUE?"bg-red-100 text-red-800":t.status===Wt.TODO?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return ie.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[ie.jsx("td",{className:"px-4 py-3 text-left text-gray-900 font-medium text-base sm:text-sm cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>o?.(t,e),children:t.title}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsxs("div",{className:"flex items-center justify-center gap-2",children:[ie.jsx("div",{className:"w-12 bg-gray-200 rounded-full h-1.5",children:ie.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full",style:{width:`${s}%`}})}),ie.jsxs("span",{className:"text-base sm:text-sm font-semibold text-gray-700",children:[s,"%"]})]})}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsx("span",{className:`px-2 py-1 rounded text-base sm:text-sm font-medium whitespace-nowrap ${r}`,children:t.status})}),ie.jsx("td",{className:"px-4 py-3 text-center text-gray-600 text-base sm:text-sm",children:a})]},t.id)})})]})})]},e.id)})})})()})]})}),document.body),R&&h&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md animate-fade-in",children:[ie.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Share Vendor Report"}),ie.jsx("button",{onClick:()=>L(!1),className:"text-gray-400 hover:text-gray-600",title:"Close share report dialog",children:ie.jsx(Et,{className:"w-5 h-5"})})]}),ie.jsxs("div",{className:"p-6 space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Share ",ie.jsx("span",{className:"font-semibold",children:h.name}),"'s billing report with:"]}),ie.jsx("div",{className:"space-y-3",children:ce.filter(e=>e.tasks.some(e=>e.assigneeId===h?.id)).map(e=>ie.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[ie.jsx("input",{type:"checkbox",defaultChecked:!0,className:"w-4 h-4 rounded border-gray-300"}),ie.jsxs("div",{className:"ml-3",children:[ie.jsx("p",{className:"text-sm font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l?.(e),children:e.name}),ie.jsxs("p",{className:"text-xs text-gray-500",children:[e.team?.length||0," team members"]})]})]},e.id))})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Share Method"}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsxs("label",{className:"flex items-center p-3 border border-blue-200 bg-blue-50 rounded-lg cursor-pointer",children:[ie.jsx("input",{type:"radio",name:"shareMethod",value:"email",checked:"email"===F,onChange:e=>z(e.target.value),className:"w-4 h-4 border-gray-300"}),ie.jsx("span",{className:"ml-3 text-sm font-medium text-gray-900",children:"Send via Email"})]}),ie.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[ie.jsx("input",{type:"radio",name:"shareMethod",value:"link",checked:"link"===F,onChange:e=>z(e.target.value),className:"w-4 h-4 border-gray-300"}),ie.jsx("span",{className:"ml-3 text-sm font-medium text-gray-900",children:"Create Shareable Link"})]})]})]})]}),ie.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end",children:[ie.jsx("button",{onClick:()=>L(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),ie.jsxs("button",{onClick:()=>{if("link"===F&&h){const e=`${window.location.origin}${window.location.pathname}?vendorId=${h.id}`;navigator.clipboard.writeText(e).then(()=>{m("Success","Vendor link copied to clipboard","success",d?.id||"",i[0]?.id||"",i[0]?.name||"Project"),L(!1)}).catch(()=>{m("Error","Failed to copy link","error",d?.id||"",i[0]?.id||"",i[0]?.name||"Project")})}else m("Success",`Vendor report for ${h?.name} shared with client`,"success",d?.id||"",i[0]?.id||"",i[0]?.name||"Project"),L(!1)},title:"Share vendor billing report",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[ie.jsx(ut,{className:"w-4 h-4"}),"Share Report"]})]})]})}),document.body),k&&S&&n.createPortal(ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[ie.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[ie.jsxs("div",{className:"flex items-center gap-4",children:[ie.jsx(Cr,{avatar:S.avatar,name:S.name,size:"md",role:String(S.role).toLowerCase()}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:S.name}),ie.jsxs("p",{className:"text-xs text-gray-500",children:[S.specialty,"  ",S.company]})]})]}),ie.jsx("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-600",title:"Close accounts panel",children:ie.jsx(Et,{className:"w-5 h-5"})})]}),ie.jsxs("div",{className:"p-6",children:[ie.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-4",children:"Project & Billing Report"}),0===ce.filter(e=>{const t=e.teamMembers?.includes(S?.id||""),s=e.tasks?.some(e=>e.assigneeId===S?.id),a=ue[e.id]||[],r=S?.name||"",n=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"",i=a.some(e=>e.vendorId===S?.id||e.vendorName===r||e.paidTo===r||e.receivedBy===r||n(e.receivedByName)===r||n(e.paidByOther)===r);return t||s||i}).length?ie.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"No projects assigned"}):ie.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:ie.jsxs("table",{className:"w-full text-xs",children:[ie.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:ie.jsxs("tr",{children:[ie.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700",children:"Project"}),ie.jsx("th",{className:"px-4 py-2 text-right font-bold text-gray-700",children:"Net Amount"}),ie.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Tasks"}),ie.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Admin Approval"}),ie.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Client Approval"}),ie.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Status"})]})}),ie.jsx("tbody",{children:ce.filter(e=>{const t=e.teamMembers?.includes(S?.id||""),s=e.tasks?.some(e=>e.assigneeId===S?.id),a=ue[e.id]||[],r=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"",n=S?.name||"",i=a.some(e=>e.vendorId===S?.id||e.vendorName===n||e.paidTo===n||e.receivedBy===n||r(e.receivedByName)===n||r(e.paidByOther)===n);return t||s||i}).map((e,t)=>{const s=ue[e.id]||[],a=e=>e?e.includes("(")?e.split("(")[0].trim():e.trim():"",r=S?.name||"",n=s.filter(e=>e.vendorId===S?.id||e.vendorName===r||e.paidTo===r||e.receivedBy===r||a(e.receivedByName)===r||a(e.paidByOther)===r),i=n.filter(e=>e.adminApproved&&e.clientApproved),o=i.filter(e=>a(e.receivedByName)===r||e.receivedBy===r).reduce((e,t)=>e+t.amount,0)-i.filter(e=>e.vendorName===r||a(e.paidByOther)===r||e.paidTo===r).reduce((e,t)=>e+t.amount,0);let d=0;d=S?.projectMetrics&&S.projectMetrics[e.id]?S.projectMetrics[e.id].taskCount:e.tasks.filter(e=>e.assigneeId===S?.id).length;const c=n.length>0,m=c&&n.every(e=>e.adminApproved),p=c&&n.some(e=>e.adminApproved),x=c&&n.every(e=>e.clientApproved),g=c&&n.some(e=>e.clientApproved),u=(e,t)=>e?ie.jsx("div",{className:"flex justify-center text-green-500 font-bold text-lg",children:""}):t?ie.jsx("span",{className:"text-orange-500 font-medium text-xs",children:"Partial"}):ie.jsx("span",{className:"text-gray-400 text-xs",children:"-"});return ie.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 "+(t%2==0?"bg-white":"bg-gray-50/50"),children:[ie.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l?.(e),children:e.name}),ie.jsxs("td",{className:"px-4 py-3 text-left text-gray-700",children:["",(o/1e3).toFixed(1),"k"]}),ie.jsx("td",{className:"px-4 py-3 text-center text-gray-700 font-medium",children:d}),ie.jsx("td",{className:"px-4 py-3 text-center",children:u(m,p)}),ie.jsx("td",{className:"px-4 py-3 text-center",children:u(x,g)}),ie.jsx("td",{className:"px-4 py-3 text-center",children:ie.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium "+(m&&x?"bg-green-100 text-green-700":m?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:m&&x?"Approved":m?"Admin OK":"Pending"})})]},e.id)})})]})})]})]})}),document.body),ne&&ie.jsx(ie.Fragment,{children:ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-8 text-center",style:{position:"relative",zIndex:1e4},children:[ie.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:ie.jsx(Ce,{className:"w-8 h-8 text-green-600"})}),ie.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:" User Created Successfully!"}),ie.jsxs("p",{className:"text-gray-700 mb-6 text-base font-medium",children:[ie.jsx("strong",{children:ne.name})," has been created with phone authentication.",ie.jsx("br",{}),ie.jsxs("span",{className:"text-sm text-gray-600",children:["Phone: ",ne.phone]})]}),ie.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-left mb-6 border-l-4 border-blue-500",children:[ie.jsx("p",{className:"text-xs text-blue-600 font-bold uppercase mb-2",children:" Welcome Message"}),ie.jsxs("p",{className:"text-sm text-gray-800 italic",children:['"Hi ',ne.name,", welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ",ne.phone,'."']})]}),ie.jsxs("div",{className:"space-y-3",children:[ie.jsxs("a",{href:`https://wa.me/+${ne.phone?.replace(/\D/g,"")}?text=${encodeURIComponent(`Hi ${ne.name}, welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ${ne.phone}.`)}`,target:"_blank",rel:"noopener noreferrer",className:"w-full bg-[#25D366] hover:bg-[#128C7E] text-white font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-md",children:[ie.jsx(st,{className:"w-5 h-5"})," Send Welcome on WhatsApp"]}),ie.jsxs("button",{onClick:()=>{const e=`Hi ${ne.name}, welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ${ne.phone}.`;navigator.clipboard.writeText(e),m("Copied","Message copied to clipboard!","success")},className:"w-full bg-blue-100 border border-blue-300 hover:bg-blue-200 text-blue-700 font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:[ie.jsx(Te,{className:"w-5 h-5"})," Copy Message"]}),ie.jsx("button",{onClick:()=>{le(null),m("Done","Remember to send the message!","info")},className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 rounded-lg transition-colors",children:"Done"})]})]})})})]})},ln=({message:e})=>{const{loading:t,message:s}=tr();return t?ie.jsxs("div",{className:"loader-overlay",role:"status","aria-live":"polite",children:[ie.jsx("div",{className:"loader-circle"}),ie.jsx("div",{className:"loader-message",children:e||s||"Loading..."})]}):null};let on=null;const dn={"auth/invalid-phone-number":"The phone number entered is invalid. Please check and try again.","auth/missing-phone-number":"Please enter your phone number.","auth/too-many-requests":"Too many attempts. Please try again later or contact support.","auth/quota-exceeded":"SMS quota exceeded. Please try again later.","auth/user-disabled":"This account has been disabled. Contact support for help.","auth/network-request-failed":"Network error. Please check your connection and try again.","auth/code-expired":"The verification code has expired. Please request a new one.","auth/invalid-verification-code":"The code you entered is incorrect. Please try again.","auth/session-expired":"Session expired. Please request a new verification code."};function cn(e){return dn[e]||"An unexpected error occurred. Please try again."}const mn=()=>{const{user:e,adminCredentials:t}=Ka(),{addNotification:s}=Xa(),{showLoading:r,hideLoading:n}=tr(),[i,l]=a.useState(""),[o,d]=a.useState(""),[c,m]=a.useState(""),[p,x]=a.useState(""),[g,u]=a.useState("email"),[h,b]=a.useState(!1);return ie.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col font-sans",children:[ie.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),ie.jsx("div",{className:"flex-1 flex items-center justify-center p-4 mt-[env(safe-area-inset-top,24px)]",children:ie.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden max-w-5xl w-full flex flex-col md:flex-row min-h-[600px]",children:[ie.jsxs("div",{className:"md:w-5/12 bg-gray-900 p-8 md:p-12 text-white flex flex-col justify-between relative overflow-hidden",children:[ie.jsx("div",{className:"absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2"}),ie.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-white opacity-5 rounded-full translate-x-1/3 translate-y-1/3"}),ie.jsxs("div",{className:"relative z-10",children:[ie.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[ie.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-10 h-10 rounded-lg"}),ie.jsx("span",{className:"text-2xl font-bold tracking-tight",children:"Kydo Solutions"})]}),ie.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6 leading-tight",children:"Manage your business with confidence."}),ie.jsx("p",{className:"text-gray-400 text-lg mb-8",children:"Create your admin account to access powerful tools for project management, financial tracking, and team collaboration."})]}),ie.jsxs("div",{className:"space-y-4 relative z-10",children:[ie.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[ie.jsx(ht,{className:"w-8 h-8 text-gray-300"}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"font-semibold",children:"Enterprise Security"}),ie.jsx("p",{className:"text-sm text-gray-400",children:"High-Level encryption for your data"})]})]}),ie.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[ie.jsx($t,{className:"w-8 h-8 text-gray-300"}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"font-semibold",children:"Quick Setup"}),ie.jsx("p",{className:"text-sm text-gray-400",children:"Get started in less than 2 minutes"})]})]})]})]}),ie.jsx("div",{className:"md:w-7/12 p-8 md:p-12 bg-white overflow-y-auto",children:ie.jsxs("div",{className:"max-w-md mx-auto",children:[ie.jsxs("div",{className:"mb-8",children:[ie.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Create Admin Account"}),ie.jsx("p",{className:"text-gray-500",children:"Enter your details to set up your workspace."})]}),ie.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!i)return s("Validation Error","Please enter a name","error");if(!p)return s("Validation Error","Please enter a business name","error");if(!c)return s("Validation Error","Please enter a phone number","error");if("email"===g&&!o)return s("Validation Error","Please enter an email","error");b(!0),r("Creating admin...");try{const t=(c||"").replace(/\D/g,"").slice(-6)||"admin123",a={id:"",name:i,email:"email"===g?o:"",role:Ft.ADMIN,company:p||void 0,phone:c||void 0,password:t,authMethod:g};e&&e.tenantId&&(a.tenantId=e.tenantId),await rn(a),s("Success",`Admin account created. Password: last 6 digits of ${c}`,"success"),l(""),d(""),m(""),x("")}catch(a){s("Error",a.message||"Failed to create admin","error")}finally{b(!1),n()}},className:"space-y-5",children:[ie.jsxs("div",{className:"space-y-1.5",children:[ie.jsx("label",{htmlFor:"fullName",className:"text-sm font-medium text-gray-700",children:"Full Name"}),ie.jsxs("div",{className:"relative",children:[ie.jsx(Ct,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),ie.jsx("input",{id:"fullName",placeholder:"e.g. Rajesh Kumar",value:i,onChange:e=>l(e.target.value),className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),ie.jsxs("div",{className:"space-y-1.5",children:[ie.jsx("label",{htmlFor:"businessName",className:"text-sm font-medium text-gray-700",children:"Business Name"}),ie.jsxs("div",{className:"relative",children:[ie.jsx(je,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),ie.jsx("input",{id:"businessName",placeholder:"e.g. Kydo Interiors",value:p,onChange:e=>x(e.target.value),className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),ie.jsxs("div",{className:"space-y-1.5",children:[ie.jsx("label",{htmlFor:"phone",className:"text-sm font-medium text-gray-700",children:"Phone Number"}),ie.jsxs("div",{className:"relative",children:[ie.jsx(ot,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),ie.jsx("input",{id:"phone",type:"tel",placeholder:"+91 9876543210",value:c,onChange:e=>m(e.target.value),title:"Include country code, e.g. +91 for India",className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]}),ie.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[ie.jsx(De,{className:"w-3 h-3 text-green-500"}),"Last 6 digits will be your password"]})]}),ie.jsxs("div",{className:"space-y-1.5",children:[ie.jsx("label",{htmlFor:"adminEmail",className:"text-sm font-medium text-gray-700",children:"Email Address"}),ie.jsxs("div",{className:"relative",children:[ie.jsx(et,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),ie.jsx("input",{id:"adminEmail",placeholder:"admin@example.com",value:o,onChange:e=>d(e.target.value),type:"email",className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),ie.jsxs("div",{className:"pt-2",children:[ie.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Preferred Login Method"}),ie.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ie.jsxs("button",{type:"button",onClick:()=>u("email"),className:"py-2.5 px-4 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 border "+("email"===g?"bg-gray-900 border-gray-900 text-white ring-1 ring-gray-900":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"),children:[ie.jsx(et,{className:"w-4 h-4"}),"Email Login"]}),ie.jsxs("button",{type:"button",onClick:()=>u("phone"),className:"py-2.5 px-4 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 border "+("phone"===g?"bg-gray-900 border-gray-900 text-white ring-1 ring-gray-900":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"),children:[ie.jsx(ot,{className:"w-4 h-4"}),"Phone Login"]})]})]}),ie.jsx("div",{className:"flex justify-center pt-2",children:ie.jsx("button",{type:"submit",disabled:h,className:"px-10 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold py-2.5 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-600/20",children:h?ie.jsxs(ie.Fragment,{children:[ie.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):ie.jsxs(ie.Fragment,{children:["Create Admin Account",ie.jsx(he,{className:"w-4 h-4"})]})})}),ie.jsx("div",{className:"text-center mt-6",children:ie.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",ie.jsx("a",{href:"/",className:"font-semibold text-blue-600 hover:text-blue-700 hover:underline transition-colors",children:"Sign In"})]})})]})]})})]})})]})},pn=({users:e=[]})=>{const{login:t,setAdminCredentials:s}=Ka(),{addNotification:r}=Xa(),{showLoading:n,hideLoading:i}=tr(),[l,o]=a.useState(""),[d,c]=a.useState(""),[m,p]=a.useState("+91 "),[x,g]=a.useState(""),[u,h]=a.useState(""),[b,y]=a.useState(!1),[f,v]=a.useState(!1),[j,N]=a.useState("email"),[w,k]=a.useState(!1),[I,S]=a.useState(null),[C,D]=a.useState(!0);return"admins"===("undefined"!=typeof window?new URLSearchParams(window.location.search).get("open"):null)?ie.jsx(mn,{}):ie.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[ie.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),ie.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 mt-[env(safe-area-inset-top,24px)]",children:[b&&ie.jsx(ln,{message:"Signing in..."}),ie.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full overflow-hidden flex flex-col md:flex-row",children:[ie.jsxs("div",{className:"md:w-1/2 bg-gray-900 p-12 text-white flex flex-col justify-between relative overflow-hidden",children:[ie.jsx("div",{className:"absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2"}),ie.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-white opacity-5 rounded-full translate-x-1/3 translate-y-1/3"}),ie.jsxs("div",{className:"relative z-10",children:[ie.jsx("img",{src:"/kydoicon.png",alt:"Kydo Solutions Logo",className:"h-12 w-12 mb-6 rounded-lg"}),ie.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Kydo Solutions"}),ie.jsx("p",{className:"text-gray-400 text-lg leading-relaxed",children:"Manage your interior design projects, clients, and vendors in one seamless platform."})]}),ie.jsx("div",{className:"mt-12 relative z-10",children:ie.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[ie.jsx(Xe,{className:"w-8 h-8 text-gray-300"}),ie.jsxs("div",{children:[ie.jsx("h3",{className:"font-semibold",children:"Secure Access"}),ie.jsx("p",{className:"text-sm text-gray-400",children:"Role-Based Access Control"})]})]})})]}),ie.jsxs("div",{className:"md:w-1/2 p-12 bg-white flex flex-col justify-center",children:[ie.jsxs("div",{className:"mb-8",children:[ie.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Sign In"}),ie.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[ie.jsxs("button",{type:"button",onClick:()=>{N("email"),k(!1),h(""),v(!1),p("+91 "),g("")},className:"pb-3 px-4 font-medium border-b-2 transition-colors flex items-center gap-2 "+("email"===j?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[ie.jsx(et,{className:"w-4 h-4"}),"Email"]}),ie.jsxs("button",{type:"button",onClick:()=>{N("phone"),k(!1),h(""),v(!1),o(""),c("")},className:"pb-3 px-4 font-medium border-b-2 transition-colors flex items-center gap-2 "+("phone"===j?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[ie.jsx(ot,{className:"w-4 h-4"}),"Phone"]})]})]}),"email"===j&&ie.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v(!0),h(""),l&&d){y(!0),n("Signing in...");try{const e=await X(wa,l,d);s({email:l,password:d}),sessionStorage.setItem("adminEmail",l),sessionStorage.setItem("adminPassword",d);let n=null;try{n=await Ma(e.user.uid)}catch(a){}if(!n){const e="Account not found. Please contact your administrator to set up your account.";return h(e),r("Account Not Found",e,"error"),await F(wa),y(!1),void i()}C&&((e=>{try{const t=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");t[e.id]=e,localStorage.setItem("rememberedDevices",JSON.stringify(t))}catch(u){}})((()=>{const e=(new Date).toISOString();return{id:Ra(),name:`${Fa()} on ${za()}`,type:La(),browser:Fa(),os:za(),lastLogin:e,createdAt:e}})()),r("Device Remembered","This device will be remembered for 30 days","success")),t(n),h(""),window.location.href="/"}catch(o){let e="Invalid credentials.";"auth/user-not-found"===o.code?e="Email not found.":"auth/wrong-password"===o.code?e="Incorrect password.":"auth/invalid-email"===o.code&&(e="Invalid email format."),h(e),r("Login Failed",e,"error")}finally{y(!1),i()}}else r("Validation Error","Please fill in all required fields.","error")},className:"space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"email",className:"w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 "+(f&&!l?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"),placeholder:"Enter your email",value:l,onChange:e=>o(e.target.value),disabled:b})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"password",className:"w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 "+(f&&!d?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"),placeholder:"Enter password",value:d,onChange:e=>c(e.target.value),disabled:b})]}),ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[ie.jsx("input",{type:"checkbox",checked:C,onChange:e=>D(e.target.checked),disabled:b,className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),ie.jsx("span",{className:"text-sm text-gray-700",children:"Remember this device for 30 days"})]}),u&&ie.jsx("p",{className:"text-sm text-red-500 font-medium",children:u}),ie.jsxs("button",{type:"submit",disabled:b,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[b?"Signing in...":"Login"," ",!b&&ie.jsx(he,{className:"w-4 h-4"})]}),ie.jsx("div",{className:"mt-3 text-center",children:ie.jsx("a",{href:"?open=admins",className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Create Admin account"})})]}),"phone"===j&&ie.jsx(ie.Fragment,{children:w?ie.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v(!0),h(""),x){y(!0),n("Verifying OTP...");try{const e=await(async(e,t)=>{try{const s=(await e.confirm(t)).user;return await s.getIdTokenResult(!0),await new Promise(e=>setTimeout(e,500)),s}catch(u){throw u}})(I,x);let a=null;try{a=await Ma(e.uid),!a&&e.phoneNumber&&(a=await Oa(e.uid,e.phoneNumber))}catch(s){}if(!a)return h("User profile not found. Please contact your administrator to set up your account."),r("Profile Not Found","Your profile has not been created yet. Please contact the administrator.","error"),k(!1),void g("");t(a),h("")}catch(a){let e=cn(a.code);h(e),r("Verification Failed",e,"error")}finally{y(!1),i()}}else r("Validation Error","Please enter the OTP.","error")},className:"space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Enter OTP ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["OTP sent to ",m]}),ie.jsx("input",{type:"text",className:"w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 text-center tracking-widest "+(f&&!x?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"),placeholder:"000000",value:x,onChange:e=>g(e.target.value.replace(/\D/g,"").slice(0,6)),disabled:b,maxLength:6})]}),u&&ie.jsx("p",{className:"text-sm text-red-500 font-medium",children:u}),ie.jsxs("button",{type:"submit",disabled:b,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[b?"Verifying...":"Verify OTP"," ",!b&&ie.jsx(he,{className:"w-4 h-4"})]}),ie.jsx("button",{type:"button",onClick:()=>{k(!1),g(""),h("")},className:"w-full text-blue-600 hover:text-blue-700 font-medium py-2",children:"Send OTP Again"})]}):ie.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v(!0),h(""),m){y(!0),n("Sending OTP...");try{let t=m.replace(/[\s\-()]/g,"");t.startsWith("+")||(t=`+91${t}`),i();const s=await(async(t,s)=>{try{let a=document.getElementById(s);if(a||(a=document.createElement("div"),a.id=s,a.style.display="none",document.body.appendChild(a)),on){try{on.clear()}catch(e){}on=null}const r=t.trim();return on=new J(wa,s,{size:"invisible",callback:()=>{}}),await Z(wa,r,on)}catch(u){if(on){try{on.clear()}catch(e){}on=null}if("auth/invalid-app-credential"===u.code)throw new Error("Firebase app credential error. This usually means: 1) Phone authentication not properly enabled in Firebase Console, 2) API key restrictions, or 3) Enforcement mode not set correctly. Please verify Phone auth is enabled and set to AUDIT mode.");if("auth/invalid-phone-number"===u.code)throw new Error("Invalid phone number format. Please use format like +911234567890");if(u.message&&u.message.includes("400"))throw new Error("SMS delivery failed (400). Possible reasons: 1) Daily SMS quota exceeded (50/day free), 2) Too many requests from this number, 3) Billing issue.");if("auth/quota-exceeded"===u.code)throw new Error("SMS quota exceeded. Daily limit reached.");throw u}})(t,"recaptcha-container");S(s),k(!0),r("Success","OTP sent to your phone number.","success"),h("")}catch(t){let e=cn(t.code);"auth/too-many-requests"===t.code&&(e+=" You have reached the maximum number of attempts. Please wait a few minutes before trying again."),h(e),r("Error",e,"error")}finally{y(!1),i()}}else r("Validation Error","Please enter your phone number.","error")},className:"space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"tel",className:"w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 "+(f&&!m?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"),placeholder:"+91 9876543210",value:m,onChange:e=>p(e.target.value),disabled:b}),ie.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Include country code (e.g., +91 for India)"})]}),ie.jsx("div",{id:"recaptcha-container"}),u&&ie.jsx("p",{className:"text-sm text-red-500 font-medium",children:u}),ie.jsxs("button",{type:"submit",disabled:b,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[b?"Sending OTP...":"Send OTP"," ",!b&&ie.jsx(he,{className:"w-4 h-4"})]})]})})]})]})]})]})},xn=({isOpen:e,onClose:t,projects:s,onSelectProject:a,onDeepLink:r})=>{const{notifications:n,markAsRead:i,markAllAsRead:l,clearNotifications:o,handleNotificationDeepLink:d}=Xa();return e?ie.jsxs("div",{className:"fixed sm:absolute right-1/2 sm:right-0 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 top-12 w-[calc(100%-2rem)] sm:w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-100 z-50 overflow-hidden animate-fade-in",children:[ie.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[ie.jsx("h3",{className:"font-semibold text-gray-800",children:"Notifications"}),ie.jsxs("div",{className:"flex items-center gap-2",children:[n.length>0&&ie.jsxs(ie.Fragment,{children:[ie.jsx("button",{onClick:l,className:"text-xs text-blue-600 hover:text-blue-800 font-medium px-2 py-1 rounded hover:bg-blue-50",title:"Mark all as read",children:"Mark all read"}),ie.jsx("button",{onClick:o,className:"text-gray-400 hover:text-red-600 p-1 rounded hover:bg-red-50",title:"Clear all",children:ie.jsx(kt,{className:"w-4 h-4"})})]}),ie.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100 transition-colors",title:"Close",children:ie.jsx(Et,{className:"w-5 h-5"})})]})]}),ie.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:0===n.length?ie.jsxs("div",{className:"p-8 text-center text-gray-400 flex flex-col items-center",children:[ie.jsx(fe,{className:"w-8 h-8 mb-2 opacity-20"}),ie.jsx("p",{className:"text-sm",children:"No new notifications"})]}):ie.jsx("div",{className:"divide-y divide-gray-50",children:n.map(e=>ie.jsx("div",{onClick:()=>(e=>{if(i(e.id),r)return d(e),void t();if(e.projectId&&a){const r=s.find(t=>t.id===e.projectId);r&&(a(r,{initialTab:e.targetTab,taskId:e.taskId,meetingId:e.meetingId}),t())}})(e),className:"p-4 hover:bg-gray-50 transition-colors relative group cursor-pointer "+(e.read?"opacity-60":"bg-blue-50/30"),children:ie.jsxs("div",{className:"flex gap-3",children:[ie.jsx("div",{className:"mt-1 w-2 h-2 rounded-full flex-shrink-0 "+("error"===e.type?"bg-red-500":"warning"===e.type?"bg-yellow-500":"success"===e.type?"bg-green-500":"bg-blue-500")}),ie.jsxs("div",{className:"flex-1",children:[ie.jsx("h4",{className:"text-sm font-medium "+(e.read?"text-gray-700":"text-gray-900"),children:e.title}),ie.jsx("p",{className:"text-xs text-gray-500 mt-0.5 leading-relaxed",children:e.message}),ie.jsx("p",{className:"text-[10px] text-gray-400 mt-2",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),!e.read&&ie.jsx("button",{onClick:t=>{t.stopPropagation(),i(e.id)},className:"absolute top-4 right-4 text-blue-400 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity",children:ie.jsx(we,{className:"w-4 h-4"})})]})},e.id))})})]}):null},gn=({users:e,onClose:t,onSave:s,initialProject:r,selectedFirmId:n})=>{const{addNotification:i}=Xa(),{user:l}=Ka(),{createNewProject:o,updateExistingProject:d}=Jr(),[c,m]=a.useState(!1),p=!!r,x=(new Date).toISOString().split("T")[0],[g,u]=a.useState(r?{name:r.name,tenantId:r.tenantId,status:r.status,type:r.type,category:r.category,description:r.description,budget:r.budget,startDate:r.startDate,deadline:r.deadline,clientId:r.clientId,clientIds:r.clientIds||[r.clientId],leadDesignerId:r.leadDesignerId}:{name:"",tenantId:n||l?.tenantId||l?.id||"",status:zt.DISCOVERY,type:Vt.DESIGNING,category:Ut.COMMERCIAL,description:"",budget:void 0,startDate:x,deadline:x,clientId:"",clientIds:[],leadDesignerId:""}),[h,b]=a.useState(!1),[y,f]=a.useState(null),[v,j]=a.useState([]),N=a.useRef(null),w=a.useRef(null),k=e.filter(e=>e.role===Ft.CLIENT),I=e.filter(e=>e.role===Ft.DESIGNER),[S,C]=a.useState(!1),D=a.useRef(null);a.useEffect(()=>{const e=e=>{D.current&&!D.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const A=(e,t)=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(t)&&""!==t)return;const s={...g,[e]:t};"startDate"===e&&s.deadline&&new Date(t)>new Date(s.deadline)&&(s.deadline=t),u(s)},E=e=>`\n    w-full px-4 py-2 border rounded-lg focus:outline-none transition-all\n    bg-white text-gray-900 placeholder-gray-400 text-base md:text-sm\n    ${h&&!e?"border-red-500 ring-1 ring-red-500":"border-gray-200 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}\n  `;return ie.jsx("div",{className:"fixed inset-0 bg-black/60 z-[999] flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[ie.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-100 bg-white sticky top-0 z-10",children:[ie.jsx("h2",{className:"text-xl font-bold text-gray-900",children:p?"Edit Project":"Create New Project"}),ie.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close modal",children:ie.jsx(Et,{className:"w-6 h-6"})})]}),ie.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{if(g.clientIds&&g.clientIds.length>0?g.clientIds:!g.clientId||g.clientId,!(g.name&&g.leadDesignerId&&g.startDate&&g.deadline&&g.budget))return b(!0),i("Validation Error","Please complete all required fields marked in red.","error"),!1;if(!/^\d{4}-\d{2}-\d{2}$/.test(g.startDate||""))return i("Invalid Date","Start date must be in YYYY-MM-DD format.","error"),!1;if(!/^\d{4}-\d{2}-\d{2}$/.test(g.deadline||""))return i("Invalid Date","Deadline must be in YYYY-MM-DD format.","error"),!1;const e=new Date(g.startDate),t=new Date(g.deadline);return isNaN(e.getTime())?(i("Invalid Date","Start date is not a valid date.","error"),!1):isNaN(t.getTime())?(i("Invalid Date","Deadline is not a valid date.","error"),!1):!(t<e&&(i("Invalid Date Range","Deadline must be on or after the start date.","error"),1))})()){m(!0);try{if(p&&r){const e=g.clientIds&&g.clientIds.length>0?g.clientIds:g.clientId?[g.clientId]:[],a={name:g.name,clientId:e[0]||"",clientIds:e,tenantId:r.tenantId||l?.tenantId||l?.id||"",leadDesignerId:g.leadDesignerId,status:g.status||zt.DISCOVERY,type:g.type,category:g.category,startDate:g.startDate,deadline:g.deadline,budget:Number(g.budget),description:g.description||""};if(a.updatedBy=l?.id||"",a.updatedAt=(new Date).toISOString(),y)try{const e=Date.now(),t=y.name.replace(/\s+/g,"_"),s=V(Ia,`thumbnails/${r.id}/${e}_${t}`);await U(s,y),a.thumbnail=await W(s)}catch(Cn){i("Warning","Project updated but cover image upload failed.","warning")}if(v.length>0){const e=[];for(let t=0;t<v.length;t++){const s=v[t];try{const a=Date.now(),n=s.file.name.replace(/\s+/g,"_"),i=V(Ia,`documents/${r.id}/${a}_${n}`);await U(i,s.file);const o=await W(i);let d="other";s.file.type.startsWith("image/")?d="image":"application/pdf"===s.file.type&&(d="pdf");const c={id:`doc_${a}_${t}`,name:s.name||s.file.name,type:d,url:o,uploadedBy:l?.id||"system",uploadDate:(new Date).toISOString(),sharedWith:[Ft.ADMIN,Ft.DESIGNER,Ft.CLIENT],approvalStatus:"pending"};e.push(c),await nr(r.id,c)}catch(Cn){i("Warning",`Failed to upload document: ${s.name}`,"warning")}}a.documents=[...r.documents||[],...e]}await d(r.id,a);const n={...r,...a};s(n),t(),i("Success",`Project "${g.name}" has been updated successfully.`,"success")}else{const e=g.clientIds&&g.clientIds.length>0?g.clientIds:g.clientId?[g.clientId]:[],a=n||l?.tenantId||l?.id||"",r={name:g.name,clientId:e[0]||"",clientIds:e,tenantId:a,leadDesignerId:g.leadDesignerId,status:g.status||zt.DISCOVERY,type:g.type,category:g.category,startDate:g.startDate,deadline:g.deadline,budget:Number(g.budget),initialBudget:Number(g.budget),thumbnail:"",description:g.description||"",tasks:[],financials:[],meetings:[],documents:[],activityLog:[{id:`log_${Date.now()}`,userId:l?.id||"system",action:"Project Created",details:"Project initialized via Admin Dashboard",timestamp:(new Date).toISOString(),type:"creation"}],createdBy:l?.id||"",createdAt:(new Date).toISOString()},c=await o(r);let m;if(await sr(c,`Project Created: ${g.name}`,`Project initialized by ${l?.name||"System"}. Category: ${g.category}, Type: ${g.type}. Budget: ${Number(g.budget).toLocaleString()}`,"planned",Pr(g.startDate),Pr(g.deadline)).catch(e=>{}),y)try{const e=Date.now(),t=y.name.replace(/\s+/g,"_"),s=V(Ia,`thumbnails/${c}/${e}_${t}`);await U(s,y),m=await W(s)}catch(Cn){i("Warning","Project created but cover image upload failed. You can add it later.","warning")}const p=[];for(let t=0;t<v.length;t++){const e=v[t];try{const s=Date.now(),a=e.file.name.replace(/\s+/g,"_"),r=V(Ia,`documents/${c}/${s}_${a}`);await U(r,e.file);const n=await W(r);let i="other";e.file.type.startsWith("image/")?i="image":"application/pdf"===e.file.type&&(i="pdf");const o={id:`doc_${s}_${t}`,name:e.name||e.file.name,type:i,url:n,uploadedBy:l?.id||"system",uploadDate:(new Date).toISOString(),sharedWith:[Ft.ADMIN,Ft.DESIGNER,Ft.CLIENT],approvalStatus:"pending"};p.push(o),await nr(c,o)}catch(Cn){i("Warning",`Failed to upload document: ${e.name}`,"warning")}}const x={};m&&(x.thumbnail=m),p.length>0&&(x.documents=p),Object.keys(x).length>0&&await d(c,x);const u={...r,id:c,thumbnail:m,documents:p};s(u),t(),i("Success",`Project "${g.name}" has been created with ${p.length} document(s).`,"success")}}catch(Cn){i("Error",`Failed to ${p?"update":"create"} project: ${Cn.message}`,"error")}finally{m(!1)}}},className:"p-8 space-y-6 bg-white",children:[ie.jsxs("div",{className:"space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Project Name ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"text",className:E(g.name),placeholder:"e.g. House Renovation",value:g.name,onChange:e=>u({...g,name:e.target.value})})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Description"}),ie.jsx("textarea",{className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none h-24 resize-none bg-white text-gray-900 placeholder-gray-400",placeholder:"Briefly describe the scope of work...",value:g.description,onChange:e=>u({...g,description:e.target.value})})]})]}),ie.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Clients"}),ie.jsxs("div",{className:"relative",ref:D,children:[ie.jsx("button",{type:"button",onClick:()=>C(e=>!e),className:"w-full text-left px-3 py-2 border rounded-lg bg-white border-gray-300",title:"Select clients",children:ie.jsxs("div",{className:"flex items-center justify-between",children:[ie.jsx("div",{className:"text-sm text-gray-700 truncate",children:g.clientIds&&g.clientIds.length>0?`${g.clientIds.length} client${1!==g.clientIds.length?"s":""} selected`:"Select clients..."}),ie.jsx("div",{className:"text-gray-400",children:S?"":""})]})}),S&&ie.jsx("div",{className:"absolute z-30 left-0 right-0 mt-2 bg-white border border-gray-200 rounded-md shadow-md max-h-48 overflow-y-auto",children:0===k.length?ie.jsx("p",{className:"text-gray-500 text-sm p-3",children:"No clients available"}):k.map(e=>ie.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[ie.jsx("input",{type:"checkbox",checked:(g.clientIds||[]).includes(e.id),onChange:t=>{const s=g.clientIds||[],a=t.target.checked?[...s,e.id]:s.filter(t=>t!==e.id);u({...g,clientIds:a,clientId:a[0]||""})},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),ie.jsx("span",{className:"text-sm text-gray-700",children:e.name})]},e.id))})]}),g.clientIds&&g.clientIds.length>0&&ie.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[g.clientIds.length," client",1!==g.clientIds.length?"s":""," selected"]})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Lead Designer ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("select",{className:E(g.leadDesignerId),value:g.leadDesignerId,onChange:e=>u({...g,leadDesignerId:e.target.value}),title:"Select the lead designer for the project",children:[ie.jsx("option",{value:"",children:"Select Designer..."}),I.map(e=>ie.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),ie.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Project Type ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("select",{className:E(g.type),value:g.type||"",onChange:e=>u({...g,type:e.target.value}),title:"Select the project type (Designing or Turnkey)",children:[ie.jsx("option",{value:"",children:"Select Type..."}),ie.jsx("option",{value:Vt.DESIGNING,children:Vt.DESIGNING}),ie.jsx("option",{value:Vt.TURNKEY,children:Vt.TURNKEY})]})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Category ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsxs("select",{className:E(g.category),value:g.category||"",onChange:e=>u({...g,category:e.target.value}),title:"Select the project category (Commercial or Residential)",children:[ie.jsx("option",{value:"",children:"Select Category..."}),ie.jsx("option",{value:Ut.COMMERCIAL,children:Ut.COMMERCIAL}),ie.jsx("option",{value:Ut.RESIDENTIAL,children:Ut.RESIDENTIAL})]})]})]}),ie.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[ie.jsx(Ne,{className:"w-3 h-3 text-gray-400"})," Start Date ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"date",className:E(g.startDate),value:g.startDate||"",onChange:e=>A("startDate",e.target.value),title:"Select the project start date"})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[ie.jsx(Ne,{className:"w-3 h-3 text-gray-400"})," Deadline ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"date",className:E(g.deadline),value:g.deadline||"",onChange:e=>A("deadline",e.target.value),title:"Select the project deadline date"})]}),ie.jsxs("div",{children:[ie.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[ie.jsx(_e,{className:"w-3 h-3 text-gray-400"})," Budget ",ie.jsx("span",{className:"text-red-500",children:"*"})]}),ie.jsx("input",{type:"number",className:E(g.budget),placeholder:"0.00",value:g.budget||"",onChange:e=>u({...g,budget:Number(e.target.value)}),title:"Enter the total project budget"})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Cover Image (Optional)"}),ie.jsxs("div",{className:"flex gap-2 items-start",children:[ie.jsx("div",{className:"flex-1",children:ie.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-2 text-center cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>N.current?.click(),children:[y?ie.jsxs("div",{className:"flex items-center justify-center gap-1",children:[ie.jsx(We,{className:"w-3 h-3 text-blue-500"}),ie.jsx("span",{className:"text-base md:text-sm text-gray-700 truncate",children:y.name})]}):ie.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[ie.jsx(We,{className:"w-4 h-4 text-gray-300"}),ie.jsx("p",{className:"text-base md:text-sm text-gray-500",children:"Upload image"})]}),ie.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];t&&f(t)},className:"hidden",title:"Upload cover image"})]})}),y&&ie.jsx("div",{className:"w-16 h-16 rounded-lg border border-gray-200 overflow-hidden bg-gray-50 flex-shrink-0",children:ie.jsx("img",{src:URL.createObjectURL(y),alt:"Cover preview",className:"w-full h-full object-cover"})})]})]}),ie.jsxs("div",{children:[ie.jsxs("div",{className:"flex items-center justify-between mb-1",children:[ie.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Attached Documents (Optional)"}),v.length>0&&ie.jsxs("span",{className:"text-base md:text-sm text-gray-500",children:[v.length," file(s)"]})]}),ie.jsxs("div",{className:"space-y-1",children:[ie.jsxs("button",{type:"button",onClick:()=>w.current?.click(),className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-2 text-center cursor-pointer hover:bg-gray-50 transition-colors flex items-center justify-center gap-1",children:[ie.jsx(St,{className:"w-3 h-3 text-gray-500"}),ie.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Add documents"})]}),ie.jsx("input",{ref:w,type:"file",multiple:!0,onChange:e=>{const t=e.target.files;if(t){const e=Array.from(t).map(e=>({file:e,name:e.name}));j([...v,...e])}},className:"hidden",title:"Upload documents"}),v.length>0&&ie.jsx("div",{className:"space-y-0.5 max-h-24 overflow-y-auto bg-gray-50 p-1 rounded border border-gray-200",children:v.map((e,t)=>ie.jsxs("div",{className:"flex items-center justify-between bg-white p-1 rounded border border-gray-200 text-base md:text-sm",children:[ie.jsx("span",{className:"text-gray-700 truncate flex-1",children:e.name}),ie.jsx("button",{type:"button",onClick:()=>j(v.filter((e,s)=>s!==t)),className:"text-red-500 hover:text-red-700 transition-colors ml-1",title:"Remove document",children:ie.jsx(kt,{className:"w-2.5 h-2.5"})})]},t))})]})]}),ie.jsxs("div",{className:"pt-2 border-t border-gray-100 flex justify-end gap-2",children:[ie.jsx("button",{type:"button",onClick:t,disabled:c,className:"px-4 py-1.5 rounded-lg text-base md:text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors disabled:opacity-50",children:"Cancel"}),ie.jsx("button",{type:"submit",disabled:c,className:"px-6 py-1.5 rounded-lg text-base md:text-sm font-bold text-white bg-gray-900 hover:bg-gray-800 shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:c?ie.jsxs(ie.Fragment,{children:[ie.jsx(Ze,{className:"w-3 h-3 animate-spin"}),p?"Updating...":"Saving..."]}):p?"Update Project":"Launch Project"})]})]})]})})},un=()=>{const[e,t]=a.useState([]),[s,r]=a.useState("");a.useEffect(()=>{n()},[]);const n=()=>{const e=(()=>{try{const e=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");return Object.values(e)}catch(Cn){return[]}})(),s=Ra();t(e),r(s)},i=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/864e5);if(0===a){const e=Math.floor(s/36e5);if(0===e){const e=Math.floor(s/6e4);return`${e} minute${e>1?"s":""} ago`}return`${e} hour${e>1?"s":""} ago`}return 1===a?"Yesterday":a<7?`${a} days ago`:t.toLocaleDateString("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return ie.jsxs("div",{className:"space-y-4",children:[ie.jsxs("div",{children:[ie.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[ie.jsx(ft,{className:"w-5 h-5"}),"Remembered Devices (",e.length,")"]}),ie.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Manage devices that have been remembered for automatic login"})]}),0===e.length?ie.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[ie.jsx(ft,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),ie.jsx("p",{className:"text-gray-600",children:"No remembered devices"}),ie.jsx("p",{className:"text-sm text-gray-500",children:'Next time you log in, check "Remember this device"'})]}):ie.jsx("div",{className:"space-y-3",children:e.map(a=>{const r=a.id===s;return ie.jsxs("div",{className:"border rounded-lg p-4 flex items-center justify-between "+(r?"bg-blue-50 border-blue-200":"bg-white border-gray-200 hover:border-gray-300"),children:[ie.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[ie.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center "+(r?"bg-blue-100":"bg-gray-100"),children:ie.jsx(ft,{className:"w-5 h-5 "+(r?"text-blue-600":"text-gray-600")})}),ie.jsxs("div",{className:"flex-1",children:[ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("p",{className:"font-semibold text-gray-900",children:a.name}),r&&ie.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs font-semibold px-2 py-1 rounded",children:"This Device"})]}),ie.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[ie.jsx($e,{className:"w-3 h-3"}),ie.jsxs("span",{children:["Last login: ",i(a.lastLogin)]})]}),ie.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Added: ",i(a.createdAt)]})]})]}),ie.jsx("button",{onClick:()=>{return(e=>{try{const t=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");delete t[e],localStorage.setItem("rememberedDevices",JSON.stringify(t))}catch(Cn){}})(s=a.id),void t(e.filter(e=>e.id!==s));var s},className:"ml-4 p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Forget this device"+(r?" (will require login next time)":""),children:ie.jsx(kt,{className:"w-4 h-4"})})]},a.id)})}),ie.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 text-sm text-amber-900",children:[ie.jsxs("p",{className:"font-semibold mb-1",children:[ie.jsx(Ge,{className:"w-4 h-4 inline-block mr-2"})," About Device Memory"]}),ie.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[ie.jsx("li",{children:"Devices are remembered for 30 days of inactivity"}),ie.jsx("li",{children:"Each login extends the 30-day period"}),ie.jsx("li",{children:"Forgetting a device requires manual login next time"}),ie.jsx("li",{children:"Device fingerprints are stored locally in your browser"})]})]})]})},hn=()=>{const{extendSession:e}=Ka(),[t,s]=a.useState(!1),[r,n]=a.useState("");return a.useEffect(()=>{const e=()=>{(()=>{const e=_a();if(!e)return!1;const t=new Date(e.loginTime);return(new Date).getTime()-t.getTime()>=828e5})()&&(s(!0),n((()=>{const e=(()=>{const e=_a();if(!e)return 0;const t=new Date(e.expiresAt),s=new Date,a=t.getTime()-s.getTime();return Math.max(0,a)})();if(e<=0)return"Session expired";const t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4);return t>0?`${t}h ${s}m remaining`:`${s}m remaining`})()))};e();const t=setInterval(e,6e4);return()=>clearInterval(t)},[]),t?ie.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in",children:ie.jsx("div",{className:"bg-amber-50 border border-amber-300 rounded-lg shadow-lg p-4 max-w-sm",children:ie.jsxs("div",{className:"flex gap-3",children:[ie.jsx(Se,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),ie.jsxs("div",{className:"flex-1",children:[ie.jsx("h3",{className:"font-semibold text-amber-900 mb-1",children:"Session Expiring Soon"}),ie.jsxs("p",{className:"text-sm text-amber-800 mb-3 flex items-center gap-1",children:[ie.jsx($e,{className:"w-3 h-3"}),r]}),ie.jsxs("div",{className:"flex gap-2",children:[ie.jsx("button",{onClick:()=>{e(),s(!1)},className:"flex-1 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium py-2 rounded transition-colors",children:"Extend Session"}),ie.jsx("button",{onClick:()=>s(!1),className:"px-3 py-2 text-amber-700 hover:bg-amber-100 rounded transition-colors",title:"Dismiss warning",children:ie.jsx(Et,{className:"w-4 h-4"})})]}),ie.jsx("p",{className:"text-xs text-amber-700 mt-2",children:"After expiry, you'll need to log in again."})]})]})})}):null},bn=({isOpen:e,onClose:t})=>{const{user:s,currentTenant:a,availableTenants:n,switchTenant:i}=Ka(),{addNotification:l}=Xa(),[o,d]=r.useState(!1);return!e||!s||n.length<=1?null:ie.jsx(ie.Fragment,{children:e&&ie.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] transition-opacity",onClick:t,children:ie.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-96 max-w-full",onClick:e=>e.stopPropagation(),children:[ie.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[ie.jsx(je,{className:"w-5 h-5 text-blue-600"}),ie.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Switch Firm"})]}),ie.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:n.map(e=>ie.jsx("button",{onClick:()=>(async e=>{if(a?.id!==e)try{d(!0),await i(e),l("Success","Firm switched successfully","success"),setTimeout(()=>{window.location.reload()},800)}catch(Cn){l("Error","Failed to switch firm","error"),d(!1)}else t()})(e.id),disabled:o,className:`w-full text-left px-4 py-3 rounded-lg transition-all ${a?.id===e.id?"bg-blue-100 text-blue-900 border-2 border-blue-500":"bg-gray-100 text-gray-900 hover:bg-gray-200 border-2 border-transparent"} disabled:opacity-50 disabled:cursor-not-allowed`,children:ie.jsxs("div",{className:"flex items-center justify-between",children:[ie.jsx("span",{className:"font-medium",children:e.name}),a?.id===e.id&&ie.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-1 rounded",children:"Active"})]})},e.id))}),ie.jsx("button",{onClick:t,disabled:o,className:"w-full mt-4 px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50",children:"Close"})]})})})},yn=({isOpen:e,onClose:t})=>{const{currentTenant:s,availableTenants:a}=Ka(),[n,i]=r.useState(!1);return e?ie.jsxs(ie.Fragment,{children:[ie.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[900] p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[ie.jsx("div",{className:"p-6 border-b border-gray-200",children:ie.jsxs("div",{className:"flex items-center justify-between",children:[ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx(je,{className:"w-6 h-6 text-blue-600"}),ie.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Firm Settings"})]}),ie.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-xl font-bold",children:""})]})}),ie.jsxs("div",{className:"p-6 space-y-6",children:[ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Current Firm"}),ie.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-10 h-10 bg-blue-600 text-white rounded-lg flex items-center justify-center",children:ie.jsx(je,{className:"w-5 h-5"})}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-600",children:"Active Firm"}),ie.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s?.name||"Loading..."})]})]})})]}),a&&a.length>0&&ie.jsxs("div",{children:[ie.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:["Your Firms (",a.length,")"]}),ie.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.map(e=>ie.jsx("div",{className:"p-3 rounded-lg border-2 transition-all "+(s?.id===e.id?"bg-blue-50 border-blue-300":"bg-gray-50 border-gray-200 hover:border-gray-300"),children:ie.jsxs("div",{className:"flex items-center justify-between",children:[ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center "+(s?.id===e.id?"bg-blue-600 text-white":"bg-gray-300 text-gray-700"),children:ie.jsx(je,{className:"w-4 h-4"})}),ie.jsx("span",{className:"font-medium text-gray-900",children:e.name})]}),s?.id===e.id&&ie.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full font-semibold",children:"Active"})]})},e.id))})]}),a&&a.length>1&&ie.jsx("button",{onClick:()=>i(!0),className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Switch Firm"}),ie.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2.5 rounded-xl transition-all",children:"Close"})]})]})}),ie.jsx(bn,{isOpen:n,onClose:()=>i(!1)})]}):null},fn=()=>{const{user:e,currentTenant:t,availableTenants:s}=Ka(),[r,n]=a.useState({brandName:"Kydo Solutions",logoUrl:"/kydoicon.png",isLoading:!0});return a.useEffect(()=>{(async()=>{n(e=>({...e,isLoading:!0}));try{const a="Admin"===e?.role&&s.length>1&&t?.id?t.id:e?.tenantId,r=await(async e=>{const t={brandName:"Kydo Solutions",logoUrl:"/kydoicon.png"};if(!e)return t;try{const s=await Ba(e);return s?{brandName:s.brandName||t.brandName,logoUrl:s.logoUrl||t.logoUrl}:t}catch(Cn){return t}})(a);n({brandName:r.brandName,logoUrl:r.logoUrl,isLoading:!1})}catch(Cn){n({brandName:"Kydo Solutions",logoUrl:"/kydoicon.png",isLoading:!1})}})()},[e?.tenantId,t?.id,s.length]),r},vn=({isOpen:e,onClose:t})=>{const{user:s}=Ka(),{addNotification:r}=Xa(),{brandName:n,logoUrl:i}=fn(),[l,o]=a.useState(""),[d,c]=a.useState(null),[m,p]=a.useState(""),[x,g]=a.useState(!1),[u,h]=a.useState(!1);return a.useEffect(()=>{e&&(o("Kydo Solutions"===n?"":n),p("/kydoicon.png"===i?"":i),c(null),h(!1))},[e,n,i]),e?ie.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[999] p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[ie.jsx("div",{className:"p-6 border-b border-gray-200",children:ie.jsxs("div",{className:"flex items-center justify-between",children:[ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx(je,{className:"w-6 h-6 text-blue-600"}),ie.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Branding Settings"})]}),ie.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-xl font-bold",children:""})]})}),ie.jsxs("div",{className:"p-6 space-y-6",children:[ie.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[ie.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Branding"}),ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("img",{src:i,alt:n,className:"w-8 h-8 rounded"}),ie.jsx("span",{className:"font-medium text-gray-900",children:n})]})]}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsx("label",{htmlFor:"brandName",className:"text-sm font-medium text-gray-700",children:"Company Brand Name"}),ie.jsx("input",{id:"brandName",placeholder:"Enter your company name (leave empty for Kydo Solutions)",value:l,onChange:e=>{o(e.target.value),h(!0)},className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"}),ie.jsx("p",{className:"text-xs text-gray-500",children:'This will replace "Kydo Solutions" throughout the application'})]}),ie.jsxs("div",{className:"space-y-2",children:[ie.jsx("label",{htmlFor:"logo",className:"text-sm font-medium text-gray-700",children:"Company Logo"}),ie.jsxs("div",{className:"flex items-center gap-4",children:[ie.jsxs("div",{className:"flex-1",children:[ie.jsx("input",{id:"logo",type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){if(t.size>2097152)return void r("File Size Error","Logo must be less than 2MB","error");if(!t.type.startsWith("image/"))return void r("File Type Error","Please upload an image file","error");c(t);const e=new FileReader;e.onload=()=>p(e.result),e.readAsDataURL(t),h(!0)}},className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all file:mr-4 file:py-1 file:px-3 file:border-0 file:text-sm file:bg-blue-100 file:text-blue-700 file:rounded-lg hover:file:bg-blue-200"}),ie.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG up to 2MB. Square logos work best."})]}),m&&ie.jsx("div",{className:"w-16 h-16 border-2 border-gray-200 rounded-lg overflow-hidden",children:ie.jsx("img",{src:m,alt:"Logo preview",className:"w-full h-full object-cover"})})]})]}),ie.jsxs("div",{className:"flex flex-col gap-3 pt-4 border-t border-gray-200",children:[ie.jsxs("div",{className:"flex gap-3",children:[ie.jsx("button",{onClick:async()=>{if(s?.tenantId){g(!0);try{const a={};if(""!==l.trim()&&l.trim()!==n?a.brandName=l.trim():""===l.trim()&&"Kydo Solutions"!==n&&(a.brandName=void 0),d)try{const e=await(async(e,t)=>{try{const s=e.name.split(".").pop()?.toLowerCase()||"png",a=`tenants/${t}/branding/logo_${Date.now()}.${s}`;return await Zr(e,a)}catch(Cn){throw Cn}})(d,s.tenantId);a.logoUrl=e}catch(e){return r("Upload Error","Failed to upload logo. Please try again.","error"),void g(!1)}Object.keys(a).length>0?(await(async(e,t)=>{try{const{setDoc:s}=await ee(async()=>{const{setDoc:e}=await import("./firebase-CoIuEebr.js").then(e=>e.U);return{setDoc:e}},[]),a=T(ka,"tenants",e),r={};void 0!==t.brandName&&(r.brandName=t.brandName),void 0!==t.logoUrl&&(r.logoUrl=t.logoUrl),await s(a,r,{merge:!0})}catch(Cn){throw Cn}})(s.tenantId,a),r("Success","Branding updated successfully! Please refresh the page to see changes.","success"),h(!1),setTimeout(()=>{t()},1500)):r("No Changes","No changes to save","info")}catch(Cn){r("Error","Failed to update branding. Please try again.","error")}finally{g(!1)}}else r("Error","No tenant ID found","error")},disabled:!u||x,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white font-medium py-2.5 rounded-xl transition-all flex items-center justify-center gap-2",children:x?ie.jsxs(ie.Fragment,{children:[ie.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Saving..."]}):ie.jsxs(ie.Fragment,{children:[ie.jsx(pt,{className:"w-4 h-4"}),"Save Changes"]})}),ie.jsxs("button",{onClick:()=>{o(""),c(null),p(""),h(!0)},disabled:x,className:"px-4 bg-gray-100 hover:bg-gray-200 disabled:bg-gray-300 text-gray-700 font-medium py-2.5 rounded-xl transition-all flex items-center justify-center gap-2",children:[ie.jsx(mt,{className:"w-4 h-4"}),"Reset"]})]}),ie.jsx("button",{onClick:t,disabled:x,className:"w-full bg-gray-200 hover:bg-gray-300 disabled:bg-gray-300 text-gray-700 font-medium py-2.5 rounded-xl transition-all",children:"Cancel"})]})]})]})}):null},jn=()=>{const{brandName:e,isLoading:t}=fn();return a.useEffect(()=>{t||(document.title=e)},[e,t]),null},Nn=({projects:e,onSelect:t,user:s,setEditingProject:r,setIsNewProjectModalOpen:n,onDeleteProject:i,realTimeTasks:l})=>{const[o,d]=a.useState({}),c=e.reduce((e,t)=>{const s=t.category;return e[s]||(e[s]=[]),e[s].push(t),e},{}),m=Object.keys(c).sort((e,t)=>e===Ut.COMMERCIAL?-1:t===Ut.COMMERCIAL?1:0);return ie.jsx("div",{className:"space-y-8 animate-fade-in",children:m.map(e=>ie.jsxs("div",{children:[ie.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[ie.jsx(jt,{className:"w-5 h-5 text-gray-600"}),ie.jsx("h2",{className:"text-lg font-bold text-gray-800",children:e}),ie.jsxs("span",{className:"text-xs font-bold bg-gray-100 text-gray-600 px-2 py-1 rounded-full mobile-increase",children:[c[e].length," projects"]})]}),ie.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c[e].map(e=>{return ie.jsxs("div",{onClick:()=>t(e),className:"group bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-300",children:[ie.jsxs("div",{className:"h-40 overflow-hidden relative bg-gray-100",children:[o[e.id]&&ie.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-100 via-gray-50 to-gray-100 animate-pulse"}),ie.jsx("img",{src:e.thumbnail,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onLoad:()=>d(t=>({...t,[e.id]:!1})),onLoadStart:()=>d(t=>({...t,[e.id]:!0}))}),ie.jsx("div",{className:"absolute top-3 right-3 flex gap-2 items-center",children:ie.jsx("div",{className:"backdrop-blur-md px-3 py-1 rounded text-sm font-bold md:px-2 md:text-xs md:font-bold shadow-sm border border-white/20 "+(a=e.type,a===Vt.DESIGNING?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700"),children:e.type})}),e.activityLog&&e.activityLog.length>0&&(new Date).getTime()-new Date(e.activityLog[0].timestamp).getTime()<864e5&&ie.jsx("div",{className:"absolute bottom-3 right-3 w-3 h-3 bg-blue-500 rounded-full border-2 border-white animate-pulse",title:"New Activity"})]}),ie.jsxs("div",{className:"p-5",children:[ie.jsx("h3",{className:"font-bold text-gray-900 text-lg mb-1 mobile-increase",children:e.name}),ie.jsx("p",{className:"text-base text-gray-600 md:text-sm md:text-gray-500 mb-4 line-clamp-2 mobile-increase",children:e.description}),ie.jsxs("div",{className:"mt-2",children:[ie.jsxs("div",{className:"flex justify-between mb-1",children:[ie.jsx("span",{className:"text-gray-500 text-[10px]",children:"Progress"}),ie.jsxs("span",{className:"text-gray-900 font-bold text-[10px]",children:[Ar(l.get(e.id)||e.tasks),"%"]})]}),ie.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5",children:ie.jsx("div",{style:{width:`${Ar(l.get(e.id)||e.tasks)}%`},className:"bg-gray-900 h-1.5 rounded-full transition-all duration-1000"})})]}),ie.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-4 mt-3",children:[ie.jsx("div",{className:"flex items-center gap-2",children:s?.role===Ft.ADMIN&&ie.jsxs(ie.Fragment,{children:[ie.jsx("button",{onClick:t=>{t.stopPropagation(),r(e),n(!0)},className:"p-2 rounded text-xs font-bold shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors",title:"Edit project",children:ie.jsx(vt,{className:"w-4 h-4 text-gray-900"})}),ie.jsx("button",{onClick:t=>{t.stopPropagation(),window.confirm(`Are you sure you want to delete project "${e.name}"? This action cannot be undone.`)&&i(e)},className:"p-2 rounded text-xs font-bold shadow-sm border border-gray-200 hover:bg-red-50 transition-colors",title:"Delete project",children:ie.jsx(kt,{className:"w-4 h-4 text-red-600"})})]})}),ie.jsxs("span",{className:"text-sm font-medium text-gray-600 md:text-xs md:text-gray-400 mobile-increase",children:["Due ",Tr(e.deadline)]})]})]})]},e.id);var a})})]},e))})};function wn(){const[e,t]=a.useState([]),[s,r]=a.useState([]);return ie.jsx(qa,{children:ie.jsx(Za,{projects:e,children:ie.jsx(er,{children:ie.jsx(kn,{projects:e,setProjects:t,users:s,setUsers:r})})})})}function kn({projects:e,setProjects:t,users:s,setUsers:r}){const{user:n,logout:i,loading:l,currentTenant:o,availableTenants:d}=Ka(),{unreadCount:c,addNotification:m,setDeepLinkHandler:p}=Xa(),{brandName:x,logoUrl:u}=fn(),[h,b]=a.useState(()=>n&&n.role===Ft.CLIENT?"projects":"dashboard"),[y,f]=a.useState(null),[v,j]=a.useState(null),[N,w]=a.useState(!1),[k,I]=a.useState(void 0),[S,$]=a.useState(null),[T,P]=a.useState(!1),[M,O]=a.useState(!1),[B,R]=a.useState(!1),[L,F]=a.useState(!1),[z,V]=a.useState(null),[U,W]=a.useState(!1),[_,G]=a.useState(!1),[H,q]=a.useState(!0),[K,Y]=a.useState(new Map),[J,Z]=a.useState(!1),[X,Q]=a.useState(null),[ee,te]=a.useState(""),[se,ae]=a.useState("All"),[re,ne]=a.useState("recent-desc");if(a.useEffect(()=>{o?.id&&Q(o.id)},[o?.id]),a.useEffect(()=>{p(t=>{Ya(t,{setCurrentView:b,setSelectedProject:f,setSelectedTask:j,setInitialProjectTab:I,projects:e,tasks:K})})},[e,K,p]),a.useEffect(()=>{n&&((async()=>{if(pr.isNativePlatform())await Ir(n.id);else if("Notification"in window){const e=Notification.permission;"default"===e?Z(!0):"granted"===e&&await Ir(n.id)}})(),(e=>new Promise(t=>{var s;pr.isNativePlatform()?kr.addListener("pushNotificationReceived",s=>{if(e){const t=s.data?.deepLinkPath||"/";e({title:s.title||"New Notification",message:s.body||"",type:"info",projectId:s.data?.projectId,taskId:s.data?.taskId,meetingId:s.data?.meetingId,targetTab:s.data?.targetTab,deepLinkPath:t})}t(s)}):Ca?(s=s=>{const a=s.data?.deepLinkPath||s.fcmOptions?.link||"/",r=s.data?.projectId,n=s.data?.taskId,i=s.data?.meetingId,l=s.data?.targetTab;if("granted"===Notification.permission){const e=s.notification?.title||"New Notification",t={body:s.notification?.body||"",icon:s.notification?.icon||"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png",tag:"notification-"+Date.now(),requireInteraction:!1,data:{url:a,deepLinkPath:a,projectId:r,taskId:n,meetingId:i,targetTab:l}},o=new Notification(e,t);o.onclick=e=>{e.preventDefault(),window.focus(),"/"!==a&&(window.location.href=a),o.close()}}e&&e({title:s.notification?.title||"New Notification",message:s.notification?.body||"",type:"info",projectId:r,taskId:n,meetingId:i,targetTab:l,deepLinkPath:a}),t(s)},function(e,t){if(!navigator)throw oa.create("only-available-in-window");e.onMessageHandler=t}(g(Ca),s)):t(null)}))(e=>{m({title:e.title,message:e.message||e.body,type:"info",projectId:e.projectId,taskId:e.taskId,meetingId:e.meetingId,targetTab:e.targetTab,deepLinkPath:e.deepLinkPath})}).catch(e=>{}))},[n,m]),a.useEffect(()=>{try{if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search),t=e.get("projectId")||e.get("project")||void 0,s=e.get("taskId")||e.get("task")||void 0,a=e.get("meetingId")||void 0,r=e.get("tab")||void 0,n=e.get("open")||void 0;(t||s||a||r||n)&&$({projectId:t,taskId:s,meetingId:a,tab:r,open:n})}}catch(c){}if(!n)return;q(!1);const e=n.role===Ft.ADMIN&&d.length>1&&X?X:n.tenantId;let s;s=((s,a)=>{let r=D(Aa);return a&&(r=D(Aa,A("tenantId","==",a))),E(r,s=>{const a=s.docs.map(e=>({...e.data(),id:e.id}));t(a||[]),n.role!==Ft.VENDOR&&Da(e).catch(e=>{})},e=>{e.code})})(0,e);const a=((e,t)=>{let s=[],a=[],n=D(Pa);t&&(n=D(Pa,A("tenantId","==",t)));const i=E(n,e=>{const t=e.docs.map(e=>({...e.data(),id:e.id}));s=t,r(s||[])},e=>{});return a.push(i),()=>{a.forEach(e=>e())}})(0,e),i=((e,t)=>{let s=D(C(ka,"designers"));return t&&(s=D(C(ka,"designers"),A("tenantId","==",t))),E(s,e=>{(e=>{r(t=>{const s=new Set(e.map(e=>e.id));return[...t.filter(e=>!s.has(e.id)),...e]})})(e.docs.map(e=>({...e.data(),id:e.id})))},e=>{e.code})})(0,e),l=((e,t)=>{let s=D(C(ka,"vendors"));return t&&(s=D(C(ka,"vendors"),A("tenantId","==",t))),E(s,e=>{(e=>{r(t=>{const s=new Set(e.map(e=>e.id));return[...t.filter(e=>!s.has(e.id)),...e]})})(e.docs.map(e=>({...e.data(),id:e.id})))},e=>{e.code})})(0,e),o=((e,t)=>{let s=D(C(ka,"clients"));return t&&(s=D(C(ka,"clients"),A("tenantId","==",t))),E(s,e=>{(e=>{r(t=>{const s=new Set(e.map(e=>e.id));return[...t.filter(e=>!s.has(e.id)),...e]})})(e.docs.map(e=>({...e.data(),id:e.id})))},e=>{e.code})})(0,e);return()=>{s(),a(),i(),l(),o()}},[n,t,r,X]),a.useEffect(()=>{if(!S)return;const{projectId:t,taskId:s,meetingId:a,tab:r}=S;if(!t)return;const n=e.find(e=>e.id===t);if(n){if(f(n),I(r||void 0),s){const e=(K.get(t)||n.tasks||[]).find(e=>e.id===s)||null;e&&(j(e),w(!0))}a&&!s&&I("meetings"),$(null);try{window.history.replaceState({},document.title,window.location.pathname)}catch(i){}}},[e,K,S]),a.useEffect(()=>{if(0===e.length)return;const t=[];return e.forEach(e=>{const s=rr(e.id,t=>{Y(s=>new Map(s).set(e.id,t))});t.push(s)}),()=>{t.forEach(e=>e())}},[e]),a.useEffect(()=>{if(n){try{"admins"===(S||{}).open?b("admins"):b(n.role===Ft.CLIENT?"projects":"dashboard")}catch(e){b(n.role===Ft.CLIENT?"projects":"dashboard")}f(null)}},[n]),a.useEffect(()=>{if(y){const t=e.find(e=>e.id===y.id);t&&JSON.stringify(t)!==JSON.stringify(y)&&f(t)}},[e,y]),!n)return ie.jsx(pn,{users:s});const le=n.role===Ft.ADMIN||n.role===Ft.DESIGNER,oe=n.role===Ft.ADMIN,de=n.role===Ft.ADMIN||n.role===Ft.DESIGNER,ce=n.role===Ft.ADMIN||n.role===Ft.VENDOR,me=e=>{r(t=>[...t,e])},pe=e.filter(e=>n.role===Ft.ADMIN||(n.role===Ft.DESIGNER?e.leadDesignerId===n.id||(e.teamMembers||[]).includes(n.id):n.role===Ft.CLIENT?e.clientId===n.id||(e.clientIds||[]).includes(n.id):n.role===Ft.VENDOR&&((K.get(e.id)||[]).some(e=>e.assigneeId===n.id)||(e.vendorIds||[]).includes(n.id)||(e.teamMembers||[]).includes(n.id)))),xe=({view:e,icon:t,label:s})=>ie.jsxs("button",{onClick:()=>{b(e),f(null),j(null),w(!1),P(!1)},className:`w-full flex items-center gap-1 px-4 py-3 rounded-lg transition-colors mb-1 ${M?"justify-center":""}\n        ${h!==e||y?"text-gray-500 hover:bg-gray-100 hover:text-gray-900":"bg-gray-900 text-white shadow-lg"}`,title:M?s:"",children:[ie.jsx(t,{className:"w-5 h-5 flex-shrink-0"}),!M&&ie.jsx("span",{className:"font-medium",children:s})]});return ie.jsxs("div",{className:"flex h-screen bg-gray-50 overflow-hidden",children:[ie.jsx(ln,{}),ie.jsx(hn,{}),ie.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),T&&ie.jsx("div",{className:"fixed inset-0 bg-black/50 z-20 md:hidden",onClick:()=>P(!1)}),ie.jsx("aside",{className:`\n        fixed inset-y-0 left-0 z-30 bg-white transform transition-all duration-300 ease-in-out md:relative md:translate-x-0 md:border-r md:border-gray-200\n        ${T?"translate-x-0":"-translate-x-full"} md:translate-x-0\n        ${M?"md:w-20":"md:w-64 w-64"}\n      `,children:ie.jsxs("div",{className:"h-full flex flex-col relative",children:[ie.jsxs("div",{className:"p-6 flex items-center justify-between pt-[calc(0.5rem+env(safe-area-inset-top))]",children:[!M&&ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-12 h-12 rounded-lg"}),ie.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Kydo Solutions"})]}),M&&ie.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-12 h-12 rounded-lg"}),ie.jsx("button",{className:"md:hidden",onClick:()=>P(!1),title:"Close sidebar",children:ie.jsx(Et,{className:"w-5 h-5 text-gray-500"})})]}),ie.jsx("button",{onClick:()=>O(!M),className:"hidden md:flex absolute -right-3 top-6 w-7 h-7 bg-white text-gray-900 rounded-full items-center justify-center hover:bg-gray-100 transition-colors shadow-md border border-gray-200 z-40",title:M?"Expand sidebar":"Collapse sidebar","aria-label":"Toggle sidebar",children:ie.jsxs("span",{className:"relative w-4 h-4 block",children:[ie.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out\n                  ${M?"-translate-x-1/2":"rotate-45 -translate-x-1/2 -translate-y-1/2"}\n                `,style:{transform:M?"translate(-50%, -5px) rotate(0deg)":"translate(-50%, -50%) rotate(45deg)"}}),ie.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out\n                  ${M?"-translate-x-1/2 translate-y-1/2":"-rotate-45 -translate-x-1/2 -translate-y-1/2"}\n                `,style:{transform:M?"translate(-50%, 5px) rotate(0deg)":"translate(-50%, -50%) rotate(-45deg)"}}),ie.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out\n                  ${M?"-translate-x-1/2 -translate-y-1/2":"opacity-0"}\n                `,style:{opacity:M?1:0,transform:M?"translate(-50%, 0) scaleX(1)":"translate(-50%, -50%) scaleX(0)"}})]})}),ie.jsxs("div",{className:"px-4 flex-1 overflow-y-auto",children:[ie.jsxs("div",{className:"mb-6",children:[!M&&ie.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Main"}),n.role!==Ft.CLIENT&&ie.jsx(xe,{view:"dashboard",icon:qe,label:"Dashboard"}),ie.jsx(xe,{view:"projects",icon:ze,label:"Projects"})]}),(le||oe||de||ce)&&ie.jsxs("div",{className:"mb-6",children:[!M&&ie.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"People"}),le&&ie.jsx(xe,{view:"clients",icon:Lt,label:"Clients"}),oe&&ie.jsx(xe,{view:"designers",icon:Dt,label:"Team"}),de&&ie.jsx(xe,{view:"vendors",icon:yt,label:"Vendors"}),ce&&ie.jsx(xe,{view:"admins",icon:bt,label:"Admins"})]}),ie.jsxs("div",{className:"mb-6",children:[!M&&ie.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Account"}),ie.jsx(xe,{view:"settings",icon:gt,label:"Settings"})]})]}),ie.jsx("div",{className:"p-4 border-t border-gray-200",children:ie.jsxs("button",{onClick:async()=>{try{await i()}catch(Cn){}},className:"w-full flex items-center gap-3 px-4 py-3 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:M?"Sign Out":"",children:[ie.jsx(Qe,{className:"w-5 h-5 flex-shrink-0"}),!M&&ie.jsx("span",{className:"font-medium",children:"Sign Out"})]})})]})}),ie.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden relative",children:[ie.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full flex-shrink-0"}),J&&ie.jsxs("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-3 flex items-center justify-between gap-4",children:[ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx(fe,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),ie.jsx("p",{className:"text-sm text-blue-900",children:"Enable push notifications to stay updated on project activities"})]}),ie.jsxs("div",{className:"flex items-center gap-2",children:[ie.jsx("button",{onClick:async()=>{n&&await Ir(n.id)&&(Z(!1),pr.isNativePlatform()||"granted"!==Notification.permission?pr.isNativePlatform()&&m({title:"Notifications Enabled! ",message:"You will now receive push notifications for project updates",type:"success"}):new Notification("Notifications Enabled! ",{body:"You will now receive push notifications for project updates",icon:"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png"}))},className:"bg-blue-600 text-white px-4 py-1.5 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:"Enable"}),ie.jsx("button",{onClick:()=>Z(!1),"aria-label":"Dismiss notification banner",title:"Dismiss notification banner",className:"text-blue-600 px-2 py-1.5 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors",children:ie.jsx(Et,{className:"w-4 h-4"})})]})]}),ie.jsxs("header",{className:"h-14 sm:h-20 bg-white border-b border-gray-200 flex items-center justify-between px-3 sm:px-6 relative z-10",children:[ie.jsx("div",{className:"flex items-center gap-4",children:ie.jsx("button",{onClick:()=>P(!0),className:"md:hidden p-2 text-gray-500 hover:bg-gray-100 rounded-lg",title:"Toggle sidebar menu",children:ie.jsx(tt,{className:"w-6 h-6"})})}),ie.jsxs("div",{className:"flex items-center gap-4",children:[ie.jsxs("div",{className:"relative",children:[ie.jsxs("button",{onClick:()=>R(!B),className:"relative p-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",title:"Toggle notifications",children:[ie.jsx(fe,{className:"w-5 h-5"}),c>0&&ie.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white animate-pulse"})]}),ie.jsx(xn,{isOpen:B,onClose:()=>R(!1),projects:e,onDeepLink:t=>{Ya(t,{setCurrentView:b,setSelectedProject:f,setSelectedTask:j,setInitialProjectTab:I,projects:e,tasks:K}),R(!1)}})]}),ie.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-gray-200",children:[ie.jsxs("div",{className:"text-right hidden sm:block",children:[ie.jsx("p",{className:"text-sm font-semibold text-gray-900",children:n.name}),ie.jsx("p",{className:"text-xs text-gray-500 capitalize",children:n.role})]}),ie.jsx(Cr,{avatar:n.avatar,name:n.name,size:"sm",role:String(n.role).toLowerCase()})]})]})]}),ie.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 relative z-0",onClick:()=>B&&R(!1),children:ie.jsxs("div",{className:"px-4 sm:px-6 py-2 sm:py-4 pb-12 sm:pb-16 h-full flex flex-col",children:[H&&ie.jsx("div",{className:"flex items-center justify-center h-full",children:ie.jsxs("div",{className:"text-center",children:[ie.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-gray-200 border-t-gray-900 animate-spin mx-auto mb-4"}),ie.jsx("p",{className:"text-gray-500 font-medium",children:"Loading data from Firebase..."})]})}),!H&&ie.jsx(ie.Fragment,{children:y?ie.jsx(an,{project:y,users:s,onUpdateProject:e=>{t(t=>t.map(t=>t.id===e.id?e:t)),f(e);const{id:s,...a}=e;$a(e.id,a).catch(e=>{}),Da(n.tenantId).catch(e=>{})},onBack:()=>{f(null),j(null),w(!1),I(void 0)},initialTask:v||void 0,initialTab:k,onCloseTask:()=>{N&&(f(null),j(null),w(!1))}}):ie.jsxs(ie.Fragment,{children:["dashboard"===h&&ie.jsx(Kr,{projects:e,users:s,onSelectProject:(e,t)=>{f(e),j(null),w(!1),I(t?.initialTab)},onSelectTask:(e,t)=>{f(t),j(e),w(!0)}}),"projects"===h&&ie.jsxs("div",{className:"space-y-6 pb-12",children:[ie.jsxs("div",{className:"flex justify-between items-center",children:[ie.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Projects"}),n.role===Ft.ADMIN&&ie.jsxs("button",{onClick:()=>{V(null),F(!0)},className:"bg-gray-900 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-800 transition-colors shadow-sm flex items-center gap-2",children:[ie.jsx(rt,{className:"w-4 h-4"})," New Project"]})]}),ie.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:[ie.jsxs("div",{className:"hidden md:flex md:items-end gap-3",children:[ie.jsxs("div",{className:"flex-1 min-w-[180px]",children:[ie.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Search by Name"}),ie.jsx("input",{type:"text",placeholder:"Search projects...",value:ee,onChange:e=>te(e.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white"})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Category"}),ie.jsxs("select",{"aria-label":"Filter by category",value:se,onChange:e=>ae(e.target.value),className:"px-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white hover:bg-gray-50 cursor-pointer font-medium text-gray-700 appearance-none",style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 8l3 3 3-3" stroke="%23333" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg>\')',backgroundPosition:"right 0.5rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.25rem 1.25rem",paddingRight:"1.75rem"},children:[ie.jsx("option",{value:"All",children:"All Categories"}),ie.jsx("option",{value:Ut.RESIDENTIAL,children:"Residential"}),ie.jsx("option",{value:Ut.COMMERCIAL,children:"Commercial"})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Sort By"}),ie.jsxs("select",{"aria-label":"Sort projects",value:re,onChange:e=>ne(e.target.value),className:"px-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white hover:bg-gray-50 cursor-pointer font-medium text-gray-700 appearance-none",style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 8l3 3 3-3" stroke="%23333" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg>\')',backgroundPosition:"right 0.5rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.25rem 1.25rem",paddingRight:"1.75rem"},children:[ie.jsx("option",{value:"recent-desc",children:"Recent (Newest First)"}),ie.jsx("option",{value:"recent-asc",children:"Recent (Oldest First)"}),ie.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),ie.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),ie.jsx("option",{value:"progress-asc",children:"Progress (Low to High)"}),ie.jsx("option",{value:"progress-desc",children:"Progress (High to Low)"})]})]}),(ee||"All"!==se)&&ie.jsx("button",{type:"button","aria-label":"Clear all filters",title:"Clear all filters",onClick:()=>{te(""),ae("All")},className:"px-2 py-1.5 bg-gray-200 hover:bg-gray-300 rounded text-xs font-medium transition-colors whitespace-nowrap",children:"Clear"})]}),ie.jsxs("div",{className:"md:hidden space-y-3",children:[ie.jsx("div",{className:"flex items-end",children:ie.jsxs("div",{className:"flex-1 min-w-[180px]",children:[ie.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Search by Name"}),ie.jsx("input",{type:"text",placeholder:"Search projects...",value:ee,onChange:e=>te(e.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white"})]})}),ie.jsxs("div",{className:"flex items-end gap-3 flex-wrap",children:[ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Category"}),ie.jsxs("select",{"aria-label":"Filter by category",value:se,onChange:e=>ae(e.target.value),className:"px-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white hover:bg-gray-50 cursor-pointer font-medium text-gray-700 appearance-none",style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 8l3 3 3-3" stroke="%23333" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg>\')',backgroundPosition:"right 0.5rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.25rem 1.25rem",paddingRight:"1.75rem"},children:[ie.jsx("option",{value:"All",children:"All Categories"}),ie.jsx("option",{value:Ut.RESIDENTIAL,children:"Residential"}),ie.jsx("option",{value:Ut.COMMERCIAL,children:"Commercial"})]})]}),ie.jsxs("div",{children:[ie.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Sort By"}),ie.jsxs("select",{"aria-label":"Sort projects",value:re,onChange:e=>ne(e.target.value),className:"px-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white hover:bg-gray-50 cursor-pointer font-medium text-gray-700 appearance-none",style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 8l3 3 3-3" stroke="%23333" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg>\')',backgroundPosition:"right 0.5rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.25rem 1.25rem",paddingRight:"1.75rem"},children:[ie.jsx("option",{value:"recent-desc",children:"Recent (Newest First)"}),ie.jsx("option",{value:"recent-asc",children:"Recent (Oldest First)"}),ie.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),ie.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),ie.jsx("option",{value:"progress-asc",children:"Progress (Low to High)"}),ie.jsx("option",{value:"progress-desc",children:"Progress (High to Low)"})]})]}),(ee||"All"!==se)&&ie.jsx("button",{type:"button","aria-label":"Clear all filters",title:"Clear all filters",onClick:()=>{te(""),ae("All")},className:"px-2 py-1.5 bg-gray-200 hover:bg-gray-300 rounded text-xs font-medium transition-colors whitespace-nowrap",children:"Clear"})]})]})]}),pe.length>0?ie.jsx(Nn,{projects:pe.filter(e=>!(ee.trim()&&!e.name.toLowerCase().includes(ee.toLowerCase())||"All"!==se&&e.category!==se)).sort((e,t)=>{switch(re){case"name-asc":return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"progress-asc":return Ar(K.get(e.id)||[])-Ar(K.get(t.id)||[]);case"progress-desc":{const s=Ar(K.get(e.id)||[]);return Ar(K.get(t.id)||[])-s}case"recent-asc":{const s=new Date("string"==typeof e.createdAt?e.createdAt:e.createdAt?.toDate?.()||new Date),a=new Date("string"==typeof t.createdAt?t.createdAt:t.createdAt?.toDate?.()||new Date);return s.getTime()-a.getTime()}case"recent-desc":{const s=new Date("string"==typeof e.createdAt?e.createdAt:e.createdAt?.toDate?.()||new Date);return new Date("string"==typeof t.createdAt?t.createdAt:t.createdAt?.toDate?.()||new Date).getTime()-s.getTime()}default:return 0}}),onSelect:e=>{f(e),j(null),w(!1),I(void 0)},user:n,setEditingProject:V,setIsNewProjectModalOpen:F,onDeleteProject:async e=>{try{await Ta(e.id),m("Success",`Project "${e.name}" deleted successfully`,"success")}catch(Cn){m("Error",`Failed to delete project: ${Cn.message}`,"error")}},realTimeTasks:K}):ie.jsx("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed border-gray-300",children:ie.jsx("p",{className:"text-gray-500",children:"No projects found for your account."})})]}),"clients"===h&&ie.jsx(nn,{users:s,roleFilter:Ft.CLIENT,onAddUser:me,projects:e,onSelectProject:e=>{f(e),j(null),w(!1),I(void 0)},onSelectTask:(e,t)=>{f(t),j(e),w(!0)}}),"vendors"===h&&ie.jsx(nn,{users:s,roleFilter:Ft.VENDOR,onAddUser:me,projects:e,onSelectProject:e=>{f(e),j(null),w(!1),I(void 0)},onSelectTask:(e,t)=>{f(t),j(e),w(!0)}}),"designers"===h&&ie.jsx(nn,{users:s,roleFilter:Ft.DESIGNER,onAddUser:me,projects:e,onSelectProject:e=>{f(e),j(null),w(!1),I(void 0)},onSelectTask:(e,t)=>{f(t),j(e),w(!0)}}),"admins"===h&&ie.jsx(nn,{users:s,roleFilter:Ft.ADMIN,onAddUser:me,projects:e,onSelectProject:e=>{f(e),j(null),w(!1),I(void 0)},onSelectTask:(e,t)=>{f(t),j(e),w(!0)}}),"settings"===h&&ie.jsx("div",{className:"w-full min-h-full",children:ie.jsxs("div",{className:"max-w-3xl mx-auto space-y-8 pb-12",children:[ie.jsxs("div",{children:[ie.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Settings"}),ie.jsx("p",{className:"text-gray-600",children:"Manage your account security and preferences"})]}),ie.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Account Information"}),ie.jsx("div",{className:"space-y-4",children:ie.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Name"}),ie.jsx("p",{className:"text-gray-900 font-medium",children:n.name})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Email"}),ie.jsx("p",{className:"text-gray-900 font-medium",children:n.email})]}),ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Role"}),ie.jsx("p",{className:"text-gray-900 font-medium capitalize",children:n.role})]}),n.phone&&ie.jsxs("div",{children:[ie.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Phone"}),ie.jsx("p",{className:"text-gray-900 font-medium",children:n.phone})]})]})})]}),n.role===Ft.ADMIN&&ie.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[ie.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Company Branding"}),ie.jsx("p",{className:"text-sm text-gray-600",children:"Customize your organization's brand name and logo"})]}),ie.jsxs("button",{type:"button",onClick:()=>W(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2",children:[ie.jsx(rt,{className:"w-4 h-4"}),"Edit Branding"]})]}),ie.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:ie.jsxs("div",{className:"flex items-center gap-3",children:[ie.jsx("img",{src:u,alt:x,className:"w-8 h-8 rounded"}),ie.jsx("span",{className:"font-medium text-gray-900",children:x})]})})]}),n.role===Ft.ADMIN&&ie.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:ie.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ie.jsxs("div",{children:[ie.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Firm Management"}),ie.jsx("p",{className:"text-sm text-gray-600",children:"Switch between your firms and manage partnerships"})]}),ie.jsxs("button",{type:"button",onClick:()=>G(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2",children:[ie.jsx(je,{className:"w-4 h-4"}),"Manage Firms"]})]})}),ie.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:ie.jsx(un,{})})]})})]})})]})})]}),L&&ie.jsx(gn,{users:s,onClose:()=>{F(!1),V(null)},onSave:e=>{},initialProject:z,selectedFirmId:X}),U&&ie.jsx(vn,{isOpen:U,onClose:()=>W(!1)}),_&&ie.jsx(yn,{isOpen:_,onClose:()=>G(!1)}),ie.jsx(jn,{})]})}class In extends a.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:ie.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:ie.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-red-100 p-6 max-w-md w-full",children:[ie.jsxs("div",{className:"flex items-center gap-3 mb-4 text-red-600",children:[ie.jsx(Se,{className:"w-8 h-8"}),ie.jsx("h2",{className:"text-xl font-bold",children:"Something went wrong"})]}),ie.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:"An unexpected error occurred while rendering this page."}),ie.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-100 mb-6 overflow-auto max-h-48",children:[ie.jsx("code",{className:"text-xs text-red-800 block whitespace-pre-wrap font-mono",children:this.state.error&&this.state.error.toString()}),this.state.errorInfo&&ie.jsxs("details",{className:"mt-2 text-xs text-red-700",children:[ie.jsx("summary",{className:"cursor-pointer font-semibold mb-1",children:"Stack Trace"}),ie.jsx("pre",{className:"whitespace-pre-wrap pl-2 border-l-2 border-red-200",children:this.state.errorInfo.componentStack})]})]}),ie.jsx("div",{className:"flex gap-3",children:ie.jsxs("button",{type:"button",onClick:()=>window.location.reload(),className:"flex-1 bg-gray-900 text-white px-4 py-2.5 rounded-lg flex items-center justify-center gap-2 font-medium hover:bg-gray-800 transition-colors",title:"Reload Application",children:[ie.jsx(ct,{className:"w-4 h-4"}),"Reload App"]})})]})}):this.props.children}}const Sn=document.getElementById("root");if(!Sn)throw new Error("Could not find root element to mount to");oe.createRoot(Sn).render(ie.jsx(In,{children:ie.jsx(wn,{})})),(async()=>{try{if(!window.capacitor&&!window.cordova)return;try{const{StatusBar:e,Style:t}=await ee(async()=>{const{StatusBar:e,Style:t}=await import("./index-yXAMf3Jx.js");return{StatusBar:e,Style:t}},__vite__mapDeps([0,1,2]));await e.setStyle({style:t.Dark}),await e.setBackgroundColor({color:"#111827"}),await e.setOverlaysWebView({overlay:!0})}catch(e){}}catch(Cn){}})().catch(e=>{});export{xr as r};
